import{e as G,r as k,j as e,X as ee,p as B,d as W,R as _e,B as Le,b as Q,U as pe,T as X,C as ce,S as Ce,c as te,F as Ne,u as Ue,h as Ae,I as xt,k as mt,f as Ie,l as ut,m as ht,n as bt,o as pt,q as gt,s as ft,g as jt,v as vt,P as Fe,w as Nt}from"./index-DLTjagqU.js";import{u as yt}from"./usePMOStore-DS52zjxl.js";import{G as wt}from"./grip-vertical-CstU-yNJ.js";import{f as T,s as Te}from"./format-uOgKDlBx.js";import{c as kt,E as Ct,S as St}from"./EnhancedResourceTimeline-CTh1wV7R.js";import{a as V}from"./addDays-D4wmfkaz.js";import{T as me}from"./target-DV1Y2p6C.js";import{D as Pe}from"./download-uSilePMs.js";import{A as ge}from"./index-CMKpIJ8t.js";import{m as O}from"./proxy-D-plNmX1.js";import{s as Se}from"./startOfMonth-C0LmOFGa.js";import{C as le}from"./calendar-CL0HZWKx.js";import{L as ie}from"./list-D-VOgiD7.js";import{N as Dt}from"./network-CTpn4u6q.js";import{P as xe}from"./plus-3jrXwcUn.js";import{C as Mt}from"./chevron-down-CIlHAhRm.js";import{C as Qe}from"./chevron-right-C5BQvsgd.js";import{C as zt}from"./circle-check-DjAyg8Eb.js";import{C as se}from"./clock-rSh1zfGn.js";import{Z as J}from"./zap-D58-BX3k.js";import{p as qe}from"./resourcePrediction-ByFp-xYh.js";import{a as Z,C as fe,B as ae}from"./Badge-BJpTdfkm.js";import{R as je,C as Je,X as Ze,Y as Ke,T as ve,a as $t,L as et}from"./generateCategoricalChart-DH5lPorQ.js";import{A as It,a as Pt}from"./AreaChart-DazUk6Yo.js";import{A as Me}from"./activity-BlMjTlla.js";import{D as K}from"./dollar-sign-6Xl0YCsZ.js";import{P as Bt,a as Rt,b as Lt,c as At}from"./PieChart-AeQHYWFc.js";import{L as Ft}from"./LineChart-BzLi5zpr.js";import{L as Tt}from"./Line-C9NpidXG.js";import{R as qt,P as Et,a as Gt}from"./RadarChart-DCSJ2vKt.js";import{T as Be}from"./trending-down-Qa0rh93Q.js";import{c as Ot,g as Ht,v as Ee,A as Ge}from"./scopeManagement-DCAZJBUs.js";import{P as Vt}from"./pen-CBqSd5D8.js";import{G as Xt}from"./git-branch-D9ZsBHhf.js";import"./endOfWeek-jaEUXgem.js";import"./addMonths-j2JIt22a.js";import"./endOfDay-BQMT-Byu.js";import"./eachDayOfInterval-CrgWC9rH.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=G("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=G("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=G("GitMerge",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=G("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=G("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=G("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=G("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=G("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=G("PanelLeftClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=G("PanelLeftOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=G("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=G("Redo2",[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=G("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=G("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=G("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=G("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=G("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),ls=({task:r,onSave:c,onDelete:s,onClose:i})=>{const[d,o]=k.useState(r),a=()=>{c(d),i()},t=()=>{s&&window.confirm("确定要删除这个任务吗？")&&(s(r.id),i())};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm",onClick:i,children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl shadow-2xl p-6 max-h-[90vh] overflow-y-auto",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"编辑任务"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(ee,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"任务名称"}),e.jsx("input",{type:"text",value:d.name,onChange:l=>o({...d,name:l.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"描述"}),e.jsx("textarea",{value:d.description||"",onChange:l=>o({...d,description:l.target.value}),rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"开始日期"}),e.jsx("input",{type:"date",value:d.startDate,onChange:l=>o({...d,startDate:l.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"结束日期"}),e.jsx("input",{type:"date",value:d.endDate,onChange:l=>o({...d,endDate:l.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"状态"}),e.jsxs("select",{value:d.status,onChange:l=>o({...d,status:l.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[e.jsx("option",{value:"planning",children:"规划中"}),e.jsx("option",{value:"active",children:"进行中"}),e.jsx("option",{value:"completed",children:"已完成"}),e.jsx("option",{value:"on-hold",children:"暂停"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"优先级"}),e.jsxs("select",{value:d.priority,onChange:l=>o({...d,priority:l.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[e.jsx("option",{value:"P0",children:"P0 - 紧急"}),e.jsx("option",{value:"P1",children:"P1 - 高"}),e.jsx("option",{value:"P2",children:"P2 - 中"}),e.jsx("option",{value:"P3",children:"P3 - 低"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"类型"}),e.jsxs("select",{value:d.type,onChange:l=>o({...d,type:l.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[e.jsx("option",{value:"task",children:"任务"}),e.jsx("option",{value:"milestone",children:"里程碑"}),e.jsx("option",{value:"group",children:"任务组"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["进度: ",d.progress||0,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:d.progress||0,onChange:l=>o({...d,progress:parseInt(l.target.value)}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"颜色"}),e.jsx("div",{className:"flex gap-2",children:["#3B82F6","#8B5CF6","#10B981","#F59E0B","#EF4444","#6B7280"].map(l=>e.jsx("button",{onClick:()=>o({...d,color:l}),className:`w-10 h-10 rounded-lg border-2 transition-all ${d.color===l?"border-slate-900 scale-110":"border-slate-200"}`,style:{backgroundColor:l}},l))})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-slate-200",children:[s&&e.jsx("button",{onClick:t,className:"px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:"删除任务"}),e.jsxs("div",{className:"flex gap-3 ml-auto",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:"取消"}),e.jsx("button",{onClick:a,className:"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors",children:"保存"})]})]})]})]})})},rs=({tasks:r,onTaskUpdate:c,onTaskClick:s})=>{const[i,d]=k.useState(null),o=[{id:"planning",label:"规划中",color:"bg-blue-50 border-blue-200"},{id:"active",label:"进行中",color:"bg-green-50 border-green-200"},{id:"completed",label:"已完成",color:"bg-purple-50 border-purple-200"},{id:"on-hold",label:"暂停",color:"bg-orange-50 border-orange-200"}],a=n=>r.filter(m=>(m.status||"planning")===n),t=(n,m)=>{d(m),n.dataTransfer.effectAllowed="move"},l=n=>{n.preventDefault(),n.dataTransfer.dropEffect="move"},h=(n,m)=>{n.preventDefault(),i&&i.status!==m&&c({...i,status:m}),d(null)};return e.jsx("div",{className:"h-full overflow-x-auto p-4 bg-slate-50",children:e.jsx("div",{className:"flex gap-4 min-w-max h-full",children:o.map(n=>{const m=a(n.id);return e.jsxs("div",{className:"flex-1 min-w-[300px] flex flex-col",onDragOver:l,onDrop:x=>h(x,n.id),children:[e.jsx("div",{className:`rounded-t-lg border-2 ${n.color} p-3 mb-2`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:n.label}),e.jsx("span",{className:"px-2 py-0.5 bg-white rounded-full text-xs font-medium text-slate-600",children:m.length})]})}),e.jsxs("div",{className:"flex-1 space-y-2 overflow-y-auto",children:[m.map(x=>e.jsx("div",{draggable:!0,onDragStart:w=>t(w,x),onClick:()=>s(x),className:`bg-white rounded-lg border border-slate-200 p-3 cursor-move hover:shadow-md transition-all ${(i==null?void 0:i.id)===x.id?"opacity-50":""}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(wt,{size:16,className:"text-slate-400 mt-1 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-slate-900 mb-1 truncate",children:x.name}),x.description&&e.jsx("p",{className:"text-xs text-slate-600 mb-2 line-clamp-2",children:x.description}),e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[x.priority&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${x.priority==="P0"?"bg-red-100 text-red-700":x.priority==="P1"?"bg-orange-100 text-orange-700":x.priority==="P2"?"bg-yellow-100 text-yellow-700":"bg-slate-100 text-slate-700"}`,children:x.priority}),x.type&&x.type!=="task"&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs font-medium",children:x.type==="milestone"?"里程碑":"任务组"})]}),e.jsxs("div",{className:"text-xs text-slate-500 mb-2",children:[T(B(x.startDate),"MM/dd")," - ",T(B(x.endDate),"MM/dd")]}),x.progress!==void 0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs text-slate-600",children:"进度"}),e.jsxs("span",{className:"text-xs font-medium text-slate-900",children:[x.progress,"%"]})]}),e.jsx("div",{className:"h-1.5 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${x.progress}%`,backgroundColor:x.color||"#3B82F6"}})})]})]})]})},x.id)),m.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 text-sm",children:"暂无任务"})]})]},n.id)})})})},He=180,be=80,Ve=250,ns=120,is=({tasks:r})=>{const[c,s]=k.useState(1),[i,d]=k.useState({x:50,y:50}),[o,a]=k.useState(!1),[t,l]=k.useState({x:0,y:0}),{nodes:h,edges:n,width:m,height:x}=k.useMemo(()=>{const y=kt(r),v=new Map,b=new Map,p=(N,z=new Set)=>{if(z.has(N))return 0;z.add(N);const f=r.find(R=>R.id===N);if(!f)return 0;const $=f.dependencies||[];if($.length===0)return 0;let D=-1;return $.forEach(R=>{D=Math.max(D,p(R,new Set(z)))}),D+1};r.forEach(N=>{const z=p(N.id),f=y.criticalPath.includes(N.id),$={id:N.id,task:N,x:0,y:0,width:He,height:be,level:z,isCritical:f};v.set(N.id,$),b.has(z)||b.set(z,[]),b.get(z).push($)});let j=0,S=0;b.forEach((N,z)=>{j=Math.max(j,z),N.sort(($,D)=>$.task.startDate.localeCompare(D.task.startDate));const f=50;N.forEach(($,D)=>{$.x=z*Ve,$.y=f+D*ns,S=Math.max(S,$.y+be)})});const g=[];return r.forEach(N=>{N.dependencies&&N.dependencies.forEach(z=>{if(v.has(z)){const f=y.criticalPath.includes(N.id)&&y.criticalPath.includes(z);g.push({from:z,to:N.id,isCritical:f})}})}),{nodes:Array.from(v.values()),edges:g,width:(j+1)*Ve+100,height:S+100}},[r]),w=y=>{a(!0),l({x:y.clientX-i.x,y:y.clientY-i.y})},P=y=>{o&&d({x:y.clientX-t.x,y:y.clientY-t.y})},A=()=>{a(!1)},C=y=>{if(y.ctrlKey||y.metaKey){y.preventDefault();const v=y.deltaY>0?.9:1.1;s(b=>Math.min(2,Math.max(.2,b*v)))}};return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 shadow-sm flex flex-col h-[600px]",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 bg-slate-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ut,{size:20,className:"text-blue-600"}),e.jsx("h3",{className:"font-semibold text-slate-900",children:"任务网络图 (PERT)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>s(y=>Math.max(.2,y-.1)),className:"p-2 hover:bg-slate-200 rounded text-slate-600",title:"缩小",children:e.jsx(at,{size:18})}),e.jsxs("span",{className:"text-sm text-slate-500 w-12 text-center",children:[Math.round(c*100),"%"]}),e.jsx("button",{onClick:()=>s(y=>Math.min(2,y+.1)),className:"p-2 hover:bg-slate-200 rounded text-slate-600",title:"放大",children:e.jsx(st,{size:18})}),e.jsx("button",{onClick:()=>{s(1),d({x:50,y:50})},className:"p-2 hover:bg-slate-200 rounded text-slate-600",title:"重置视图",children:e.jsx(Qt,{size:18})})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden relative cursor-grab active:cursor-grabbing bg-slate-50",onMouseDown:w,onMouseMove:P,onMouseUp:A,onMouseLeave:A,onWheel:C,children:e.jsxs("div",{style:{transform:`translate(${i.x}px, ${i.y}px) scale(${c})`,transformOrigin:"0 0",transition:o?"none":"transform 0.1s ease-out"},children:[e.jsxs("svg",{width:m,height:x,className:"pointer-events-none",children:[e.jsxs("defs",{children:[e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#94a3b8"})}),e.jsx("marker",{id:"arrowhead-critical",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#ef4444"})})]}),n.map((y,v)=>{const b=h.find(H=>H.id===y.from),p=h.find(H=>H.id===y.to),j=b.x+He,S=b.y+be/2,g=p.x,N=p.y+be/2,z=j+(g-j)/2,f=S,$=j+(g-j)/2,R=`M ${j} ${S} C ${z} ${f}, ${$} ${N}, ${g} ${N}`;return e.jsx("path",{d:R,stroke:y.isCritical?"#ef4444":"#94a3b8",strokeWidth:y.isCritical?3:2,fill:"none",markerEnd:y.isCritical?"url(#arrowhead-critical)":"url(#arrowhead)",strokeDasharray:y.isCritical?"none":"5,5"},v)})]}),h.map(y=>e.jsxs("div",{className:`absolute rounded-lg border-2 shadow-sm p-3 flex flex-col justify-between transition-colors hover:shadow-md pointer-events-auto ${y.isCritical?"bg-red-50 border-red-500":"bg-white border-slate-300 hover:border-blue-400"}`,style:{left:y.x,top:y.y,width:y.width,height:y.height},children:[e.jsx("div",{className:"font-medium text-sm text-slate-900 truncate",title:y.task.name,children:y.task.name}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500",children:[e.jsx("span",{children:y.task.startDate}),e.jsxs("span",{children:[W(B(y.task.endDate),B(y.task.startDate)),"天"]})]}),y.isCritical&&e.jsx("div",{className:"absolute -top-2 -right-2 w-4 h-4 bg-red-500 rounded-full border-2 border-white",title:"关键路径"})]},y.id))]})}),e.jsxs("div",{className:"p-2 bg-white border-t border-slate-200 flex gap-4 text-xs justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-white border-2 border-slate-300 rounded"}),e.jsx("span",{children:"普通任务"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-50 border-2 border-red-500 rounded"}),e.jsx("span",{children:"关键路径任务"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-slate-400 border-t border-dashed"}),e.jsx("span",{children:"依赖关系"})]})]})]})},de=48,ds=320,os=({tasks:r,milestones:c=[],onTaskUpdate:s,onTaskDelete:i,onTaskAdd:d,onMilestoneAdd:o,onMilestoneUpdate:a,onMilestoneDelete:t,onDependencyAdd:l,onDependencyDelete:h,onEditTask:n})=>{const m=k.useRef(null);k.useRef(null);const[x,w]=k.useState("Day"),[P,A]=k.useState(1),[C,y]=k.useState({x:0,y:0}),[v,b]=k.useState(!1),[p,j]=k.useState({x:0,y:0}),[S,g]=k.useState(new Set),[N,z]=k.useState(!0),[f,$]=k.useState(!0),[D,R]=k.useState(null),[H,ye]=k.useState(null),[_,ue]=k.useState(null);_e.useEffect(()=>{if(m.current){const u=U(new Date),M=m.current.clientWidth;y(I=>({...I,x:Math.max(0,u-M/3)}))}},[x]);const lt=()=>{var I;const u=U(new Date),M=((I=m.current)==null?void 0:I.clientWidth)||800;y(L=>({...L,x:Math.max(0,u-M/3)}))},{startDate:he,totalDays:we}=k.useMemo(()=>{if(r.length===0)return{startDate:Te(new Date),totalDays:30};const u=r.flatMap(E=>[new Date(E.startDate).getTime(),new Date(E.endDate).getTime()]),M=new Date(Math.min(...u)),I=new Date(Math.max(...u)),L=V(Te(M),-14),q=V(I,30);return{startDate:L,totalDays:W(q,L)}},[r]),Y=(()=>{switch(x){case"Week":return 25;case"Month":return 10;default:return 60}})()*P,U=u=>{const M=typeof u=="string"?B(u):u;return W(M,he)*Y},ke=(u,M,I)=>{u.stopPropagation(),ye({id:M.id,type:I,startX:u.clientX})},rt=u=>{var M;if(v){const I=u.clientX-p.x,L=u.clientY-p.y;y({x:Math.max(0,C.x-I),y:Math.max(0,C.y-L)}),j({x:u.clientX,y:u.clientY});return}if(H){const I=u.clientX-H.startX,L=Math.round(I/Y);if(L===0)return;const q=r.find(F=>F.id===H.id);if(!q)return;let E={...q};if(H.type==="move")E.startDate=V(B(q.startDate),L).toISOString(),E.endDate=V(B(q.endDate),L).toISOString();else if(H.type==="resize-l"){const F=V(B(q.startDate),L);F<B(q.endDate)&&(E.startDate=F.toISOString())}else{const F=V(B(q.endDate),L);F>B(q.startDate)&&(E.endDate=F.toISOString())}s(E),ye({...H,startX:u.clientX})}if(_){const I=(M=m.current)==null?void 0:M.getBoundingClientRect();I&&ue({..._,endX:u.clientX-I.left+C.x,endY:u.clientY-I.top+C.y})}},nt=u=>{(u.target===m.current||u.target.tagName==="svg")&&(b(!0),j({x:u.clientX,y:u.clientY}),R(null))},Re=()=>{b(!1),ye(null),ue(null)},it=(u,M)=>{var L;u.stopPropagation();const I=(L=m.current)==null?void 0:L.getBoundingClientRect();I&&ue({sourceId:M,endX:u.clientX-I.left+C.x,endY:u.clientY-I.top+C.y})},dt=(u,M)=>{_&&_.sourceId!==M&&(l==null||l(_.sourceId,M)),ue(null)},ot=u=>{if(u.ctrlKey){u.preventDefault();const M=u.deltaY>0?.9:1.1;A(I=>Math.max(.1,Math.min(3,I*M)))}else y({x:Math.max(0,C.x+u.deltaX),y:Math.max(0,C.y+u.deltaY)})},ct=()=>{const u=[];let M=Se(he);const I=V(he,we);for(;M<=I;)u.push(M),M=V(M,32),M=Se(M);return e.jsx("div",{className:"h-12 bg-white border-b flex-shrink-0 relative overflow-hidden z-20 shadow-sm select-none",children:e.jsx("div",{className:"absolute top-0 left-0 h-full",style:{transform:`translate(${-C.x}px, 0px)`,width:we*Y},children:e.jsx("div",{className:"h-1/2 border-b flex relative bg-slate-50 text-xs font-semibold text-slate-600",children:u.map((L,q)=>{const E=U(L),F=W(Se(V(L,32)),L)*Y;return e.jsx("div",{className:"absolute top-0 border-r flex items-center justify-center px-2 whitespace-nowrap overflow-hidden",style:{left:E,width:F,height:"100%"},children:T(L,"yyyy年 M月")},q)})})})})};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-50 border rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"h-12 bg-white border-b flex items-center px-4 justify-between z-40 relative shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>$(!f),className:`p-1.5 rounded-lg transition-colors ${f?"bg-blue-50 text-blue-600":"text-slate-500 hover:bg-slate-100"}`,title:f?"隐藏任务列表":"显示任务列表",children:f?e.jsx(Jt,{size:20}):e.jsx(Zt,{size:20})}),e.jsx("div",{className:"flex bg-slate-100 p-0.5 rounded-lg",children:["Day","Week","Month"].map(u=>e.jsx("button",{onClick:()=>w(u),className:`px-3 py-1 text-xs font-bold rounded-md transition-all flex items-center gap-1 ${x===u?"bg-white shadow-sm text-blue-600":"text-slate-500 hover:text-slate-700"}`,children:u==="Day"?"天 (d)":u==="Week"?"周 (w)":"月 (m)"},u))}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>A(u=>Math.max(.1,u-.1)),className:"p-1.5 hover:bg-slate-100 rounded text-slate-600",children:e.jsx(at,{size:18})}),e.jsxs("span",{className:"text-sm font-medium w-12 text-center text-slate-500",children:[(P*100).toFixed(0),"%"]}),e.jsx("button",{onClick:()=>A(u=>Math.min(3,u+.1)),className:"p-1.5 hover:bg-slate-100 rounded text-slate-600",children:e.jsx(st,{size:18})})]}),e.jsx("div",{className:"w-px h-6 bg-slate-200"}),e.jsx("button",{onClick:()=>z(!N),className:`p-1.5 rounded transition-colors ${N?"bg-blue-50 text-blue-600":"text-slate-600 hover:bg-slate-100"}`,title:"切换网格线",children:e.jsx(Wt,{size:18})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:lt,className:"px-3 py-1.5 bg-blue-600 text-white text-xs font-bold rounded-lg hover:bg-blue-700 shadow-sm transition-all flex items-center gap-1.5",children:[e.jsx(me,{size:14})," 跳转今天"]}),e.jsx("div",{className:"w-px h-6 bg-slate-200 mx-1"}),e.jsx("button",{className:"p-1.5 hover:bg-slate-100 rounded text-slate-600",children:e.jsx(ss,{size:18})}),e.jsx("button",{className:"p-1.5 hover:bg-slate-100 rounded text-slate-600",children:e.jsx(es,{size:18})}),e.jsx("div",{className:"w-px h-6 bg-slate-200 mx-1"}),e.jsx("button",{className:"p-1.5 hover:bg-slate-100 rounded text-slate-600",children:e.jsx(Pe,{size:18})})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[e.jsx(ge,{children:f&&e.jsxs(O.div,{initial:{width:0,opacity:0},animate:{width:ds,opacity:1},exit:{width:0,opacity:0},className:"bg-white border-r flex-shrink-0 flex flex-col z-30 shadow-[4px_0_12px_-2px_rgba(0,0,0,0.05)]",children:[e.jsxs("div",{className:"h-12 border-b bg-slate-50 flex items-center px-4 font-bold text-xs text-slate-500 uppercase tracking-wider",children:[e.jsx("div",{className:"flex-1",children:"任务名称"}),e.jsx("div",{className:"w-24 text-center",children:"周期"})]}),e.jsx("div",{className:"flex-1 overflow-hidden",onWheel:u=>{y(M=>({...M,y:Math.max(0,M.y+u.deltaY)}))},children:e.jsxs("div",{style:{transform:`translateY(${-C.y}px)`},className:"pt-4",children:[r.map((u,M)=>e.jsxs("div",{className:`h-[48px] px-4 flex items-center text-sm border-b border-slate-50 hover:bg-blue-50/50 transition-colors group cursor-pointer ${S.has(u.id)?"bg-blue-50":""}`,onClick:()=>g(new Set([u.id])),onDoubleClick:()=>n==null?void 0:n(u),children:[e.jsxs("div",{className:"flex-1 truncate font-medium text-slate-700",children:[e.jsx("span",{className:"text-blue-500 opacity-0 group-hover:opacity-100 mr-1.5",children:"●"}),u.name]}),e.jsxs("div",{className:"w-24 text-[10px] text-slate-400 font-mono text-center flex flex-col leading-tight",children:[e.jsx("span",{children:T(B(u.startDate),"MM/dd")}),e.jsx("span",{className:"opacity-40",children:"→"}),e.jsx("span",{children:T(B(u.endDate),"MM/dd")})]})]},u.id)),r.length===0&&e.jsx("div",{className:"p-8 text-center text-slate-400 text-xs",children:"列表为空"})]})})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden relative",children:[ct(),e.jsx("div",{className:"flex-1 relative overflow-hidden cursor-grab active:cursor-grabbing bg-slate-50",ref:m,onMouseDown:nt,onMouseMove:rt,onMouseUp:Re,onMouseLeave:Re,onWheel:ot,onContextMenu:u=>u.preventDefault(),children:e.jsxs("div",{className:"absolute top-0 left-0 transition-transform duration-75 ease-out",style:{transform:`translate(${-C.x}px, ${-C.y}px)`},children:[e.jsxs("div",{className:"absolute top-0 left-0 right-0 bottom-0 pointer-events-none z-0",children:[Array.from({length:we}).map((u,M)=>{const I=V(he,M);return I.getDay()!==0&&I.getDay()!==6?null:e.jsx("div",{className:"absolute top-0 bottom-0 bg-slate-200/20 shadow-inner",style:{left:M*Y,width:Y}},`weekend-${M}`)}),r.map((u,M)=>e.jsx("div",{className:`absolute left-0 right-0 h-[48px] border-b border-slate-100 ${M%2===1?"bg-slate-400/5":"bg-transparent"}`,style:{top:M*de+20}},`row-bg-${M}`)),e.jsxs("div",{className:"absolute top-0 bottom-0 border-l-2 border-red-500 z-10",style:{left:U(new Date)},children:[e.jsx("div",{className:"absolute top-0 -left-1.5 px-1.5 py-0.5 bg-red-500 text-white text-[9px] font-bold rounded-sm shadow-sm whitespace-nowrap",children:"今天"}),e.jsx("div",{className:"h-full w-px bg-red-500/20"})]})]}),e.jsxs("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none overflow-visible z-10",children:[e.jsx("defs",{children:e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#94a3b8"})})}),r.flatMap(u=>(u.dependencies||[]).map(M=>{const I=r.find(ne=>ne.id===M);if(!I)return null;const L=U(u.endDate)+Y,q=r.findIndex(ne=>ne.id===u.id)*de+20+16,E=U(I.startDate),F=r.findIndex(ne=>ne.id===I.id)*de+20+16;return e.jsx("path",{d:`M ${L} ${q} C ${L+30} ${q}, ${E-30} ${F}, ${E} ${F}`,stroke:"#cbd5e1",strokeWidth:"1.5",fill:"none",markerEnd:"url(#arrowhead)"},`${u.id}-${I.id}`)})),_&&(()=>{const u=r.find(L=>L.id===_.sourceId);if(!u)return null;const M=U(u.endDate)+Y,I=r.findIndex(L=>L.id===u.id)*de+20+16;return e.jsx("line",{x1:M,y1:I,x2:_.endX,y2:_.endY,stroke:"#3b82f6",strokeWidth:"2",strokeDasharray:"4 4",markerEnd:"url(#arrowhead)"})})()]}),e.jsxs("div",{className:"relative pt-4 pb-20 select-none z-20",children:[r.map((u,M)=>{const I=U(u.startDate),L=Math.max(Y,W(B(u.endDate),B(u.startDate))*Y+Y),q=M*de+20,E=S.has(u.id);return u.type==="milestone"?e.jsx(O.div,{className:`absolute cursor-pointer z-30 ${E?"ring-2 ring-blue-500 rounded-full scale-110 shadow-lg":"hover:scale-110"}`,style:{left:I-16,top:q-4},onClick:()=>g(new Set([u.id])),onDoubleClick:()=>n==null?void 0:n(u),children:e.jsxs("div",{className:"relative text-center group",children:[e.jsx("div",{className:"text-4xl drop-shadow-md",children:"⭐"}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-1 px-2 py-0.5 bg-amber-500 text-white text-[10px] font-bold rounded shadow-sm whitespace-nowrap z-50",children:u.name})]})},u.id):e.jsxs(O.div,{className:`absolute h-8 rounded-lg shadow-sm border border-black/5 flex items-center group overflow-hidden ${E?"ring-2 ring-blue-500 z-30 shadow-md":"hover:shadow-md z-20"}`,style:{left:I,width:L,top:q,backgroundColor:u.color||"#3b82f6"},onMouseDown:F=>ke(F,u,"move"),onDoubleClick:()=>n==null?void 0:n(u),onContextMenu:F=>{F.preventDefault(),R({x:F.clientX,y:F.clientY,taskId:u.id}),g(new Set([u.id]))},children:[e.jsx("div",{className:"absolute top-0 left-0 h-full bg-black/15 pointer-events-none transition-all duration-300",style:{width:`${u.progress||0}%`}}),e.jsxs("div",{className:"px-3 text-xs text-white font-bold truncate w-full flex items-center justify-between gap-2 z-10 pointer-events-none drop-shadow-sm",children:[e.jsx("span",{className:"truncate",children:u.name}),e.jsxs("span",{className:"text-[10px] opacity-90",children:[u.progress||0,"%"]})]}),e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 cursor-ew-resize hover:bg-white/30 z-20",onMouseDown:F=>ke(F,u,"resize-l")}),e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1.5 cursor-ew-resize hover:bg-white/30 z-20",onMouseDown:F=>ke(F,u,"resize-r")}),e.jsx("div",{className:"absolute -right-3 w-6 h-6 flex items-center justify-center cursor-crosshair opacity-0 group-hover:opacity-100 transition-opacity z-30",onMouseDown:F=>it(F,u.id),onMouseUp:()=>dt(null,u.id),children:e.jsx("div",{className:"w-2.5 h-2.5 bg-white border-2 border-blue-500 rounded-full shadow-sm"})})]},u.id)}),c.map(u=>{const M=U(u.date);return e.jsxs("div",{className:"absolute group cursor-pointer z-30",style:{left:M-12,top:10},children:[e.jsx("div",{className:"text-2xl drop-shadow-sm",children:"⭐"}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-1 px-2 py-0.5 bg-amber-500 text-white text-[10px] font-bold rounded shadow-sm whitespace-nowrap",children:u.name})]},u.id)})]})]})})]})]}),e.jsx(ge,{children:D&&e.jsxs("div",{className:"fixed bg-white shadow-2xl border border-slate-200 rounded-xl py-1.5 z-[100] w-40 overflow-hidden",style:{top:D.y,left:D.x},children:[e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-blue-50 transition-colors",onClick:()=>{n==null||n(r.find(u=>u.id===D.taskId)),R(null)},children:"编辑任务"}),e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors",onClick:()=>{i(D.taskId),R(null)},children:"删除任务"}),e.jsx("div",{className:"border-t border-slate-100 my-1"}),e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm text-slate-400 font-medium",onClick:()=>R(null),children:"取消操作"})]})})]})},cs=()=>{window.print()},xs=(r,c)=>{const s=["任务名称","描述","开始日期","结束日期","状态","优先级","类型","进度(%)"],i=r.map(t=>[t.name,t.description||"",t.startDate,t.endDate,t.status||"planning",t.priority||"P2",t.type||"task",(t.progress||0).toString()]),d=[s.join(","),...i.map(t=>t.map(l=>`"${l}"`).join(","))].join(`
`),o=new Blob(["\uFEFF"+d],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download=`${c}_tasks_${T(new Date,"yyyyMMdd")}.csv`,a.click()},ms=(r,c)=>{const s={projectName:c,exportDate:T(new Date,"yyyy-MM-dd HH:mm:ss"),tasks:r.map(a=>({id:a.id,name:a.name,description:a.description,startDate:a.startDate,endDate:a.endDate,status:a.status,priority:a.priority,type:a.type,progress:a.progress,color:a.color,dependencies:a.dependencies||[]}))},i=JSON.stringify(s,null,2),d=new Blob([i],{type:"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(d),o.download=`${c}_gantt_${T(new Date,"yyyyMMdd")}.json`,o.click()},us=(r,c)=>{const s=["资源名称","分配数量","总容量","利用率(%)","工期","预估成本(元)","技能要求","状态"],i=(r.resourceRequirements||[]).map(t=>{const l=c.find(w=>w.id===t.resourceId);if(!l)return null;const h=t.unit==="day"?t.duration:t.unit==="month"?t.duration*22:t.unit==="year"?t.duration*260:0,n=l.hourlyRate?l.hourlyRate*h*8*t.count:l.costPerUnit?l.costPerUnit*t.duration*t.count:0,m=t.count/l.totalQuantity*100,x=t.count>l.totalQuantity;return[l.name,t.count.toString(),l.totalQuantity.toString(),m.toFixed(1),`${t.duration}${t.unit==="day"?"天":t.unit==="month"?"月":"年"}`,n.toFixed(2),(t.requiredSkills||[]).join("; "),x?"超额":"正常"]}).filter(Boolean),d=[s.join(","),...i.map(t=>t.map(l=>`"${l}"`).join(","))].join(`
`),o=new Blob(["\uFEFF"+d],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download=`${r.name}_resources_${T(new Date,"yyyyMMdd")}.csv`,a.click()},hs=({tasks:r,projectName:c="Project",onTaskUpdate:s,onTaskAdd:i,onTaskDelete:d})=>{const[o,a]=k.useState("gantt"),[t,l]=k.useState("status"),[h,n]=k.useState(new Set(["active","planning"])),[m,x]=k.useState(null),[w,P]=k.useState(null),A=k.useMemo(()=>{const g={};return r.forEach(N=>{let z="ungrouped";switch(t){case"status":z=N.status||"planning";break;case"priority":z=N.priority||"P2";break;case"type":z=N.type||"task";break;default:z="all"}g[z]||(g[z]=[]),g[z].push(N)}),Object.keys(g).forEach(N=>{g[N].sort((z,f)=>{const $=B(z.startDate),D=B(f.startDate);return $.getTime()-D.getTime()})}),g},[r,t]),C=g=>{const N=new Set(h);N.has(g)?N.delete(g):N.add(g),n(N)},y=g=>t==="status"?{planning:{label:"规划中",color:"bg-blue-100 text-blue-700",icon:oe},active:{label:"进行中",color:"bg-green-100 text-green-700",icon:se},completed:{label:"已完成",color:"bg-purple-100 text-purple-700",icon:zt},"on-hold":{label:"暂停",color:"bg-orange-100 text-orange-700",icon:oe}}[g]||{label:g,color:"bg-slate-100 text-slate-700",icon:oe}:t==="priority"?{P0:{label:"紧急",color:"bg-red-100 text-red-700",icon:J},P1:{label:"高",color:"bg-orange-100 text-orange-700",icon:J},P2:{label:"中",color:"bg-yellow-100 text-yellow-700",icon:J},P3:{label:"低",color:"bg-slate-100 text-slate-700",icon:J}}[g]||{label:g,color:"bg-slate-100 text-slate-700",icon:J}:t==="type"?{task:{label:"任务",color:"bg-blue-100 text-blue-700",icon:ie},milestone:{label:"里程碑",color:"bg-purple-100 text-purple-700",icon:J},group:{label:"任务组",color:"bg-green-100 text-green-700",icon:Oe}}[g]||{label:g,color:"bg-slate-100 text-slate-700",icon:ie}:{label:"全部任务",color:"bg-slate-100 text-slate-700",icon:ie},v=(g,N)=>{P(N),g.dataTransfer.effectAllowed="move"},b=g=>{g.preventDefault(),g.dataTransfer.dropEffect="move"},p=(g,N)=>{if(g.preventDefault(),!w||w.id===N.id)return;const z=[...r],f=z.findIndex(D=>D.id===w.id),$=z.findIndex(D=>D.id===N.id);if(f!==-1&&$!==-1){const D=w.y||0,R=N.y||0;s({...w,y:R}),s({...N,y:D})}P(null)},j=()=>e.jsx("div",{className:"h-full overflow-hidden",children:e.jsx(os,{tasks:r,onTaskUpdate:s,onTaskDelete:d,onEditTask:x,onTaskAdd:g=>{const N={id:Date.now().toString(),name:"新任务",status:"planning",priority:"P2",progress:0,startDate:g.startDate||T(new Date,"yyyy-MM-dd"),endDate:g.endDate||T(V(new Date,2),"yyyy-MM-dd"),type:"task",dependencies:[],...g};i(N)}})}),S=()=>e.jsx("div",{className:"overflow-auto h-full p-4",children:Object.entries(A).map(([g,N])=>{const z=y(g),f=h.has(g),$=z.icon;return e.jsxs("div",{className:"mb-6",children:[t!=="none"&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 cursor-pointer",onClick:()=>C(g),children:[f?e.jsx(Mt,{size:18}):e.jsx(Qe,{size:18}),e.jsx($,{size:18}),e.jsx("h3",{className:"font-semibold text-slate-900",children:z.label}),e.jsxs("span",{className:"text-sm text-slate-500",children:["(",N.length,")"]})]}),(f||t==="none")&&e.jsx("div",{className:"space-y-2",children:N.map(D=>e.jsxs("div",{draggable:!0,onDragStart:R=>v(R,D),onDragOver:b,onDrop:R=>p(R,D),className:`bg-white rounded-lg border border-slate-200 p-4 hover:shadow-md transition-all cursor-move ${(w==null?void 0:w.id)===D.id?"opacity-50":""}`,onClick:()=>x(D),children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-medium text-slate-900",children:D.name}),D.priority&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${D.priority==="P0"?"bg-red-100 text-red-700":D.priority==="P1"?"bg-orange-100 text-orange-700":D.priority==="P2"?"bg-yellow-100 text-yellow-700":"bg-slate-100 text-slate-700"}`,children:D.priority})]}),D.description&&e.jsx("p",{className:"text-sm text-slate-600 mb-2",children:D.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(le,{size:12}),T(B(D.startDate),"yyyy-MM-dd")," - ",T(B(D.endDate),"yyyy-MM-dd")]}),D.progress!==void 0&&e.jsxs("span",{children:["进度: ",D.progress,"%"]})]})]})}),D.progress!==void 0&&e.jsx("div",{className:"mt-3 h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all",style:{width:`${D.progress}%`}})})]},D.id))})]},g)})});return e.jsxs("div",{className:"flex flex-col h-full bg-slate-50",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 p-4 shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex bg-slate-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>a("gantt"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${o==="gantt"?"bg-white text-slate-900 shadow-sm":"text-slate-600"}`,children:[e.jsx(le,{size:16,className:"inline mr-1"}),"时间总览"]}),e.jsxs("button",{onClick:()=>a("list"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${o==="list"?"bg-white text-slate-900 shadow-sm":"text-slate-600"}`,children:[e.jsx(ie,{size:16,className:"inline mr-1"}),"列表"]}),e.jsxs("button",{onClick:()=>a("board"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${o==="board"?"bg-white text-slate-900 shadow-sm":"text-slate-600"}`,children:[e.jsx(Oe,{size:16,className:"inline mr-1"}),"看板"]}),e.jsxs("button",{onClick:()=>a("network"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${o==="network"?"bg-white text-slate-900 shadow-sm":"text-slate-600"}`,children:[e.jsx(Dt,{size:16,className:"inline mr-1"}),"网络图"]})]}),o!=="board"&&o!=="network"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"分组:"}),e.jsxs("select",{value:t,onChange:g=>l(g.target.value),className:"px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"none",children:"不分组"}),e.jsx("option",{value:"status",children:"按状态"}),e.jsx("option",{value:"priority",children:"按优先级"}),e.jsx("option",{value:"type",children:"按类型"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mr-2 border-r border-slate-200 pr-3",children:[e.jsx("button",{onClick:()=>xs(r,c),className:"p-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",title:"导出 CSV",children:e.jsx(Pe,{size:18})}),e.jsx("button",{onClick:()=>ms(r,c),className:"p-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",title:"导出 JSON",children:e.jsx(ie,{size:18})}),e.jsx("button",{onClick:cs,className:"p-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",title:"打印",children:e.jsx(Kt,{size:18})})]}),e.jsxs("button",{onClick:()=>{const g={id:Date.now().toString(),name:"新任务",startDate:T(new Date,"yyyy-MM-dd"),endDate:T(V(new Date,7),"yyyy-MM-dd"),progress:0,type:"task",status:"planning",priority:"P2",color:"#3B82F6"};i(g)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(xe,{size:18}),"新建任务"]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[o==="gantt"&&j(),o==="list"&&S(),o==="board"&&e.jsx(rs,{tasks:r,onTaskUpdate:s,onTaskClick:x}),o==="network"&&e.jsx(is,{tasks:r})]}),m&&e.jsx(ls,{task:m,onSave:g=>{s(g),x(null)},onDelete:g=>{d(g),x(null)},onClose:()=>x(null)})]})},bs=({project:r,resourcePool:c})=>{const[s,i]=k.useState("details"),d=k.useMemo(()=>(r.resourceRequirements||[]).map(a=>{const t=c.find(x=>x.id===a.resourceId);if(!t)return null;const l=a.unit==="day"?a.duration:a.unit==="month"?a.duration*22:a.unit==="year"?a.duration*260:0,h=t.hourlyRate?t.hourlyRate*l*8*a.count:t.costPerUnit?t.costPerUnit*a.duration*a.count:0,n=t.totalQuantity,m=a.count/n*100;return{requirement:a,resource:t,workDays:l,estimatedCost:h,utilization:m,isOverAllocated:a.count>n}}).filter(Boolean),[r.resourceRequirements,c]),o=k.useMemo(()=>{const a=d.reduce((n,m)=>n+((m==null?void 0:m.estimatedCost)||0),0),t=d.reduce((n,m)=>n+((m==null?void 0:m.requirement.count)||0),0),l=d.filter(n=>n==null?void 0:n.isOverAllocated).length,h=d.length>0?d.reduce((n,m)=>n+((m==null?void 0:m.utilization)||0),0)/d.length:0;return{totalCost:a,totalHeadcount:t,overAllocatedCount:l,avgUtilization:h}},[d]);return e.jsx("div",{className:"h-full overflow-auto p-6 bg-slate-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex bg-white rounded-lg border border-slate-200 p-1",children:[e.jsx("button",{onClick:()=>i("details"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${s==="details"?"bg-slate-100 text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"分配详情"}),e.jsx("button",{onClick:()=>i("timeline"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${s==="timeline"?"bg-slate-100 text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"时间线"}),e.jsx("button",{onClick:()=>i("prediction"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${s==="prediction"?"bg-slate-100 text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"预测分析 (AI)"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>us(r,c),className:"flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors",children:[e.jsx(Pe,{size:18}),"导出报表"]})})]}),s==="timeline"&&e.jsx("div",{className:"bg-white rounded-lg border border-slate-200 p-4 h-[400px] animate-in fade-in duration-300",children:e.jsx(Ct,{resources:c,projects:[r]})}),s==="prediction"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-indigo-600",children:[e.jsx(Le,{size:20}),e.jsx("h3",{className:"font-bold text-lg",children:"人力平衡预测趋势"})]}),e.jsx("div",{className:"h-[300px]",children:e.jsx(je,{width:"100%",height:"100%",children:e.jsxs(It,{data:(()=>{const a=r.resourceRequirements||[],t={};return a.forEach(l=>{const h=c.find(n=>n.id===l.resourceId);h&&qe(h,[r],6).predictions.forEach(m=>{t[m.month]||(t[m.month]={month:m.month}),t[m.month][h.name]=m.predicted})}),Object.values(t).sort((l,h)=>l.month.localeCompare(h.month))})(),children:[e.jsx(Je,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(Ze,{dataKey:"month",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#64748b"}}),e.jsx(Ke,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#64748b"}}),e.jsx(ve,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.1)"}}),(r.resourceRequirements||[]).map((a,t)=>{const l=c.find(n=>n.id===a.resourceId);if(!l)return null;const h=["#6366f1","#10b981","#f59e0b","#ef4444","#8b5cf6"];return e.jsx(Pt,{type:"monotone",dataKey:l.name,stroke:h[t%h.length],fill:h[t%h.length],fillOpacity:.1,strokeWidth:2},a.resourceId)})]})})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-amber-600",children:[e.jsx(Q,{size:20}),e.jsx("h3",{className:"font-bold text-lg",children:"风险洞察与干预建议"})]}),e.jsx("div",{className:"space-y-4",children:(()=>{const a=[];return(r.resourceRequirements||[]).forEach(l=>{const h=c.find(n=>n.id===l.resourceId);if(h){const n=qe(h,[r],6);n.peakLoad>h.totalQuantity&&a.push(`【${h.name}】风险：预计在 ${n.peakMonth} 出现缺口，峰值负载指数达 ${(n.peakLoad/h.totalQuantity*100).toFixed(0)}%。`),n.trend==="increasing"&&a.push(`【${h.name}】预判：需求呈持续上升趋势，建议在第二季度末启动人才储备或外包补位。`)}}),a.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(Me,{className:"mx-auto text-emerald-500 mb-3 opacity-20",size:48}),e.jsx("p",{className:"text-slate-500 text-sm italic",children:"当前项目资源平衡在预测周期内表现优异，暂无缺口风险。"})]}):a.map((l,h)=>e.jsx("div",{className:"group p-4 bg-slate-50 hover:bg-white dark:bg-slate-800/50 rounded-xl border border-slate-100 dark:border-slate-700 hover:border-amber-200 transition-all cursor-default",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/30 text-amber-600 rounded-lg h-fit",children:e.jsx(Le,{size:16})}),e.jsx("p",{className:"text-sm text-slate-700 leading-relaxed font-medium",children:l})]})},h))})()})]})]}),s==="details"&&e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{size:20,className:"text-blue-600"}),e.jsx("span",{className:"text-sm text-slate-600 font-medium",children:"总人力投入"})]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:o.totalHeadcount}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"项目累计分配人数"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(X,{size:20,className:"text-green-600"}),e.jsx("span",{className:"text-sm text-slate-600 font-medium",children:"资源平均利用率"})]}),e.jsxs("div",{className:"text-2xl font-bold text-slate-900",children:[o.avgUtilization.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"当前周期占用负荷"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(le,{size:20,className:"text-purple-600"}),e.jsx("span",{className:"text-sm text-slate-600 font-medium",children:"预估人力成本"})]}),e.jsxs("div",{className:"text-2xl font-bold text-slate-900",children:["¥",(o.totalCost/1e4).toFixed(1),"万"]}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"基于岗位单价核算"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.overAllocatedCount>0?e.jsx(Q,{size:20,className:"text-red-600"}):e.jsx(ce,{size:20,className:"text-green-600"}),e.jsx("span",{className:"text-sm text-slate-600 font-medium",children:"资源调度状态"})]}),e.jsx("div",{className:`text-2xl font-bold ${o.overAllocatedCount>0?"text-red-600":"text-green-600"}`,children:o.overAllocatedCount>0?"资源告警":"运行正常"}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:o.overAllocatedCount>0?`当前有 ${o.overAllocatedCount} 项分配冲突`:"暂无冲突风险"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm",children:[e.jsx("div",{className:"p-4 border-b border-slate-200 bg-slate-50/50",children:e.jsx("h3",{className:"font-bold text-slate-900",children:"人力资源明细清单"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50/80 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"资源名称"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"分配数量"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"岗位容量"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"实时利用率"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"工期单位"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"总工作日"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"人力成本"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"状态"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:d.map((a,t)=>e.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center",children:e.jsx(pe,{size:16,className:"text-blue-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-slate-900",children:a.resource.name}),a.resource.hourlyRate&&e.jsxs("div",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-tight",children:["¥",a.resource.hourlyRate,"/HOUR"]})]})]})}),e.jsx("td",{className:"px-4 py-3 font-bold text-slate-900",children:a.requirement.count}),e.jsx("td",{className:"px-4 py-3 text-slate-500",children:a.resource.totalQuantity}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-slate-100 rounded-full overflow-hidden max-w-[80px]",children:e.jsx("div",{className:`h-full rounded-full ${a.utilization>100?"bg-red-500":a.utilization>80?"bg-yellow-500":"bg-emerald-500"}`,style:{width:`${Math.min(a.utilization,100)}%`}})}),e.jsxs("span",{className:`text-xs font-black ${a.utilization>100?"text-red-600":a.utilization>80?"text-yellow-600":"text-emerald-600"}`,children:[a.utilization.toFixed(0),"%"]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-slate-600",children:[a.requirement.duration," ",a.requirement.unit==="day"?"天":a.requirement.unit==="month"?"月":a.requirement.unit==="year"?"年":""]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-slate-600 font-medium",children:[a.workDays,"天"]}),e.jsxs("td",{className:"px-4 py-3 font-bold text-slate-900",children:["¥",(a.estimatedCost/1e4).toFixed(2),"万"]}),e.jsx("td",{className:"px-4 py-3",children:a.isOverAllocated?e.jsx(Z,{variant:"danger",size:"sm",children:"超额"}):e.jsx(Z,{variant:"success",size:"sm",children:"正常"})})]},t))})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[e.jsx("h3",{className:"font-bold text-slate-900 mb-6 border-l-4 border-indigo-500 pl-3",children:"资源岗位技能适配度"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:d.map((a,t)=>{if(!a||!a.resource.skills)return null;const l=a.requirement.requiredSkills||[],h=a.resource.skills.map(x=>x.name),n=l.filter(x=>h.includes(x)),m=l.length>0?n.length/l.length*100:100;return e.jsxs("div",{className:"bg-slate-50/50 rounded-xl p-4 border border-slate-100 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-bold text-slate-900",children:a.resource.name}),e.jsxs("div",{className:`px-2 py-1 rounded-full text-[10px] font-black tracking-widest uppercase ${m===100?"bg-emerald-100 text-emerald-700":m>=50?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:["MATCH ",m.toFixed(0),"%"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-slate-400 font-bold uppercase mb-2",children:"项目需求项:"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:l.length>0?l.map((x,w)=>e.jsx("span",{className:`px-2 py-0.5 text-[11px] font-medium rounded-md ${n.includes(x)?"bg-emerald-50 text-emerald-700 border border-emerald-100":"bg-red-50 text-red-700 border border-red-100"}`,children:x},w)):e.jsx("span",{className:"text-xs text-slate-400 italic",children:"常规基础技能"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-slate-400 font-bold uppercase mb-2",children:"人才画像特征:"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:a.resource.skills.map((x,w)=>e.jsxs("span",{className:"px-2 py-0.5 bg-blue-50 text-blue-700 text-[11px] font-medium rounded-md border border-blue-100",children:[x.name," · ",x.level]},w))})]})]})]},t)})})]}),o.totalCost>(r.budget||0)&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-6 shadow-sm border-l-8 border-l-red-500",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-white rounded-xl shadow-sm text-red-600",children:e.jsx(Q,{size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-red-900 text-lg mb-1",children:"人力资本预算超支预警"}),e.jsxs("p",{className:"text-sm text-red-800/80 leading-relaxed font-medium",children:["当前预估人力成本 ¥",(o.totalCost/1e4).toFixed(2),"万 已超出项目初期核准预算 ¥",((r.budget||0)/1e4).toFixed(2),"万。",e.jsxs("span",{className:"block mt-2 font-bold underline decoration-2 underline-offset-4 decoration-red-300",children:["当前缺口规模：¥",((o.totalCost-(r.budget||0))/1e4).toFixed(2),"万，建议优先审视 P2 级以下资源岗位。"]})]})]})]})})]})]})})},ps=({project:r,risks:c,onRisksChange:s,onClose:i})=>{const[d,o]=k.useState("all"),[a,t]=k.useState(!1),[l,h]=k.useState({category:"schedule",probability:3,impact:3,status:"identified",owner:"",mitigationStrategy:""}),n=[{id:"all",label:"全部",icon:Ce,color:"slate"},{id:"schedule",label:"进度",icon:se,color:"blue"},{id:"cost",label:"成本",icon:K,color:"green"},{id:"resource",label:"资源",icon:pe,color:"purple"},{id:"technical",label:"技术",icon:X,color:"orange"},{id:"external",label:"外部",icon:te,color:"red"}],m=b=>b.probability*b.impact,x=b=>b>=20?{label:"极高",color:"text-red-700",bgColor:"bg-red-50 border-red-200",darkColor:"text-red-400",darkBgColor:"dark:bg-red-900/20 dark:border-red-800"}:b>=15?{label:"高",color:"text-orange-700",bgColor:"bg-orange-50 border-orange-200",darkColor:"text-orange-400",darkBgColor:"dark:bg-orange-900/20 dark:border-orange-800"}:b>=10?{label:"中",color:"text-yellow-700",bgColor:"bg-yellow-50 border-yellow-200",darkColor:"text-yellow-400",darkBgColor:"dark:bg-yellow-900/20 dark:border-yellow-800"}:b>=5?{label:"低",color:"text-blue-700",bgColor:"bg-blue-50 border-blue-200",darkColor:"text-blue-400",darkBgColor:"dark:bg-blue-900/20 dark:border-blue-800"}:{label:"极低",color:"text-slate-700",bgColor:"bg-slate-50 border-slate-200",darkColor:"text-slate-400",darkBgColor:"dark:bg-slate-700/50 dark:border-slate-700"},w=k.useMemo(()=>{if(c.length===0)return{score:0,level:x(0)};const b=c.filter(S=>S.status!=="resolved"),j=b.reduce((S,g)=>S+m(g),0)/b.length;return{score:j,level:x(j)}},[c]),P=d==="all"?c:c.filter(b=>b.category===d),A=k.useMemo(()=>{const b={极高:[],高:[],中:[],低:[],极低:[]};return P.forEach(p=>{const j=m(p),S=x(j);b[S.label].push(p)}),b},[P]),C=()=>{if(!l.title||!l.description){alert("请填写风险标题和描述");return}const b=(l.probability||3)*(l.impact||3),p=b>=20?"critical":b>=15?"high":b>=10?"medium":"low",j={id:`risk-${Date.now()}`,projectId:r.id,category:l.category,title:l.title,description:l.description,probability:l.probability||3,impact:l.impact||3,riskScore:b,priority:p,mitigationStrategy:l.mitigationStrategy||"",mitigationActions:[],owner:l.owner||"",ownerName:l.owner||"",status:"identified",identifiedDate:new Date().toISOString(),history:[{id:`hist-${Date.now()}`,date:new Date().toISOString(),userId:"current-user",userName:"Admin",action:"created",description:"风险已创建"}]};s([...c,j]),h({category:"schedule",probability:3,impact:3,status:"identified",owner:"",mitigationStrategy:""}),t(!1)},y=b=>{s(c.filter(p=>p.id!==b))},v=(b,p)=>{s(c.map(j=>j.id===b?{...j,status:p}:j))};return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Ce,{size:32,className:"text-blue-600 dark:text-blue-400"}),e.jsx("h2",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100",children:"风险评估"})]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["项目: ",r.name]})]}),e.jsxs("div",{className:`px-6 py-4 rounded-xl border-2 ${w.level.bgColor} ${w.level.darkBgColor}`,children:[e.jsx("div",{className:"text-xs font-semibold text-slate-600 dark:text-slate-400 mb-1",children:"综合风险等级"}),e.jsx("div",{className:`text-3xl font-bold ${w.level.color} ${w.level.darkColor}`,children:w.level.label}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["评分: ",w.score.toFixed(1)," / 25"]})]}),i&&e.jsx("button",{onClick:i,className:"ml-4 p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(ee,{size:24})})]}),e.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2 no-scrollbar",children:n.map(b=>{const p=b.icon,j=b.id==="all"?c.length:c.filter(z=>z.category===b.id).length,S=d===b.id,g={slate:"bg-slate-600 text-white shadow-md",blue:"bg-blue-600 text-white shadow-md",green:"bg-green-600 text-white shadow-md",purple:"bg-purple-600 text-white shadow-md",orange:"bg-orange-600 text-white shadow-md",red:"bg-red-600 text-white shadow-md"},N={slate:"bg-slate-100 text-slate-700 hover:bg-slate-200 dark:bg-slate-800 dark:text-slate-300",blue:"bg-blue-100 text-blue-700 hover:bg-blue-200 dark:bg-blue-900/30 dark:text-blue-400",green:"bg-green-100 text-green-700 hover:bg-green-200 dark:bg-green-900/30 dark:text-green-400",purple:"bg-purple-100 text-purple-700 hover:bg-purple-200 dark:bg-purple-900/30 dark:text-purple-400",orange:"bg-orange-100 text-orange-700 hover:bg-orange-200 dark:bg-orange-900/30 dark:text-orange-400",red:"bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900/30 dark:text-red-400"};return e.jsxs("button",{onClick:()=>o(b.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap ${S?g[b.color]:N[b.color]}`,children:[e.jsx(p,{size:16}),e.jsx("span",{children:b.label}),e.jsx("span",{className:`ml-1 px-2 py-0.5 rounded-full text-xs ${S?"bg-white/20":"bg-slate-200 dark:bg-slate-700"}`,children:j})]},b.id)})}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>t(!a),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors shadow-lg",children:[e.jsx(xe,{size:18}),"添加风险"]})}),a&&e.jsxs("div",{className:"mb-6 p-6 bg-blue-50 rounded-xl border-2 border-blue-200",children:[e.jsx("h3",{className:"font-bold text-slate-900 mb-4",children:"新增风险"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"风险类别"}),e.jsxs("select",{value:l.category,onChange:b=>h({...l,category:b.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"schedule",children:"进度风险"}),e.jsx("option",{value:"cost",children:"成本风险"}),e.jsx("option",{value:"resource",children:"资源风险"}),e.jsx("option",{value:"technical",children:"技术风险"}),e.jsx("option",{value:"external",children:"外部风险"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"负责人"}),e.jsx("input",{type:"text",value:l.owner||"",onChange:b=>h({...l,owner:b.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"风险负责人"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"风险标题"}),e.jsx("input",{type:"text",value:l.title||"",onChange:b=>h({...l,title:b.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"简要描述风险"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"风险描述"}),e.jsx("textarea",{value:l.description||"",onChange:b=>h({...l,description:b.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"详细描述风险情况"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["发生概率 (1-5): ",l.probability]}),e.jsx("input",{type:"range",min:"1",max:"5",value:l.probability,onChange:b=>h({...l,probability:parseInt(b.target.value)}),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:"极低"}),e.jsx("span",{children:"极高"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["影响程度 (1-5): ",l.impact]}),e.jsx("input",{type:"range",min:"1",max:"5",value:l.impact,onChange:b=>h({...l,impact:parseInt(b.target.value)}),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:"极低"}),e.jsx("span",{children:"极高"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"缓解措施"}),e.jsx("textarea",{value:l.mitigationStrategy||"",onChange:b=>h({...l,mitigationStrategy:b.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2,placeholder:"如何降低或消除此风险"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:C,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:"添加"}),e.jsx("button",{onClick:()=>t(!1),className:"px-6 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg transition-colors",children:"取消"})]})]}),e.jsxs("div",{className:"space-y-6",children:[Object.entries(A).map(([b,p])=>{if(p.length===0)return null;const j=x(b==="极高"?25:b==="高"?18:b==="中"?12:b==="低"?7:3);return e.jsxs("div",{children:[e.jsxs("h3",{className:`font-bold text-lg mb-3 ${j.color}`,children:[b,"风险 (",p.length,")"]}),e.jsx("div",{className:"space-y-3",children:p.map(S=>{var z;const g=m(S),N=x(g);return e.jsxs("div",{className:`p-5 rounded-xl border-2 ${N.bgColor} ${N.darkBgColor} transition-all hover:shadow-lg`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-bold text-lg text-slate-900 dark:text-slate-100",children:S.title}),e.jsx("span",{className:`text-xs font-semibold px-2 py-1 rounded uppercase ${N.color} ${N.darkColor} ${N.bgColor} ${N.darkBgColor}`,children:N.label}),e.jsx("span",{className:"text-xs bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 px-2 py-1 rounded",children:(z=n.find(f=>f.id===S.category))==null?void 0:z.label})]}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 mb-2",children:S.description}),S.mitigationStrategy&&e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400 bg-white/50 dark:bg-black/20 p-2 rounded",children:[e.jsx("strong",{children:"缓解措施:"})," ",S.mitigationStrategy]})]}),e.jsx("button",{onClick:()=>y(S.id),className:"ml-4 p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",children:e.jsx(ee,{size:18})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"概率:"}),e.jsxs("span",{className:"ml-2 font-bold",children:[S.probability,"/5"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"影响:"}),e.jsxs("span",{className:"ml-2 font-bold",children:[S.impact,"/5"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"评分:"}),e.jsxs("span",{className:"ml-2 font-bold",children:[g,"/25"]})]}),S.owner&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"负责人:"}),e.jsx("span",{className:"ml-2 font-medium",children:S.owner})]})]}),e.jsxs("select",{value:S.status,onChange:f=>v(S.id,f.target.value),className:"px-3 py-1 rounded-lg border border-slate-300 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"identified",children:"已识别"}),e.jsx("option",{value:"mitigating",children:"缓解中"}),e.jsx("option",{value:"resolved",children:"已解决"})]})]})]},S.id)})})]},b)}),P.length===0&&e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(Ce,{size:64,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"暂无风险记录"})]})]})]})},gs=({projectName:r,budget:c,existingCosts:s=[],onSave:i,onClose:d})=>{const[o,a]=k.useState(c||0),[t,l]=k.useState(s),[h,n]=k.useState({date:new Date().toISOString().split("T")[0],amount:0,category:"labor",description:""}),m=[{id:"labor",label:"人力成本",color:"#3b82f6"},{id:"equipment",label:"设备成本",color:"#8b5cf6"},{id:"materials",label:"材料成本",color:"#10b981"},{id:"overhead",label:"管理费用",color:"#f59e0b"},{id:"other",label:"其他",color:"#6b7280"}],x=t.reduce((p,j)=>p+j.amount,0),w=o-x,P=o>0?x/o*100:0,A=m.map(p=>({name:p.label,value:t.filter(j=>j.category===p.id).reduce((j,S)=>j+S.amount,0),color:p.color})).filter(p=>p.value>0),C=t.sort((p,j)=>new Date(p.date).getTime()-new Date(j.date).getTime()).reduce((p,j)=>{const S=p.find(g=>g.date===j.date);if(S)S.amount+=j.amount;else{const g=p.length>0?p[p.length-1].cumulative:0;p.push({date:j.date,amount:j.amount,cumulative:g+j.amount})}return p},[]),y=()=>{if(h.amount&&h.amount>0&&h.description){const p={id:Date.now().toString(),date:h.date,amount:h.amount,category:h.category,description:h.description};l([...t,p]),n({date:new Date().toISOString().split("T")[0],amount:0,category:"labor",description:""})}},v=p=>{l(t.filter(j=>j.id!==p))},b=()=>{i(t,o),d()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"成本登记"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["项目: ",r]})]}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(ee,{size:24,className:"text-slate-500"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-6 text-white",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-blue-100",children:"项目预算"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{size:24}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:o,onChange:p=>a(parseFloat(p.target.value)||0),className:"flex-1 px-4 py-3 rounded-lg bg-white/20 backdrop-blur border border-white/30 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50 text-xl font-bold",placeholder:"输入预算金额"}),e.jsx("span",{className:"text-xl font-bold",children:"元"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-lg p-3",children:[e.jsx("div",{className:"text-blue-100",children:"已用"}),e.jsxs("div",{className:"font-bold text-lg",children:["¥",x.toLocaleString()]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-lg p-3",children:[e.jsx("div",{className:"text-blue-100",children:"剩余"}),e.jsxs("div",{className:`font-bold text-lg ${w<0?"text-red-300":""}`,children:["¥",w.toLocaleString()]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-lg p-3",children:[e.jsx("div",{className:"text-blue-100",children:"使用率"}),e.jsxs("div",{className:`font-bold text-lg ${P>100?"text-red-300":""}`,children:[P.toFixed(1),"%"]})]})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900 rounded-xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-4 flex items-center gap-2",children:[e.jsx(xe,{size:20}),"添加成本记录"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"日期"}),e.jsx("input",{type:"date",value:h.date,onChange:p=>n({...h,date:p.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"金额"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:h.amount,onChange:p=>n({...h,amount:parseFloat(p.target.value)}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"类别"}),e.jsx("select",{value:h.category,onChange:p=>n({...h,category:p.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500",children:m.map(p=>e.jsx("option",{value:p.id,children:p.label},p.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"说明"}),e.jsx("textarea",{value:h.description,onChange:p=>n({...h,description:p.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:2,placeholder:"描述此项成本..."})]}),e.jsxs("button",{onClick:y,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx(xe,{size:18}),"添加记录"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 flex items-center gap-2",children:[e.jsx(Ne,{size:20}),"成本记录 (",t.length,")"]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:t.length===0?e.jsx("div",{className:"p-8 text-center text-slate-400",children:"暂无成本记录"}):e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:t.map(p=>{const j=m.find(S=>S.id===p.category);return e.jsx("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors group",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${j==null?void 0:j.color}20`,color:j==null?void 0:j.color},children:j==null?void 0:j.label}),e.jsx("span",{className:"text-xs text-slate-400",children:p.date})]}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 mb-1",children:p.description}),e.jsxs("div",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:["¥",p.amount.toLocaleString()]})]}),e.jsx("button",{onClick:()=>v(p.id),className:"opacity-0 group-hover:opacity-100 p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all",children:e.jsx(ee,{size:16})})]})},p.id)})})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-4",children:"成本构成"}),A.length>0?e.jsx(je,{width:"100%",height:250,children:e.jsxs(Bt,{children:[e.jsx(Rt,{data:A,cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:5,dataKey:"value",label:({name:p,percent:j})=>`${p} ${((j||0)*100).toFixed(0)}%`,children:A.map((p,j)=>e.jsx($t,{fill:p.color},`cell-${j}`))}),e.jsx(ve,{formatter:p=>`¥${p.toLocaleString()}`})]})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-slate-400",children:"暂无数据"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-4",children:"成本趋势"}),C.length>0?e.jsx(je,{width:"100%",height:250,children:e.jsxs(Ft,{data:C,children:[e.jsx(Je,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(Ze,{dataKey:"date",tick:{fill:"#64748b",fontSize:12}}),e.jsx(Ke,{tick:{fill:"#64748b",fontSize:12}}),e.jsx(ve,{formatter:p=>`¥${p.toLocaleString()}`}),e.jsx(et,{}),e.jsx(Tt,{type:"monotone",dataKey:"cumulative",stroke:"#3b82f6",strokeWidth:2,name:"累计成本",dot:{fill:"#3b82f6",r:4}})]})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-slate-400",children:"暂无数据"})]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-slate-200 dark:border-slate-700 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:["总计: ",e.jsxs("strong",{className:"text-slate-900 dark:text-slate-100 text-lg",children:["¥",x.toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:d,className:"px-6 py-2 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg font-medium transition-colors",children:"取消"}),e.jsx("button",{onClick:b,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors shadow-lg shadow-blue-600/20",children:"保存成本数据"})]})]})]})})},fs=({project:r,onUpdate:c})=>{const{factorDefinitions:s}=Ue(),i=r.factors||{},{totalScore:d,maxPossibleScore:o,normalizedScore:a}=k.useMemo(()=>{const n=Ae(i,s);return{totalScore:n,maxPossibleScore:10,normalizedScore:n*10}},[i,s]),t=(n,m)=>{const x={...i,[n]:m},w=Ae(x,s);c({factors:x,score:w})},h=(n=>n>=80?"text-green-600 bg-green-50 border-green-200":n>=60?"text-blue-600 bg-blue-50 border-blue-200":n>=40?"text-orange-600 bg-orange-50 border-orange-200":"text-red-600 bg-red-50 border-red-200")(a);return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full p-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:`p-6 rounded-2xl border-2 ${h} flex flex-col items-center justify-center text-center shadow-sm`,children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-700 mb-2",children:"项目战略评分"}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx("span",{className:"text-6xl font-black tracking-tighter",children:a.toFixed(0)}),e.jsx("span",{className:"text-sm font-medium text-slate-500 absolute -top-1 -right-6",children:"/100"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm font-medium opacity-80",children:[a>=80&&e.jsxs(e.Fragment,{children:[e.jsx(X,{size:16})," 极具潜力"]}),a>=60&&a<80&&e.jsxs(e.Fragment,{children:[e.jsx(me,{size:16})," 值得关注"]}),a<60&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:16})," 需重新评估"]})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-xl border border-slate-200 shadow-sm",children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(xt,{size:16,className:"text-blue-500"}),"评分说明"]}),e.jsx("p",{className:"text-sm text-slate-500 leading-relaxed",children:"该评分用于评估项目的战略价值和优先级。 请根据下方定义的各项影响因素，为本项目进行打分（0-10分）。 系统将根据设定的权重自动计算最终得分。"})]})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(St,{size:18,className:"text-slate-500"}),"评分因素配置"]}),e.jsxs("span",{className:"text-xs font-medium text-slate-500 bg-slate-200 px-2 py-1 rounded",children:["共 ",s.length," 项指标"]})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1 space-y-6",children:s.length===0?e.jsxs("div",{className:"text-center py-10 text-slate-400",children:[e.jsx("p",{children:"尚未定义评分因素。"}),e.jsx("p",{className:"text-sm mt-2",children:'请前往 "设置" 页面配置评分模型。'})]}):s.map(n=>{const m=i[n.id]||0;return e.jsxs(O.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"group",children:[e.jsxs("div",{className:"flex justify-between items-end mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-slate-800",children:n.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:["权重: ",n.weight,"%"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`text-2xl font-bold ${m>8?"text-green-600":m>5?"text-blue-600":"text-slate-400"}`,children:m}),e.jsx("span",{className:"text-xs text-slate-400",children:" / 10"})]})]}),e.jsxs("div",{className:"relative h-6 flex items-center",children:[e.jsx("input",{type:"range",min:"0",max:"10",step:"1",value:m,onChange:x=>t(n.id,parseInt(x.target.value)),className:"w-full h-2 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-blue-600 z-10 relative"}),e.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 h-2 rounded-l-lg pointer-events-none transition-all duration-3000 bg-blue-100",style:{width:`${m*10}%`}})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-300 mt-1 px-1 font-mono",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"5"}),e.jsx("span",{children:"10"})]})]},n.id)})})]})]})},js=(r,c)=>{if(!c.length)return 1;const s=new Date;let i=0,d=0;return c.forEach(o=>{const a=B(o.startDate),t=B(o.endDate),l=W(t,a);if(l<=0)return;const h=W(s,a),n=Math.min(100,Math.max(0,h/l*100));i+=n,d+=o.progress||0}),i===0?1:d/i},vs=r=>{const c=r.actualCost||r.budgetUsed||0,s=r.totalBudget||0;if(c===0||s===0)return 1;const i=r.progress||0,d=s*(i/100);return d===0?1:d/c},re=r=>r>=80?"excellent":r>=60?"good":r>=40?"warning":"critical",Ns=(r,c)=>{const s=js(r,c),i=[];let d=100;s>=.95?d=100:s>=.85?(d=80,i.push(`进度稍慢，SPI=${s.toFixed(2)}`)):s>=.75?(d=60,i.push(`进度明显落后，SPI=${s.toFixed(2)}`)):(d=40,i.push(`进度严重滞后，SPI=${s.toFixed(2)}`));const o=new Date,a=c.filter(h=>B(h.endDate)<o&&(h.progress||0)<100);a.length>0&&(d-=a.length*5,i.push(`${a.length} 个任务已逾期`));const t=c.filter(h=>{if(h.type!=="milestone")return!1;const n=B(h.endDate),m=W(n,o);return m>0&&m<=7&&(h.progress||0)<100});t.length>0&&i.push(`${t.length} 个里程碑即将到期`);const l=re(d);return{score:Math.max(0,Math.min(100,d)),spi:s,status:l,issues:i}},ys=r=>{const c=vs(r),s=[];let i=100;c>=.95?i=100:c>=.85?(i=80,s.push(`成本稍微超支，CPI=${c.toFixed(2)}`)):c>=.75?(i=60,s.push(`成本明显超支，CPI=${c.toFixed(2)}`)):(i=40,s.push(`成本严重超支，CPI=${c.toFixed(2)}`));const d=r.budgetUsed||0,o=r.totalBudget||0,a=r.progress||0;if(o>0){const l=d/o*100;l>a+10&&(i-=10,s.push(`预算使用率(${l.toFixed(0)}%)超过进度(${a.toFixed(0)}%)`)),l>90&&s.push("预算即将耗尽")}const t=re(i);return{score:Math.max(0,Math.min(100,i)),cpi:c,status:t,issues:s}},ws=(r,c)=>{const s=[];let i=100,d=0;const o=r.resourceRequirements||[];let a=0,t=0;o.forEach(m=>{a+=m.count,t+=m.count});const l=a>0?t/a*100:100;l<70?(i-=15,s.push(`资源利用率偏低(${l.toFixed(0)}%)`)):l>110&&(i-=20,s.push(`资源过度分配(${l.toFixed(0)}%)`),d++);const h=o.filter(m=>(m.requiredSkills||[]).length>0&&!m.resourceId);h.length>0&&(i-=h.length*5,s.push(`${h.length} 个资源需求未匹配合适技能`));const n=re(i);return{score:Math.max(0,Math.min(100,i)),utilization:l,conflicts:d,status:n,issues:s}},ks=r=>{const c=[],s=r.risks||[];let i=100;const d=s.filter(l=>l.impact===5||typeof l.impact=="string"&&(l.impact==="critical"||l.impact==="high")),o=s.length;if(o===0)return{score:100,total:0,critical:0,status:"excellent",issues:[]};i-=d.length*15,i-=(o-d.length)*5,d.length>0&&c.push(`存在 ${d.length} 个高危风险`),o>10&&c.push(`风险数量较多(${o}个)`);const a=s.filter(l=>!l.mitigation||l.mitigation.trim()==="");a.length>0&&(i-=a.length*3,c.push(`${a.length} 个风险缺少应对措施`));const t=re(i);return{score:Math.max(0,Math.min(100,i)),total:o,critical:d.length,status:t,issues:c}},Cs=(r,c)=>{const s=[];let i=100;const d=c.length;if(d===0)return{score:100,defectRate:0,status:"excellent",issues:[]};const o=0,a=c.filter(l=>l.status==="active"&&(l.progress||0)>50);if(a.length>0){const l=a.length/d*100;i-=l,s.push(`${a.length} 个任务需要返工`)}const t=re(i);return{score:Math.max(0,Math.min(100,i)),defectRate:o,status:t,issues:s}},Ss=(r,c)=>{const s=[];let i=100;const d=c.filter(n=>(n.progress||0)===100),o=c.length,a=o>0?d.length/o*100:0;a<30&&(i-=20,s.push(`团队速率较低(${a.toFixed(0)}%)`));const t=75,l=new Map;if(c.forEach(n=>{n.assignee&&l.set(n.assignee,(l.get(n.assignee)||0)+1)}),l.size>0){const n=Array.from(l.values()),m=n.reduce((w,P)=>w+P,0)/n.length;Math.max(...n.map(w=>Math.abs(w-m)))>m*.5&&(i-=10,s.push("任务分配不均衡"))}const h=re(i);return{score:Math.max(0,Math.min(100,i)),morale:t,velocity:a,status:h,issues:s}},ze=(r,c,s=[])=>{const i=Ns(r,c),d=ys(r),o=ws(r),a=ks(r),t=Cs(r,c),l=Ss(r,c),h=i.score*.25+d.score*.2+o.score*.2+a.score*.15+t.score*.1+l.score*.1;return{overall:Math.round(h),schedule:i,cost:d,resources:o,risks:a,quality:t,team:l}},Ds=({project:r,tasks:c,allProjects:s,showComparison:i=!1})=>{var n,m;const d=k.useMemo(()=>{const x=ze(r,c,s);return[{dimension:"进度",value:x.schedule.score,fullMark:100},{dimension:"成本",value:x.cost.score,fullMark:100},{dimension:"资源",value:x.resources.score,fullMark:100},{dimension:"风险",value:x.risks.score,fullMark:100},{dimension:"质量",value:x.quality.score,fullMark:100},{dimension:"团队",value:x.team.score,fullMark:100}]},[r,c,s]),o=k.useMemo(()=>ze(r,c,s),[r,c,s]),a=x=>x>=80?{label:"优秀",color:"text-green-600",bg:"bg-green-100",icon:ce}:x>=60?{label:"良好",color:"text-blue-600",bg:"bg-blue-100",icon:X}:x>=40?{label:"警告",color:"text-yellow-600",bg:"bg-yellow-100",icon:Q}:{label:"危险",color:"text-red-600",bg:"bg-red-100",icon:Be},t=a(o.overall),l=t.icon,h=({active:x,payload:w})=>{if(x&&w&&w.length){const P=w[0];return e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-lg border border-slate-200",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:P.payload.dimension}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:P.value}),e.jsxs("p",{className:"text-xs text-slate-500",children:["满分: ",P.payload.fullMark]})]})}return null};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"项目健康度"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"text-5xl font-bold text-blue-600",children:o.overall}),e.jsxs("div",{children:[e.jsxs("div",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full ${t.bg} ${t.color} text-sm font-semibold`,children:[e.jsx(l,{size:16}),t.label]}),e.jsxs("p",{className:"text-xs text-slate-600 mt-1",children:[((n=o.schedule)==null?void 0:n.spi)>0&&`SPI: ${o.schedule.spi.toFixed(2)}`,((m=o.cost)==null?void 0:m.cpi)>0&&` | CPI: ${o.cost.cpi.toFixed(2)}`]})]})]})]}),e.jsxs("div",{className:"relative w-32 h-32",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"#E5E7EB",strokeWidth:"8",fill:"none"}),e.jsx(O.circle,{cx:"64",cy:"64",r:"56",stroke:"url(#healthGradient)",strokeWidth:"8",fill:"none",strokeLinecap:"round",initial:{strokeDasharray:"0 352"},animate:{strokeDasharray:`${o.overall/100*352} 352`},transition:{duration:1,ease:"easeOut"}}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"healthGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#3B82F6"}),e.jsx("stop",{offset:"100%",stopColor:"#8B5CF6"})]})})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-2xl font-bold text-slate-700",children:[o.overall,"%"]})})]})]})}),e.jsxs(O.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.3,duration:.5},className:"bg-white rounded-xl p-6 shadow-sm border border-slate-200",children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-900 mb-4",children:"六维健康度分析"}),e.jsx(je,{width:"100%",height:400,children:e.jsxs(qt,{data:d,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"radarGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#3B82F6",stopOpacity:.8}),e.jsx("stop",{offset:"100%",stopColor:"#8B5CF6",stopOpacity:.3})]})}),e.jsx(Et,{stroke:"#E5E7EB"}),e.jsx(Lt,{dataKey:"dimension",tick:{fill:"#64748B",fontSize:14,fontWeight:500}}),e.jsx(At,{angle:90,domain:[0,100],tick:{fill:"#94A3B8",fontSize:12}}),e.jsx(Gt,{name:"健康度",dataKey:"value",stroke:"#3B82F6",fill:"url(#radarGradient)",fillOpacity:.6,strokeWidth:2,dot:{fill:"#3B82F6",r:4},animationDuration:1e3,animationEasing:"ease-out"}),e.jsx(ve,{content:e.jsx(h,{})}),e.jsx(et,{wrapperStyle:{paddingTop:"20px",fontSize:"14px",fontWeight:500}})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map((x,w)=>{const P=a(x.value),A=P.icon;return e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4+w*.1,duration:.4},className:"bg-white rounded-lg p-4 shadow-sm border border-slate-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700",children:x.dimension}),e.jsx(A,{size:18,className:P.color})]}),e.jsxs("div",{className:"flex items-end gap-2 mb-2",children:[e.jsx("span",{className:"text-3xl font-bold text-slate-900",children:x.value}),e.jsx("span",{className:"text-sm text-slate-500 mb-1",children:"/ 100"})]}),e.jsx("div",{className:"w-full h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx(O.div,{initial:{width:0},animate:{width:`${x.value}%`},transition:{delay:.5+w*.1,duration:.8,ease:"easeOut"},className:`h-full rounded-full ${x.value>=80?"bg-gradient-to-r from-green-400 to-green-600":x.value>=60?"bg-gradient-to-r from-blue-400 to-blue-600":x.value>=40?"bg-gradient-to-r from-yellow-400 to-yellow-600":"bg-gradient-to-r from-red-400 to-red-600"}`})})]},x.dimension)})}),e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1,duration:.5},className:"bg-amber-50 rounded-xl p-6 border border-amber-200",children:[e.jsxs("h4",{className:"text-lg font-semibold text-amber-900 mb-4 flex items-center gap-2",children:[e.jsx(Q,{size:20}),"改进建议"]}),(()=>{const x=[...o.schedule.issues,...o.cost.issues,...o.resources.issues,...o.risks.issues,...o.quality.issues,...o.team.issues];return x.length===0?e.jsx("p",{className:"text-amber-800 text-sm",children:"当前项目健康状况良好，暂无改进建议。"}):e.jsx("ul",{className:"space-y-2",children:x.slice(0,5).map((w,P)=>e.jsxs(O.li,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:1.1+P*.1,duration:.3},className:"flex items-start gap-2 text-amber-800",children:[e.jsx("span",{className:"text-amber-600 mt-1",children:"•"}),e.jsx("span",{children:w})]},P))})})()]})]})},Ms=(r,c)=>{const s=new Date,i=r.totalBudget||0,d=r.actualCost||r.budgetUsed||0;let o=0,a=0;if(c.length===0||i===0)return{pv:0,ev:0,ac:d,sv:0,cv:0,spi:1,cpi:1,bac:i,eac:i,etc:0,vac:0,status:{schedule:"on_track",cost:"on_track"}};const t=c.reduce((v,b)=>{const p=B(b.startDate),j=B(b.endDate);return v+Math.max(1,W(j,p))},0),l=t>0?i/t:0;c.forEach(v=>{const b=B(v.startDate),p=B(v.endDate),j=Math.max(1,W(p,b)),S=j*l;if(s>=b){const z=Math.min(j,Math.max(0,W(s,b)))/j;o+=S*z}const g=v.progress||0;a+=S*(g/100)});const h=a-o,n=a-d,m=o>0?a/o:1,x=d>0?a/d:1,w=x>.1?d+(i-a)/x:d+(i-a),P=w-d,A=i-w,C=m>=1?"ahead":m>=.9?"on_track":"behind",y=x>=1?"under_budget":x>=.9?"on_track":"over_budget";return{pv:o,ev:a,ac:d,sv:h,cv:n,spi:m,cpi:x,bac:i,eac:w,etc:P,vac:A,status:{schedule:C,cost:y}}},zs=(r,c=6)=>{const s=[],i=new Date;for(let a=3;a>0;a--){const t=new Date(i.getFullYear(),i.getMonth()-a,1),l=1-a*.1;s.push({date:T(t,"yyyy-MM"),ac:r.ac*l,ev:r.ev*l,pv:r.pv*l,type:"history"})}s.push({date:T(i,"yyyy-MM"),ac:r.ac,ev:r.ev,pv:r.pv,type:"current"});const d=c,o=r.etc/d;for(let a=1;a<=d;a++){const t=new Date(i.getFullYear(),i.getMonth()+a,1);s.push({date:T(t,"yyyy-MM"),ac:r.ac+o*a,bac:r.bac,type:"forecast"})}return s},$s=({project:r,tasks:c})=>{const s=k.useMemo(()=>Ms(r,c),[r,c]),i=k.useMemo(()=>zs(s),[s]),d=o=>`¥${Math.round(o).toLocaleString()}`;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-lg border-2 ${s.cpi>=1?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"成本绩效 (CPI)"}),e.jsx(Me,{size:18,className:s.cpi>=1?"text-green-600":"text-red-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:s.cpi.toFixed(2)}),e.jsx("div",{className:"text-xs mt-1 text-slate-500",children:s.cpi>=1?"预算内":`超支 ${((1-s.cpi)*100).toFixed(0)}%`})]}),e.jsxs("div",{className:`p-4 rounded-lg border-2 ${s.spi>=1?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"进度绩效 (SPI)"}),e.jsx(Me,{size:18,className:s.spi>=1?"text-green-600":"text-yellow-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:s.spi.toFixed(2)}),e.jsx("div",{className:"text-xs mt-1 text-slate-500",children:s.spi>=1?"提前":`滞后 ${((1-s.spi)*100).toFixed(0)}%`})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"成本偏差 (CV)"}),e.jsx(K,{size:18,className:s.cv>=0?"text-green-600":"text-red-600"})]}),e.jsxs("div",{className:`text-2xl font-bold ${s.cv>=0?"text-green-600":"text-red-600"}`,children:[s.cv>=0?"+":"",d(s.cv)]}),e.jsx("div",{className:"text-xs mt-1 text-slate-500",children:"EV - AC"})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"进度偏差 (SV)"}),e.jsx(me,{size:18,className:s.sv>=0?"text-green-600":"text-yellow-600"})]}),e.jsxs("div",{className:`text-2xl font-bold ${s.sv>=0?"text-green-600":"text-yellow-600"}`,children:[s.sv>=0?"+":"",d(s.sv)]}),e.jsx("div",{className:"text-xs mt-1 text-slate-500",children:"EV - PV"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white rounded-lg border border-slate-200 p-6",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(X,{size:20,className:"text-blue-600"}),"完工预测 (EAC)"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-500",children:"完工预算 (BAC)"}),e.jsx("span",{className:"font-medium text-slate-900",children:d(s.bac)})]}),e.jsx("div",{className:"w-full bg-slate-100 rounded-full h-2",children:e.jsx("div",{className:"bg-slate-400 h-2 rounded-full w-full opacity-30"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-500",children:"完工估算 (EAC)"}),e.jsx("span",{className:`font-bold ${s.vac>=0?"text-green-600":"text-red-600"}`,children:d(s.eac)})]}),e.jsxs("div",{className:"w-full bg-slate-100 rounded-full h-2 relative",children:[e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-slate-900 z-10",style:{left:"80%"},title:"BAC"}),e.jsx("div",{className:`h-2 rounded-full ${s.vac>=0?"bg-green-500":"bg-red-500"}`,style:{width:`${Math.min(100,s.eac/(s.bac*1.2)*100)}%`}})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["预计",s.vac>=0?"结余":"超支"," ",d(Math.abs(s.vac))]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900 mb-2",children:"完工尚需 (ETC)"}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:d(s.etc)}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"还需要投入的资金以完成剩余工作"})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-lg border border-slate-200 p-6 flex flex-col",children:[e.jsx("h3",{className:"font-semibold text-slate-900 mb-4",children:"成本趋势预测"}),e.jsxs("div",{className:"flex-1 flex items-end gap-4 min-h-[200px] relative pt-8",children:[i.map((o,a)=>{const t=Math.max(s.eac,s.bac)*1.1,l=(o.ac||o.bac||0)/t*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center group relative",children:[e.jsx("div",{className:`w-full max-w-[40px] rounded-t transition-all ${o.type==="history"?"bg-slate-300":o.type==="current"?"bg-blue-600":"bg-blue-100 border-t-2 border-dashed border-blue-400"}`,style:{height:`${l}%`}}),e.jsx("div",{className:"text-xs text-slate-500 mt-2 rotate-45 origin-top-left",children:o.date}),e.jsxs("div",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-slate-900 text-white text-xs p-2 rounded z-10 whitespace-nowrap",children:[e.jsx("div",{children:o.date}),e.jsxs("div",{children:[o.type==="forecast"?"预测":"实际",": ",d(o.ac||o.bac||0)]})]})]},a)}),e.jsx("div",{className:"absolute left-0 right-0 border-t-2 border-dashed border-slate-400 pointer-events-none flex items-center",style:{bottom:`${s.bac/(Math.max(s.eac,s.bac)*1.1)*100}%`},children:e.jsx("span",{className:"bg-white text-xs text-slate-500 px-1 ml-2",children:"BAC (预算)"})})]})]})]}),s.vac<0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(te,{className:"text-red-600 mt-0.5 flex-shrink-0",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-900 mb-1",children:"成本超支预警"}),e.jsxs("p",{className:"text-sm text-red-700 mb-2",children:["按照当前绩效 (CPI = ",s.cpi.toFixed(2),")，项目预计将超支 ",d(Math.abs(s.vac)),"。"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-3 py-1 bg-red-100 text-red-700 rounded text-xs font-medium hover:bg-red-200 transition-colors",children:"查看详细支出"}),e.jsx("button",{className:"px-3 py-1 bg-white border border-red-200 text-red-700 rounded text-xs font-medium hover:bg-red-50 transition-colors",children:"申请预算变更"})]})]})]})]})},Is=({project:r,onCreateBaseline:c,onSetActiveBaseline:s,currentUserId:i,currentUserName:d})=>{const[o,a]=k.useState(!1),[t,l]=k.useState(""),[h,n]=k.useState(""),m=r.baselines||[],x=mt(r),w=()=>{if(!t.trim())return;const C=ht(r,t,h,i,d);c(C),a(!1),l(""),n("")},P=C=>C?bt(r,C):null,A=({variance:C,unit:y})=>{const v=gt(C),b=v==="good"?"text-green-600":v==="warning"?"text-orange-600":"text-red-600",p=C>0?X:C<0?Be:Q;return e.jsxs("div",{className:`flex items-center gap-1 ${b} text-sm font-medium`,children:[e.jsx(p,{size:14}),e.jsx("span",{children:pt(C,y)})]})};return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_t,{className:"text-blue-600 dark:text-blue-400",size:20}),e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:"基线管理"}),e.jsxs("span",{className:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs font-medium rounded-full",children:[m.length," 个基线"]})]}),e.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(xe,{size:16}),"创建基线"]})]})}),e.jsx(ge,{children:o&&e.jsx(O.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 overflow-hidden",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"基线名称 *"}),e.jsx("input",{type:"text",value:t,onChange:C=>l(C.target.value),placeholder:"例如: Baseline 1.0",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"描述"}),e.jsx("textarea",{value:h,onChange:C=>n(C.target.value),placeholder:"说明创建此基线的原因...",rows:2,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:w,disabled:!t.trim(),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(Ie,{size:16}),"创建"]}),e.jsxs("button",{onClick:()=>{a(!1),l(""),n("")},className:"flex items-center gap-2 px-4 py-2 bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg text-sm font-medium transition-colors",children:[e.jsx(ee,{size:16}),"取消"]})]})]})})}),e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:m.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-500 dark:text-slate-400",children:[e.jsx(Ne,{size:48,className:"mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"暂无基线"}),e.jsx("p",{className:"text-xs mt-1",children:"创建基线以跟踪项目变更和偏差"})]}):m.map(C=>{const y=(x==null?void 0:x.id)===C.id,v=P(C);return e.jsx("div",{className:`p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors ${y?"bg-blue-50/50 dark:bg-blue-900/10 border-l-4 border-blue-600":""}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-slate-100",children:C.name}),y&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-600 text-white text-xs font-medium rounded-full",children:"当前基线"})]}),C.description&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:C.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{size:12}),T(new Date(C.createdDate),"yyyy-MM-dd HH:mm")]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ut,{size:12}),C.createdByName||C.createdBy]})]}),y&&v&&e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-2 border border-slate-200 dark:border-slate-600",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"进度偏差"}),e.jsx(A,{variance:v.scheduleVariance,unit:"days"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-2 border border-slate-200 dark:border-slate-600",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"成本偏差"}),e.jsx(A,{variance:v.costVariance,unit:"currency"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-2 border border-slate-200 dark:border-slate-600",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"预算偏差"}),e.jsx(A,{variance:v.budgetVariancePercent,unit:"percent"})]})]})]}),!y&&e.jsx("button",{onClick:()=>s(C.id),className:"ml-4 px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:hover:bg-blue-900/20 rounded-lg transition-colors",children:"设为当前"})]})},C.id)})})]})},Xe={standard:[{id:"gate-1",stage:"initiation",name:"Gate 1: 项目启动审批",description:"项目章程和初步范围定义",requirements:[{id:"req-1-1",description:"项目章程已编制",required:!0,completed:!1},{id:"req-1-2",description:"干系人已识别",required:!0,completed:!1},{id:"req-1-3",description:"初步预算已批准",required:!0,completed:!1}],status:"pending"},{id:"gate-2",stage:"planning",name:"Gate 2: 计划审批",description:"详细项目计划和资源分配",requirements:[{id:"req-2-1",description:"项目计划已完成",required:!0,completed:!1},{id:"req-2-2",description:"风险评估已完成",required:!0,completed:!1},{id:"req-2-3",description:"资源已分配",required:!0,completed:!1},{id:"req-2-4",description:"质量标准已定义",required:!1,completed:!1}],status:"pending"},{id:"gate-3",stage:"execution",name:"Gate 3: 执行审批",description:"开始项目执行",requirements:[{id:"req-3-1",description:"团队已组建",required:!0,completed:!1},{id:"req-3-2",description:"启动会议已召开",required:!0,completed:!1},{id:"req-3-3",description:"基线已建立",required:!0,completed:!1}],status:"pending"},{id:"gate-4",stage:"monitoring",name:"Gate 4: 监控审批",description:"项目进度和质量监控",requirements:[{id:"req-4-1",description:"进度报告机制已建立",required:!0,completed:!1},{id:"req-4-2",description:"变更控制流程已实施",required:!0,completed:!1},{id:"req-4-3",description:"质量检查点已设置",required:!1,completed:!1}],status:"pending"},{id:"gate-5",stage:"closing",name:"Gate 5: 项目收尾",description:"项目验收和总结",requirements:[{id:"req-5-1",description:"所有交付物已完成",required:!0,completed:!1},{id:"req-5-2",description:"客户验收已获得",required:!0,completed:!1},{id:"req-5-3",description:"经验教训已总结",required:!0,completed:!1},{id:"req-5-4",description:"项目文档已归档",required:!1,completed:!1}],status:"pending"}]};function De(r){return{initiation:"启动",planning:"计划",execution:"执行",monitoring:"监控",closing:"收尾"}[r]}function $e(r){const c=["initiation","planning","execution","monitoring","closing"],s=c.indexOf(r);return s<c.length-1?c[s+1]:null}function Ps(r){return r.requirements.filter(s=>s.required).every(s=>s.completed)}function Bs(r){const c=r.requirements.length;if(c===0)return 100;const s=r.requirements.filter(i=>i.completed).length;return Math.round(s/c*100)}function Ye(r){return{pending:"text-slate-600 bg-slate-100 dark:text-slate-400 dark:bg-slate-700",approved:"text-green-600 bg-green-100 dark:text-green-400 dark:bg-green-900/20",rejected:"text-red-600 bg-red-100 dark:text-red-400 dark:bg-red-900/20",conditional:"text-orange-600 bg-orange-100 dark:text-orange-400 dark:bg-orange-900/20"}[r]}function We(r){return{pending:"待审批",approved:"已批准",rejected:"已拒绝",conditional:"有条件批准"}[r]}function Rs(r,c,s,i,d){return{...r,status:d&&d.length>0?"conditional":"approved",approvedBy:c,approvedByName:s,approvalDate:new Date().toISOString(),comments:i,conditions:d}}function Ls(r,c,s,i){return{...r,status:"rejected",approvedBy:c,approvedByName:s,approvalDate:new Date().toISOString(),comments:i}}function As(r,c,s,i,d){return{...r,requirements:r.requirements.map(o=>o.id===c?{...o,completed:s,completedDate:s?new Date().toISOString():void 0,completedBy:s?i:void 0,evidence:s?d:void 0}:o)}}const Fs=({project:r,onUpdateGate:c,onMoveToNextStage:s,currentUserId:i,currentUserName:d,userRole:o})=>{const[a,t]=k.useState(null),[l,h]=k.useState(""),[n,m]=k.useState(""),x=o==="admin"||o==="manager",w=["initiation","planning","execution","monitoring","closing"].indexOf(r.currentStage),P=(v,b,p)=>{const j=As(v,b,p,i);c(j)},A=v=>{const b=n.trim()?n.split(`
`).filter(j=>j.trim()):void 0,p=Rs(v,i,d,l||void 0,b);c(p),t(null),h(""),m("")},C=v=>{if(!l.trim()){alert("请输入拒绝原因");return}const b=Ls(v,i,d,l);c(b),t(null),h("")},y=({stage:v,index:b})=>{const p=b===w,j=b<w,S=r.gates.find(g=>g.stage===v);return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`relative flex items-center justify-center w-16 h-16 rounded-full border-4 ${j?"border-green-500 bg-green-100 dark:bg-green-900/20":p?"border-blue-500 bg-blue-100 dark:bg-blue-900/20":"border-slate-300 dark:border-slate-600 bg-slate-100 dark:bg-slate-800"}`,children:j?e.jsx(ce,{className:"text-green-600 dark:text-green-400",size:32}):p?e.jsx(oe,{className:"text-blue-600 dark:text-blue-400",size:32}):e.jsx(oe,{className:"text-slate-400 dark:text-slate-600",size:32})}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("div",{className:`text-sm font-semibold ${p?"text-blue-600 dark:text-blue-400":"text-slate-700 dark:text-slate-300"}`,children:De(v)}),S&&e.jsx("div",{className:`text-xs mt-1 px-2 py-0.5 rounded-full inline-block ${Ye(S.status)}`,children:We(S.status)})]})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100 mb-6",children:"项目阶段进度"}),e.jsx("div",{className:"flex items-center justify-between",children:["initiation","planning","execution","monitoring","closing"].map((v,b)=>e.jsxs(_e.Fragment,{children:[e.jsx(y,{stage:v,index:b}),b<4&&e.jsx(Qe,{className:`mx-2 ${b<w?"text-green-600 dark:text-green-400":"text-slate-300 dark:text-slate-600"}`,size:24})]},v))})]}),e.jsx("div",{className:"space-y-4",children:r.gates.map((v,b)=>{const p=Bs(v),j=Ps(v),S=a===v.id;return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",onClick:()=>t(S?null:v.id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:v.name}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${Ye(v.status)}`,children:We(v.status)})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:v.description})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("div",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:[p,"%"]}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"完成度"})]})]}),e.jsx("div",{className:"mt-3 h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx(O.div,{initial:{width:0},animate:{width:`${p}%`},className:`h-full ${p===100?"bg-green-500":p>=50?"bg-blue-500":"bg-orange-500"}`})})]}),e.jsx(ge,{children:S&&e.jsx(O.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100 mb-3",children:"检查清单"}),e.jsx("div",{className:"space-y-2",children:v.requirements.map(g=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 dark:bg-slate-900/50 rounded-lg",children:[e.jsx("button",{onClick:()=>x&&P(v,g.id,!g.completed),disabled:!x||v.status==="approved",className:`flex-shrink-0 w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${g.completed?"bg-green-500 border-green-500":"border-slate-300 dark:border-slate-600 hover:border-green-500"} ${!x||v.status==="approved"?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:g.completed&&e.jsx(Ie,{size:14,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm ${g.completed?"text-slate-500 dark:text-slate-400 line-through":"text-slate-900 dark:text-slate-100"}`,children:g.description}),g.required&&e.jsx("span",{className:"px-2 py-0.5 bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-400 text-xs rounded-full",children:"必需"})]}),g.completedDate&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["完成于 ",new Date(g.completedDate).toLocaleDateString("zh-CN"),g.completedBy&&` by ${g.completedBy}`]})]})]},g.id))})]}),x&&v.status==="pending"&&e.jsxs("div",{className:"pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("h5",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100 mb-3",children:"审批决策"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"审批意见"}),e.jsx("textarea",{value:l,onChange:g=>h(g.target.value),rows:2,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 resize-none",placeholder:"输入审批意见..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"附加条件（可选，每行一个）"}),e.jsx("textarea",{value:n,onChange:g=>m(g.target.value),rows:2,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 resize-none",placeholder:"例如：需在2周内完成XX任务"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>A(v),disabled:!j,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(ce,{size:16}),"批准通过"]}),e.jsxs("button",{onClick:()=>C(v),className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(tt,{size:16}),"拒绝"]})]}),!j&&e.jsxs("p",{className:"text-xs text-orange-600 dark:text-orange-400 flex items-center gap-1",children:[e.jsx(Q,{size:12}),"请先完成所有必需项才能批准"]})]})]}),v.status!=="pending"&&e.jsx("div",{className:"pt-4 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-slate-50 dark:bg-slate-900/50 rounded-lg",children:[e.jsx(Ne,{size:16,className:"text-slate-600 dark:text-slate-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:[v.approvedByName||v.approvedBy," · ",new Date(v.approvalDate).toLocaleDateString("zh-CN")]}),v.comments&&e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:v.comments}),v.conditions&&v.conditions.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs font-medium text-orange-700 dark:text-orange-400 mb-1",children:"附加条件："}),e.jsx("ul",{className:"list-disc list-inside text-sm text-slate-600 dark:text-slate-400",children:v.conditions.map((g,N)=>e.jsx("li",{children:g},N))})]})]})]})})]})})})]},v.id)})}),x&&$e(r.currentStage)&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100",children:"准备进入下一阶段？"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:["当前阶段：",De(r.currentStage)," → 下一阶段：",De($e(r.currentStage))]})]}),e.jsx("button",{onClick:s,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:"进入下一阶段"})]})})]})},Ts=({project:r,changeRequests:c})=>{const s=k.useMemo(()=>Ot(r,c),[r,c]),i=k.useMemo(()=>Ht(s),[s]),d=a=>a<10?"text-green-600 dark:text-green-400":a<20?"text-yellow-600 dark:text-yellow-400":a<30?"text-orange-600 dark:text-orange-400":"text-red-600 dark:text-red-400",o=a=>a<10?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":a<20?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":a<30?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800";return e.jsxs("div",{className:"space-y-4",children:[e.jsx(fe,{className:`border ${o(s.creepPercentage)}`,children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:`w-6 h-6 ${d(s.creepPercentage)}`}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"范围蔓延指数"})]}),s.requiresRebaseline&&e.jsxs(Z,{variant:"error",children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),"需要重新基线"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[e.jsxs("span",{className:`text-4xl font-bold ${d(s.creepPercentage)}`,children:[s.creepPercentage.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:"超出基线"})]}),e.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all ${s.creepPercentage<10?"bg-green-500":s.creepPercentage<20?"bg-yellow-500":s.creepPercentage<30?"bg-orange-500":"bg-red-500"}`,style:{width:`${Math.min(s.creepPercentage,100)}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 dark:text-slate-400 mt-1",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{className:"text-orange-500",children:"30% 阈值"}),e.jsx("span",{children:"100%"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(se,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"基线工时"})]}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:s.baselineEffortHours.toLocaleString()}),e.jsx("p",{className:"text-xs text-slate-500",children:"小时"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(se,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"当前工时"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:s.currentEffortHours.toLocaleString()}),e.jsxs("p",{className:"text-xs text-slate-500",children:["+",(s.currentEffortHours-s.baselineEffortHours).toLocaleString()," 小时"]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-3 text-center",children:[e.jsx(Ne,{className:"w-5 h-5 text-slate-400 mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:s.totalChangeRequests}),e.jsx("p",{className:"text-xs text-slate-500",children:"总变更"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-3 text-center",children:[e.jsx(ce,{className:"w-5 h-5 text-green-500 mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:s.approvedChanges}),e.jsx("p",{className:"text-xs text-slate-500",children:"已批准"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-3 text-center",children:[e.jsx(se,{className:"w-5 h-5 text-yellow-500 mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold text-yellow-600 dark:text-yellow-400",children:s.pendingChanges}),e.jsx("p",{className:"text-xs text-slate-500",children:"待审批"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-3 text-center",children:[e.jsx(tt,{className:"w-5 h-5 text-red-500 mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:s.rejectedChanges}),e.jsx("p",{className:"text-xs text-slate-500",children:"已拒绝"})]})]})]})}),i&&e.jsx(fe,{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(te,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-red-900 dark:text-red-100 mb-2",children:"范围蔓延警告"}),e.jsx("pre",{className:"text-sm text-red-800 dark:text-red-200 whitespace-pre-wrap font-sans",children:i})]})]})})})]})},qs=({project:r,onSubmit:c,onCancel:s,currentUser:i})=>{const[d,o]=k.useState({title:"",description:"",category:"scope",estimatedEffortHours:0,estimatedCostIncrease:0,scheduleImpactDays:0,impactLevel:"medium",businessJustification:"",alternativeConsidered:"",riskIfNotImplemented:""}),[a,t]=k.useState(null),l=(n,m)=>{const x={...d,[n]:m};if(o(x),n==="estimatedCostIncrease"||n==="scheduleImpactDays"||n==="businessJustification"){const w={projectId:r.id,projectName:r.name,requestedBy:i.id,requestedByName:i.name,requestDate:new Date().toISOString(),createdAt:new Date().toISOString(),...x};t(Ee(r,w))}},h=()=>{const n={projectId:r.id,projectName:r.name,requestedBy:i.id,requestedByName:i.name,requestDate:new Date().toISOString(),status:"pending",...d},m=Ee(r,n);t(m),m.isValid&&c(n)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx(fe,{className:"max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-6 h-6 text-orange-500"}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"变更影响评估"})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(ee,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4 mb-6",children:e.jsxs("p",{className:"text-sm text-orange-800 dark:text-orange-200",children:[e.jsx("strong",{children:"重要提示："})," 所有变更必须进行影响评估。请如实填写工时、成本和进度影响。"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"变更标题 *"}),e.jsx("input",{type:"text",value:d.title,onChange:n=>l("title",n.target.value),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"简要描述变更内容"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"详细描述 *"}),e.jsx("textarea",{value:d.description,onChange:n=>l("description",n.target.value),rows:3,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"详细说明变更的具体内容"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100 mb-4",children:"影响评估（必填）"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(se,{className:"w-4 h-4 inline mr-1"}),"增加工时（小时）*"]}),e.jsx("input",{type:"number",value:d.estimatedEffortHours,onChange:n=>l("estimatedEffortHours",Number(n.target.value)),min:"0",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(K,{className:"w-4 h-4 inline mr-1"}),"增加成本（元）*"]}),e.jsx("input",{type:"number",value:d.estimatedCostIncrease,onChange:n=>l("estimatedCostIncrease",Number(n.target.value)),min:"0",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(X,{className:"w-4 h-4 inline mr-1"}),"延后天数 *"]}),e.jsx("input",{type:"number",value:d.scheduleImpactDays,onChange:n=>l("scheduleImpactDays",Number(n.target.value)),min:"0",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"业务理由 * （至少 20 字符）"}),e.jsx("textarea",{value:d.businessJustification,onChange:n=>l("businessJustification",n.target.value),rows:3,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"为什么必须进行这个变更？对业务有什么价值？"}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[d.businessJustification.length," / 20 字符"]})]}),a&&e.jsxs("div",{className:"space-y-2",children:[a.errors.map((n,m)=>e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:n})},m)),a.warnings.map((n,m)=>e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:n})},m))]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-6 border-t border-slate-200 dark:border-slate-700",children:[e.jsx(ae,{onClick:h,disabled:!(a!=null&&a.isValid),className:"flex-1",children:"提交变更请求"}),e.jsx(ae,{onClick:s,variant:"outline",className:"flex-1",children:"取消"})]})]})})})},Es=({tasks:r})=>{const c=r.length,s=r.filter(l=>l.status==="completed").length,i=c>0?s/c*100:0,d=r.filter(l=>l.type==="milestone"),o=d.filter(l=>l.status==="completed").length,a=d.filter(l=>l.status!=="completed").sort((l,h)=>B(l.startDate).getTime()-B(h.startDate).getTime())[0],t=r.filter(l=>l.status==="completed"?!1:B(l.endDate).getTime()<new Date().getTime());return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 text-blue-600 rounded-xl",children:e.jsx(X,{size:20})}),e.jsxs("span",{className:"text-xs font-bold text-blue-600 px-2 py-1 bg-blue-50 rounded-full",children:[i.toFixed(0),"%"]})]}),e.jsx("h4",{className:"text-sm font-medium text-slate-500 mb-1",children:"整体任务进展"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:s}),e.jsxs("span",{className:"text-sm text-slate-400",children:["/ ",c," 任务"]})]}),e.jsx("div",{className:"mt-4 h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-1000 ease-out",style:{width:`${i}%`}})})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"p-2 bg-purple-50 text-purple-600 rounded-xl",children:e.jsx(me,{size:20})}),a&&e.jsxs("span",{className:"text-[10px] font-bold text-amber-600 px-2 py-1 bg-amber-50 rounded-full flex items-center gap-1",children:[e.jsx(le,{size:10}),"最近: ",T(B(a.startDate),"MM-dd")]})]}),e.jsx("h4",{className:"text-sm font-medium text-slate-500 mb-1",children:"关键里程碑"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:o}),e.jsxs("span",{className:"text-sm text-slate-400",children:["/ ",d.length," 交付物"]})]}),e.jsx("p",{className:"mt-2 text-xs text-slate-500 truncate",children:a?`下个目标: ${a.name}`:"所有里程碑已完成"})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"p-2 bg-indigo-50 text-indigo-600 rounded-xl",children:e.jsx(ts,{size:20})}),e.jsx("span",{className:"text-xs font-bold text-indigo-600 px-2 py-1 bg-indigo-50 rounded-full",children:"正常"})]}),e.jsx("h4",{className:"text-sm font-medium text-slate-500 mb-1",children:"资源调度健康"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:"100%"}),e.jsx("span",{className:"text-sm text-slate-400",children:"匹配率"})]}),e.jsx("p",{className:"mt-2 text-xs text-slate-500",children:"当前人力资源分配合理，无过载风险"})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"p-2 bg-orange-50 text-orange-600 rounded-xl",children:e.jsx(te,{size:20})}),t.length>0&&e.jsxs("span",{className:"animate-pulse text-xs font-bold text-red-600 px-2 py-1 bg-red-50 rounded-full",children:[t.length," 项延期"]})]}),e.jsx("h4",{className:"text-sm font-medium text-slate-500 mb-1",children:"进度风险预警"}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("span",{className:`text-2xl font-bold ${t.length>0?"text-red-600":"text-slate-900"}`,children:t.length>0?"需介入":"稳健"})}),e.jsx("p",{className:"mt-2 text-xs text-slate-500",children:t.length>0?`有 ${t.length} 个任务超出计划日期`:"进度与基线完全吻合"})]})]})},Gs=({existingTasks:r,resourcePool:c})=>{const[s,i]=k.useState({name:"",durationDays:5,resourceId:"",dependencyId:"",startDate:T(new Date,"yyyy-MM-dd")}),[d,o]=k.useState(!1),a=k.useMemo(()=>{if(!s.name||!d)return null;const t=V(B(s.startDate),s.durationDays),l=c.find(n=>n.id===s.resourceId);s.dependencyId;const h=l?1/l.totalQuantity*100:0;return{endDate:T(t,"yyyy-MM-dd"),resourceLoadIncrease:h,riskLevel:s.durationDays>10?"high":"medium",conflicts:s.resourceId==="res-1"?["前端资源池在 2025-02 月份已饱和"]:[]}},[s,d,c,r]);return e.jsxs(fe,{className:"p-6 bg-slate-50/50 border-dashed border-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-indigo-600",children:[e.jsx(J,{size:20,fill:"currentColor"}),e.jsx("h3",{className:"font-bold text-lg",children:"新任务影响分析模拟 (AI)"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"预期新增任务名称"}),e.jsx("input",{type:"text",className:"w-full px-4 py-2 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 bg-white",placeholder:"如：增加移动端适配模块",value:s.name,onChange:t=>i({...s,name:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"预计工期 (天)"}),e.jsx("input",{type:"number",className:"w-full px-4 py-2 border border-slate-200 rounded-xl bg-white",value:s.durationDays,onChange:t=>i({...s,durationDays:parseInt(t.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"责任岗位/人员"}),e.jsxs("select",{className:"w-full px-4 py-2 border border-slate-200 rounded-xl bg-white",value:s.resourceId,onChange:t=>i({...s,resourceId:t.target.value}),children:[e.jsx("option",{value:"",children:"选择资源..."}),c.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsx(ae,{onClick:()=>o(!0),variant:"primary",className:"w-full py-6 rounded-xl text-lg font-bold shadow-indigo-100 shadow-lg",disabled:!s.name,children:"开始影响因子分析"})]}),e.jsx("div",{className:"relative min-h-[200px] flex items-center justify-center border border-slate-200 rounded-2xl bg-white p-6",children:d?e.jsxs("div",{className:"w-full space-y-6 animate-in fade-in slide-in-from-right-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-bold text-slate-900",children:"模拟结果报告"}),e.jsx(Z,{variant:(a==null?void 0:a.riskLevel)==="high"?"danger":"warning",children:(a==null?void 0:a.riskLevel)==="high"?"高风险":"中等风险"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 rounded-xl",children:[e.jsx(le,{className:"text-blue-600 mt-1",size:18}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 font-bold uppercase",children:"关键路径偏移"}),e.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["此任务将导致项目最终交付日期推迟约 ",e.jsxs("span",{className:"text-blue-700 font-bold",children:[s.durationDays," 天"]}),"(预计至 ",a==null?void 0:a.endDate,")"]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-amber-50 rounded-xl",children:[e.jsx(as,{className:"text-amber-600 mt-1",size:18}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-amber-600 font-bold uppercase",children:"资源压力变化"}),e.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["对应资源池负荷将上升 ",e.jsxs("span",{className:"text-amber-700 font-bold",children:[a==null?void 0:a.resourceLoadIncrease.toFixed(1),"%"]})]})]})]}),(a==null?void 0:a.conflicts)&&a.conflicts.length>0&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-red-50 rounded-xl border border-red-100",children:[e.jsx(Q,{className:"text-red-600 mt-1",size:18}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-600 font-bold uppercase",children:"检测到冲突"}),a.conflicts.map((t,l)=>e.jsx("p",{className:"text-sm font-medium text-red-700",children:t},l))]})]})]}),e.jsx("div",{className:"pt-4 border-t border-slate-100 text-center",children:e.jsx("button",{onClick:()=>o(!1),className:"text-xs text-slate-400 hover:text-indigo-600 transition-colors",children:"清除模拟结果并重新分析"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx(Be,{size:48,className:"mx-auto text-slate-200 mb-4"}),e.jsx("p",{className:"text-slate-400 text-sm italic",children:"输入模拟数据以预测对项目基线的影响"})]})})]})]})},Da=()=>{const{projectId:r}=ft(),c=jt(),{projects:s,updateProject:i}=Ue(),d=vt(),{addChangeRequest:o,getChangeRequestsByProject:a}=yt(),t=s.find(f=>f.id===r),[l,h]=k.useState(!1),[n,m]=k.useState("diagram"),[x,w]=k.useState(!1),[P,A]=k.useState(!1),[C,y]=k.useState(!1);if(!t)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"项目未找到"}),e.jsx("button",{onClick:()=>c("/projects"),className:"text-blue-600 hover:underline",children:"返回项目列表"})]})});const v=t.costHistory||[],b=t.budget||1e6,p=k.useMemo(()=>ze(t,t.tasks||[],s),[t,s]),j=f=>f>=80?"text-green-600 bg-green-50 border-green-200":f>=60?"text-blue-600 bg-blue-50 border-blue-200":f>=40?"text-orange-600 bg-orange-50 border-orange-200":"text-red-600 bg-red-50 border-red-200",S=f=>{const $=t.tasks||[],D=$.findIndex(H=>H.id===f.id);let R;D>=0?(R=[...$],R[D]=f):R=[...$,f],i(t.id,{...t,tasks:R})},g=f=>{const D=[...t.tasks||[],f];i(t.id,{...t,tasks:D})},N=f=>{const D=(t.tasks||[]).filter(R=>R.id!==f);i(t.id,{...t,tasks:D})},z=(f,$)=>{const D=f.reduce((R,H)=>R+H.amount,0);i(t.id,{...t,costHistory:f,budget:$||t.budget,actualCost:D}),w(!1)};return e.jsxs("div",{className:"flex flex-col h-screen bg-slate-50 overflow-hidden",children:[e.jsxs("div",{className:"bg-white border-b border-slate-200 px-4 py-2 flex items-center justify-between shadow-sm z-20 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>c("/projects"),className:"p-2 hover:bg-slate-100 rounded-full text-slate-500",children:e.jsx(Ge,{size:20})}),e.jsx("div",{className:"h-6 w-px bg-slate-200"}),l?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:t.name,onChange:f=>i(t.id,{...t,name:f.target.value}),className:"font-bold text-lg border-b border-blue-500 focus:outline-none px-1"}),e.jsxs("select",{value:t.status,onChange:f=>i(t.id,{...t,status:f.target.value}),className:"text-sm bg-slate-50 border rounded px-2 py-1",children:[e.jsx("option",{value:"planning",children:"规划中"}),e.jsx("option",{value:"active",children:"进行中"}),e.jsx("option",{value:"completed",children:"已完成"}),e.jsx("option",{value:"on-hold",children:"暂停"})]}),e.jsxs("select",{value:t.priority,onChange:f=>i(t.id,{...t,priority:f.target.value}),className:"text-sm bg-slate-50 border rounded px-2 py-1",children:[e.jsx("option",{value:"P0",children:"P0 - 紧急"}),e.jsx("option",{value:"P1",children:"P1 - 高"}),e.jsx("option",{value:"P2",children:"P2 - 中"}),e.jsx("option",{value:"P3",children:"P3 - 低"})]})]}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"font-bold text-lg text-slate-800 dark:text-slate-100",children:t.name}),e.jsx(Z,{variant:t.status==="active"?"success":t.status==="planning"?"primary":"neutral",size:"sm",children:t.status}),e.jsx(Z,{variant:t.priority==="P0"?"danger":t.priority==="P1"?"warning":"primary",size:"sm",children:t.priority}),e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-0.5 rounded-full border text-xs font-bold ${j(p.overall)}`,children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-current"}),e.jsxs("span",{children:[p.overall," 分"]})]})]}),e.jsx("button",{onClick:()=>h(!l),className:`p-1.5 rounded-lg transition-colors ${l?"bg-blue-100 text-blue-600":"hover:bg-slate-100 text-slate-400"}`,children:l?e.jsx(Ie,{size:16}):e.jsx(Vt,{size:16})})]}),e.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>m("diagram"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all ${n==="diagram"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(Fe,{size:16})," 任务视图"]}),e.jsxs("button",{onClick:()=>m("resources"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all ${n==="resources"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(pe,{size:16})," 资源"]}),e.jsxs("button",{onClick:()=>m("risks"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all relative ${n==="risks"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(te,{size:16})," 风险",t.risks&&t.risks.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-500 rounded-full",children:t.risks.filter(f=>f.status!=="resolved"&&f.status!=="accepted").length})]}),e.jsxs("button",{onClick:()=>m("costs"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all ${n==="costs"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(K,{size:16})," 成本"]}),e.jsxs("button",{onClick:()=>m("analytics"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all ${n==="analytics"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(Nt,{size:16})," 高级分析"]}),e.jsxs("button",{onClick:()=>m("strategy"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all ${n==="strategy"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(me,{size:16})," 战略评分"]}),e.jsxs("button",{onClick:()=>m("baseline"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all ${n==="baseline"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(Xt,{size:16})," 基线管理"]}),e.jsxs("button",{onClick:()=>m("stagegate"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all ${n==="stagegate"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(Yt,{size:16})," 阶段门径"]}),e.jsxs("button",{onClick:()=>m("scope"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all ${n==="scope"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(X,{size:16})," 范围管理"]})]})]}),e.jsxs("div",{className:"flex-1 relative overflow-hidden bg-slate-50",children:[n==="diagram"&&e.jsxs("div",{className:"flex flex-col h-full bg-slate-50 overflow-hidden",children:[e.jsxs("div",{className:"p-6 pb-0 shrink-0",children:[e.jsx(Es,{project:t,tasks:t.tasks||[]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 flex items-center gap-2",children:[e.jsx(Fe,{size:20,className:"text-blue-600"}),"任务编排与进度分析"]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(ae,{onClick:()=>y(!C),variant:C?"primary":"secondary",size:"sm",icon:X,children:C?"隐藏分析器":"开启影响分析模拟"})})]})]}),C&&e.jsx("div",{className:"px-6 pb-6 shrink-0 animate-in slide-in-from-top duration-300",children:e.jsx(Gs,{project:t,existingTasks:t.tasks||[],resourcePool:d})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(hs,{tasks:t.tasks||[],projectName:t.name,onTaskUpdate:S,onTaskAdd:g,onTaskDelete:N})})]}),n==="risks"&&e.jsx("div",{className:"h-full overflow-auto p-6 max-w-7xl mx-auto",children:e.jsx(ps,{project:t,risks:t.risks||[],onRisksChange:f=>i(t.id,{...t,risks:f})})}),n==="costs"&&e.jsxs("div",{className:"h-full overflow-auto p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"成本概览"}),e.jsxs("p",{className:"text-sm text-slate-500",children:["预算: $",b.toLocaleString()," | 实际: $",v.reduce((f,$)=>f+$.amount,0).toLocaleString()]})]}),e.jsx(ae,{onClick:()=>w(!0),variant:"primary",icon:K,children:"登记成本"})]}),e.jsxs("div",{className:"space-y-3",children:[v.map(f=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600",children:e.jsx(K,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900",children:f.description}),e.jsxs("div",{className:"text-xs text-slate-500",children:[f.date," · ",f.category]})]})]}),e.jsxs("div",{className:"font-bold text-slate-900",children:["$",f.amount.toLocaleString()]})]},f.id)),v.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 text-sm",children:"暂无成本记录"})]})]}),n==="analytics"&&e.jsxs("div",{className:"h-full overflow-auto p-6 max-w-7xl mx-auto space-y-6",children:[e.jsx(Ds,{project:t,tasks:t.tasks||[],allProjects:s}),e.jsx($s,{project:t,tasks:t.tasks||[]})]}),n==="strategy"&&e.jsx("div",{className:"h-full overflow-hidden max-w-7xl mx-auto",children:e.jsx(fs,{project:t,onUpdate:f=>i(t.id,{...t,...f})})}),n==="resources"&&e.jsx(bs,{project:t,resourcePool:d}),n==="baseline"&&e.jsx("div",{className:"h-full overflow-auto p-6 max-w-7xl mx-auto",children:e.jsx(Is,{project:t,onCreateBaseline:f=>{const $=[...t.baselines||[],f];i(t.id,{...t,baselines:$,activeBaselineId:f.id})},onSetActiveBaseline:f=>{i(t.id,{...t,activeBaselineId:f})},currentUserId:"current-user",currentUserName:t.manager||"项目经理"})}),n==="stagegate"&&e.jsx("div",{className:"h-full overflow-auto p-6 max-w-7xl mx-auto",children:e.jsx(Fs,{project:{...t,currentStage:t.currentStage||"initiation",gates:t.gates||Xe.standard},onUpdateGate:f=>{const D=(t.gates||Xe.standard).map(R=>R.id===f.id?f:R);i(t.id,{...t,gates:D})},onMoveToNextStage:()=>{const f=t.currentStage||"initiation",$=$e(f);$&&i(t.id,{...t,currentStage:$})},currentUserId:"current-user",currentUserName:t.manager||"项目经理",userRole:"admin"})}),n==="scope"&&e.jsxs("div",{className:"h-full overflow-auto p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"范围管理与变更控制"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"监控范围蔓延，管理变更请求，防止项目失控"})]}),e.jsx(ae,{onClick:()=>A(!0),variant:"primary",icon:X,children:"提交变更请求"})]}),e.jsx(Ts,{project:t,changeRequests:a(t.id)}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4",children:"变更请求历史"}),e.jsxs("div",{className:"space-y-3",children:[a(t.id).map(f=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-slate-900 dark:text-slate-100",children:f.title}),e.jsx(Z,{variant:f.status==="approved"?"success":f.status==="rejected"?"danger":"warning",children:f.status})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:f.description}),e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-slate-500",children:[e.jsxs("span",{children:["工时: +",f.estimatedEffortHours,"h"]}),e.jsxs("span",{children:["成本: +¥",f.estimatedCostIncrease]}),e.jsxs("span",{children:["延期: +",f.scheduleImpactDays,"天"]})]})]}),e.jsx("div",{className:"text-sm text-slate-500",children:new Date(f.requestDate).toLocaleDateString()})]},f.id)),a(t.id).length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400",children:"暂无变更请求"})]})]})]})]}),P&&e.jsx(qs,{project:t,onSubmit:f=>{o(f),A(!1)},onCancel:()=>A(!1),currentUser:{id:"current-user",name:t.manager||"项目经理"}}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"登记项目成本"}),e.jsx("button",{onClick:()=>w(!1),className:"text-slate-400 hover:text-slate-600",children:e.jsx(Ge,{size:24,className:"rotate-180"})})]}),e.jsx(gs,{projectId:t.id,projectName:t.name,budget:b,existingCosts:v,onSave:z,onClose:()=>w(!1)})]})})})]})};export{Da as default};
