import{x as u,i as v,u as w,r as p,j as e,F as N,C as h,c as k}from"./index-2kGYW54C.js";import{u as y}from"./usePMOStore-ZQGNOuEH.js";import{d as T,A as C}from"./scopeManagement-DuJEL-xi.js";import{C as t,a as o,B}from"./Badge-OJQ0mcnR.js";const A=()=>{const{projectId:a}=u(),n=v(),{projects:b}=w(),{getRequirementsByProject:j}=y(),l=b.find(s=>s.id===a),r=p.useMemo(()=>a?j(a):[],[a,j]),d=p.useMemo(()=>l?T(l,r):[],[l,r]);if(!l)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-50 dark:bg-slate-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mb-2",children:"项目未找到"}),e.jsx("button",{onClick:()=>n("/projects"),className:"text-blue-600 hover:underline",children:"返回项目列表"})]})});const i=l.tasks||[],m=i.length,g=i.filter(s=>r.some(x=>x.relatedTaskIds.includes(s.id))).length,f=m>0?g/m*100:0;return e.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-6",children:e.jsxs("div",{className:"max-w-[1920px] mx-auto w-full",children:[e.jsxs("button",{onClick:()=>n(`/projects/${a}`),className:"flex items-center gap-2 text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 mb-6",children:[e.jsx(C,{className:"w-4 h-4"}),"返回项目详情"]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100 mb-2",children:["需求追踪矩阵 - ",l.name]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"建立需求、任务和交付物的全链路追踪，识别幽灵任务"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(t,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(N,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"总需求数"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:r.length})]})]})}),e.jsx(t,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(h,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"任务覆盖率"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[f.toFixed(0),"%"]})]})]})}),e.jsx(t,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg",children:e.jsx(h,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"已关联任务"}),e.jsxs("p",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:[g," / ",m]})]})]})}),e.jsx(t,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 rounded-lg",children:e.jsx(k,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"幽灵任务"}),e.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:d.length})]})]})})]}),d.length>0&&e.jsx(t,{className:"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(k,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-semibold text-red-900 dark:text-red-100 mb-2",children:["发现 ",d.length," 个幽灵任务"]}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200 mb-3",children:'以下任务未关联任何需求，可能是团队私自添加的"镀金"功能，建议审查或移除。'}),e.jsxs("div",{className:"space-y-2",children:[d.slice(0,5).map(s=>e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-3 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:s.taskName}),e.jsxs(o,{variant:"danger",children:[s.estimatedEffort,"h"]})]})},s.taskId)),d.length>5&&e.jsxs("p",{className:"text-xs text-red-700 dark:text-red-300",children:["还有 ",d.length-5," 个幽灵任务..."]})]})]})]})}),r.length>0?e.jsx("div",{className:"space-y-4",children:r.map(s=>{const x=i.filter(c=>s.relatedTaskIds.includes(c.id));return e.jsxs(t,{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:s.title}),e.jsx(o,{variant:s.status==="completed"?"success":s.status==="in-progress"?"primary":"neutral",children:s.status}),e.jsx(o,{variant:s.priority==="P0"?"danger":"neutral",children:s.priority})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:s.description})]})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["关联任务 (",x.length,")"]}),e.jsxs("div",{className:"space-y-2",children:[x.map(c=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx(h,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-sm text-slate-900 dark:text-slate-100",children:c.name})]},c.id)),x.length===0&&e.jsx("p",{className:"text-sm text-slate-400 text-center py-2",children:"暂无关联任务"})]})]})]},s.id)})}):e.jsxs(t,{className:"p-12 text-center",children:[e.jsx(N,{className:"w-16 h-16 text-slate-300 dark:text-slate-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"暂无需求"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-4",children:"添加需求以建立完整的追踪矩阵"}),e.jsx(B,{onClick:()=>n(`/projects/${a}`),children:"返回项目详情"})]})]})})};export{A as default};
