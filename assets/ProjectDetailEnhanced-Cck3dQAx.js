import{o as H,r as k,j as e,q as Z,p as R,Z as Ye,M as Je,d as W,E as Pe,D as Ie,N as ye,O,G as De,A as re,P as Ae,Q as ut,V as Qe,W as ht,b as se,_ as te,$ as Le,R as we,a0 as bt,i as Ke,X as Ze,Y as et,k as ke,a1 as pt,f as ee,a2 as Me,U as he,T as X,c as be,n as Y,a3 as me,e as ae,g as le,F as pe,m as gt,a4 as tt,u as st,z as Fe,a5 as ft,a6 as jt,a7 as vt,a8 as Nt,a9 as yt,aa as wt,ab as Be,ac as kt,s as qe,ad as Ct,ae as St,af as Dt,ag as Mt,C as ne,B as K,ah as zt,ai as $t,y as Pt,aj as It,x as Bt,ak as Te,al as qt}from"./index-BvQyAdiV.js";import{G as Rt}from"./grip-vertical-BZ1vaH7H.js";import{f as T,s as Ee}from"./format-BaDDL2Yc.js";import{c as At,E as Lt,p as Ge,S as Ft}from"./EnhancedResourceTimeline-D74AFK0t.js";import{a as _}from"./eachDayOfInterval-B8Wvjce2.js";import{T as ge}from"./target-EwM4tyRW.js";import{L as ce,H as Tt}from"./list-BCM3B6Kd.js";import{P as ie}from"./plus-CjGNTfrT.js";import{C as Et}from"./chevron-down-D8exDbX1.js";import{C as at}from"./chevron-right-DFoHNZMg.js";import{P as Gt,a as Ot}from"./PieChart-B80Mv7Bs.js";import{L as Ht,a as Vt}from"./LineChart-DWu9qlAM.js";import{S as _t}from"./shield-alert-B0YzzqUT.js";import{c as Xt,g as Ut,v as Oe,A as He}from"./scopeManagement-CLO_3ESv.js";import{P as Wt}from"./pen-IFSPnjG1.js";import"./addWeeks-DBFXsJNP.js";import"./endOfWeek-BLqtcsTo.js";import"./chevron-left-IrjyfQG2.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=H("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=H("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=H("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=H("GitMerge",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=H("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=H("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=H("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=H("PanelLeftClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=H("PanelLeftOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=H("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=H("Redo2",[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=H("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=H("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=H("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),ns=({task:l,onSave:m,onDelete:a,onClose:n,pdsgMembers:i})=>{const[d,s]=k.useState(l),o=()=>{m(d),n()},t=()=>{a&&window.confirm("确定要删除这个任务吗？")&&(a(l.id),n())};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm",onClick:n,children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl shadow-2xl p-6 max-h-[90vh] overflow-y-auto",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"编辑任务"}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(Z,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"任务名称"}),e.jsx("input",{type:"text",value:d.name,onChange:x=>s({...d,name:x.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"描述"}),e.jsx("textarea",{value:d.description||"",onChange:x=>s({...d,description:x.target.value}),rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"开始日期"}),e.jsx("input",{type:"date",value:d.startDate,onChange:x=>s({...d,startDate:x.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"结束日期"}),e.jsx("input",{type:"date",value:d.endDate,onChange:x=>s({...d,endDate:x.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"状态"}),e.jsxs("select",{value:d.status,onChange:x=>s({...d,status:x.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[e.jsx("option",{value:"planning",children:"规划中"}),e.jsx("option",{value:"active",children:"进行中"}),e.jsx("option",{value:"completed",children:"已完成"}),e.jsx("option",{value:"on-hold",children:"暂停"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"优先级"}),e.jsxs("select",{value:d.priority,onChange:x=>s({...d,priority:x.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[e.jsx("option",{value:"P0",children:"P0 - 紧急"}),e.jsx("option",{value:"P1",children:"P1 - 高"}),e.jsx("option",{value:"P2",children:"P2 - 中"}),e.jsx("option",{value:"P3",children:"P3 - 低"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"类型"}),e.jsxs("select",{value:d.type,onChange:x=>s({...d,type:x.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[e.jsx("option",{value:"task",children:"任务"}),e.jsx("option",{value:"milestone",children:"里程碑"}),e.jsx("option",{value:"group",children:"任务组"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2 font-bold flex items-center gap-2",children:"负责人 (PDSG 成员)"}),e.jsxs("select",{value:d.assignee||"",onChange:x=>s({...d,assignee:x.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[e.jsx("option",{value:"",children:"未指派"}),i&&i.map(x=>e.jsxs("option",{value:x.id,children:[x.name," (",x.role,")"]},x.id))]}),(!i||i.length===0)&&e.jsx("p",{className:"text-[10px] text-amber-600 mt-1 italic",children:"提示：请先在项目“PDSG”页签中添加成员，以便在此处指派负责人。"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"颜色"}),e.jsx("div",{className:"flex gap-2",children:["#3B82F6","#8B5CF6","#10B981","#F59E0B","#EF4444","#6B7280"].map(x=>e.jsx("button",{onClick:()=>s({...d,color:x}),className:`w-10 h-10 rounded-lg border-2 transition-all ${d.color===x?"border-slate-900 scale-110":"border-slate-200"}`,style:{backgroundColor:x}},x))})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-slate-200",children:[a&&e.jsx("button",{onClick:t,className:"px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:"删除任务"}),e.jsxs("div",{className:"flex gap-3 ml-auto",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:"取消"}),e.jsx("button",{onClick:o,className:"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors",children:"保存"})]})]})]})]})})},is=({tasks:l,onTaskUpdate:m,onTaskClick:a})=>{const[n,i]=k.useState(null),d=[{id:"planning",label:"规划中",color:"bg-blue-50 border-blue-200"},{id:"active",label:"进行中",color:"bg-green-50 border-green-200"},{id:"completed",label:"已完成",color:"bg-purple-50 border-purple-200"},{id:"on-hold",label:"暂停",color:"bg-orange-50 border-orange-200"}],s=c=>l.filter(u=>(u.status||"planning")===c),o=(c,u)=>{i(u),c.dataTransfer.effectAllowed="move"},t=c=>{c.preventDefault(),c.dataTransfer.dropEffect="move"},x=(c,u)=>{c.preventDefault(),n&&n.status!==u&&m({...n,status:u}),i(null)};return e.jsx("div",{className:"h-full overflow-x-auto p-4 bg-slate-50",children:e.jsx("div",{className:"flex gap-4 min-w-max h-full",children:d.map(c=>{const u=s(c.id);return e.jsxs("div",{className:"flex-1 min-w-[300px] flex flex-col",onDragOver:t,onDrop:r=>x(r,c.id),children:[e.jsx("div",{className:`rounded-t-lg border-2 ${c.color} p-3 mb-2`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:c.label}),e.jsx("span",{className:"px-2 py-0.5 bg-white rounded-full text-xs font-medium text-slate-600",children:u.length})]})}),e.jsxs("div",{className:"flex-1 space-y-2 overflow-y-auto",children:[u.map(r=>e.jsx("div",{draggable:!0,onDragStart:g=>o(g,r),onClick:()=>a(r),className:`bg-white rounded-lg border border-slate-200 p-3 cursor-move hover:shadow-md transition-all ${(n==null?void 0:n.id)===r.id?"opacity-50":""}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Rt,{size:16,className:"text-slate-400 mt-1 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-slate-900 mb-1 truncate",children:r.name}),r.description&&e.jsx("p",{className:"text-xs text-slate-600 mb-2 line-clamp-2",children:r.description}),e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[r.priority&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${r.priority==="P0"?"bg-red-100 text-red-700":r.priority==="P1"?"bg-orange-100 text-orange-700":r.priority==="P2"?"bg-yellow-100 text-yellow-700":"bg-slate-100 text-slate-700"}`,children:r.priority}),r.type&&r.type!=="task"&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs font-medium",children:r.type==="milestone"?"里程碑":"任务组"})]}),e.jsxs("div",{className:"text-xs text-slate-500 mb-2",children:[T(R(r.startDate),"MM/dd")," - ",T(R(r.endDate),"MM/dd")]}),r.progress!==void 0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs text-slate-600",children:"进度"}),e.jsxs("span",{className:"text-xs font-medium text-slate-900",children:[r.progress,"%"]})]}),e.jsx("div",{className:"h-1.5 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${r.progress}%`,backgroundColor:r.color||"#3B82F6"}})})]})]})]})},r.id)),u.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 text-sm",children:"暂无任务"})]})]},c.id)})})})},Ve=180,ve=80,_e=250,ds=120,os=({tasks:l})=>{const[m,a]=k.useState(1),[n,i]=k.useState({x:50,y:50}),[d,s]=k.useState(!1),[o,t]=k.useState({x:0,y:0}),{nodes:x,edges:c,width:u,height:r}=k.useMemo(()=>{const y=At(l),q=new Map,f=new Map,j=(v,w=new Set)=>{if(w.has(v))return 0;w.add(v);const S=l.find(M=>M.id===v);if(!S)return 0;const p=S.dependencies||[];if(p.length===0)return 0;let B=-1;return p.forEach(M=>{B=Math.max(B,j(M,new Set(w)))}),B+1};l.forEach(v=>{const w=j(v.id),S=y.criticalPath.includes(v.id),p={id:v.id,task:v,x:0,y:0,width:Ve,height:ve,level:w,isCritical:S};q.set(v.id,p),f.has(w)||f.set(w,[]),f.get(w).push(p)});let N=0,b=0;f.forEach((v,w)=>{N=Math.max(N,w),v.sort((p,B)=>p.task.startDate.localeCompare(B.task.startDate));const S=50;v.forEach((p,B)=>{p.x=w*_e,p.y=S+B*ds,b=Math.max(b,p.y+ve)})});const z=[];return l.forEach(v=>{v.dependencies&&v.dependencies.forEach(w=>{if(q.has(w)){const S=y.criticalPath.includes(v.id)&&y.criticalPath.includes(w);z.push({from:w,to:v.id,isCritical:S})}})}),{nodes:Array.from(q.values()),edges:z,width:(N+1)*_e+100,height:b+100}},[l]),g=y=>{s(!0),t({x:y.clientX-n.x,y:y.clientY-n.y})},D=y=>{d&&i({x:y.clientX-o.x,y:y.clientY-o.y})},I=()=>{s(!1)},C=y=>{if(y.ctrlKey||y.metaKey){y.preventDefault();const q=y.deltaY>0?.9:1.1;a(f=>Math.min(2,Math.max(.2,f*q)))}};return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 shadow-sm flex flex-col h-[600px]",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 bg-slate-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Kt,{size:20,className:"text-blue-600"}),e.jsx("h3",{className:"font-semibold text-slate-900",children:"任务网络图 (PERT)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>a(y=>Math.max(.2,y-.1)),className:"p-2 hover:bg-slate-200 rounded text-slate-600",title:"缩小",children:e.jsx(Ye,{size:18})}),e.jsxs("span",{className:"text-sm text-slate-500 w-12 text-center",children:[Math.round(m*100),"%"]}),e.jsx("button",{onClick:()=>a(y=>Math.min(2,y+.1)),className:"p-2 hover:bg-slate-200 rounded text-slate-600",title:"放大",children:e.jsx(Je,{size:18})}),e.jsx("button",{onClick:()=>{a(1),i({x:50,y:50})},className:"p-2 hover:bg-slate-200 rounded text-slate-600",title:"重置视图",children:e.jsx(Zt,{size:18})})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden relative cursor-grab active:cursor-grabbing bg-slate-50",onMouseDown:g,onMouseMove:D,onMouseUp:I,onMouseLeave:I,onWheel:C,children:e.jsxs("div",{style:{transform:`translate(${n.x}px, ${n.y}px) scale(${m})`,transformOrigin:"0 0",transition:d?"none":"transform 0.1s ease-out"},children:[e.jsxs("svg",{width:u,height:r,className:"pointer-events-none",children:[e.jsxs("defs",{children:[e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#94a3b8"})}),e.jsx("marker",{id:"arrowhead-critical",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#ef4444"})})]}),c.map((y,q)=>{const f=x.find(L=>L.id===y.from),j=x.find(L=>L.id===y.to),N=f.x+Ve,b=f.y+ve/2,z=j.x,v=j.y+ve/2,w=N+(z-N)/2,S=b,p=N+(z-N)/2,M=`M ${N} ${b} C ${w} ${S}, ${p} ${v}, ${z} ${v}`;return e.jsx("path",{d:M,stroke:y.isCritical?"#ef4444":"#94a3b8",strokeWidth:y.isCritical?3:2,fill:"none",markerEnd:y.isCritical?"url(#arrowhead-critical)":"url(#arrowhead)",strokeDasharray:y.isCritical?"none":"5,5"},q)})]}),x.map(y=>e.jsxs("div",{className:`absolute rounded-lg border-2 shadow-sm p-3 flex flex-col justify-between transition-colors hover:shadow-md pointer-events-auto ${y.isCritical?"bg-red-50 border-red-500":"bg-white border-slate-300 hover:border-blue-400"}`,style:{left:y.x,top:y.y,width:y.width,height:y.height},children:[e.jsx("div",{className:"font-medium text-sm text-slate-900 truncate",title:y.task.name,children:y.task.name}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500",children:[e.jsx("span",{children:y.task.startDate}),e.jsxs("span",{children:[W(R(y.task.endDate),R(y.task.startDate)),"天"]})]}),y.isCritical&&e.jsx("div",{className:"absolute -top-2 -right-2 w-4 h-4 bg-red-500 rounded-full border-2 border-white",title:"关键路径"})]},y.id))]})}),e.jsxs("div",{className:"p-2 bg-white border-t border-slate-200 flex gap-4 text-xs justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-white border-2 border-slate-300 rounded"}),e.jsx("span",{children:"普通任务"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-50 border-2 border-red-500 rounded"}),e.jsx("span",{children:"关键路径任务"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-slate-400 border-t border-dashed"}),e.jsx("span",{children:"依赖关系"})]})]})]})},xe=48,cs=320,xs=({tasks:l,milestones:m=[],onTaskUpdate:a,onTaskDelete:n,onTaskAdd:i,onMilestoneAdd:d,onMilestoneUpdate:s,onMilestoneDelete:o,onDependencyAdd:t,onDependencyDelete:x,onEditTask:c})=>{const u=k.useRef(null);k.useRef(null);const[r,g]=k.useState("Day"),[D,I]=k.useState(1),[C,y]=k.useState({x:0,y:0}),[q,f]=k.useState(!1),[j,N]=k.useState({x:0,y:0}),[b,z]=k.useState(new Set),[v,w]=k.useState(!0),[S,p]=k.useState(!0),[B,M]=k.useState(null),[L,V]=k.useState(null),[J,fe]=k.useState(null);Pe.useEffect(()=>{if(u.current){const h=Q(new Date),$=u.current.clientWidth;y(P=>({...P,x:Math.max(0,h-$/3)}))}},[r]);const nt=()=>{var P;const h=Q(new Date),$=((P=u.current)==null?void 0:P.clientWidth)||800;y(A=>({...A,x:Math.max(0,h-$/3)}))},{startDate:je,totalDays:Ce}=k.useMemo(()=>{if(l.length===0)return{startDate:Ee(new Date),totalDays:30};const h=l.flatMap(G=>[new Date(G.startDate).getTime(),new Date(G.endDate).getTime()]),$=new Date(Math.min(...h)),P=new Date(Math.max(...h)),A=_(Ee($),-14),E=_(P,30);return{startDate:A,totalDays:W(E,A)}},[l]),U=(()=>{switch(r){case"Week":return 25;case"Month":return 10;default:return 60}})()*D,Q=h=>{const $=typeof h=="string"?R(h):h;return W($,je)*U},Se=(h,$,P)=>{h.stopPropagation(),V({id:$.id,type:P,startX:h.clientX})},it=h=>{var $;if(q){const P=h.clientX-j.x,A=h.clientY-j.y;y({x:Math.max(0,C.x-P),y:Math.max(0,C.y-A)}),N({x:h.clientX,y:h.clientY});return}if(L){const P=h.clientX-L.startX,A=Math.round(P/U);if(A===0)return;const E=l.find(F=>F.id===L.id);if(!E)return;let G={...E};if(L.type==="move")G.startDate=_(R(E.startDate),A).toISOString(),G.endDate=_(R(E.endDate),A).toISOString();else if(L.type==="resize-l"){const F=_(R(E.startDate),A);F<R(E.endDate)&&(G.startDate=F.toISOString())}else{const F=_(R(E.endDate),A);F>R(E.startDate)&&(G.endDate=F.toISOString())}a(G),V({...L,startX:h.clientX})}if(J){const P=($=u.current)==null?void 0:$.getBoundingClientRect();P&&fe({...J,endX:h.clientX-P.left+C.x,endY:h.clientY-P.top+C.y})}},dt=h=>{(h.target===u.current||h.target.tagName==="svg")&&(f(!0),N({x:h.clientX,y:h.clientY}),M(null))},Re=()=>{f(!1),V(null),fe(null)},ot=(h,$)=>{var A;h.stopPropagation();const P=(A=u.current)==null?void 0:A.getBoundingClientRect();P&&fe({sourceId:$,endX:h.clientX-P.left+C.x,endY:h.clientY-P.top+C.y})},ct=(h,$)=>{J&&J.sourceId!==$&&(t==null||t(J.sourceId,$)),fe(null)},xt=h=>{if(h.ctrlKey){h.preventDefault();const $=h.deltaY>0?.9:1.1;I(P=>Math.max(.1,Math.min(3,P*$)))}else y({x:Math.max(0,C.x+h.deltaX),y:Math.max(0,C.y+h.deltaY)})},mt=()=>{const h=[];let $=De(je);const P=_(je,Ce);for(;$<=P;)h.push($),$=_($,32),$=De($);return e.jsx("div",{className:"h-12 bg-white border-b flex-shrink-0 relative overflow-hidden z-20 shadow-sm select-none",children:e.jsx("div",{className:"absolute top-0 left-0 h-full",style:{transform:`translate(${-C.x}px, 0px)`,width:Ce*U},children:e.jsx("div",{className:"h-1/2 border-b flex relative bg-slate-50 text-xs font-semibold text-slate-600",children:h.map((A,E)=>{const G=Q(A),F=W(De(_(A,32)),A)*U;return e.jsx("div",{className:"absolute top-0 border-r flex items-center justify-center px-2 whitespace-nowrap overflow-hidden",style:{left:G,width:F,height:"100%"},children:T(A,"yyyy年 M月")},E)})})})})};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-50 border rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"h-12 bg-white border-b flex items-center px-4 justify-between z-40 relative shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>p(!S),className:`p-1.5 rounded-lg transition-colors ${S?"bg-blue-50 text-blue-600":"text-slate-500 hover:bg-slate-100"}`,title:S?"隐藏任务列表":"显示任务列表",children:S?e.jsx(es,{size:20}):e.jsx(ts,{size:20})}),e.jsx("div",{className:"flex bg-slate-100 p-0.5 rounded-lg",children:["Day","Week","Month"].map(h=>e.jsx("button",{onClick:()=>g(h),className:`px-3 py-1 text-xs font-bold rounded-md transition-all flex items-center gap-1 ${r===h?"bg-white shadow-sm text-blue-600":"text-slate-500 hover:text-slate-700"}`,children:h==="Day"?"天 (d)":h==="Week"?"周 (w)":"月 (m)"},h))}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>I(h=>Math.max(.1,h-.1)),className:"p-1.5 hover:bg-slate-100 rounded text-slate-600",children:e.jsx(Ye,{size:18})}),e.jsxs("span",{className:"text-sm font-medium w-12 text-center text-slate-500",children:[(D*100).toFixed(0),"%"]}),e.jsx("button",{onClick:()=>I(h=>Math.min(3,h+.1)),className:"p-1.5 hover:bg-slate-100 rounded text-slate-600",children:e.jsx(Je,{size:18})})]}),e.jsx("div",{className:"w-px h-6 bg-slate-200"}),e.jsx("button",{onClick:()=>w(!v),className:`p-1.5 rounded transition-colors ${v?"bg-blue-50 text-blue-600":"text-slate-600 hover:bg-slate-100"}`,title:"切换网格线",children:e.jsx(Qt,{size:18})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:nt,className:"px-3 py-1.5 bg-blue-600 text-white text-xs font-bold rounded-lg hover:bg-blue-700 shadow-sm transition-all flex items-center gap-1.5",children:[e.jsx(ge,{size:14})," 跳转今天"]}),e.jsx("div",{className:"w-px h-6 bg-slate-200 mx-1"}),e.jsx("button",{className:"p-1.5 hover:bg-slate-100 rounded text-slate-600",children:e.jsx(rs,{size:18})}),e.jsx("button",{className:"p-1.5 hover:bg-slate-100 rounded text-slate-600",children:e.jsx(as,{size:18})}),e.jsx("div",{className:"w-px h-6 bg-slate-200 mx-1"}),e.jsx("button",{className:"p-1.5 hover:bg-slate-100 rounded text-slate-600",children:e.jsx(Ie,{size:18})})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[e.jsx(ye,{children:S&&e.jsxs(O.div,{initial:{width:0,opacity:0},animate:{width:cs,opacity:1},exit:{width:0,opacity:0},className:"bg-white border-r flex-shrink-0 flex flex-col z-30 shadow-[4px_0_12px_-2px_rgba(0,0,0,0.05)]",children:[e.jsxs("div",{className:"h-12 border-b bg-slate-50 flex items-center px-4 font-bold text-xs text-slate-500 uppercase tracking-wider",children:[e.jsx("div",{className:"flex-1",children:"任务名称"}),e.jsx("div",{className:"w-24 text-center",children:"周期"})]}),e.jsx("div",{className:"flex-1 overflow-hidden",onWheel:h=>{y($=>({...$,y:Math.max(0,$.y+h.deltaY)}))},children:e.jsxs("div",{style:{transform:`translateY(${-C.y}px)`},className:"pt-4",children:[l.map((h,$)=>e.jsxs("div",{className:`h-[48px] px-4 flex items-center text-sm border-b border-slate-50 hover:bg-blue-50/50 transition-colors group cursor-pointer ${b.has(h.id)?"bg-blue-50":""}`,onClick:()=>z(new Set([h.id])),onDoubleClick:()=>c==null?void 0:c(h),children:[e.jsxs("div",{className:"flex-1 truncate font-medium text-slate-700",children:[e.jsx("span",{className:"text-blue-500 opacity-0 group-hover:opacity-100 mr-1.5",children:"●"}),h.name]}),e.jsxs("div",{className:"w-24 text-[10px] text-slate-400 font-mono text-center flex flex-col leading-tight",children:[e.jsx("span",{children:T(R(h.startDate),"MM/dd")}),e.jsx("span",{className:"opacity-40",children:"→"}),e.jsx("span",{children:T(R(h.endDate),"MM/dd")})]})]},h.id)),l.length===0&&e.jsx("div",{className:"p-8 text-center text-slate-400 text-xs",children:"列表为空"})]})})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden relative",children:[mt(),e.jsx("div",{className:"flex-1 relative overflow-hidden cursor-grab active:cursor-grabbing bg-slate-50",ref:u,onMouseDown:dt,onMouseMove:it,onMouseUp:Re,onMouseLeave:Re,onWheel:xt,onContextMenu:h=>h.preventDefault(),children:e.jsxs("div",{className:"absolute top-0 left-0 transition-transform duration-75 ease-out",style:{transform:`translate(${-C.x}px, ${-C.y}px)`},children:[e.jsxs("div",{className:"absolute top-0 left-0 right-0 bottom-0 pointer-events-none z-0",children:[Array.from({length:Ce}).map((h,$)=>{const P=_(je,$);return P.getDay()!==0&&P.getDay()!==6?null:e.jsx("div",{className:"absolute top-0 bottom-0 bg-slate-200/20 shadow-inner",style:{left:$*U,width:U}},`weekend-${$}`)}),l.map((h,$)=>e.jsx("div",{className:`absolute left-0 right-0 h-[48px] border-b border-slate-100 ${$%2===1?"bg-slate-400/5":"bg-transparent"}`,style:{top:$*xe+20}},`row-bg-${$}`)),e.jsxs("div",{className:"absolute top-0 bottom-0 border-l-2 border-red-500 z-10",style:{left:Q(new Date)},children:[e.jsx("div",{className:"absolute top-0 -left-1.5 px-1.5 py-0.5 bg-red-500 text-white text-[9px] font-bold rounded-sm shadow-sm whitespace-nowrap",children:"今天"}),e.jsx("div",{className:"h-full w-px bg-red-500/20"})]})]}),e.jsxs("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none overflow-visible z-10",children:[e.jsx("defs",{children:e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#94a3b8"})})}),l.flatMap(h=>(h.dependencies||[]).map($=>{const P=l.find(oe=>oe.id===$);if(!P)return null;const A=Q(h.endDate)+U,E=l.findIndex(oe=>oe.id===h.id)*xe+20+16,G=Q(P.startDate),F=l.findIndex(oe=>oe.id===P.id)*xe+20+16;return e.jsx("path",{d:`M ${A} ${E} C ${A+30} ${E}, ${G-30} ${F}, ${G} ${F}`,stroke:"#cbd5e1",strokeWidth:"1.5",fill:"none",markerEnd:"url(#arrowhead)"},`${h.id}-${P.id}`)})),J&&(()=>{const h=l.find(A=>A.id===J.sourceId);if(!h)return null;const $=Q(h.endDate)+U,P=l.findIndex(A=>A.id===h.id)*xe+20+16;return e.jsx("line",{x1:$,y1:P,x2:J.endX,y2:J.endY,stroke:"#3b82f6",strokeWidth:"2",strokeDasharray:"4 4",markerEnd:"url(#arrowhead)"})})()]}),e.jsxs("div",{className:"relative pt-4 pb-20 select-none z-20",children:[l.map((h,$)=>{const P=Q(h.startDate),A=Math.max(U,W(R(h.endDate),R(h.startDate))*U+U),E=$*xe+20,G=b.has(h.id);return h.type==="milestone"?e.jsx(O.div,{className:`absolute cursor-pointer z-30 ${G?"ring-2 ring-blue-500 rounded-full scale-110 shadow-lg":"hover:scale-110"}`,style:{left:P-16,top:E-4},onClick:()=>z(new Set([h.id])),onDoubleClick:()=>c==null?void 0:c(h),children:e.jsxs("div",{className:"relative text-center group",children:[e.jsx("div",{className:"text-4xl drop-shadow-md",children:"⭐"}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-1 px-2 py-0.5 bg-amber-500 text-white text-[10px] font-bold rounded shadow-sm whitespace-nowrap z-50",children:h.name})]})},h.id):e.jsxs(O.div,{className:`absolute h-8 rounded-lg shadow-sm border border-black/5 flex items-center group overflow-hidden ${G?"ring-2 ring-blue-500 z-30 shadow-md":"hover:shadow-md z-20"}`,style:{left:P,width:A,top:E,backgroundColor:h.color||"#3b82f6"},onMouseDown:F=>Se(F,h,"move"),onDoubleClick:()=>c==null?void 0:c(h),onContextMenu:F=>{F.preventDefault(),M({x:F.clientX,y:F.clientY,taskId:h.id}),z(new Set([h.id]))},children:[e.jsx("div",{className:"absolute top-0 left-0 h-full bg-black/15 pointer-events-none transition-all duration-300",style:{width:`${h.progress||0}%`}}),e.jsxs("div",{className:"px-3 text-xs text-white font-bold truncate w-full flex items-center justify-between gap-2 z-10 pointer-events-none drop-shadow-sm",children:[e.jsx("span",{className:"truncate",children:h.name}),e.jsxs("span",{className:"text-[10px] opacity-90",children:[h.progress||0,"%"]})]}),e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 cursor-ew-resize hover:bg-white/30 z-20",onMouseDown:F=>Se(F,h,"resize-l")}),e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1.5 cursor-ew-resize hover:bg-white/30 z-20",onMouseDown:F=>Se(F,h,"resize-r")}),e.jsx("div",{className:"absolute -right-3 w-6 h-6 flex items-center justify-center cursor-crosshair opacity-0 group-hover:opacity-100 transition-opacity z-30",onMouseDown:F=>ot(F,h.id),onMouseUp:()=>ct(null,h.id),children:e.jsx("div",{className:"w-2.5 h-2.5 bg-white border-2 border-blue-500 rounded-full shadow-sm"})})]},h.id)}),m.map(h=>{const $=Q(h.date);return e.jsxs("div",{className:"absolute group cursor-pointer z-30",style:{left:$-12,top:10},children:[e.jsx("div",{className:"text-2xl drop-shadow-sm",children:"⭐"}),e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-1 px-2 py-0.5 bg-amber-500 text-white text-[10px] font-bold rounded shadow-sm whitespace-nowrap",children:h.name})]},h.id)})]})]})})]})]}),e.jsx(ye,{children:B&&e.jsxs("div",{className:"fixed bg-white shadow-2xl border border-slate-200 rounded-xl py-1.5 z-[100] w-40 overflow-hidden",style:{top:B.y,left:B.x},children:[e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-blue-50 transition-colors",onClick:()=>{c==null||c(l.find(h=>h.id===B.taskId)),M(null)},children:"编辑任务"}),e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors",onClick:()=>{n(B.taskId),M(null)},children:"删除任务"}),e.jsx("div",{className:"border-t border-slate-100 my-1"}),e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm text-slate-400 font-medium",onClick:()=>M(null),children:"取消操作"})]})})]})},ms=()=>{window.print()},us=(l,m)=>{const a=["任务名称","描述","开始日期","结束日期","状态","优先级","类型","进度(%)"],n=l.map(o=>[o.name,o.description||"",o.startDate,o.endDate,o.status||"planning",o.priority||"P2",o.type||"task",(o.progress||0).toString()]),i=[a.join(","),...n.map(o=>o.map(t=>`"${t}"`).join(","))].join(`
`),d=new Blob(["\uFEFF"+i],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(d),s.download=`${m}_tasks_${T(new Date,"yyyyMMdd")}.csv`,s.click()},hs=(l,m)=>{const a={projectName:m,exportDate:T(new Date,"yyyy-MM-dd HH:mm:ss"),tasks:l.map(s=>({id:s.id,name:s.name,description:s.description,startDate:s.startDate,endDate:s.endDate,status:s.status,priority:s.priority,type:s.type,progress:s.progress,color:s.color,dependencies:s.dependencies||[]}))},n=JSON.stringify(a,null,2),i=new Blob([n],{type:"application/json"}),d=document.createElement("a");d.href=URL.createObjectURL(i),d.download=`${m}_gantt_${T(new Date,"yyyyMMdd")}.json`,d.click()},bs=(l,m)=>{const a=["资源名称","分配数量","总容量","利用率(%)","工期","预估成本(元)","技能要求","状态"],n=(l.resourceRequirements||[]).map(o=>{const t=m.find(g=>g.id===o.resourceId);if(!t)return null;const x=o.unit==="day"?o.duration:o.unit==="month"?o.duration*22:o.unit==="year"?o.duration*260:0,c=t.hourlyRate?t.hourlyRate*x*8*o.count:t.costPerUnit?t.costPerUnit*o.duration*o.count:0,u=o.count/t.totalQuantity*100,r=o.count>t.totalQuantity;return[t.name,o.count.toString(),t.totalQuantity.toString(),u.toFixed(1),`${o.duration}${o.unit==="day"?"天":o.unit==="month"?"月":"年"}`,c.toFixed(2),(o.requiredSkills||[]).join("; "),r?"超额":"正常"]}).filter(Boolean),i=[a.join(","),...n.map(o=>o.map(t=>`"${t}"`).join(","))].join(`
`),d=new Blob(["\uFEFF"+i],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(d),s.download=`${l.name}_resources_${T(new Date,"yyyyMMdd")}.csv`,s.click()},ps=({tasks:l,projectName:m="Project",onTaskUpdate:a,onTaskAdd:n,onTaskDelete:i,pdsgMembers:d})=>{const[s,o]=k.useState("gantt"),[t,x]=k.useState("status"),[c,u]=k.useState(new Set(["active","planning"])),[r,g]=k.useState(null),[D,I]=k.useState(null),C=k.useMemo(()=>{const v={};return l.forEach(w=>{let S="ungrouped";switch(t){case"status":S=w.status||"planning";break;case"priority":S=w.priority||"P2";break;case"type":S=w.type||"task";break;default:S="all"}v[S]||(v[S]=[]),v[S].push(w)}),Object.keys(v).forEach(w=>{v[w].sort((S,p)=>{const B=R(S.startDate),M=R(p.startDate);return B.getTime()-M.getTime()})}),v},[l,t]),y=v=>{const w=new Set(c);w.has(v)?w.delete(v):w.add(v),u(w)},q=v=>t==="status"?{planning:{label:"规划中",color:"bg-blue-100 text-blue-700",icon:ue},active:{label:"进行中",color:"bg-green-100 text-green-700",icon:se},completed:{label:"已完成",color:"bg-purple-100 text-purple-700",icon:ht},"on-hold":{label:"暂停",color:"bg-orange-100 text-orange-700",icon:ue}}[v]||{label:v,color:"bg-slate-100 text-slate-700",icon:ue}:t==="priority"?{P0:{label:"紧急",color:"bg-red-100 text-red-700",icon:te},P1:{label:"高",color:"bg-orange-100 text-orange-700",icon:te},P2:{label:"中",color:"bg-yellow-100 text-yellow-700",icon:te},P3:{label:"低",color:"bg-slate-100 text-slate-700",icon:te}}[v]||{label:v,color:"bg-slate-100 text-slate-700",icon:te}:t==="type"?{task:{label:"任务",color:"bg-blue-100 text-blue-700",icon:ce},milestone:{label:"里程碑",color:"bg-purple-100 text-purple-700",icon:te},group:{label:"任务组",color:"bg-green-100 text-green-700",icon:Ae}}[v]||{label:v,color:"bg-slate-100 text-slate-700",icon:ce}:{label:"全部任务",color:"bg-slate-100 text-slate-700",icon:ce},f=(v,w)=>{I(w),v.dataTransfer.effectAllowed="move"},j=v=>{v.preventDefault(),v.dataTransfer.dropEffect="move"},N=(v,w)=>{if(v.preventDefault(),!D||D.id===w.id)return;const S=[...l],p=S.findIndex(M=>M.id===D.id),B=S.findIndex(M=>M.id===w.id);if(p!==-1&&B!==-1){const M=D.y||0,L=w.y||0;a({...D,y:L}),a({...w,y:M})}I(null)},b=()=>e.jsx("div",{className:"h-full overflow-hidden",children:e.jsx(xs,{tasks:l,onTaskUpdate:a,onTaskDelete:i,onEditTask:g,onTaskAdd:v=>{const w={id:Date.now().toString(),name:"新任务",status:"planning",priority:"P2",progress:0,startDate:v.startDate||T(new Date,"yyyy-MM-dd"),endDate:v.endDate||T(_(new Date,2),"yyyy-MM-dd"),type:"task",dependencies:[],...v};n(w)}})}),z=()=>e.jsx("div",{className:"overflow-auto h-full p-4",children:Object.entries(C).map(([v,w])=>{const S=q(v),p=c.has(v),B=S.icon;return e.jsxs("div",{className:"mb-6",children:[t!=="none"&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 cursor-pointer",onClick:()=>y(v),children:[p?e.jsx(Et,{size:18}):e.jsx(at,{size:18}),e.jsx(B,{size:18}),e.jsx("h3",{className:"font-semibold text-slate-900",children:S.label}),e.jsxs("span",{className:"text-sm text-slate-500",children:["(",w.length,")"]})]}),(p||t==="none")&&e.jsx("div",{className:"space-y-2",children:w.map(M=>{var L;return e.jsxs("div",{draggable:!0,onDragStart:V=>f(V,M),onDragOver:j,onDrop:V=>N(V,M),className:`bg-white rounded-lg border border-slate-200 p-4 hover:shadow-md transition-all cursor-move ${(D==null?void 0:D.id)===M.id?"opacity-50":""}`,onClick:()=>g(M),children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-medium text-slate-900",children:M.name}),M.priority&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${M.priority==="P0"?"bg-red-100 text-red-700":M.priority==="P1"?"bg-orange-100 text-orange-700":M.priority==="P2"?"bg-yellow-100 text-yellow-700":"bg-slate-100 text-slate-700"}`,children:M.priority})]}),M.description&&e.jsx("p",{className:"text-sm text-slate-600 mb-2",children:M.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{size:12}),T(R(M.startDate),"yyyy-MM-dd")," - ",T(R(M.endDate),"yyyy-MM-dd")]}),M.assignee&&e.jsxs("span",{className:"flex items-center gap-1 text-indigo-600 font-bold",children:[e.jsx(Qe,{size:12}),"负责人: ",((L=d==null?void 0:d.find(V=>V.id===M.assignee))==null?void 0:L.name)||"未知"]}),M.progress!==void 0&&e.jsxs("span",{children:["进度: ",M.progress,"%"]})]})]})}),M.progress!==void 0&&e.jsx("div",{className:"mt-3 h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all",style:{width:`${M.progress}%`}})})]},M.id)})})]},v)})});return e.jsxs("div",{className:"flex flex-col h-full bg-slate-50",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 p-4 shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex bg-slate-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>o("gantt"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${s==="gantt"?"bg-white text-slate-900 shadow-sm":"text-slate-600"}`,children:[e.jsx(re,{size:16,className:"inline mr-1"}),"时间总览"]}),e.jsxs("button",{onClick:()=>o("list"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${s==="list"?"bg-white text-slate-900 shadow-sm":"text-slate-600"}`,children:[e.jsx(ce,{size:16,className:"inline mr-1"}),"列表"]}),e.jsxs("button",{onClick:()=>o("board"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${s==="board"?"bg-white text-slate-900 shadow-sm":"text-slate-600"}`,children:[e.jsx(Ae,{size:16,className:"inline mr-1"}),"看板"]}),e.jsxs("button",{onClick:()=>o("network"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${s==="network"?"bg-white text-slate-900 shadow-sm":"text-slate-600"}`,children:[e.jsx(ut,{size:16,className:"inline mr-1"}),"网络图"]})]}),s!=="board"&&s!=="network"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"分组:"}),e.jsxs("select",{value:t,onChange:v=>x(v.target.value),className:"px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"none",children:"不分组"}),e.jsx("option",{value:"status",children:"按状态"}),e.jsx("option",{value:"priority",children:"按优先级"}),e.jsx("option",{value:"type",children:"按类型"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mr-2 border-r border-slate-200 pr-3",children:[e.jsx("button",{onClick:()=>us(l,m),className:"p-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",title:"导出 CSV",children:e.jsx(Ie,{size:18})}),e.jsx("button",{onClick:()=>hs(l,m),className:"p-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",title:"导出 JSON",children:e.jsx(ce,{size:18})}),e.jsx("button",{onClick:ms,className:"p-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",title:"打印",children:e.jsx(ss,{size:18})})]}),e.jsxs("button",{onClick:()=>{const v={id:Date.now().toString(),name:"新任务",startDate:T(new Date,"yyyy-MM-dd"),endDate:T(_(new Date,7),"yyyy-MM-dd"),progress:0,type:"task",status:"planning",priority:"P2",color:"#3B82F6"};n(v)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ie,{size:18}),"新建任务"]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[s==="gantt"&&b(),s==="list"&&z(),s==="board"&&e.jsx(is,{tasks:l,onTaskUpdate:a,onTaskClick:g}),s==="network"&&e.jsx(os,{tasks:l})]}),r&&e.jsx(ns,{task:r,pdsgMembers:d,onSave:v=>{a(v),g(null)},onDelete:v=>{i(v),g(null)},onClose:()=>g(null)})]})},gs=({project:l,resourcePool:m})=>{const[a,n]=k.useState("details"),i=k.useMemo(()=>{const s=l.resourceRequirements||[],o=l.actualResourceUsage||[];return Array.from(new Set([...s.map(x=>x.resourceId),...o.map(x=>x.resourceId)])).map(x=>{const c=m.find(b=>b.id===x);if(!c)return null;const u=s.find(b=>b.resourceId===x),r=o.find(b=>b.resourceId===x),g=(u==null?void 0:u.count)||0,D=(r==null?void 0:r.count)||0,I=(u==null?void 0:u.unit)||(r==null?void 0:r.unit)||"month",C=(u==null?void 0:u.duration)||(r==null?void 0:r.duration)||0,y=I==="day"?C:I==="month"?C*22:I==="year"?C*260:0,q=c.hourlyRate?c.hourlyRate*y*8*g:c.costPerUnit?c.costPerUnit*C*g:0,f=c.hourlyRate?c.hourlyRate*y*8*D:c.costPerUnit?c.costPerUnit*C*D:0,j=c.totalQuantity,N=D/j*100;return{resourceId:x,resource:c,plannedCount:g,actualCount:D,variance:D-g,workDays:y,estimatedCost:q,actualCost:f,utilization:N,unit:I,duration:C,isOverAllocated:D>j,requiredSkills:(u==null?void 0:u.requiredSkills)||[]}}).filter(Boolean)},[l.resourceRequirements,l.actualResourceUsage,m]),d=k.useMemo(()=>{const s=i.reduce((r,g)=>r+((g==null?void 0:g.estimatedCost)||0),0),o=i.reduce((r,g)=>r+((g==null?void 0:g.actualCost)||0),0),t=i.reduce((r,g)=>r+((g==null?void 0:g.plannedCount)||0),0),x=i.reduce((r,g)=>r+((g==null?void 0:g.actualCount)||0),0),c=i.filter(r=>r==null?void 0:r.isOverAllocated).length,u=i.length>0?i.reduce((r,g)=>r+((g==null?void 0:g.utilization)||0),0)/i.length:0;return{totalEstimatedCost:s,totalActualCost:o,totalPlannedHeadcount:t,totalActualHeadcount:x,overAllocatedCount:c,avgUtilization:u,costVariance:o-s,headcountVariance:x-t}},[i]);return e.jsx("div",{className:"h-full overflow-auto p-6 bg-slate-50",children:e.jsxs("div",{className:"max-w-[1920px] mx-auto w-full space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex bg-white rounded-lg border border-slate-200 p-1",children:[e.jsx("button",{onClick:()=>n("details"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${a==="details"?"bg-slate-100 text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"分配详情"}),e.jsx("button",{onClick:()=>n("timeline"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${a==="timeline"?"bg-slate-100 text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"时间线"}),e.jsx("button",{onClick:()=>n("prediction"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${a==="prediction"?"bg-slate-100 text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"预测分析 (AI)"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>bs(l,m),className:"flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors",children:[e.jsx(Ie,{size:18}),"导出报表"]})})]}),a==="timeline"&&e.jsx("div",{className:"bg-white rounded-lg border border-slate-200 p-4 h-[400px] animate-in fade-in duration-300",children:e.jsx(Lt,{resources:m,projects:[l]})}),a==="prediction"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-indigo-600",children:[e.jsx(Le,{size:20}),e.jsx("h3",{className:"font-bold text-lg",children:"人力平衡预测趋势"})]}),e.jsx("div",{className:"h-[300px]",children:e.jsx(we,{width:"100%",height:"100%",children:e.jsxs(bt,{data:(()=>{const s=l.resourceRequirements||[],o={};return s.forEach(t=>{const x=m.find(c=>c.id===t.resourceId);x&&Ge(x,[l],6).predictions.forEach(u=>{o[u.month]||(o[u.month]={month:u.month}),o[u.month][x.name]=u.predicted})}),Object.values(o).sort((t,x)=>t.month.localeCompare(x.month))})(),children:[e.jsx(Ke,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(Ze,{dataKey:"month",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#64748b"}}),e.jsx(et,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#64748b"}}),e.jsx(ke,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.1)"}}),(l.resourceRequirements||[]).map((s,o)=>{const t=m.find(c=>c.id===s.resourceId);if(!t)return null;const x=["#6366f1","#10b981","#f59e0b","#ef4444","#8b5cf6"];return e.jsx(pt,{type:"monotone",dataKey:t.name,stroke:x[o%x.length],fill:x[o%x.length],fillOpacity:.1,strokeWidth:2},s.resourceId)})]})})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-amber-600",children:[e.jsx(ee,{size:20}),e.jsx("h3",{className:"font-bold text-lg",children:"风险洞察与干预建议"})]}),e.jsx("div",{className:"space-y-4",children:(()=>{const s=[];return(l.resourceRequirements||[]).forEach(t=>{const x=m.find(c=>c.id===t.resourceId);if(x){const c=Ge(x,[l],6);c.peakLoad>x.totalQuantity&&s.push(`【${x.name}】风险：预计在 ${c.peakMonth} 出现缺口，峰值负载指数达 ${(c.peakLoad/x.totalQuantity*100).toFixed(0)}%。`),c.trend==="increasing"&&s.push(`【${x.name}】预判：需求呈持续上升趋势，建议在第二季度末启动人才储备或外包补位。`)}}),s.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(Me,{className:"mx-auto text-emerald-500 mb-3 opacity-20",size:48}),e.jsx("p",{className:"text-slate-500 text-sm italic",children:"当前项目资源平衡在预测周期内表现优异，暂无缺口风险。"})]}):s.map((t,x)=>e.jsx("div",{className:"group p-4 bg-slate-50 hover:bg-white dark:bg-slate-800/50 rounded-xl border border-slate-100 dark:border-slate-700 hover:border-amber-200 transition-all cursor-default",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/30 text-amber-600 rounded-lg h-fit",children:e.jsx(Le,{size:16})}),e.jsx("p",{className:"text-sm text-slate-700 leading-relaxed font-medium",children:t})]})},x))})()})]})]}),a==="details"&&e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(he,{size:20,className:"text-blue-600"}),e.jsx("span",{className:"text-sm text-slate-600 font-medium",children:"总人力投入"})]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:d.totalActualHeadcount}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["项目累计实际占用 (Plan: ",d.totalPlannedHeadcount,")"]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(X,{size:20,className:"text-green-600"}),e.jsx("span",{className:"text-sm text-slate-600 font-medium",children:"资源平均利用率"})]}),e.jsxs("div",{className:"text-2xl font-bold text-slate-900",children:[d.avgUtilization.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"当前周期占用负荷"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(re,{size:20,className:"text-purple-600"}),e.jsx("span",{className:"text-sm text-slate-600 font-medium",children:"预估人力成本"})]}),e.jsxs("div",{className:"text-2xl font-bold text-slate-900",children:["¥",(d.totalActualCost/1e4).toFixed(1),"万"]}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["实际成本 (Plan: ¥",(d.totalEstimatedCost/1e4).toFixed(1),"万)"]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.overAllocatedCount>0?e.jsx(ee,{size:20,className:"text-red-600"}):e.jsx(be,{size:20,className:"text-green-600"}),e.jsx("span",{className:"text-sm text-slate-600 font-medium",children:"资源调度状态"})]}),e.jsx("div",{className:`text-2xl font-bold ${d.overAllocatedCount>0?"text-red-600":"text-green-600"}`,children:d.overAllocatedCount>0?"资源告警":"运行正常"}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:d.overAllocatedCount>0?`当前有 ${d.overAllocatedCount} 项分配冲突`:"暂无冲突风险"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm",children:[e.jsx("div",{className:"p-4 border-b border-slate-200 bg-slate-50/50",children:e.jsx("h3",{className:"font-bold text-slate-900",children:"人力资源明细清单"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50/80 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"资源名称"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"预计投入"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"实际占用"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"偏差"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"实时利用率"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"预计成本"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"实际成本"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider",children:"状态"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:i.map((s,o)=>e.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center",children:e.jsx(he,{size:16,className:"text-blue-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-slate-900",children:s.resource.name}),e.jsxs("div",{className:"flex gap-2",children:[s.resource.department&&e.jsx(Y,{variant:"neutral",size:"sm",className:"text-[9px] px-1",children:s.resource.department}),s.resource.category&&e.jsx(Y,{variant:"neutral",size:"sm",className:"text-[9px] px-1 uppercase",children:s.resource.category})]})]})]})}),e.jsx("td",{className:"px-4 py-3 text-slate-500 font-medium",children:s.plannedCount}),e.jsx("td",{className:"px-4 py-3 font-bold text-slate-900",children:s.actualCount}),e.jsx("td",{className:`px-4 py-3 text-xs font-bold ${s.variance>0?"text-red-500":s.variance<0?"text-emerald-500":"text-slate-400"}`,children:s.variance>0?`+${s.variance}`:s.variance===0?"-":s.variance}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-slate-100 rounded-full overflow-hidden max-w-[60px]",children:e.jsx("div",{className:`h-full rounded-full ${s.utilization>100?"bg-red-500":s.utilization>80?"bg-yellow-500":"bg-emerald-500"}`,style:{width:`${Math.min(s.utilization,100)}%`}})}),e.jsxs("span",{className:`text-xs font-black ${s.utilization>100?"text-red-600":s.utilization>80?"text-yellow-600":"text-emerald-600"}`,children:[s.utilization.toFixed(0),"%"]})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-slate-500",children:["¥",(s.estimatedCost/1e4).toFixed(1),"万"]}),e.jsxs("td",{className:"px-4 py-3 font-bold text-slate-900",children:["¥",(s.actualCost/1e4).toFixed(1),"万"]}),e.jsx("td",{className:"px-4 py-3",children:s.isOverAllocated?e.jsx(Y,{variant:"danger",size:"sm",children:"超额"}):e.jsx(Y,{variant:"success",size:"sm",children:"正常"})})]},o))})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[e.jsx("h3",{className:"font-bold text-slate-900 mb-6 border-l-4 border-indigo-500 pl-3",children:"资源岗位技能适配度"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map((s,o)=>{if(!s||!s.resource.skills)return null;const t=s.requirement.requiredSkills||[],x=s.resource.skills.map(r=>r.name),c=t.filter(r=>x.includes(r)),u=t.length>0?c.length/t.length*100:100;return e.jsxs("div",{className:"bg-slate-50/50 rounded-xl p-4 border border-slate-100 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-bold text-slate-900",children:s.resource.name}),e.jsxs("div",{className:`px-2 py-1 rounded-full text-[10px] font-black tracking-widest uppercase ${u===100?"bg-emerald-100 text-emerald-700":u>=50?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:["MATCH ",u.toFixed(0),"%"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-slate-400 font-bold uppercase mb-2",children:"项目需求项:"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.length>0?t.map((r,g)=>e.jsx("span",{className:`px-2 py-0.5 text-[11px] font-medium rounded-md ${c.includes(r)?"bg-emerald-50 text-emerald-700 border border-emerald-100":"bg-red-50 text-red-700 border border-red-100"}`,children:r},g)):e.jsx("span",{className:"text-xs text-slate-400 italic",children:"常规基础技能"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-slate-400 font-bold uppercase mb-2",children:"人才画像特征:"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.resource.skills.map((r,g)=>e.jsxs("span",{className:"px-2 py-0.5 bg-blue-50 text-blue-700 text-[11px] font-medium rounded-md border border-blue-100",children:[r.name," · ",r.level]},g))})]})]})]},o)})})]}),d.totalActualCost>(l.budget||0)&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-6 shadow-sm border-l-8 border-l-red-500",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-white rounded-xl shadow-sm text-red-600",children:e.jsx(ee,{size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-red-900 text-lg mb-1",children:"人力资本预算超支预警"}),e.jsxs("p",{className:"text-sm text-red-800/80 leading-relaxed font-medium",children:["当前实际人力成本 ¥",(d.totalActualCost/1e4).toFixed(2),"万 已超出项目初期核准预算 ¥",((l.budget||0)/1e4).toFixed(2),"万。",e.jsxs("span",{className:"block mt-2 font-bold underline decoration-2 underline-offset-4 decoration-red-300",children:["当前缺口规模：¥",((d.totalActualCost-(l.budget||0))/1e4).toFixed(2),"万，建议优先审视 P2 级以下资源岗位。"]})]})]})]})})]})]})})},fs=({project:l,risks:m,onRisksChange:a,onClose:n})=>{const[i,d]=k.useState("all"),[s,o]=k.useState(!1),[t,x]=k.useState({category:"schedule",probability:3,impact:3,status:"identified",owner:"",mitigationStrategy:""}),c=[{id:"all",label:"全部",icon:me,color:"slate"},{id:"schedule",label:"进度",icon:se,color:"blue"},{id:"cost",label:"成本",icon:ae,color:"green"},{id:"resource",label:"资源",icon:he,color:"purple"},{id:"technical",label:"技术",icon:X,color:"orange"},{id:"external",label:"外部",icon:le,color:"red"}],u=f=>f.probability*f.impact,r=f=>f>=20?{label:"极高",color:"text-red-700",bgColor:"bg-red-50 border-red-200",darkColor:"text-red-400",darkBgColor:"dark:bg-red-900/20 dark:border-red-800"}:f>=15?{label:"高",color:"text-orange-700",bgColor:"bg-orange-50 border-orange-200",darkColor:"text-orange-400",darkBgColor:"dark:bg-orange-900/20 dark:border-orange-800"}:f>=10?{label:"中",color:"text-yellow-700",bgColor:"bg-yellow-50 border-yellow-200",darkColor:"text-yellow-400",darkBgColor:"dark:bg-yellow-900/20 dark:border-yellow-800"}:f>=5?{label:"低",color:"text-blue-700",bgColor:"bg-blue-50 border-blue-200",darkColor:"text-blue-400",darkBgColor:"dark:bg-blue-900/20 dark:border-blue-800"}:{label:"极低",color:"text-slate-700",bgColor:"bg-slate-50 border-slate-200",darkColor:"text-slate-400",darkBgColor:"dark:bg-slate-700/50 dark:border-slate-700"},g=k.useMemo(()=>{if(m.length===0)return{score:0,level:r(0)};const f=m.filter(b=>b.status!=="resolved"),N=f.reduce((b,z)=>b+u(z),0)/f.length;return{score:N,level:r(N)}},[m]),D=i==="all"?m:m.filter(f=>f.category===i),I=k.useMemo(()=>{const f={极高:[],高:[],中:[],低:[],极低:[]};return D.forEach(j=>{const N=u(j),b=r(N);f[b.label].push(j)}),f},[D]),C=()=>{if(!t.title||!t.description){alert("请填写风险标题和描述");return}const f=(t.probability||3)*(t.impact||3),j=f>=20?"critical":f>=15?"high":f>=10?"medium":"low",N={id:`risk-${Date.now()}`,projectId:l.id,category:t.category,title:t.title,description:t.description,probability:t.probability||3,impact:t.impact||3,riskScore:f,priority:j,mitigationStrategy:t.mitigationStrategy||"",mitigationActions:[],owner:t.owner||"",ownerName:t.owner||"",status:"identified",identifiedDate:new Date().toISOString(),history:[{id:`hist-${Date.now()}`,date:new Date().toISOString(),userId:"current-user",userName:"Admin",action:"created",description:"风险已创建"}]};a([...m,N]),x({category:"schedule",probability:3,impact:3,status:"identified",owner:"",mitigationStrategy:""}),o(!1)},y=f=>{a(m.filter(j=>j.id!==f))},q=(f,j)=>{a(m.map(N=>N.id===f?{...N,status:j}:N))};return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(me,{size:32,className:"text-blue-600 dark:text-blue-400"}),e.jsx("h2",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100",children:"风险评估"})]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["项目: ",l.name]})]}),e.jsxs("div",{className:`px-6 py-4 rounded-xl border-2 ${g.level.bgColor} ${g.level.darkBgColor}`,children:[e.jsx("div",{className:"text-xs font-semibold text-slate-600 dark:text-slate-400 mb-1",children:"综合风险等级"}),e.jsx("div",{className:`text-3xl font-bold ${g.level.color} ${g.level.darkColor}`,children:g.level.label}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["评分: ",g.score.toFixed(1)," / 25"]})]}),n&&e.jsx("button",{onClick:n,className:"ml-4 p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(Z,{size:24})})]}),e.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2 no-scrollbar",children:c.map(f=>{const j=f.icon,N=f.id==="all"?m.length:m.filter(w=>w.category===f.id).length,b=i===f.id,z={slate:"bg-slate-600 text-white shadow-md",blue:"bg-blue-600 text-white shadow-md",green:"bg-green-600 text-white shadow-md",purple:"bg-purple-600 text-white shadow-md",orange:"bg-orange-600 text-white shadow-md",red:"bg-red-600 text-white shadow-md"},v={slate:"bg-slate-100 text-slate-700 hover:bg-slate-200 dark:bg-slate-800 dark:text-slate-300",blue:"bg-blue-100 text-blue-700 hover:bg-blue-200 dark:bg-blue-900/30 dark:text-blue-400",green:"bg-green-100 text-green-700 hover:bg-green-200 dark:bg-green-900/30 dark:text-green-400",purple:"bg-purple-100 text-purple-700 hover:bg-purple-200 dark:bg-purple-900/30 dark:text-purple-400",orange:"bg-orange-100 text-orange-700 hover:bg-orange-200 dark:bg-orange-900/30 dark:text-orange-400",red:"bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900/30 dark:text-red-400"};return e.jsxs("button",{onClick:()=>d(f.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap ${b?z[f.color]:v[f.color]}`,children:[e.jsx(j,{size:16}),e.jsx("span",{children:f.label}),e.jsx("span",{className:`ml-1 px-2 py-0.5 rounded-full text-xs ${b?"bg-white/20":"bg-slate-200 dark:bg-slate-700"}`,children:N})]},f.id)})}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>o(!s),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors shadow-lg",children:[e.jsx(ie,{size:18}),"添加风险"]})}),s&&e.jsxs("div",{className:"mb-6 p-6 bg-blue-50 rounded-xl border-2 border-blue-200",children:[e.jsx("h3",{className:"font-bold text-slate-900 mb-4",children:"新增风险"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"风险类别"}),e.jsxs("select",{value:t.category,onChange:f=>x({...t,category:f.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"schedule",children:"进度风险"}),e.jsx("option",{value:"cost",children:"成本风险"}),e.jsx("option",{value:"resource",children:"资源风险"}),e.jsx("option",{value:"technical",children:"技术风险"}),e.jsx("option",{value:"external",children:"外部风险"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"负责人"}),e.jsx("input",{type:"text",value:t.owner||"",onChange:f=>x({...t,owner:f.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"风险负责人"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"风险标题"}),e.jsx("input",{type:"text",value:t.title||"",onChange:f=>x({...t,title:f.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"简要描述风险"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"风险描述"}),e.jsx("textarea",{value:t.description||"",onChange:f=>x({...t,description:f.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"详细描述风险情况"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["发生概率 (1-5): ",t.probability]}),e.jsx("input",{type:"range",min:"1",max:"5",value:t.probability,onChange:f=>x({...t,probability:parseInt(f.target.value)}),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:"极低"}),e.jsx("span",{children:"极高"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["影响程度 (1-5): ",t.impact]}),e.jsx("input",{type:"range",min:"1",max:"5",value:t.impact,onChange:f=>x({...t,impact:parseInt(f.target.value)}),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:"极低"}),e.jsx("span",{children:"极高"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"缓解措施"}),e.jsx("textarea",{value:t.mitigationStrategy||"",onChange:f=>x({...t,mitigationStrategy:f.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2,placeholder:"如何降低或消除此风险"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:C,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:"添加"}),e.jsx("button",{onClick:()=>o(!1),className:"px-6 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg transition-colors",children:"取消"})]})]}),e.jsxs("div",{className:"space-y-6",children:[Object.entries(I).map(([f,j])=>{if(j.length===0)return null;const N=r(f==="极高"?25:f==="高"?18:f==="中"?12:f==="低"?7:3);return e.jsxs("div",{children:[e.jsxs("h3",{className:`font-bold text-lg mb-3 ${N.color}`,children:[f,"风险 (",j.length,")"]}),e.jsx("div",{className:"space-y-3",children:j.map(b=>{var w;const z=u(b),v=r(z);return e.jsxs("div",{className:`p-5 rounded-xl border-2 ${v.bgColor} ${v.darkBgColor} transition-all hover:shadow-lg`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-bold text-lg text-slate-900 dark:text-slate-100",children:b.title}),e.jsx("span",{className:`text-xs font-semibold px-2 py-1 rounded uppercase ${v.color} ${v.darkColor} ${v.bgColor} ${v.darkBgColor}`,children:v.label}),e.jsx("span",{className:"text-xs bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 px-2 py-1 rounded",children:(w=c.find(S=>S.id===b.category))==null?void 0:w.label})]}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 mb-2",children:b.description}),b.mitigationStrategy&&e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400 bg-white/50 dark:bg-black/20 p-2 rounded",children:[e.jsx("strong",{children:"缓解措施:"})," ",b.mitigationStrategy]})]}),e.jsx("button",{onClick:()=>y(b.id),className:"ml-4 p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",children:e.jsx(Z,{size:18})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"概率:"}),e.jsxs("span",{className:"ml-2 font-bold",children:[b.probability,"/5"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"影响:"}),e.jsxs("span",{className:"ml-2 font-bold",children:[b.impact,"/5"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"评分:"}),e.jsxs("span",{className:"ml-2 font-bold",children:[z,"/25"]})]}),b.owner&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"负责人:"}),e.jsx("span",{className:"ml-2 font-medium",children:b.owner})]})]}),e.jsxs("select",{value:b.status,onChange:S=>q(b.id,S.target.value),className:"px-3 py-1 rounded-lg border border-slate-300 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"identified",children:"已识别"}),e.jsx("option",{value:"mitigating",children:"缓解中"}),e.jsx("option",{value:"resolved",children:"已解决"})]})]})]},b.id)})})]},f)}),D.length===0&&e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(me,{size:64,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"暂无风险记录"})]})]})]})},js=({projectName:l,budget:m,existingCosts:a=[],onSave:n,onClose:i})=>{const[d,s]=k.useState(m||0),[o,t]=k.useState(a),[x,c]=k.useState({date:new Date().toISOString().split("T")[0],amount:0,category:"labor",description:""}),u=[{id:"labor",label:"人力成本",color:"#3b82f6"},{id:"equipment",label:"设备成本",color:"#8b5cf6"},{id:"materials",label:"材料成本",color:"#10b981"},{id:"overhead",label:"管理费用",color:"#f59e0b"},{id:"other",label:"其他",color:"#6b7280"}],r=o.reduce((j,N)=>j+N.amount,0),g=d-r,D=d>0?r/d*100:0,I=u.map(j=>({name:j.label,value:o.filter(N=>N.category===j.id).reduce((N,b)=>N+b.amount,0),color:j.color})).filter(j=>j.value>0),C=o.sort((j,N)=>new Date(j.date).getTime()-new Date(N.date).getTime()).reduce((j,N)=>{const b=j.find(z=>z.date===N.date);if(b)b.amount+=N.amount;else{const z=j.length>0?j[j.length-1].cumulative:0;j.push({date:N.date,amount:N.amount,cumulative:z+N.amount})}return j},[]),y=()=>{if(x.amount&&x.amount>0&&x.description){const j={id:Date.now().toString(),date:x.date,amount:x.amount,category:x.category,description:x.description};t([...o,j]),c({date:new Date().toISOString().split("T")[0],amount:0,category:"labor",description:""})}},q=j=>{t(o.filter(N=>N.id!==j))},f=()=>{n(o,d),i()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"成本登记"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["项目: ",l]})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(Z,{size:24,className:"text-slate-500"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-6 text-white",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-blue-100",children:"项目预算"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{size:24}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:d,onChange:j=>s(parseFloat(j.target.value)||0),className:"flex-1 px-4 py-3 rounded-lg bg-white/20 backdrop-blur border border-white/30 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50 text-xl font-bold",placeholder:"输入预算金额"}),e.jsx("span",{className:"text-xl font-bold",children:"元"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-lg p-3",children:[e.jsx("div",{className:"text-blue-100",children:"已用"}),e.jsxs("div",{className:"font-bold text-lg",children:["¥",r.toLocaleString()]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-lg p-3",children:[e.jsx("div",{className:"text-blue-100",children:"剩余"}),e.jsxs("div",{className:`font-bold text-lg ${g<0?"text-red-300":""}`,children:["¥",g.toLocaleString()]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-lg p-3",children:[e.jsx("div",{className:"text-blue-100",children:"使用率"}),e.jsxs("div",{className:`font-bold text-lg ${D>100?"text-red-300":""}`,children:[D.toFixed(1),"%"]})]})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900 rounded-xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-4 flex items-center gap-2",children:[e.jsx(ie,{size:20}),"添加成本记录"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"日期"}),e.jsx("input",{type:"date",value:x.date,onChange:j=>c({...x,date:j.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"金额"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:x.amount,onChange:j=>c({...x,amount:parseFloat(j.target.value)}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"类别"}),e.jsx("select",{value:x.category,onChange:j=>c({...x,category:j.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500",children:u.map(j=>e.jsx("option",{value:j.id,children:j.label},j.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"说明"}),e.jsx("textarea",{value:x.description,onChange:j=>c({...x,description:j.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:2,placeholder:"描述此项成本..."})]}),e.jsxs("button",{onClick:y,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx(ie,{size:18}),"添加记录"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 flex items-center gap-2",children:[e.jsx(pe,{size:20}),"成本记录 (",o.length,")"]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:o.length===0?e.jsx("div",{className:"p-8 text-center text-slate-400",children:"暂无成本记录"}):e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:o.map(j=>{const N=u.find(b=>b.id===j.category);return e.jsx("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors group",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${N==null?void 0:N.color}20`,color:N==null?void 0:N.color},children:N==null?void 0:N.label}),e.jsx("span",{className:"text-xs text-slate-400",children:j.date})]}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 mb-1",children:j.description}),e.jsxs("div",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:["¥",j.amount.toLocaleString()]})]}),e.jsx("button",{onClick:()=>q(j.id),className:"opacity-0 group-hover:opacity-100 p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all",children:e.jsx(Z,{size:16})})]})},j.id)})})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-4",children:"成本构成"}),I.length>0?e.jsx(we,{width:"100%",height:250,children:e.jsxs(Gt,{children:[e.jsx(Ot,{data:I,cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:5,dataKey:"value",label:({name:j,percent:N})=>`${j} ${((N||0)*100).toFixed(0)}%`,children:I.map((j,N)=>e.jsx(gt,{fill:j.color},`cell-${N}`))}),e.jsx(ke,{formatter:j=>`¥${j.toLocaleString()}`})]})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-slate-400",children:"暂无数据"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-4",children:"成本趋势"}),C.length>0?e.jsx(we,{width:"100%",height:250,children:e.jsxs(Ht,{data:C,children:[e.jsx(Ke,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(Ze,{dataKey:"date",tick:{fill:"#64748b",fontSize:12}}),e.jsx(et,{tick:{fill:"#64748b",fontSize:12}}),e.jsx(ke,{formatter:j=>`¥${j.toLocaleString()}`}),e.jsx(tt,{}),e.jsx(Vt,{type:"monotone",dataKey:"cumulative",stroke:"#3b82f6",strokeWidth:2,name:"累计成本",dot:{fill:"#3b82f6",r:4}})]})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-slate-400",children:"暂无数据"})]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-slate-200 dark:border-slate-700 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:["总计: ",e.jsxs("strong",{className:"text-slate-900 dark:text-slate-100 text-lg",children:["¥",r.toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:i,className:"px-6 py-2 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg font-medium transition-colors",children:"取消"}),e.jsx("button",{onClick:f,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors shadow-lg shadow-blue-600/20",children:"保存成本数据"})]})]})]})})},vs=({project:l,onUpdate:m})=>{const{factorDefinitions:a}=st(),n=l.factors||{},{totalScore:i,maxPossibleScore:d,normalizedScore:s}=k.useMemo(()=>{const c=Fe(n,a);return{totalScore:c,maxPossibleScore:10,normalizedScore:c*10}},[n,a]),o=(c,u)=>{const r={...n,[c]:u},g=Fe(r,a);m({factors:r,score:g})},x=(c=>c>=80?"text-green-600 bg-green-50 border-green-200":c>=60?"text-blue-600 bg-blue-50 border-blue-200":c>=40?"text-orange-600 bg-orange-50 border-orange-200":"text-red-600 bg-red-50 border-red-200")(s);return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full p-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:`p-6 rounded-2xl border-2 ${x} flex flex-col items-center justify-center text-center shadow-sm`,children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-700 mb-2",children:"项目战略评分"}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx("span",{className:"text-6xl font-black tracking-tighter",children:s.toFixed(0)}),e.jsx("span",{className:"text-sm font-medium text-slate-500 absolute -top-1 -right-6",children:"/100"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm font-medium opacity-80",children:[s>=80&&e.jsxs(e.Fragment,{children:[e.jsx(X,{size:16})," 极具潜力"]}),s>=60&&s<80&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{size:16})," 值得关注"]}),s<60&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:16})," 需重新评估"]})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-xl border border-slate-200 shadow-sm",children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(ft,{size:16,className:"text-blue-500"}),"评分说明"]}),e.jsx("p",{className:"text-sm text-slate-500 leading-relaxed",children:"该评分用于评估项目的战略价值和优先级。 请根据下方定义的各项影响因素，为本项目进行打分（0-10分）。 系统将根据设定的权重自动计算最终得分。"})]})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Ft,{size:18,className:"text-slate-500"}),"评分因素配置"]}),e.jsxs("span",{className:"text-xs font-medium text-slate-500 bg-slate-200 px-2 py-1 rounded",children:["共 ",a.length," 项指标"]})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1 space-y-6",children:a.length===0?e.jsxs("div",{className:"text-center py-10 text-slate-400",children:[e.jsx("p",{children:"尚未定义评分因素。"}),e.jsx("p",{className:"text-sm mt-2",children:'请前往 "设置" 页面配置评分模型。'})]}):a.map(c=>{const u=n[c.id]||0;return e.jsxs(O.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"group",children:[e.jsxs("div",{className:"flex justify-between items-end mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-slate-800",children:c.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:["权重: ",c.weight,"%"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`text-2xl font-bold ${u>8?"text-green-600":u>5?"text-blue-600":"text-slate-400"}`,children:u}),e.jsx("span",{className:"text-xs text-slate-400",children:" / 10"})]})]}),e.jsxs("div",{className:"relative h-6 flex items-center",children:[e.jsx("input",{type:"range",min:"0",max:"10",step:"1",value:u,onChange:r=>o(c.id,parseInt(r.target.value)),className:"w-full h-2 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-blue-600 z-10 relative"}),e.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 h-2 rounded-l-lg pointer-events-none transition-all duration-3000 bg-blue-100",style:{width:`${u*10}%`}})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-300 mt-1 px-1 font-mono",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"5"}),e.jsx("span",{children:"10"})]})]},c.id)})})]})]})},Ns=(l,m)=>{if(!m.length)return 1;const a=new Date;let n=0,i=0;return m.forEach(d=>{const s=R(d.startDate),o=R(d.endDate),t=W(o,s);if(t<=0)return;const x=W(a,s),c=Math.min(100,Math.max(0,x/t*100));n+=c,i+=d.progress||0}),n===0?1:i/n},ys=l=>{const m=l.actualCost||l.budgetUsed||0,a=l.totalBudget||0;if(m===0||a===0)return 1;const n=l.progress||0,i=a*(n/100);return i===0?1:i/m},de=l=>l>=80?"excellent":l>=60?"good":l>=40?"warning":"critical",ws=(l,m)=>{const a=Ns(l,m),n=[];let i=100;a>=.95?i=100:a>=.85?(i=80,n.push(`进度稍慢，SPI=${a.toFixed(2)}`)):a>=.75?(i=60,n.push(`进度明显落后，SPI=${a.toFixed(2)}`)):(i=40,n.push(`进度严重滞后，SPI=${a.toFixed(2)}`));const d=new Date,s=m.filter(x=>R(x.endDate)<d&&(x.progress||0)<100);s.length>0&&(i-=s.length*5,n.push(`${s.length} 个任务已逾期`));const o=m.filter(x=>{if(x.type!=="milestone")return!1;const c=R(x.endDate),u=W(c,d);return u>0&&u<=7&&(x.progress||0)<100});o.length>0&&n.push(`${o.length} 个里程碑即将到期`);const t=de(i);return{score:Math.max(0,Math.min(100,i)),spi:a,status:t,issues:n}},ks=l=>{const m=ys(l),a=[];let n=100;m>=.95?n=100:m>=.85?(n=80,a.push(`成本稍微超支，CPI=${m.toFixed(2)}`)):m>=.75?(n=60,a.push(`成本明显超支，CPI=${m.toFixed(2)}`)):(n=40,a.push(`成本严重超支，CPI=${m.toFixed(2)}`));const i=l.budgetUsed||0,d=l.totalBudget||0,s=l.progress||0;if(d>0){const t=i/d*100;t>s+10&&(n-=10,a.push(`预算使用率(${t.toFixed(0)}%)超过进度(${s.toFixed(0)}%)`)),t>90&&a.push("预算即将耗尽")}const o=de(n);return{score:Math.max(0,Math.min(100,n)),cpi:m,status:o,issues:a}},Cs=(l,m)=>{const a=[];let n=100,i=0;const d=l.resourceRequirements||[];let s=0,o=0;d.forEach(u=>{s+=u.count,o+=u.count});const t=s>0?o/s*100:100;t<70?(n-=15,a.push(`资源利用率偏低(${t.toFixed(0)}%)`)):t>110&&(n-=20,a.push(`资源过度分配(${t.toFixed(0)}%)`),i++);const x=d.filter(u=>(u.requiredSkills||[]).length>0&&!u.resourceId);x.length>0&&(n-=x.length*5,a.push(`${x.length} 个资源需求未匹配合适技能`));const c=de(n);return{score:Math.max(0,Math.min(100,n)),utilization:t,conflicts:i,status:c,issues:a}},Ss=l=>{const m=[],a=l.risks||[];let n=100;const i=a.filter(t=>t.impact===5||typeof t.impact=="string"&&(t.impact==="critical"||t.impact==="high")),d=a.length;if(d===0)return{score:100,total:0,critical:0,status:"excellent",issues:[]};n-=i.length*15,n-=(d-i.length)*5,i.length>0&&m.push(`存在 ${i.length} 个高危风险`),d>10&&m.push(`风险数量较多(${d}个)`);const s=a.filter(t=>!t.mitigation||t.mitigation.trim()==="");s.length>0&&(n-=s.length*3,m.push(`${s.length} 个风险缺少应对措施`));const o=de(n);return{score:Math.max(0,Math.min(100,n)),total:d,critical:i.length,status:o,issues:m}},Ds=(l,m)=>{const a=[];let n=100;const i=m.length;if(i===0)return{score:100,defectRate:0,status:"excellent",issues:[]};const d=0,s=m.filter(t=>t.status==="active"&&(t.progress||0)>50);if(s.length>0){const t=s.length/i*100;n-=t,a.push(`${s.length} 个任务需要返工`)}const o=de(n);return{score:Math.max(0,Math.min(100,n)),defectRate:d,status:o,issues:a}},Ms=(l,m)=>{const a=[];let n=100;const i=m.filter(c=>(c.progress||0)===100),d=m.length,s=d>0?i.length/d*100:0;s<30&&(n-=20,a.push(`团队速率较低(${s.toFixed(0)}%)`));const o=75,t=new Map;if(m.forEach(c=>{c.assignee&&t.set(c.assignee,(t.get(c.assignee)||0)+1)}),t.size>0){const c=Array.from(t.values()),u=c.reduce((g,D)=>g+D,0)/c.length;Math.max(...c.map(g=>Math.abs(g-u)))>u*.5&&(n-=10,a.push("任务分配不均衡"))}const x=de(n);return{score:Math.max(0,Math.min(100,n)),morale:o,velocity:s,status:x,issues:a}},ze=(l,m,a=[])=>{const n=ws(l,m),i=ks(l),d=Cs(l),s=Ss(l),o=Ds(l,m),t=Ms(l,m),x=n.score*.25+i.score*.2+d.score*.2+s.score*.15+o.score*.1+t.score*.1;return{overall:Math.round(x),schedule:n,cost:i,resources:d,risks:s,quality:o,team:t}},zs=({project:l,tasks:m,allProjects:a,showComparison:n=!1})=>{var c,u;const i=k.useMemo(()=>{const r=ze(l,m,a);return[{dimension:"进度",value:r.schedule.score,fullMark:100},{dimension:"成本",value:r.cost.score,fullMark:100},{dimension:"资源",value:r.resources.score,fullMark:100},{dimension:"风险",value:r.risks.score,fullMark:100},{dimension:"质量",value:r.quality.score,fullMark:100},{dimension:"团队",value:r.team.score,fullMark:100}]},[l,m,a]),d=k.useMemo(()=>ze(l,m,a),[l,m,a]),s=r=>r>=80?{label:"优秀",color:"text-green-600",bg:"bg-green-100",icon:be}:r>=60?{label:"良好",color:"text-blue-600",bg:"bg-blue-100",icon:X}:r>=40?{label:"警告",color:"text-yellow-600",bg:"bg-yellow-100",icon:ee}:{label:"危险",color:"text-red-600",bg:"bg-red-100",icon:Be},o=s(d.overall),t=o.icon,x=({active:r,payload:g})=>{if(r&&g&&g.length){const D=g[0];return e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-lg border border-slate-200",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:D.payload.dimension}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:D.value}),e.jsxs("p",{className:"text-xs text-slate-500",children:["满分: ",D.payload.fullMark]})]})}return null};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"项目健康度"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"text-5xl font-bold text-blue-600",children:d.overall}),e.jsxs("div",{children:[e.jsxs("div",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full ${o.bg} ${o.color} text-sm font-semibold`,children:[e.jsx(t,{size:16}),o.label]}),e.jsxs("p",{className:"text-xs text-slate-600 mt-1",children:[((c=d.schedule)==null?void 0:c.spi)>0&&`SPI: ${d.schedule.spi.toFixed(2)}`,((u=d.cost)==null?void 0:u.cpi)>0&&` | CPI: ${d.cost.cpi.toFixed(2)}`]})]})]})]}),e.jsxs("div",{className:"relative w-32 h-32",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"#E5E7EB",strokeWidth:"8",fill:"none"}),e.jsx(O.circle,{cx:"64",cy:"64",r:"56",stroke:"url(#healthGradient)",strokeWidth:"8",fill:"none",strokeLinecap:"round",initial:{strokeDasharray:"0 352"},animate:{strokeDasharray:`${d.overall/100*352} 352`},transition:{duration:1,ease:"easeOut"}}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"healthGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#3B82F6"}),e.jsx("stop",{offset:"100%",stopColor:"#8B5CF6"})]})})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-2xl font-bold text-slate-700",children:[d.overall,"%"]})})]})]})}),e.jsxs(O.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.3,duration:.5},className:"bg-white rounded-xl p-6 shadow-sm border border-slate-200",children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-900 mb-4",children:"六维健康度分析"}),e.jsx(we,{width:"100%",height:400,children:e.jsxs(jt,{data:i,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"radarGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#3B82F6",stopOpacity:.8}),e.jsx("stop",{offset:"100%",stopColor:"#8B5CF6",stopOpacity:.3})]})}),e.jsx(vt,{stroke:"#E5E7EB"}),e.jsx(Nt,{dataKey:"dimension",tick:{fill:"#64748B",fontSize:14,fontWeight:500}}),e.jsx(yt,{angle:90,domain:[0,100],tick:{fill:"#94A3B8",fontSize:12}}),e.jsx(wt,{name:"健康度",dataKey:"value",stroke:"#3B82F6",fill:"url(#radarGradient)",fillOpacity:.6,strokeWidth:2,dot:{fill:"#3B82F6",r:4},animationDuration:1e3,animationEasing:"ease-out"}),e.jsx(ke,{content:e.jsx(x,{})}),e.jsx(tt,{wrapperStyle:{paddingTop:"20px",fontSize:"14px",fontWeight:500}})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map((r,g)=>{const D=s(r.value),I=D.icon;return e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4+g*.1,duration:.4},className:"bg-white rounded-lg p-4 shadow-sm border border-slate-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700",children:r.dimension}),e.jsx(I,{size:18,className:D.color})]}),e.jsxs("div",{className:"flex items-end gap-2 mb-2",children:[e.jsx("span",{className:"text-3xl font-bold text-slate-900",children:r.value}),e.jsx("span",{className:"text-sm text-slate-500 mb-1",children:"/ 100"})]}),e.jsx("div",{className:"w-full h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx(O.div,{initial:{width:0},animate:{width:`${r.value}%`},transition:{delay:.5+g*.1,duration:.8,ease:"easeOut"},className:`h-full rounded-full ${r.value>=80?"bg-gradient-to-r from-green-400 to-green-600":r.value>=60?"bg-gradient-to-r from-blue-400 to-blue-600":r.value>=40?"bg-gradient-to-r from-yellow-400 to-yellow-600":"bg-gradient-to-r from-red-400 to-red-600"}`})})]},r.dimension)})}),e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1,duration:.5},className:"bg-amber-50 rounded-xl p-6 border border-amber-200",children:[e.jsxs("h4",{className:"text-lg font-semibold text-amber-900 mb-4 flex items-center gap-2",children:[e.jsx(ee,{size:20}),"改进建议"]}),(()=>{const r=[...d.schedule.issues,...d.cost.issues,...d.resources.issues,...d.risks.issues,...d.quality.issues,...d.team.issues];return r.length===0?e.jsx("p",{className:"text-amber-800 text-sm",children:"当前项目健康状况良好，暂无改进建议。"}):e.jsx("ul",{className:"space-y-2",children:r.slice(0,5).map((g,D)=>e.jsxs(O.li,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:1.1+D*.1,duration:.3},className:"flex items-start gap-2 text-amber-800",children:[e.jsx("span",{className:"text-amber-600 mt-1",children:"•"}),e.jsx("span",{children:g})]},D))})})()]})]})},$s=(l,m)=>{const a=new Date,n=l.totalBudget||0,i=l.actualCost||l.budgetUsed||0;let d=0,s=0;if(m.length===0||n===0)return{pv:0,ev:0,ac:i,sv:0,cv:0,spi:1,cpi:1,bac:n,eac:n,etc:0,vac:0,status:{schedule:"on_track",cost:"on_track"}};const o=m.reduce((q,f)=>{const j=R(f.startDate),N=R(f.endDate);return q+Math.max(1,W(N,j))},0),t=o>0?n/o:0;m.forEach(q=>{const f=R(q.startDate),j=R(q.endDate),N=Math.max(1,W(j,f)),b=N*t;if(a>=f){const w=Math.min(N,Math.max(0,W(a,f)))/N;d+=b*w}const z=q.progress||0;s+=b*(z/100)});const x=s-d,c=s-i,u=d>0?s/d:1,r=i>0?s/i:1,g=r>.1?i+(n-s)/r:i+(n-s),D=g-i,I=n-g,C=u>=1?"ahead":u>=.9?"on_track":"behind",y=r>=1?"under_budget":r>=.9?"on_track":"over_budget";return{pv:d,ev:s,ac:i,sv:x,cv:c,spi:u,cpi:r,bac:n,eac:g,etc:D,vac:I,status:{schedule:C,cost:y}}},Ps=(l,m=6)=>{const a=[],n=new Date;for(let s=3;s>0;s--){const o=new Date(n.getFullYear(),n.getMonth()-s,1),t=1-s*.1;a.push({date:T(o,"yyyy-MM"),ac:l.ac*t,ev:l.ev*t,pv:l.pv*t,type:"history"})}a.push({date:T(n,"yyyy-MM"),ac:l.ac,ev:l.ev,pv:l.pv,type:"current"});const i=m,d=l.etc/i;for(let s=1;s<=i;s++){const o=new Date(n.getFullYear(),n.getMonth()+s,1);a.push({date:T(o,"yyyy-MM"),ac:l.ac+d*s,bac:l.bac,type:"forecast"})}return a},Is=({project:l,tasks:m})=>{const a=k.useMemo(()=>$s(l,m),[l,m]),n=k.useMemo(()=>Ps(a),[a]),i=d=>`¥${Math.round(d).toLocaleString()}`;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-lg border-2 ${a.cpi>=1?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"成本绩效 (CPI)"}),e.jsx(Me,{size:18,className:a.cpi>=1?"text-green-600":"text-red-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:a.cpi.toFixed(2)}),e.jsx("div",{className:"text-xs mt-1 text-slate-500",children:a.cpi>=1?"预算内":`超支 ${((1-a.cpi)*100).toFixed(0)}%`})]}),e.jsxs("div",{className:`p-4 rounded-lg border-2 ${a.spi>=1?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"进度绩效 (SPI)"}),e.jsx(Me,{size:18,className:a.spi>=1?"text-green-600":"text-yellow-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:a.spi.toFixed(2)}),e.jsx("div",{className:"text-xs mt-1 text-slate-500",children:a.spi>=1?"提前":`滞后 ${((1-a.spi)*100).toFixed(0)}%`})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"成本偏差 (CV)"}),e.jsx(ae,{size:18,className:a.cv>=0?"text-green-600":"text-red-600"})]}),e.jsxs("div",{className:`text-2xl font-bold ${a.cv>=0?"text-green-600":"text-red-600"}`,children:[a.cv>=0?"+":"",i(a.cv)]}),e.jsx("div",{className:"text-xs mt-1 text-slate-500",children:"EV - AC"})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"进度偏差 (SV)"}),e.jsx(ge,{size:18,className:a.sv>=0?"text-green-600":"text-yellow-600"})]}),e.jsxs("div",{className:`text-2xl font-bold ${a.sv>=0?"text-green-600":"text-yellow-600"}`,children:[a.sv>=0?"+":"",i(a.sv)]}),e.jsx("div",{className:"text-xs mt-1 text-slate-500",children:"EV - PV"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white rounded-lg border border-slate-200 p-6",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(X,{size:20,className:"text-blue-600"}),"完工预测 (EAC)"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-500",children:"完工预算 (BAC)"}),e.jsx("span",{className:"font-medium text-slate-900",children:i(a.bac)})]}),e.jsx("div",{className:"w-full bg-slate-100 rounded-full h-2",children:e.jsx("div",{className:"bg-slate-400 h-2 rounded-full w-full opacity-30"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-500",children:"完工估算 (EAC)"}),e.jsx("span",{className:`font-bold ${a.vac>=0?"text-green-600":"text-red-600"}`,children:i(a.eac)})]}),e.jsxs("div",{className:"w-full bg-slate-100 rounded-full h-2 relative",children:[e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-slate-900 z-10",style:{left:"80%"},title:"BAC"}),e.jsx("div",{className:`h-2 rounded-full ${a.vac>=0?"bg-green-500":"bg-red-500"}`,style:{width:`${Math.min(100,a.eac/(a.bac*1.2)*100)}%`}})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["预计",a.vac>=0?"结余":"超支"," ",i(Math.abs(a.vac))]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900 mb-2",children:"完工尚需 (ETC)"}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:i(a.etc)}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"还需要投入的资金以完成剩余工作"})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-lg border border-slate-200 p-6 flex flex-col",children:[e.jsx("h3",{className:"font-semibold text-slate-900 mb-4",children:"成本趋势预测"}),e.jsxs("div",{className:"flex-1 flex items-end gap-4 min-h-[200px] relative pt-8",children:[n.map((d,s)=>{const o=Math.max(a.eac,a.bac)*1.1,t=(d.ac||d.bac||0)/o*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center group relative",children:[e.jsx("div",{className:`w-full max-w-[40px] rounded-t transition-all ${d.type==="history"?"bg-slate-300":d.type==="current"?"bg-blue-600":"bg-blue-100 border-t-2 border-dashed border-blue-400"}`,style:{height:`${t}%`}}),e.jsx("div",{className:"text-xs text-slate-500 mt-2 rotate-45 origin-top-left",children:d.date}),e.jsxs("div",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-slate-900 text-white text-xs p-2 rounded z-10 whitespace-nowrap",children:[e.jsx("div",{children:d.date}),e.jsxs("div",{children:[d.type==="forecast"?"预测":"实际",": ",i(d.ac||d.bac||0)]})]})]},s)}),e.jsx("div",{className:"absolute left-0 right-0 border-t-2 border-dashed border-slate-400 pointer-events-none flex items-center",style:{bottom:`${a.bac/(Math.max(a.eac,a.bac)*1.1)*100}%`},children:e.jsx("span",{className:"bg-white text-xs text-slate-500 px-1 ml-2",children:"BAC (预算)"})})]})]})]}),a.vac<0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(le,{className:"text-red-600 mt-0.5 flex-shrink-0",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-900 mb-1",children:"成本超支预警"}),e.jsxs("p",{className:"text-sm text-red-700 mb-2",children:["按照当前绩效 (CPI = ",a.cpi.toFixed(2),")，项目预计将超支 ",i(Math.abs(a.vac)),"。"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-3 py-1 bg-red-100 text-red-700 rounded text-xs font-medium hover:bg-red-200 transition-colors",children:"查看详细支出"}),e.jsx("button",{className:"px-3 py-1 bg-white border border-red-200 text-red-700 rounded text-xs font-medium hover:bg-red-50 transition-colors",children:"申请预算变更"})]})]})]})]})},Bs=({project:l,onCreateBaseline:m,onSetActiveBaseline:a,currentUserId:n,currentUserName:i})=>{const[d,s]=k.useState(!1),[o,t]=k.useState(""),[x,c]=k.useState(""),u=l.baselines||[],r=kt(l),g=()=>{if(!o.trim())return;const C=Ct(l,o,x,n,i);m(C),s(!1),t(""),c("")},D=C=>C?St(l,C):null,I=({variance:C,unit:y})=>{const q=Mt(C),f=q==="good"?"text-green-600":q==="warning"?"text-orange-600":"text-red-600",j=C>0?X:C<0?Be:ee;return e.jsxs("div",{className:`flex items-center gap-1 ${f} text-sm font-medium`,children:[e.jsx(j,{size:14}),e.jsx("span",{children:Dt(C,y)})]})};return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Tt,{className:"text-blue-600 dark:text-blue-400",size:20}),e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:"基线管理"}),e.jsxs("span",{className:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs font-medium rounded-full",children:[u.length," 个基线"]})]}),e.jsxs("button",{onClick:()=>s(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(ie,{size:16}),"创建基线"]})]})}),e.jsx(ye,{children:d&&e.jsx(O.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 overflow-hidden",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"基线名称 *"}),e.jsx("input",{type:"text",value:o,onChange:C=>t(C.target.value),placeholder:"例如: Baseline 1.0",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"描述"}),e.jsx("textarea",{value:x,onChange:C=>c(C.target.value),placeholder:"说明创建此基线的原因...",rows:2,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:g,disabled:!o.trim(),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(qe,{size:16}),"创建"]}),e.jsxs("button",{onClick:()=>{s(!1),t(""),c("")},className:"flex items-center gap-2 px-4 py-2 bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg text-sm font-medium transition-colors",children:[e.jsx(Z,{size:16}),"取消"]})]})]})})}),e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:u.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-500 dark:text-slate-400",children:[e.jsx(pe,{size:48,className:"mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"暂无基线"}),e.jsx("p",{className:"text-xs mt-1",children:"创建基线以跟踪项目变更和偏差"})]}):u.map(C=>{const y=(r==null?void 0:r.id)===C.id,q=D(C);return e.jsx("div",{className:`p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors ${y?"bg-blue-50/50 dark:bg-blue-900/10 border-l-4 border-blue-600":""}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-slate-100",children:C.name}),y&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-600 text-white text-xs font-medium rounded-full",children:"当前基线"})]}),C.description&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:C.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{size:12}),T(new Date(C.createdDate),"yyyy-MM-dd HH:mm")]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qe,{size:12}),C.createdByName||C.createdBy]})]}),y&&q&&e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-2 border border-slate-200 dark:border-slate-600",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"进度偏差"}),e.jsx(I,{variance:q.scheduleVariance,unit:"days"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-2 border border-slate-200 dark:border-slate-600",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"成本偏差"}),e.jsx(I,{variance:q.costVariance,unit:"currency"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-2 border border-slate-200 dark:border-slate-600",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"预算偏差"}),e.jsx(I,{variance:q.budgetVariancePercent,unit:"percent"})]})]})]}),!y&&e.jsx("button",{onClick:()=>a(C.id),className:"ml-4 px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:hover:bg-blue-900/20 rounded-lg transition-colors",children:"设为当前"})]})},C.id)})})]})},Xe={standard:[{id:"gate-1",stage:"initiation",name:"Gate 1: 项目启动审批",description:"项目章程和初步范围定义",requirements:[{id:"req-1-1",description:"项目章程已编制",required:!0,completed:!1},{id:"req-1-2",description:"干系人已识别",required:!0,completed:!1},{id:"req-1-3",description:"初步预算已批准",required:!0,completed:!1}],status:"pending"},{id:"gate-2",stage:"planning",name:"Gate 2: 计划审批",description:"详细项目计划和资源分配",requirements:[{id:"req-2-1",description:"项目计划已完成",required:!0,completed:!1},{id:"req-2-2",description:"风险评估已完成",required:!0,completed:!1},{id:"req-2-3",description:"资源已分配",required:!0,completed:!1},{id:"req-2-4",description:"质量标准已定义",required:!1,completed:!1}],status:"pending"},{id:"gate-3",stage:"execution",name:"Gate 3: 执行审批",description:"开始项目执行",requirements:[{id:"req-3-1",description:"团队已组建",required:!0,completed:!1},{id:"req-3-2",description:"启动会议已召开",required:!0,completed:!1},{id:"req-3-3",description:"基线已建立",required:!0,completed:!1}],status:"pending"},{id:"gate-4",stage:"monitoring",name:"Gate 4: 监控审批",description:"项目进度和质量监控",requirements:[{id:"req-4-1",description:"进度报告机制已建立",required:!0,completed:!1},{id:"req-4-2",description:"变更控制流程已实施",required:!0,completed:!1},{id:"req-4-3",description:"质量检查点已设置",required:!1,completed:!1}],status:"pending"},{id:"gate-5",stage:"closing",name:"Gate 5: 项目收尾",description:"项目验收和总结",requirements:[{id:"req-5-1",description:"所有交付物已完成",required:!0,completed:!1},{id:"req-5-2",description:"客户验收已获得",required:!0,completed:!1},{id:"req-5-3",description:"经验教训已总结",required:!0,completed:!1},{id:"req-5-4",description:"项目文档已归档",required:!1,completed:!1}],status:"pending"}]};function Ne(l){return{initiation:"启动",planning:"计划",execution:"执行",monitoring:"监控",closing:"收尾"}[l]}function $e(l){const m=["initiation","planning","execution","monitoring","closing"],a=m.indexOf(l);return a<m.length-1?m[a+1]:null}function qs(l){return l.requirements.filter(a=>a.required).every(a=>a.completed)}function Rs(l){const m=l.requirements.length;if(m===0)return 100;const a=l.requirements.filter(n=>n.completed).length;return Math.round(a/m*100)}function Ue(l){return{pending:"text-slate-600 bg-slate-100 dark:text-slate-400 dark:bg-slate-700",requested:"text-blue-600 bg-blue-100 dark:text-blue-400 dark:bg-blue-900/20",approved:"text-green-600 bg-green-100 dark:text-green-400 dark:bg-green-900/20",rejected:"text-red-600 bg-red-100 dark:text-red-400 dark:bg-red-900/20",conditional:"text-orange-600 bg-orange-100 dark:text-orange-400 dark:bg-orange-900/20"}[l]}function We(l){return{pending:"待申请",requested:"申请中",approved:"已批准",rejected:"已拒绝",conditional:"有条件批准"}[l]}function As(l,m,a,n,i){return{...l,status:i&&i.length>0?"conditional":"approved",approvedBy:m,approvedByName:a,approvalDate:new Date().toISOString(),comments:n,conditions:i}}function Ls(l){return{...l,status:"requested"}}function Fs(l,m,a,n){return{...l,status:"rejected",approvedBy:m,approvedByName:a,approvalDate:new Date().toISOString(),comments:n}}function Ts(l,m,a,n,i){return{...l,requirements:l.requirements.map(d=>d.id===m?{...d,completed:a,completedDate:a?new Date().toISOString():void 0,completedBy:a?n:void 0,evidence:a?i:void 0}:d)}}const Es=({project:l,onUpdateGate:m,onMoveToNextStage:a,currentUserId:n,currentUserName:i,userRole:d,onRequestApproval:s})=>{const[o,t]=k.useState(null),[x,c]=k.useState(""),[u,r]=k.useState(""),g=d==="admin",D=d==="manager",I=D||g,C=["initiation","planning","execution","monitoring","closing"].indexOf(l.currentStage),y=(b,z,v)=>{const w=Ts(b,z,v,n);m(w)},q=b=>{const z=Ls(b);m(z),s&&s(z)},f=b=>{const z=u.trim()?u.split(`
`).filter(w=>w.trim()):void 0,v=As(b,n,i,x||void 0,z);m(v),t(null),c(""),r("")},j=b=>{if(!x.trim()){alert("请输入拒绝原因");return}const z=Fs(b,n,i,x);m(z),t(null),c("")},N=({stage:b,index:z})=>{const v=z===C,w=z<C,S=l.gates.find(p=>p.stage===b);return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`relative flex items-center justify-center w-16 h-16 rounded-full border-4 ${w?"border-green-500 bg-green-100 dark:bg-green-900/20":v?"border-blue-500 bg-blue-100 dark:bg-blue-900/20":"border-slate-300 dark:border-slate-600 bg-slate-100 dark:bg-slate-800"}`,children:w?e.jsx(be,{className:"text-green-600 dark:text-green-400",size:32}):v?e.jsx(ue,{className:"text-blue-600 dark:text-blue-400",size:32}):e.jsx(ue,{className:"text-slate-400 dark:text-slate-600",size:32})}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("div",{className:`text-sm font-semibold ${v?"text-blue-600 dark:text-blue-400":"text-slate-700 dark:text-slate-300"}`,children:Ne(b)}),S&&e.jsx("div",{className:`text-xs mt-1 px-2 py-0.5 rounded-full inline-block ${Ue(S.status)}`,children:We(S.status)})]})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100 mb-6",children:"项目阶段进度"}),e.jsx("div",{className:"flex items-center justify-between",children:["initiation","planning","execution","monitoring","closing"].map((b,z)=>e.jsxs(Pe.Fragment,{children:[e.jsx(N,{stage:b,index:z}),z<4&&e.jsx(at,{className:`mx-2 ${z<C?"text-green-600 dark:text-green-400":"text-slate-300 dark:text-slate-600"}`,size:24})]},b))})]}),e.jsx("div",{className:"space-y-4",children:l.gates.map(b=>{const z=Rs(b),v=qs(b),w=o===b.id;return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",onClick:()=>t(w?null:b.id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:b.name}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${Ue(b.status)}`,children:We(b.status)})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:b.description})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("div",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:[z,"%"]}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"完成度"})]})]}),e.jsx("div",{className:"mt-3 h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx(O.div,{initial:{width:0},animate:{width:`${z}%`},className:`h-full ${z===100?"bg-green-500":z>=50?"bg-blue-500":"bg-orange-500"}`})})]}),e.jsx(ye,{children:w&&e.jsx(O.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100 mb-3",children:"检查清单"}),e.jsx("div",{className:"space-y-2",children:b.requirements.map(S=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 dark:bg-slate-900/50 rounded-lg",children:[e.jsx("button",{onClick:()=>I&&y(b,S.id,!S.completed),disabled:!I||b.status==="approved"||b.status==="requested",className:`flex-shrink-0 w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${S.completed?"bg-green-500 border-green-500":"border-slate-300 dark:border-slate-600 hover:border-green-500"} ${!I||b.status==="approved"||b.status==="requested"?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:S.completed&&e.jsx(qe,{size:14,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm ${S.completed?"text-slate-500 dark:text-slate-400 line-through":"text-slate-900 dark:text-slate-100"}`,children:S.description}),S.required&&e.jsx("span",{className:"px-2 py-0.5 bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-400 text-xs rounded-full",children:"必需"})]}),S.completedDate&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["完成于 ",new Date(S.completedDate).toLocaleDateString("zh-CN"),S.completedBy&&` by ${S.completedBy}`]})]})]},S.id))})]}),b.status==="pending"&&D&&e.jsx("div",{className:"pt-4 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/10 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600",children:e.jsx(pe,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-slate-900 dark:text-slate-100",children:"发起审批申请"}),e.jsx("p",{className:"text-xs text-slate-500",children:"已完成所有必需项，可申请 PMO 审核进入下一阶段"})]})]}),e.jsx("button",{onClick:()=>q(b),disabled:!v,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 text-white rounded-lg text-sm font-bold shadow-lg shadow-blue-500/20 transition-all whitespace-nowrap flex-shrink-0",children:"提交申请"})]})}),b.status==="requested"&&g&&e.jsxs("div",{className:"pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("h5",{className:"text-sm font-black uppercase tracking-widest text-slate-400 mb-4 flex items-center gap-2",children:[e.jsx(_t,{size:16})," PMO 审批决策"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase ml-1",children:"审批意见"}),e.jsx("textarea",{value:x,onChange:S=>c(S.target.value),rows:2,className:"w-full px-4 py-3 border border-slate-200 dark:border-slate-700 rounded-2xl bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 focus:ring-4 focus:ring-blue-100 outline-none transition-all",placeholder:"请输入详细的评审意见..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase ml-1",children:"附加条件 (可选)"}),e.jsx("textarea",{value:u,onChange:S=>r(S.target.value),rows:2,className:"w-full px-4 py-3 border border-slate-200 dark:border-slate-700 rounded-2xl bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 focus:ring-4 focus:ring-blue-100 outline-none transition-all",placeholder:"每行一个附加执行条件..."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>f(b),className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-2xl font-bold transition-all shadow-xl shadow-green-500/20 whitespace-nowrap flex-shrink-0",children:[e.jsx(be,{size:18}),"批准通过"]}),e.jsxs("button",{onClick:()=>j(b),className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-2xl font-bold transition-all shadow-xl shadow-red-500/20 whitespace-nowrap flex-shrink-0",children:[e.jsx(lt,{size:18}),"拒绝申请"]})]})]})]}),b.status==="requested"&&!g&&e.jsx("div",{className:"pt-4 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"p-4 bg-amber-50 dark:bg-amber-900/10 rounded-xl flex items-center gap-3",children:[e.jsx(se,{size:20,className:"text-amber-600"}),e.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-400 font-medium",children:"已提交申请，请等待 PMO 审核通过。"})]})}),b.status!=="pending"&&e.jsx("div",{className:"pt-4 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-slate-50 dark:bg-slate-900/50 rounded-lg",children:[e.jsx(pe,{size:16,className:"text-slate-600 dark:text-slate-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:[b.approvedByName||b.approvedBy," · ",new Date(b.approvalDate).toLocaleDateString("zh-CN")]}),b.comments&&e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:b.comments}),b.conditions&&b.conditions.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs font-medium text-orange-700 dark:text-orange-400 mb-1",children:"附加条件："}),e.jsx("ul",{className:"list-disc list-inside text-sm text-slate-600 dark:text-slate-400",children:b.conditions.map((S,p)=>e.jsx("li",{children:S},p))})]})]})]})})]})})})]},b.id)})}),g&&$e(l.currentStage)&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100",children:"准备进入下一阶段？"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:["当前阶段：",Ne(l.currentStage)," → 下一阶段：",Ne($e(l.currentStage))]})]}),e.jsx("button",{onClick:a,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:"进入下一阶段"})]})})]})},Gs=({project:l,changeRequests:m})=>{const a=k.useMemo(()=>Xt(l,m),[l,m]),n=k.useMemo(()=>Ut(a),[a]),i=s=>s<10?"text-green-600 dark:text-green-400":s<20?"text-yellow-600 dark:text-yellow-400":s<30?"text-orange-600 dark:text-orange-400":"text-red-600 dark:text-red-400",d=s=>s<10?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":s<20?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":s<30?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800";return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ne,{className:`border ${d(a.creepPercentage)}`,children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:`w-6 h-6 ${i(a.creepPercentage)}`}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"范围蔓延指数"})]}),a.requiresRebaseline&&e.jsxs(Y,{variant:"error",children:[e.jsx(le,{className:"w-4 h-4 mr-1"}),"需要重新基线"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[e.jsxs("span",{className:`text-4xl font-bold ${i(a.creepPercentage)}`,children:[a.creepPercentage.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:"超出基线"})]}),e.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all ${a.creepPercentage<10?"bg-green-500":a.creepPercentage<20?"bg-yellow-500":a.creepPercentage<30?"bg-orange-500":"bg-red-500"}`,style:{width:`${Math.min(a.creepPercentage,100)}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 dark:text-slate-400 mt-1",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{className:"text-orange-500",children:"30% 阈值"}),e.jsx("span",{children:"100%"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(se,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"基线工时"})]}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:a.baselineEffortHours.toLocaleString()}),e.jsx("p",{className:"text-xs text-slate-500",children:"小时"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(se,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"当前工时"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:a.currentEffortHours.toLocaleString()}),e.jsxs("p",{className:"text-xs text-slate-500",children:["+",(a.currentEffortHours-a.baselineEffortHours).toLocaleString()," 小时"]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-3 text-center",children:[e.jsx(pe,{className:"w-5 h-5 text-slate-400 mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:a.totalChangeRequests}),e.jsx("p",{className:"text-xs text-slate-500",children:"总变更"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-3 text-center",children:[e.jsx(be,{className:"w-5 h-5 text-green-500 mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:a.approvedChanges}),e.jsx("p",{className:"text-xs text-slate-500",children:"已批准"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-3 text-center",children:[e.jsx(se,{className:"w-5 h-5 text-yellow-500 mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold text-yellow-600 dark:text-yellow-400",children:a.pendingChanges}),e.jsx("p",{className:"text-xs text-slate-500",children:"待审批"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-3 text-center",children:[e.jsx(lt,{className:"w-5 h-5 text-red-500 mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:a.rejectedChanges}),e.jsx("p",{className:"text-xs text-slate-500",children:"已拒绝"})]})]})]})}),n&&e.jsx(ne,{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(le,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-red-900 dark:text-red-100 mb-2",children:"范围蔓延警告"}),e.jsx("pre",{className:"text-sm text-red-800 dark:text-red-200 whitespace-pre-wrap font-sans",children:n})]})]})})})]})},Os=({project:l,onSubmit:m,onCancel:a,currentUser:n})=>{const[i,d]=k.useState({title:"",description:"",category:"scope",estimatedEffortHours:0,estimatedCostIncrease:0,scheduleImpactDays:0,impactLevel:"medium",businessJustification:"",alternativeConsidered:"",riskIfNotImplemented:""}),[s,o]=k.useState(null),t=(c,u)=>{const r={...i,[c]:u};if(d(r),c==="estimatedCostIncrease"||c==="scheduleImpactDays"||c==="businessJustification"){const g={projectId:l.id,projectName:l.name,requestedBy:n.id,requestedByName:n.name,requestDate:new Date().toISOString(),createdAt:new Date().toISOString(),...r};o(Oe(l,g))}},x=()=>{const c={projectId:l.id,projectName:l.name,requestedBy:n.id,requestedByName:n.name,requestDate:new Date().toISOString(),status:"pending",...i},u=Oe(l,c);o(u),u.isValid&&m(c)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx(ne,{className:"max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"w-6 h-6 text-orange-500"}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"变更影响评估"})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4 mb-6",children:e.jsxs("p",{className:"text-sm text-orange-800 dark:text-orange-200",children:[e.jsx("strong",{children:"重要提示："})," 所有变更必须进行影响评估。请如实填写工时、成本和进度影响。"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"变更标题 *"}),e.jsx("input",{type:"text",value:i.title,onChange:c=>t("title",c.target.value),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"简要描述变更内容"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"详细描述 *"}),e.jsx("textarea",{value:i.description,onChange:c=>t("description",c.target.value),rows:3,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"详细说明变更的具体内容"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100 mb-4",children:"影响评估（必填）"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(se,{className:"w-4 h-4 inline mr-1"}),"增加工时（小时）*"]}),e.jsx("input",{type:"number",value:i.estimatedEffortHours,onChange:c=>t("estimatedEffortHours",Number(c.target.value)),min:"0",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(ae,{className:"w-4 h-4 inline mr-1"}),"增加成本（元）*"]}),e.jsx("input",{type:"number",value:i.estimatedCostIncrease,onChange:c=>t("estimatedCostIncrease",Number(c.target.value)),min:"0",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(X,{className:"w-4 h-4 inline mr-1"}),"延后天数 *"]}),e.jsx("input",{type:"number",value:i.scheduleImpactDays,onChange:c=>t("scheduleImpactDays",Number(c.target.value)),min:"0",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"业务理由 * （至少 20 字符）"}),e.jsx("textarea",{value:i.businessJustification,onChange:c=>t("businessJustification",c.target.value),rows:3,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800",placeholder:"为什么必须进行这个变更？对业务有什么价值？"}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[i.businessJustification.length," / 20 字符"]})]}),s&&e.jsxs("div",{className:"space-y-2",children:[s.errors.map((c,u)=>e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:c})},u)),s.warnings.map((c,u)=>e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:c})},u))]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-6 border-t border-slate-200 dark:border-slate-700",children:[e.jsx(K,{onClick:x,disabled:!(s!=null&&s.isValid),className:"flex-1",children:"提交变更请求"}),e.jsx(K,{onClick:a,variant:"outline",className:"flex-1",children:"取消"})]})]})})})},Hs=({tasks:l})=>{const m=l.length,a=l.filter(t=>t.status==="completed").length,n=m>0?a/m*100:0,i=l.filter(t=>t.type==="milestone"),d=i.filter(t=>t.status==="completed").length,s=i.filter(t=>t.status!=="completed").sort((t,x)=>R(t.startDate).getTime()-R(x.startDate).getTime())[0],o=l.filter(t=>t.status==="completed"?!1:R(t.endDate).getTime()<new Date().getTime());return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 text-blue-600 rounded-xl",children:e.jsx(X,{size:20})}),e.jsxs("span",{className:"text-xs font-bold text-blue-600 px-2 py-1 bg-blue-50 rounded-full",children:[n.toFixed(0),"%"]})]}),e.jsx("h4",{className:"text-sm font-medium text-slate-500 mb-1",children:"整体任务进展"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:a}),e.jsxs("span",{className:"text-sm text-slate-400",children:["/ ",m," 任务"]})]}),e.jsx("div",{className:"mt-4 h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-1000 ease-out",style:{width:`${n}%`}})})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"p-2 bg-purple-50 text-purple-600 rounded-xl",children:e.jsx(ge,{size:20})}),s&&e.jsxs("span",{className:"text-[10px] font-bold text-amber-600 px-2 py-1 bg-amber-50 rounded-full flex items-center gap-1",children:[e.jsx(re,{size:10}),"最近: ",T(R(s.startDate),"MM-dd")]})]}),e.jsx("h4",{className:"text-sm font-medium text-slate-500 mb-1",children:"关键里程碑"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:d}),e.jsxs("span",{className:"text-sm text-slate-400",children:["/ ",i.length," 交付物"]})]}),e.jsx("p",{className:"mt-2 text-xs text-slate-500 truncate",children:s?`下个目标: ${s.name}`:"所有里程碑已完成"})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"p-2 bg-indigo-50 text-indigo-600 rounded-xl",children:e.jsx(ls,{size:20})}),e.jsx("span",{className:"text-xs font-bold text-indigo-600 px-2 py-1 bg-indigo-50 rounded-full",children:"正常"})]}),e.jsx("h4",{className:"text-sm font-medium text-slate-500 mb-1",children:"资源调度健康"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:"100%"}),e.jsx("span",{className:"text-sm text-slate-400",children:"匹配率"})]}),e.jsx("p",{className:"mt-2 text-xs text-slate-500",children:"当前人力资源分配合理，无过载风险"})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"p-2 bg-orange-50 text-orange-600 rounded-xl",children:e.jsx(le,{size:20})}),o.length>0&&e.jsxs("span",{className:"animate-pulse text-xs font-bold text-red-600 px-2 py-1 bg-red-50 rounded-full",children:[o.length," 项延期"]})]}),e.jsx("h4",{className:"text-sm font-medium text-slate-500 mb-1",children:"进度风险预警"}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("span",{className:`text-2xl font-bold ${o.length>0?"text-red-600":"text-slate-900"}`,children:o.length>0?"需介入":"稳健"})}),e.jsx("p",{className:"mt-2 text-xs text-slate-500",children:o.length>0?`有 ${o.length} 个任务超出计划日期`:"进度与基线完全吻合"})]})]})},Vs=({existingTasks:l,resourcePool:m})=>{const[a,n]=k.useState({name:"",durationDays:5,resourceId:"",dependencyId:"",startDate:T(new Date,"yyyy-MM-dd")}),[i,d]=k.useState(!1),s=k.useMemo(()=>{if(!a.name||!i)return null;const o=_(R(a.startDate),a.durationDays),t=m.find(c=>c.id===a.resourceId);a.dependencyId;const x=t?1/t.totalQuantity*100:0;return{endDate:T(o,"yyyy-MM-dd"),resourceLoadIncrease:x,riskLevel:a.durationDays>10?"high":"medium",conflicts:a.resourceId==="res-1"?["前端资源池在 2025-02 月份已饱和"]:[]}},[a,i,m,l]);return e.jsxs(ne,{className:"p-6 bg-slate-50/50 border-dashed border-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 text-indigo-600",children:[e.jsx(te,{size:20,fill:"currentColor"}),e.jsx("h3",{className:"font-bold text-lg",children:"新任务影响分析模拟 (AI)"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"预期新增任务名称"}),e.jsx("input",{type:"text",className:"w-full px-4 py-2 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 bg-white",placeholder:"如：增加移动端适配模块",value:a.name,onChange:o=>n({...a,name:o.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"预计工期 (天)"}),e.jsx("input",{type:"number",className:"w-full px-4 py-2 border border-slate-200 rounded-xl bg-white",value:a.durationDays,onChange:o=>n({...a,durationDays:parseInt(o.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"责任岗位/人员"}),e.jsxs("select",{className:"w-full px-4 py-2 border border-slate-200 rounded-xl bg-white",value:a.resourceId,onChange:o=>n({...a,resourceId:o.target.value}),children:[e.jsx("option",{value:"",children:"选择资源..."}),m.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]})]})]}),e.jsx(K,{onClick:()=>d(!0),variant:"primary",className:"w-full py-6 rounded-xl text-lg font-bold shadow-indigo-100 shadow-lg",disabled:!a.name,children:"开始影响因子分析"})]}),e.jsx("div",{className:"relative min-h-[200px] flex items-center justify-center border border-slate-200 rounded-2xl bg-white p-6",children:i?e.jsxs("div",{className:"w-full space-y-6 animate-in fade-in slide-in-from-right-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-bold text-slate-900",children:"模拟结果报告"}),e.jsx(Y,{variant:(s==null?void 0:s.riskLevel)==="high"?"danger":"warning",children:(s==null?void 0:s.riskLevel)==="high"?"高风险":"中等风险"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 rounded-xl",children:[e.jsx(re,{className:"text-blue-600 mt-1",size:18}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 font-bold uppercase",children:"关键路径偏移"}),e.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["此任务将导致项目最终交付日期推迟约 ",e.jsxs("span",{className:"text-blue-700 font-bold",children:[a.durationDays," 天"]}),"(预计至 ",s==null?void 0:s.endDate,")"]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-amber-50 rounded-xl",children:[e.jsx(rt,{className:"text-amber-600 mt-1",size:18}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-amber-600 font-bold uppercase",children:"资源压力变化"}),e.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["对应资源池负荷将上升 ",e.jsxs("span",{className:"text-amber-700 font-bold",children:[s==null?void 0:s.resourceLoadIncrease.toFixed(1),"%"]})]})]})]}),(s==null?void 0:s.conflicts)&&s.conflicts.length>0&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-red-50 rounded-xl border border-red-100",children:[e.jsx(ee,{className:"text-red-600 mt-1",size:18}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-600 font-bold uppercase",children:"检测到冲突"}),s.conflicts.map((o,t)=>e.jsx("p",{className:"text-sm font-medium text-red-700",children:o},t))]})]})]}),e.jsx("div",{className:"pt-4 border-t border-slate-100 text-center",children:e.jsx("button",{onClick:()=>d(!1),className:"text-xs text-slate-400 hover:text-indigo-600 transition-colors",children:"清除模拟结果并重新分析"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx(Be,{size:48,className:"mx-auto text-slate-200 mb-4"}),e.jsx("p",{className:"text-slate-400 text-sm italic",children:"输入模拟数据以预测对项目基线的影响"})]})})]})]})},_s=({project:l,resourcePool:m,onUpdateMembers:a})=>{const[n,i]=k.useState(!1),[d,s]=k.useState(""),o=Pe.useMemo(()=>{const r=[];return m.forEach(g=>{g.members&&g.members.forEach(D=>{r.find(I=>I.id===D.id)||r.push({...D,department:g.name})})}),r},[m]),t=l.pdsgMembers||[],x=o.filter(r=>(r.name.toLowerCase().includes(d.toLowerCase())||r.role.toLowerCase().includes(d.toLowerCase()))&&!t.find(g=>g.id===r.id)),c=r=>{a([...t,r])},u=r=>{a(t.filter(g=>g.id!==r))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-900 flex items-center gap-2",children:[e.jsx(me,{className:"text-indigo-600",size:24}),"PDSG 核心管理小组"]}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"负责项目核心决策与关键节点执行，所有任务可指派给小组成员"})]}),e.jsx(K,{variant:"primary",icon:ie,onClick:()=>i(!0),children:"添加核心成员"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(r=>e.jsxs(ne,{className:"p-4 hover:shadow-md transition-all border-l-4 border-indigo-500 relative group",children:[e.jsx("button",{onClick:()=>u(r.id),className:"absolute top-2 right-2 p-1 text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Z,{size:16})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold text-lg overflow-hidden border border-indigo-200",children:r.avatar?e.jsx("img",{src:r.avatar,alt:r.name,className:"w-full h-full object-cover"}):r.name.substring(0,1)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900",children:r.name}),e.jsx("p",{className:"text-xs text-slate-500",children:r.role}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(Y,{size:"sm",variant:"primary",children:r.department||"核心组"}),e.jsx(Y,{size:"sm",variant:"neutral",children:r.position||"专家"})]})]})]})]},r.id)),t.length===0&&e.jsxs("div",{className:"col-span-full py-12 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200 flex flex-col items-center justify-center text-slate-400",children:[e.jsx(he,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{children:"暂未设置 PDSG 成员，点击右上角添加"})]})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[100] flex items-center justify-center p-4",children:e.jsxs(ne,{className:"w-full max-w-2xl bg-white shadow-2xl rounded-[32px] overflow-hidden flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"p-8 border-b border-slate-100 flex justify-between items-center bg-indigo-50/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-600 rounded-2xl flex items-center justify-center shadow-lg shadow-indigo-500/30 text-white",children:e.jsx(rt,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"选择核心成员"}),e.jsx("p",{className:"text-sm text-slate-500",children:"从资源池中筛选符合资质的人员加入 PDSG"})]})]}),e.jsx("button",{onClick:()=>i(!1),className:"p-2 hover:bg-white rounded-full transition-colors",children:e.jsx(Z,{size:24,className:"text-slate-400"})})]}),e.jsxs("div",{className:"p-8 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx(zt,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:20}),e.jsx("input",{type:"text",placeholder:"搜索姓名、角色或技能...",className:"w-full pl-12 pr-4 py-4 rounded-2xl border border-slate-200 focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 outline-none transition-all text-lg",value:d,onChange:r=>s(r.target.value)})]}),e.jsxs("div",{className:"space-y-3",children:[x.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl border border-slate-100 hover:border-indigo-200 hover:bg-indigo-50/30 transition-all cursor-pointer group",onClick:()=>c(r),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-500",children:r.name.substring(0,1)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-slate-900 group-hover:text-indigo-600 transition-colors",children:r.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:[r.role," · ",r.department]})]})]}),e.jsx(K,{size:"sm",variant:"ghost",className:"text-indigo-600 font-bold",children:"选择"})]},r.id)),x.length===0&&e.jsx("div",{className:"text-center py-12 text-slate-400",children:"没有找到匹配的成员"})]})]}),e.jsx("div",{className:"p-6 bg-slate-50 border-t border-slate-100 flex justify-end",children:e.jsx(K,{variant:"secondary",onClick:()=>i(!1),children:"关闭"})})]})})]})},xa=()=>{const{projectId:l}=$t(),m=Pt(),{projects:a,updateProject:n,user:i}=st(),d=It(),{addChangeRequest:s,getChangeRequestsByProject:o}=Bt(),t=a.find(p=>p.id===l),[x,c]=k.useState(!1),[u,r]=k.useState("diagram"),[g,D]=k.useState(!1),[I,C]=k.useState(!1),[y,q]=k.useState(!1);if(!t)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"项目未找到"}),e.jsx("button",{onClick:()=>m("/projects"),className:"text-blue-600 hover:underline",children:"返回项目列表"})]})});const f=t.costHistory||[],j=t.budget||1e6,N=k.useMemo(()=>ze(t,t.tasks||[],a),[t,a]),b=p=>p>=80?"text-green-600 bg-green-50 border-green-200":p>=60?"text-blue-600 bg-blue-50 border-blue-200":p>=40?"text-orange-600 bg-orange-50 border-orange-200":"text-red-600 bg-red-50 border-red-200",z=p=>{const B=t.tasks||[],M=B.findIndex(V=>V.id===p.id);let L;M>=0?(L=[...B],L[M]=p):L=[...B,p],n(t.id,{...t,tasks:L})},v=p=>{const M=[...t.tasks||[],p];n(t.id,{...t,tasks:M})},w=p=>{const M=(t.tasks||[]).filter(L=>L.id!==p);n(t.id,{...t,tasks:M})},S=(p,B)=>{const M=p.reduce((L,V)=>L+V.amount,0);n(t.id,{...t,costHistory:p,budget:B||t.budget,actualCost:M}),D(!1)};return e.jsxs("div",{className:"flex flex-col h-screen bg-slate-50 overflow-hidden",children:[e.jsxs("div",{className:"bg-white border-b border-slate-200 px-4 py-2 flex items-center justify-between shadow-sm z-20 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>m("/projects"),className:"p-2 hover:bg-slate-100 rounded-full text-slate-500",children:e.jsx(He,{size:20})}),e.jsx("div",{className:"h-6 w-px bg-slate-200"}),x?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:t.name,onChange:p=>n(t.id,{...t,name:p.target.value}),className:"font-bold text-lg border-b border-blue-500 focus:outline-none px-1"}),e.jsxs("select",{value:t.status,onChange:p=>n(t.id,{...t,status:p.target.value}),className:"text-sm bg-slate-50 border rounded px-2 py-1",children:[e.jsx("option",{value:"planning",children:"规划中"}),e.jsx("option",{value:"active",children:"进行中"}),e.jsx("option",{value:"completed",children:"已完成"}),e.jsx("option",{value:"on-hold",children:"暂停"})]}),e.jsxs("select",{value:t.priority,onChange:p=>n(t.id,{...t,priority:p.target.value}),className:"text-sm bg-slate-50 border rounded px-2 py-1",children:[e.jsx("option",{value:"P0",children:"P0 - 紧急"}),e.jsx("option",{value:"P1",children:"P1 - 高"}),e.jsx("option",{value:"P2",children:"P2 - 中"}),e.jsx("option",{value:"P3",children:"P3 - 低"})]})]}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"font-bold text-lg text-slate-800 dark:text-slate-100",children:t.name}),e.jsx(Y,{variant:t.status==="active"?"success":t.status==="planning"?"primary":"neutral",size:"sm",children:t.status}),e.jsx(Y,{variant:t.priority==="P0"?"danger":t.priority==="P1"?"warning":"primary",size:"sm",children:t.priority}),e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-0.5 rounded-full border text-xs font-bold ${b(N.overall)}`,children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-current"}),e.jsxs("span",{children:[N.overall," 分"]})]})]}),e.jsx("button",{onClick:()=>c(!x),className:`p-1.5 rounded-lg transition-colors ${x?"bg-blue-100 text-blue-600":"hover:bg-slate-100 text-slate-400"}`,children:x?e.jsx(qe,{size:16}):e.jsx(Wt,{size:16})})]}),e.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-lg overflow-x-auto no-scrollbar scroll-smooth",children:[e.jsxs("button",{onClick:()=>r("diagram"),className:`px-3 py-1.5 text-sm font-medium rounded-md whitespace-nowrap flex-shrink-0 flex items-center gap-2 transition-all ${u==="diagram"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(Te,{size:16})," 任务视图"]}),e.jsxs("button",{onClick:()=>r("resources"),className:`px-3 py-1.5 text-sm font-medium rounded-md whitespace-nowrap flex-shrink-0 flex items-center gap-2 transition-all ${u==="resources"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(he,{size:16})," 资源池"]}),e.jsxs("button",{onClick:()=>r("pdsg"),className:`px-3 py-1.5 text-sm font-medium rounded-md whitespace-nowrap flex-shrink-0 flex items-center gap-2 transition-all ${u==="pdsg"?"bg-white text-indigo-600 shadow-sm font-bold":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(me,{size:16})," PDSG 核心组"]}),e.jsxs("button",{onClick:()=>r("risks"),className:`px-3 py-1.5 text-sm font-medium rounded-md whitespace-nowrap flex-shrink-0 flex items-center gap-2 transition-all relative ${u==="risks"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(le,{size:16})," 风险",t.risks&&t.risks.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-500 rounded-full",children:t.risks.filter(p=>p.status!=="resolved"&&p.status!=="accepted").length})]}),e.jsxs("button",{onClick:()=>r("costs"),className:`px-3 py-1.5 text-sm font-medium rounded-md whitespace-nowrap flex-shrink-0 flex items-center gap-2 transition-all ${u==="costs"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(ae,{size:16})," 成本"]}),e.jsxs("button",{onClick:()=>r("analytics"),className:`px-3 py-1.5 text-sm font-medium rounded-md whitespace-nowrap flex-shrink-0 flex items-center gap-2 transition-all ${u==="analytics"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(qt,{size:16})," 高级分析"]}),e.jsxs("button",{onClick:()=>r("strategy"),className:`px-3 py-1.5 text-sm font-medium rounded-md whitespace-nowrap flex-shrink-0 flex items-center gap-2 transition-all ${u==="strategy"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(ge,{size:16})," 战略评分"]}),e.jsxs("button",{onClick:()=>r("baseline"),className:`px-3 py-1.5 text-sm font-medium rounded-md whitespace-nowrap flex-shrink-0 flex items-center gap-2 transition-all ${u==="baseline"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(Yt,{size:16})," 基线管理"]}),e.jsxs("button",{onClick:()=>r("stagegate"),className:`px-3 py-1.5 text-sm font-medium rounded-md whitespace-nowrap flex-shrink-0 flex items-center gap-2 transition-all ${u==="stagegate"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(Jt,{size:16})," 阶段门径"]}),e.jsxs("button",{onClick:()=>r("scope"),className:`px-3 py-1.5 text-sm font-medium rounded-md whitespace-nowrap flex-shrink-0 flex items-center gap-2 transition-all ${u==="scope"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(X,{size:16})," 范围管理"]})]})]}),e.jsxs("div",{className:"flex-1 relative overflow-hidden bg-slate-50",children:[u==="diagram"&&e.jsxs("div",{className:"flex flex-col h-full bg-slate-50 overflow-hidden",children:[e.jsxs("div",{className:"p-6 pb-0 shrink-0",children:[e.jsx(Hs,{project:t,tasks:t.tasks||[]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 flex items-center gap-2",children:[e.jsx(Te,{size:20,className:"text-blue-600"}),"任务编排与进度分析"]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(K,{onClick:()=>q(!y),variant:y?"primary":"secondary",size:"sm",icon:X,children:y?"隐藏分析器":"开启影响分析模拟"})})]})]}),y&&e.jsx("div",{className:"px-6 pb-6 shrink-0 animate-in slide-in-from-top duration-300",children:e.jsx(Vs,{project:t,existingTasks:t.tasks||[],resourcePool:d})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(ps,{tasks:t.tasks||[],projectName:t.name,pdsgMembers:t.pdsgMembers,onTaskUpdate:z,onTaskAdd:v,onTaskDelete:w})})]}),u==="risks"&&e.jsx("div",{className:"h-full overflow-auto p-6 max-w-[1920px] mx-auto w-full",children:e.jsx(fs,{project:t,risks:t.risks||[],onRisksChange:p=>n(t.id,{...t,risks:p})})}),u==="costs"&&e.jsxs("div",{className:"h-full overflow-auto p-6 max-w-[1920px] mx-auto w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"成本概览"}),e.jsxs("p",{className:"text-sm text-slate-500",children:["预算: $",j.toLocaleString()," | 实际: $",f.reduce((p,B)=>p+B.amount,0).toLocaleString()]})]}),e.jsx(K,{onClick:()=>D(!0),variant:"primary",icon:ae,children:"登记成本"})]}),e.jsxs("div",{className:"space-y-3",children:[f.map(p=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600",children:e.jsx(ae,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900",children:p.description}),e.jsxs("div",{className:"text-xs text-slate-500",children:[p.date," · ",p.category]})]})]}),e.jsxs("div",{className:"font-bold text-slate-900",children:["$",p.amount.toLocaleString()]})]},p.id)),f.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 text-sm",children:"暂无成本记录"})]})]}),u==="analytics"&&e.jsxs("div",{className:"h-full overflow-auto p-6 max-w-[1920px] mx-auto w-full space-y-6",children:[e.jsx(zs,{project:t,tasks:t.tasks||[],allProjects:a}),e.jsx(Is,{project:t,tasks:t.tasks||[]})]}),u==="strategy"&&e.jsx("div",{className:"h-full overflow-hidden max-w-[1920px] mx-auto w-full",children:e.jsx(vs,{project:t,onUpdate:p=>n(t.id,{...t,...p})})}),u==="resources"&&e.jsx(gs,{project:t,resourcePool:d}),u==="pdsg"&&e.jsx("div",{className:"h-full overflow-auto p-8 max-w-[1920px] mx-auto w-full",children:e.jsx(_s,{project:t,resourcePool:d,onUpdateMembers:p=>n(t.id,{...t,pdsgMembers:p})})}),u==="baseline"&&e.jsx("div",{className:"h-full overflow-auto p-6 max-w-[1920px] mx-auto w-full",children:e.jsx(Bs,{project:t,onCreateBaseline:p=>{const B=[...t.baselines||[],p];n(t.id,{...t,baselines:B,activeBaselineId:p.id})},onSetActiveBaseline:p=>{n(t.id,{...t,activeBaselineId:p})},currentUserId:"current-user",currentUserName:t.manager||"项目经理"})}),u==="stagegate"&&e.jsx("div",{className:"h-full overflow-auto p-6 max-w-[1920px] mx-auto w-full",children:e.jsx(Es,{project:{...t,currentStage:t.currentStage||"initiation",gates:t.gates||Xe.standard},onUpdateGate:p=>{const M=(t.gates||Xe.standard).map(L=>L.id===p.id?p:L);n(t.id,{...t,gates:M})},onMoveToNextStage:()=>{const p=t.currentStage||"initiation",B=$e(p);B&&n(t.id,{...t,currentStage:B})},currentUserId:(i==null?void 0:i.id)||"anonymous",currentUserName:(i==null?void 0:i.name)||"Anonymous User",userRole:(i==null?void 0:i.role)||"user",onRequestApproval:p=>{s({projectId:t.id,projectName:t.name,requestedBy:(i==null?void 0:i.id)||"anonymous",requestedByName:(i==null?void 0:i.name)||"项目经理",requestDate:new Date().toISOString(),title:`阶段门径申请: ${Ne(p.stage)}`,description:`项目经理申请进入下一步阶段: ${p.name}
${p.description}`,category:"project_status",estimatedEffortHours:0,estimatedCostIncrease:0,scheduleImpactDays:0,impactLevel:"medium",businessJustification:"项目已完成当前阶段所有必需任务，申请进入下一流程节点。",status:"pending",metadata:{type:"stage_gate",gateId:p.id,stage:p.stage}})}})}),u==="scope"&&e.jsxs("div",{className:"h-full overflow-auto p-6 max-w-[1920px] mx-auto w-full space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"范围管理与变更控制"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"监控范围蔓延，管理变更请求，防止项目失控"})]}),e.jsx(K,{onClick:()=>C(!0),variant:"primary",icon:X,children:"提交变更请求"})]}),e.jsx(Gs,{project:t,changeRequests:o(t.id)}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4",children:"变更请求历史"}),e.jsxs("div",{className:"space-y-3",children:[o(t.id).map(p=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-slate-900 dark:text-slate-100",children:p.title}),e.jsx(Y,{variant:p.status==="approved"?"success":p.status==="rejected"?"danger":"warning",children:p.status})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:p.description}),e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-slate-500",children:[e.jsxs("span",{children:["工时: +",p.estimatedEffortHours,"h"]}),e.jsxs("span",{children:["成本: +¥",p.estimatedCostIncrease]}),e.jsxs("span",{children:["延期: +",p.scheduleImpactDays,"天"]})]})]}),e.jsx("div",{className:"text-sm text-slate-500",children:new Date(p.requestDate).toLocaleDateString()})]},p.id)),o(t.id).length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400",children:"暂无变更请求"})]})]})]})]}),I&&e.jsx(Os,{project:t,onSubmit:p=>{s(p),C(!1)},onCancel:()=>C(!1),currentUser:{id:"current-user",name:t.manager||"项目经理"}}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"登记项目成本"}),e.jsx("button",{onClick:()=>D(!1),className:"text-slate-400 hover:text-slate-600",children:e.jsx(He,{size:24,className:"rotate-180"})})]}),e.jsx(js,{projectId:t.id,projectName:t.name,budget:j,existingCosts:f,onSave:S,onClose:()=>D(!1)})]})})})]})};export{xa as default};
