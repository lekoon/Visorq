import{e as oe,D as q,j as e,R as ce,r as f,X as Y,i as Q,Q as de,b as xe,T,C as me,A as pe,c as A,s as ge,g as he,u as ue,S as H}from"./index-B5c9UgXK.js";import{f as C}from"./format-DsgGBf5I.js";import{A as F,N as be}from"./index-AEP6nUya.js";import{m as $}from"./proxy-BFRa2WGu.js";import{P as I}from"./plus-CrVknpGe.js";import{a as fe,e as X}from"./eachDayOfInterval-DiCWtKlw.js";import{R as U,C as V,X as W,Y as _,T as K,L as ye}from"./generateCategoricalChart-s8lAFq2C.js";import{A as ve,a as P}from"./AreaChart-Deqnfmnh.js";import{L as je}from"./LineChart-BvwlSrIU.js";import{L as ke}from"./Line-C5gDiXpH.js";import{F as J}from"./filter-DQWibi4t.js";import{S as Ne}from"./sparkles-BpZ7-UT2.js";import{a as we}from"./addMonths-BaObKnpK.js";import{s as Ce,e as Se}from"./startOfMonth-B8ih7BjY.js";import{D as Re}from"./download-CNPnwJl7.js";import{C as B}from"./circle-check-C5ICAVch.js";import{C as De}from"./chevron-down-gXvrzdX4.js";import{P as $e}from"./pen-DzYjITnT.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=oe("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);function ze(s,a){const r=q(s),d=q(a);return+r==+d}function Pe(s,a){return fe(s,-30)}function Ie(s,a){return we(s,-a)}const Z=(s,a)=>s*a,ee=s=>s>=16?"critical":s>=10?"high":s>=5?"medium":"low",te=s=>({critical:"bg-red-500 text-white",high:"bg-orange-500 text-white",medium:"bg-yellow-500 text-white",low:"bg-green-500 text-white"})[s],M=s=>({schedule:{label:"è¿›åº¦é£é™©",color:"text-blue-600",icon:"ğŸ“…"},cost:{label:"æˆæœ¬é£é™©",color:"text-green-600",icon:"ğŸ’°"},resource:{label:"èµ„æºé£é™©",color:"text-purple-600",icon:"ğŸ‘¥"},technical:{label:"æŠ€æœ¯é£é™©",color:"text-red-600",icon:"âš™ï¸"},external:{label:"å¤–éƒ¨é£é™©",color:"text-orange-600",icon:"ğŸŒ"},quality:{label:"è´¨é‡é£é™©",color:"text-pink-600",icon:"âœ¨"},scope:{label:"èŒƒå›´é£é™©",color:"text-indigo-600",icon:"ğŸ“Š"}})[s],O=s=>({identified:{label:"å·²è¯†åˆ«",color:"bg-gray-100 text-gray-700"},analyzing:{label:"åˆ†æä¸­",color:"bg-blue-100 text-blue-700"},mitigating:{label:"ç¼“è§£ä¸­",color:"bg-yellow-100 text-yellow-700"},monitoring:{label:"ç›‘æ§ä¸­",color:"bg-purple-100 text-purple-700"},resolved:{label:"å·²è§£å†³",color:"bg-green-100 text-green-700"},accepted:{label:"å·²æ¥å—",color:"bg-orange-100 text-orange-700"}})[s],se=(s,a,r,d,n,l,t="")=>{const i=Z(d,n),o=ee(i),c=new Date().toISOString();return{id:`risk-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,projectId:s,category:r,title:a,description:t,probability:d,impact:n,riskScore:i,priority:o,owner:l,status:"identified",mitigationStrategy:"",mitigationActions:[],identifiedDate:c,history:[{id:`history-${Date.now()}`,date:c,userId:l,userName:"å½“å‰ç”¨æˆ·",action:"created",description:`åˆ›å»ºé£é™©: ${a}`}]}},Ae=(s,a,r,d)=>{const n=new Date().toISOString(),l=[];a.probability!==void 0&&a.probability!==s.probability&&l.push({id:`history-${Date.now()}-prob`,date:n,userId:r,userName:d,action:"probability_changed",description:`æ¦‚ç‡ä» ${s.probability} å˜æ›´ä¸º ${a.probability}`,oldValue:s.probability,newValue:a.probability}),a.impact!==void 0&&a.impact!==s.impact&&l.push({id:`history-${Date.now()}-impact`,date:n,userId:r,userName:d,action:"impact_changed",description:`å½±å“ä» ${s.impact} å˜æ›´ä¸º ${a.impact}`,oldValue:s.impact,newValue:a.impact}),a.status&&a.status!==s.status&&l.push({id:`history-${Date.now()}-status`,date:n,userId:r,userName:d,action:"status_changed",description:`çŠ¶æ€ä» "${s.status}" å˜æ›´ä¸º "${a.status}"`,oldValue:s.status,newValue:a.status});const t=a.probability??s.probability,i=a.impact??s.impact,o=Z(t,i),c=ee(o);return{...s,...a,probability:t,impact:i,riskScore:o,priority:c,lastReviewDate:n,history:[...s.history,...l]}},Te=s=>{if(s.length===0)return 0;const a=s.filter(l=>l.status!=="resolved"&&l.status!=="accepted");if(a.length===0)return 0;const r={critical:4,high:3,medium:2,low:1},d=a.reduce((l,t)=>l+t.riskScore*r[t.priority],0),n=a.reduce((l,t)=>l+r[t.priority],0);return Math.round(d/n*10)/10},Fe=s=>{const a={critical:0,high:0,medium:0,low:0};return s.forEach(r=>{a[r.priority]++}),a},Oe=(s,a)=>{const r=["ID","æ ‡é¢˜","ç±»åˆ«","çŠ¶æ€","ä¼˜å…ˆçº§","æ¦‚ç‡","å½±å“","é£é™©åˆ†æ•°","æè¿°","ç¼“è§£ç­–ç•¥","åº”æ€¥è®¡åˆ’","è´Ÿè´£äºº","è¯†åˆ«æ—¥æœŸ","é¢„ä¼°æˆæœ¬å½±å“","ç¼“è§£æˆæœ¬"],d=s.map(c=>{const g=M(c.category),x=O(c.status);return[c.id,c.title,g.label,x.label,c.priority.toUpperCase(),c.probability,c.impact,c.riskScore,`"${c.description.replace(/"/g,'""')}"`,`"${(c.mitigationStrategy||"").replace(/"/g,'""')}"`,`"${(c.contingencyPlan||"").replace(/"/g,'""')}"`,c.ownerName||c.owner,C(new Date(c.identifiedDate),"yyyy-MM-dd"),c.estimatedCostImpact||0,c.mitigationCost||0]}),n=[r,...d].map(c=>c.join(",")).join(`
`),l="\uFEFF",t=new Blob([l+n],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),o=URL.createObjectURL(t);i.setAttribute("href",o),i.setAttribute("download",`${a}_é£é™©æ¸…å•_${C(new Date,"yyyyMMdd")}.csv`),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)},Le=(s,a)=>{const r=o=>M(o).label,d=o=>O(o).label,n=`
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        table { border-collapse: collapse; width: 100%; font-family: Arial, sans-serif; }
        th { background-color: #4472C4; color: white; padding: 12px; text-align: left; font-weight: bold; border: 1px solid #ddd; }
        td { padding: 10px; border: 1px solid #ddd; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        .critical { background-color: #ffebee; }
        .high { background-color: #fff3e0; }
        .medium { background-color: #fff9c4; }
        .low { background-color: #e8f5e9; }
        h1 { color: #333; font-family: Arial, sans-serif; }
        .meta { color: #666; font-size: 14px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>${a} - é£é™©æ¸…å•</h1>
    <div class="meta">
        <p>å¯¼å‡ºæ—¶é—´: ${C(new Date,"yyyyå¹´MMæœˆddæ—¥ HH:mm:ss")}</p>
        <p>æ€»é£é™©æ•°: ${s.length} | æ´»è·ƒé£é™©: ${s.filter(o=>o.status!=="resolved"&&o.status!=="accepted").length}</p>
    </div>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>æ ‡é¢˜</th>
                <th>ç±»åˆ«</th>
                <th>çŠ¶æ€</th>
                <th>ä¼˜å…ˆçº§</th>
                <th>æ¦‚ç‡</th>
                <th>å½±å“</th>
                <th>é£é™©åˆ†æ•°</th>
                <th>æè¿°</th>
                <th>ç¼“è§£ç­–ç•¥</th>
                <th>è´Ÿè´£äºº</th>
                <th>è¯†åˆ«æ—¥æœŸ</th>
                <th>é¢„ä¼°æˆæœ¬å½±å“</th>
            </tr>
        </thead>
        <tbody>
            ${s.map(o=>`
                <tr class="${o.priority}">
                    <td>${o.id}</td>
                    <td><strong>${o.title}</strong></td>
                    <td>${r(o.category)}</td>
                    <td>${d(o.status)}</td>
                    <td>${o.priority.toUpperCase()}</td>
                    <td>${o.probability}/5</td>
                    <td>${o.impact}/5</td>
                    <td><strong>${o.riskScore}</strong></td>
                    <td>${o.description}</td>
                    <td>${o.mitigationStrategy||"-"}</td>
                    <td>${o.ownerName||o.owner}</td>
                    <td>${C(new Date(o.identifiedDate),"yyyy-MM-dd")}</td>
                    <td>${o.estimatedCostImpact?`Â¥${o.estimatedCostImpact.toLocaleString()}`:"-"}</td>
                </tr>
            `).join("")}
        </tbody>
    </table>
</body>
</html>
    `,l=new Blob([n],{type:"application/vnd.ms-excel"}),t=document.createElement("a"),i=URL.createObjectURL(l);t.setAttribute("href",i),t.setAttribute("download",`${a}_é£é™©æ¸…å•_${C(new Date,"yyyyMMdd")}.xls`),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)},Ee=(s,a)=>{const r=s.filter(t=>t.status!=="resolved"&&t.status!=="accepted"),d=r.filter(t=>t.priority==="critical"),n=r.filter(t=>t.priority==="high"),l=t=>M(t);return`
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>${a.name} - é£é™©è¯„ä¼°æŠ¥å‘Š</title>
    <style>
        @page { size: A4; margin: 2cm; }
        body { font-family: 'Microsoft YaHei', Arial, sans-serif; line-height: 1.6; color: #333; }
        .header { text-align: center; border-bottom: 3px solid #4472C4; padding-bottom: 20px; margin-bottom: 30px; }
        .header h1 { color: #4472C4; margin: 0; font-size: 28px; }
        .header .subtitle { color: #666; margin-top: 10px; font-size: 14px; }
        .summary { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        .summary-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 15px; }
        .summary-card { background: white; padding: 15px; border-radius: 6px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .summary-card .number { font-size: 32px; font-weight: bold; color: #4472C4; }
        .summary-card .label { font-size: 12px; color: #666; margin-top: 5px; }
        .section { margin-bottom: 30px; page-break-inside: avoid; }
        .section-title { font-size: 20px; color: #4472C4; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; margin-bottom: 15px; }
        .risk-card { background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 15px; page-break-inside: avoid; }
        .risk-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; }
        .risk-title { font-size: 18px; font-weight: bold; color: #333; }
        .risk-badges { display: flex; gap: 8px; }
        .badge { padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: bold; }
        .badge.critical { background: #ffebee; color: #c62828; }
        .badge.high { background: #fff3e0; color: #e65100; }
        .badge.medium { background: #fff9c4; color: #f57f17; }
        .badge.low { background: #e8f5e9; color: #2e7d32; }
        .risk-meta { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 6px; }
        .risk-meta-item { font-size: 13px; }
        .risk-meta-item .label { color: #666; font-weight: 500; }
        .risk-meta-item .value { color: #333; font-weight: bold; margin-top: 3px; }
        .risk-description { margin-bottom: 15px; font-size: 14px; line-height: 1.8; }
        .risk-mitigation { background: #e3f2fd; padding: 15px; border-radius: 6px; border-left: 4px solid #2196f3; }
        .risk-mitigation .title { font-weight: bold; color: #1976d2; margin-bottom: 8px; }
        .footer { text-align: center; color: #999; font-size: 12px; margin-top: 50px; padding-top: 20px; border-top: 1px solid #e0e0e0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>${a.name}</h1>
        <div class="subtitle">é£é™©è¯„ä¼°æŠ¥å‘Š</div>
        <div class="subtitle">ç”Ÿæˆæ—¶é—´: ${C(new Date,"yyyyå¹´MMæœˆddæ—¥ HH:mm")}</div>
    </div>

    <div class="summary">
        <h2 style="margin-top: 0; color: #333;">æ‰§è¡Œæ‘˜è¦</h2>
        <div class="summary-grid">
            <div class="summary-card">
                <div class="number">${s.length}</div>
                <div class="label">æ€»é£é™©æ•°</div>
            </div>
            <div class="summary-card">
                <div class="number" style="color: #f57c00;">${r.length}</div>
                <div class="label">æ´»è·ƒé£é™©</div>
            </div>
            <div class="summary-card">
                <div class="number" style="color: #d32f2f;">${d.length}</div>
                <div class="label">æé«˜é£é™©</div>
            </div>
            <div class="summary-card">
                <div class="number" style="color: #388e3c;">${s.filter(t=>t.status==="resolved").length}</div>
                <div class="label">å·²è§£å†³</div>
            </div>
        </div>
    </div>

    ${d.length>0?`
    <div class="section">
        <div class="section-title">ğŸ”´ æé«˜é£é™© (Critical)</div>
        ${d.map(t=>`
        <div class="risk-card">
            <div class="risk-header">
                <div class="risk-title">${t.title}</div>
                <div class="risk-badges">
                    <span class="badge critical">CRITICAL</span>
                    <span class="badge" style="background: #e1f5fe; color: #0277bd;">${l(t.category).label}</span>
                </div>
            </div>
            <div class="risk-meta">
                <div class="risk-meta-item">
                    <div class="label">æ¦‚ç‡</div>
                    <div class="value">${t.probability}/5</div>
                </div>
                <div class="risk-meta-item">
                    <div class="label">å½±å“</div>
                    <div class="value">${t.impact}/5</div>
                </div>
                <div class="risk-meta-item">
                    <div class="label">é£é™©åˆ†æ•°</div>
                    <div class="value">${t.riskScore}</div>
                </div>
            </div>
            <div class="risk-description">
                <strong>æè¿°:</strong> ${t.description}
            </div>
            ${t.mitigationStrategy?`
            <div class="risk-mitigation">
                <div class="title">ç¼“è§£ç­–ç•¥</div>
                <div>${t.mitigationStrategy}</div>
            </div>
            `:""}
        </div>
        `).join("")}
    </div>
    `:""}

    ${n.length>0?`
    <div class="section">
        <div class="section-title">ğŸŸ  é«˜é£é™© (High)</div>
        ${n.map(t=>`
        <div class="risk-card">
            <div class="risk-header">
                <div class="risk-title">${t.title}</div>
                <div class="risk-badges">
                    <span class="badge high">HIGH</span>
                    <span class="badge" style="background: #e1f5fe; color: #0277bd;">${l(t.category).label}</span>
                </div>
            </div>
            <div class="risk-meta">
                <div class="risk-meta-item">
                    <div class="label">æ¦‚ç‡</div>
                    <div class="value">${t.probability}/5</div>
                </div>
                <div class="risk-meta-item">
                    <div class="label">å½±å“</div>
                    <div class="value">${t.impact}/5</div>
                </div>
                <div class="risk-meta-item">
                    <div class="label">é£é™©åˆ†æ•°</div>
                    <div class="value">${t.riskScore}</div>
                </div>
            </div>
            <div class="risk-description">
                <strong>æè¿°:</strong> ${t.description}
            </div>
        </div>
        `).join("")}
    </div>
    `:""}

    <div class="footer">
        <p>æœ¬æŠ¥å‘Šç”± Visorq é¡¹ç›®ç®¡ç†ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ</p>
        <p>Â© 2025 Visorq Team. All rights reserved.</p>
    </div>
</body>
</html>
    `},qe=(s,a)=>{const r=Ee(s,a),d=window.open("","_blank");d&&(d.document.write(r),d.document.close(),d.focus(),setTimeout(()=>{d.print()},500))},He=({risks:s,onRiskClick:a})=>{const r=s.filter(i=>i.status!=="resolved"&&i.status!=="accepted"),d=(i,o)=>r.filter(c=>c.probability===i&&c.impact===o),n=(i,o)=>{const c=i*o;return c>=16?"bg-red-100 hover:bg-red-200 border-red-300":c>=10?"bg-orange-100 hover:bg-orange-200 border-orange-300":c>=5?"bg-yellow-100 hover:bg-yellow-200 border-yellow-300":"bg-green-50 hover:bg-green-100 border-green-200"},l=["æä½","ä½","ä¸­","é«˜","æé«˜"],t=["æä½","ä½","ä¸­","é«˜","æé«˜"];return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"é£é™©çŸ©é˜µ"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"æ ¹æ®æ¦‚ç‡å’Œå½±å“è¯„ä¼°é£é™©ç­‰çº§"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"inline-block min-w-full",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-1",children:[e.jsx("div",{className:"flex items-center justify-center p-2 bg-slate-50 dark:bg-slate-700 rounded-tl-lg",children:e.jsx("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-300",children:"æ¦‚ç‡ â†“ / å½±å“ â†’"})}),l.map((i,o)=>e.jsx("div",{className:"flex items-center justify-center p-2 bg-slate-50 dark:bg-slate-700 border-b border-slate-200 dark:border-slate-600",children:e.jsx("span",{className:"text-xs font-medium text-slate-700 dark:text-slate-200",children:i})},`impact-${o}`)),[5,4,3,2,1].map(i=>e.jsxs(ce.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-center p-2 bg-slate-50 dark:bg-slate-700 border-r border-slate-200 dark:border-slate-600",children:e.jsx("span",{className:"text-xs font-medium text-slate-700 dark:text-slate-200",children:t[i-1]})}),[1,2,3,4,5].map(o=>{const c=d(i,o),g=n(i,o);return e.jsxs("div",{className:`relative min-h-[80px] p-2 border ${g} transition-colors cursor-pointer group`,onClick:()=>{c.length>0&&a&&a(c[0])},children:[c.length>0&&e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 text-xs font-bold text-white bg-slate-700 dark:bg-slate-600 rounded-full",children:c.length})}),e.jsxs("div",{className:"space-y-1",children:[c.slice(0,2).map(x=>e.jsx("div",{className:"text-xs text-slate-700 dark:text-slate-200 truncate bg-white dark:bg-slate-700 px-1.5 py-0.5 rounded shadow-sm",title:x.title,children:x.title},x.id)),c.length>2&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 italic",children:["+",c.length-2," æ›´å¤š..."]})]}),c.length>0&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block z-10",children:e.jsxs("div",{className:"bg-slate-900 text-white text-xs rounded-lg py-2 px-3 shadow-xl max-w-xs",children:[e.jsxs("div",{className:"font-semibold mb-1",children:[c.length," ä¸ªé£é™©"]}),c.slice(0,3).map(x=>e.jsxs("div",{className:"truncate",children:["â€¢ ",x.title]},x.id))]})})]},`cell-${i}-${o}`)})]},`row-${i}`))]}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-100 border border-green-200 rounded"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"ä½é£é™© (1-4)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-yellow-100 border border-yellow-200 rounded"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"ä¸­é£é™© (5-9)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-orange-100 border border-orange-200 rounded"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"é«˜é£é™© (10-15)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-100 border border-red-200 rounded"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"æé«˜é£é™© (16-25)"})]})]})]})})]})},Ue=({isOpen:s,onClose:a,onSave:r,projectId:d,existingRisk:n,currentUserId:l})=>{const[t,i]=f.useState({title:"",description:"",category:"technical",probability:3,impact:3,status:"identified",owner:l,mitigationStrategy:"",contingencyPlan:"",estimatedCostImpact:void 0,mitigationCost:void 0}),[o,c]=f.useState([]);f.useEffect(()=>{n?(i(n),c(n.mitigationActions||[])):(i({title:"",description:"",category:"technical",probability:3,impact:3,status:"identified",owner:l,mitigationStrategy:"",contingencyPlan:""}),c([]))},[n,l,s]);const g=h=>{if(h.preventDefault(),!t.title||!t.description){alert("è¯·å¡«å†™æ ‡é¢˜å’Œæè¿°");return}let y;n?y={...n,...t,mitigationActions:o.map((v,w)=>({...v,id:v.id||`action-${Date.now()}-${w}`}))}:(y=se(d,t.title,t.category,t.probability,t.impact,t.owner,t.description),y={...y,mitigationStrategy:t.mitigationStrategy||"",contingencyPlan:t.contingencyPlan,estimatedCostImpact:t.estimatedCostImpact,mitigationCost:t.mitigationCost,status:t.status,mitigationActions:o.map((v,w)=>({...v,id:`action-${Date.now()}-${w}`}))}),r(y),a()},x=()=>{c([...o,{description:"",owner:l,dueDate:new Date().toISOString().split("T")[0],status:"pending"}])},u=(h,y,v)=>{const w=[...o];w[h]={...w[h],[y]:v},c(w)},N=h=>{c(o.filter((y,v)=>v!==h))};return s?e.jsx(F,{children:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:n?"ç¼–è¾‘é£é™©":"æ·»åŠ æ–°é£é™©"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(Y,{size:20})})]}),e.jsxs("form",{onSubmit:g,className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"é£é™©æ ‡é¢˜ *"}),e.jsx("input",{type:"text",value:t.title,onChange:h=>i({...t,title:h.target.value}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",placeholder:"ä¾‹å¦‚ï¼šå…³é”®æŠ€æœ¯äººå‘˜ç¦»èŒé£é™©",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"é£é™©ç±»åˆ« *"}),e.jsxs("select",{value:t.category,onChange:h=>i({...t,category:h.target.value}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",children:[e.jsx("option",{value:"schedule",children:"è¿›åº¦é£é™©"}),e.jsx("option",{value:"cost",children:"æˆæœ¬é£é™©"}),e.jsx("option",{value:"resource",children:"èµ„æºé£é™©"}),e.jsx("option",{value:"technical",children:"æŠ€æœ¯é£é™©"}),e.jsx("option",{value:"external",children:"å¤–éƒ¨é£é™©"}),e.jsx("option",{value:"quality",children:"è´¨é‡é£é™©"}),e.jsx("option",{value:"scope",children:"èŒƒå›´é£é™©"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"çŠ¶æ€"}),e.jsxs("select",{value:t.status,onChange:h=>i({...t,status:h.target.value}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",children:[e.jsx("option",{value:"identified",children:"å·²è¯†åˆ«"}),e.jsx("option",{value:"analyzing",children:"åˆ†æä¸­"}),e.jsx("option",{value:"mitigating",children:"ç¼“è§£ä¸­"}),e.jsx("option",{value:"monitoring",children:"ç›‘æ§ä¸­"}),e.jsx("option",{value:"resolved",children:"å·²è§£å†³"}),e.jsx("option",{value:"accepted",children:"å·²æ¥å—"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"é£é™©æè¿° *"}),e.jsx("textarea",{value:t.description,onChange:h=>i({...t,description:h.target.value}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",rows:3,placeholder:"è¯¦ç»†æè¿°é£é™©çš„å…·ä½“æƒ…å†µ...",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"å‘ç”Ÿæ¦‚ç‡ (1-5) *"}),e.jsx("input",{type:"range",min:"1",max:"5",value:t.probability,onChange:h=>i({...t,probability:parseInt(h.target.value)}),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:"æä½"}),e.jsx("span",{className:"font-semibold text-slate-700 dark:text-slate-200",children:t.probability}),e.jsx("span",{children:"æé«˜"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"å½±å“ç¨‹åº¦ (1-5) *"}),e.jsx("input",{type:"range",min:"1",max:"5",value:t.impact,onChange:h=>i({...t,impact:parseInt(h.target.value)}),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:"å¯å¿½ç•¥"}),e.jsx("span",{className:"font-semibold text-slate-700 dark:text-slate-200",children:t.impact}),e.jsx("span",{children:"ä¸¥é‡"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"é¢„ä¼°æˆæœ¬å½±å“ (Â¥)"}),e.jsx("input",{type:"number",value:t.estimatedCostImpact||"",onChange:h=>i({...t,estimatedCostImpact:h.target.value?parseFloat(h.target.value):void 0}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"ç¼“è§£æˆæœ¬ (Â¥)"}),e.jsx("input",{type:"number",value:t.mitigationCost||"",onChange:h=>i({...t,mitigationCost:h.target.value?parseFloat(h.target.value):void 0}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",placeholder:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"ç¼“è§£ç­–ç•¥"}),e.jsx("textarea",{value:t.mitigationStrategy,onChange:h=>i({...t,mitigationStrategy:h.target.value}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",rows:3,placeholder:"æè¿°å¦‚ä½•ç¼“è§£è¿™ä¸ªé£é™©..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"åº”æ€¥è®¡åˆ’"}),e.jsx("textarea",{value:t.contingencyPlan,onChange:h=>i({...t,contingencyPlan:h.target.value}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",rows:2,placeholder:"å¦‚æœç¼“è§£æªæ–½å¤±è´¥ï¼Œå¤‡ç”¨è®¡åˆ’æ˜¯ä»€ä¹ˆ..."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200",children:"ç¼“è§£æªæ–½"}),e.jsxs("button",{type:"button",onClick:x,className:"flex items-center gap-1 px-3 py-1 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(I,{size:14}),"æ·»åŠ æªæ–½"]})]}),e.jsx("div",{className:"space-y-3",children:o.map((h,y)=>e.jsx("div",{className:"p-3 border border-slate-200 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-700/50",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("input",{type:"text",value:h.description,onChange:v=>u(y,"description",v.target.value),className:"flex-1 px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100 text-sm",placeholder:"æªæ–½æè¿°..."}),e.jsx("input",{type:"date",value:h.dueDate,onChange:v=>u(y,"dueDate",v.target.value),className:"px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100 text-sm"}),e.jsx("button",{type:"button",onClick:()=>N(y),className:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg",children:e.jsx(Q,{size:16})})]})},y))})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:g,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:n?"ä¿å­˜æ›´æ”¹":"åˆ›å»ºé£é™©"})]})]})})}):null},Ve=({risks:s})=>{var l,t;const a=f.useMemo(()=>{const i=new Date,o=Pe(i);return X({start:o,end:i}).map(g=>{const u=s.filter(m=>new Date(m.identifiedDate)<=g).filter(m=>!m.resolvedDate||new Date(m.resolvedDate)>g).filter(m=>m.status!=="resolved"&&m.status!=="accepted"),N=u.filter(m=>m.priority==="critical").length,h=u.filter(m=>m.priority==="high").length,y=u.filter(m=>m.priority==="medium").length,v=u.filter(m=>m.priority==="low").length,w=u.length>0?u.reduce((m,R)=>m+R.riskScore,0)/u.length:0;return{date:C(g,"MM-dd"),fullDate:C(g,"yyyy-MM-dd"),total:u.length,critical:N,high:h,medium:y,low:v,avgScore:Math.round(w*10)/10}})},[s]),r=f.useMemo(()=>{if(a.length<2)return"stable";const i=a.slice(-7).reduce((c,g)=>c+g.total,0)/7,o=a.slice(-14,-7).reduce((c,g)=>c+g.total,0)/7;return i>o*1.1?"increasing":i<o*.9?"decreasing":"stable"},[a]),d=()=>{switch(r){case"increasing":return"text-red-600";case"decreasing":return"text-green-600";default:return"text-blue-600"}},n=()=>{switch(r){case"increasing":return"ğŸ“ˆ";case"decreasing":return"ğŸ“‰";default:return"â¡ï¸"}};return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"é£é™©è¶‹åŠ¿åˆ†æ"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"è¿‡å» 30 å¤©çš„é£é™©å˜åŒ–è¶‹åŠ¿"})]}),e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg bg-slate-50 dark:bg-slate-700 ${d()}`,children:[e.jsx("span",{className:"text-2xl",children:n()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium",children:"è¶‹åŠ¿"}),e.jsxs("div",{className:"text-sm font-bold",children:[r==="increasing"&&"ä¸Šå‡",r==="decreasing"&&"ä¸‹é™",r==="stable"&&"ç¨³å®š"]})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3",children:"æ´»è·ƒé£é™©æ•°é‡è¶‹åŠ¿"}),e.jsx(U,{width:"100%",height:250,children:e.jsxs(ve,{data:a,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorCritical",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#ef4444",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#ef4444",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorHigh",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#f97316",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#f97316",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorMedium",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#eab308",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#eab308",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorLow",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#22c55e",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#22c55e",stopOpacity:0})]})]}),e.jsx(V,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(W,{dataKey:"date",stroke:"#64748b",style:{fontSize:"12px"}}),e.jsx(_,{stroke:"#64748b",style:{fontSize:"12px"}}),e.jsx(K,{contentStyle:{backgroundColor:"#1e293b",border:"none",borderRadius:"8px",color:"#fff"}}),e.jsx(ye,{}),e.jsx(P,{type:"monotone",dataKey:"critical",stackId:"1",stroke:"#ef4444",fillOpacity:1,fill:"url(#colorCritical)",name:"æé«˜é£é™©"}),e.jsx(P,{type:"monotone",dataKey:"high",stackId:"1",stroke:"#f97316",fillOpacity:1,fill:"url(#colorHigh)",name:"é«˜é£é™©"}),e.jsx(P,{type:"monotone",dataKey:"medium",stackId:"1",stroke:"#eab308",fillOpacity:1,fill:"url(#colorMedium)",name:"ä¸­é£é™©"}),e.jsx(P,{type:"monotone",dataKey:"low",stackId:"1",stroke:"#22c55e",fillOpacity:1,fill:"url(#colorLow)",name:"ä½é£é™©"})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3",children:"å¹³å‡é£é™©åˆ†æ•°è¶‹åŠ¿"}),e.jsx(U,{width:"100%",height:200,children:e.jsxs(je,{data:a,children:[e.jsx(V,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(W,{dataKey:"date",stroke:"#64748b",style:{fontSize:"12px"}}),e.jsx(_,{stroke:"#64748b",style:{fontSize:"12px"},domain:[0,25]}),e.jsx(K,{contentStyle:{backgroundColor:"#1e293b",border:"none",borderRadius:"8px",color:"#fff"}}),e.jsx(ke,{type:"monotone",dataKey:"avgScore",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",r:4},activeDot:{r:6},name:"å¹³å‡é£é™©åˆ†æ•°"})]})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"ğŸ’¡ è¶‹åŠ¿æ´å¯Ÿ"}),e.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[r==="increasing"&&e.jsx("li",{children:"â€¢ é£é™©æ•°é‡å‘ˆä¸Šå‡è¶‹åŠ¿ï¼Œå»ºè®®åŠ å¼ºé£é™©è¯†åˆ«å’Œç¼“è§£æªæ–½"}),r==="decreasing"&&e.jsx("li",{children:"â€¢ é£é™©æ•°é‡å‘ˆä¸‹é™è¶‹åŠ¿ï¼Œé£é™©ç®¡ç†å·¥ä½œæˆæ•ˆæ˜¾è‘—"}),r==="stable"&&e.jsx("li",{children:"â€¢ é£é™©æ•°é‡ä¿æŒç¨³å®šï¼ŒæŒç»­ç›‘æ§å³å¯"}),e.jsxs("li",{children:["â€¢ å½“å‰æ´»è·ƒé£é™©: ",((l=a[a.length-1])==null?void 0:l.total)||0," ä¸ªï¼Œå¹³å‡é£é™©åˆ†æ•°:"," ",((t=a[a.length-1])==null?void 0:t.avgScore)||0]})]})]})]})},k=[{id:"tmpl-schedule-001",name:"å…³é”®é‡Œç¨‹ç¢‘å»¶æœŸ",category:"schedule",description:"ç”±äºéœ€æ±‚å˜æ›´ã€æŠ€æœ¯éš¾é¢˜æˆ–èµ„æºä¸è¶³ï¼Œå…³é”®é‡Œç¨‹ç¢‘å¯èƒ½æ— æ³•æŒ‰æ—¶å®Œæˆ",probability:3,impact:4,mitigationStrategy:"å»ºç«‹ä¸¥æ ¼çš„å˜æ›´æ§åˆ¶æµç¨‹ï¼Œæå‰è¯†åˆ«æŠ€æœ¯é£é™©ï¼Œé¢„ç•™ç¼“å†²æ—¶é—´ï¼Œå®šæœŸè¯„å®¡è¿›åº¦",contingencyPlan:"å¯åŠ¨å¿«é€Ÿé€šé“å®¡æ‰¹æµç¨‹ï¼Œå¢åŠ èµ„æºæŠ•å…¥ï¼Œè°ƒæ•´åç»­é‡Œç¨‹ç¢‘è®¡åˆ’",tags:["è¿›åº¦","é‡Œç¨‹ç¢‘","å»¶æœŸ"],applicableProjectTypes:["web","mobile","infrastructure"]},{id:"tmpl-schedule-002",name:"ä¾èµ–é¡¹ç›®å»¶æœŸ",category:"schedule",description:"å¤–éƒ¨ä¾èµ–é¡¹ç›®æˆ–ç¬¬ä¸‰æ–¹æœåŠ¡å»¶æœŸäº¤ä»˜ï¼Œå½±å“æœ¬é¡¹ç›®è¿›åº¦",probability:3,impact:3,mitigationStrategy:"æå‰ä¸ä¾èµ–æ–¹ç¡®è®¤äº¤ä»˜æ—¶é—´ï¼Œå»ºç«‹å®šæœŸæ²Ÿé€šæœºåˆ¶ï¼Œå‡†å¤‡å¤‡é€‰æ–¹æ¡ˆ",contingencyPlan:"å¯ç”¨å¤‡é€‰ä¾›åº”å•†æˆ–ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼Œè°ƒæ•´é¡¹ç›®è®¡åˆ’ä»¥é€‚åº”å»¶æœŸ",tags:["ä¾èµ–","å¤–éƒ¨","è¿›åº¦"]},{id:"tmpl-cost-001",name:"é¢„ç®—è¶…æ”¯",category:"cost",description:"ç”±äºèŒƒå›´è”“å»¶ã€èµ„æºæˆæœ¬ä¸Šæ¶¨æˆ–æ„å¤–æ”¯å‡ºï¼Œé¡¹ç›®é¢„ç®—å¯èƒ½è¶…æ”¯",probability:3,impact:4,mitigationStrategy:"ä¸¥æ ¼æ§åˆ¶èŒƒå›´å˜æ›´ï¼Œå»ºç«‹æˆæœ¬ç›‘æ§æœºåˆ¶ï¼Œé¢„ç•™åº”æ€¥é¢„ç®—ï¼ˆ10-15%ï¼‰ï¼Œå®šæœŸå®¡æŸ¥æˆæœ¬",contingencyPlan:"å‰Šå‡éæ ¸å¿ƒåŠŸèƒ½ï¼Œå¯»æ±‚é¢å¤–é¢„ç®—æ‰¹å‡†ï¼Œä¼˜åŒ–èµ„æºé…ç½®",tags:["é¢„ç®—","æˆæœ¬","è¶…æ”¯"],applicableProjectTypes:["web","mobile","data","infrastructure"]},{id:"tmpl-cost-002",name:"éšè—æˆæœ¬",category:"cost",description:"æœªé¢„è§çš„è®¸å¯è´¹ç”¨ã€åŸºç¡€è®¾æ–½æˆæœ¬æˆ–ç»´æŠ¤æˆæœ¬",probability:2,impact:3,mitigationStrategy:"å…¨é¢è¯„ä¼°æ‰€æœ‰æ½œåœ¨æˆæœ¬ï¼ŒåŒ…æ‹¬è®¸å¯ã€åŸºç¡€è®¾æ–½ã€åŸ¹è®­å’Œç»´æŠ¤ï¼Œé¢„ç•™åº”æ€¥èµ„é‡‘",contingencyPlan:"é‡æ–°è¯„ä¼°æŠ€æœ¯é€‰å‹ï¼Œå¯»æ‰¾å¼€æºæ›¿ä»£æ–¹æ¡ˆï¼Œç”³è¯·é¢å¤–é¢„ç®—",tags:["éšè—æˆæœ¬","è®¸å¯","åŸºç¡€è®¾æ–½"]},{id:"tmpl-resource-001",name:"å…³é”®äººå‘˜ç¦»èŒ",category:"resource",description:"æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜ç¦»èŒï¼Œå¯¼è‡´çŸ¥è¯†æµå¤±å’Œé¡¹ç›®å»¶æœŸ",probability:2,impact:5,mitigationStrategy:"å»ºç«‹çŸ¥è¯†å…±äº«æœºåˆ¶ï¼Œæ–‡æ¡£åŒ–å…³é”®æµç¨‹ï¼Œäº¤å‰åŸ¹è®­å›¢é˜Ÿæˆå‘˜ï¼Œæä¾›æœ‰ç«äº‰åŠ›çš„è–ªé…¬",contingencyPlan:"å¿«é€Ÿæ‹›è˜æ›¿ä»£äººå‘˜ï¼Œå†…éƒ¨è°ƒé…èµ„æºï¼Œå¤–åŒ…å…³é”®ä»»åŠ¡",tags:["äººå‘˜","ç¦»èŒ","çŸ¥è¯†æµå¤±"],applicableProjectTypes:["web","mobile","data","infrastructure"]},{id:"tmpl-resource-002",name:"èµ„æºæŠ€èƒ½ä¸åŒ¹é…",category:"resource",description:"å›¢é˜Ÿæˆå‘˜ç¼ºä¹é¡¹ç›®æ‰€éœ€çš„å…³é”®æŠ€èƒ½æˆ–ç»éªŒ",probability:3,impact:3,mitigationStrategy:"æå‰è¿›è¡ŒæŠ€èƒ½è¯„ä¼°ï¼Œæä¾›åŸ¹è®­å’ŒæŒ‡å¯¼ï¼Œå¼•å…¥å¤–éƒ¨ä¸“å®¶ï¼Œè°ƒæ•´ä»»åŠ¡åˆ†é…",contingencyPlan:"å¤–åŒ…ä¸“ä¸šä»»åŠ¡ï¼Œè˜è¯·é¡¾é—®ï¼Œå»¶é•¿å­¦ä¹ æ›²çº¿æ—¶é—´",tags:["æŠ€èƒ½","åŸ¹è®­","èƒ½åŠ›"]},{id:"tmpl-resource-003",name:"èµ„æºå†²çª",category:"resource",description:"å…³é”®èµ„æºè¢«å¤šä¸ªé¡¹ç›®äº‰å¤ºï¼Œå¯¼è‡´åˆ†é…ä¸è¶³",probability:4,impact:3,mitigationStrategy:"å»ºç«‹èµ„æºä¼˜å…ˆçº§æœºåˆ¶ï¼Œæå‰é¢„è®¢èµ„æºï¼Œä¸å…¶ä»–é¡¹ç›®åè°ƒï¼Œå¢åŠ èµ„æºæ± ",contingencyPlan:"è°ƒæ•´é¡¹ç›®ä¼˜å…ˆçº§ï¼Œå»¶é•¿æ—¶é—´çº¿ï¼Œä¸´æ—¶æ‹›è˜å¤–éƒ¨èµ„æº",tags:["èµ„æºå†²çª","ä¼˜å…ˆçº§","åˆ†é…"]},{id:"tmpl-technical-001",name:"æŠ€æœ¯é€‰å‹é”™è¯¯",category:"technical",description:"é€‰æ‹©çš„æŠ€æœ¯æ ˆä¸é€‚åˆé¡¹ç›®éœ€æ±‚ï¼Œå¯¼è‡´æ€§èƒ½é—®é¢˜æˆ–å¼€å‘å›°éš¾",probability:2,impact:4,mitigationStrategy:"è¿›è¡Œå……åˆ†çš„æŠ€æœ¯è°ƒç ”å’ŒPOCéªŒè¯ï¼Œå’¨è¯¢ä¸“å®¶æ„è§ï¼Œè¯„ä¼°é•¿æœŸç»´æŠ¤æ€§",contingencyPlan:"é‡æ–°è¯„ä¼°æŠ€æœ¯é€‰å‹ï¼Œè¿›è¡ŒæŠ€æœ¯è¿ç§»ï¼Œå¯»æ±‚ä¸“å®¶æ”¯æŒ",tags:["æŠ€æœ¯é€‰å‹","æ¶æ„","æ€§èƒ½"],applicableProjectTypes:["web","mobile","data"]},{id:"tmpl-technical-002",name:"ç¬¬ä¸‰æ–¹APIä¸ç¨³å®š",category:"technical",description:"ä¾èµ–çš„ç¬¬ä¸‰æ–¹APIæœåŠ¡ä¸ç¨³å®šæˆ–é¢‘ç¹å˜æ›´",probability:3,impact:3,mitigationStrategy:"é€‰æ‹©å¯é çš„æœåŠ¡æä¾›å•†ï¼Œå®ç°é‡è¯•å’Œé™çº§æœºåˆ¶ï¼Œç›‘æ§APIå¥åº·çŠ¶æ€ï¼Œå‡†å¤‡å¤‡é€‰æ–¹æ¡ˆ",contingencyPlan:"åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡å•†ï¼Œå®ç°æœ¬åœ°ç¼“å­˜ï¼Œå¼€å‘æ›¿ä»£åŠŸèƒ½",tags:["API","ç¬¬ä¸‰æ–¹","ç¨³å®šæ€§"]},{id:"tmpl-technical-003",name:"å®‰å…¨æ¼æ´",category:"technical",description:"ç³»ç»Ÿå­˜åœ¨å®‰å…¨æ¼æ´ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²æˆ–æ”»å‡»",probability:2,impact:5,mitigationStrategy:"å®šæœŸå®‰å…¨å®¡è®¡ï¼Œéµå¾ªå®‰å…¨æœ€ä½³å®è·µï¼Œä½¿ç”¨å®‰å…¨æ‰«æå·¥å…·ï¼ŒåŠæ—¶æ›´æ–°ä¾èµ–",contingencyPlan:"ç«‹å³ä¿®å¤æ¼æ´ï¼Œé€šçŸ¥å—å½±å“ç”¨æˆ·ï¼ŒåŠ å¼ºå®‰å…¨ç›‘æ§",tags:["å®‰å…¨","æ¼æ´","æ•°æ®ä¿æŠ¤"],applicableProjectTypes:["web","mobile","data"]},{id:"tmpl-external-001",name:"æ”¿ç­–æ³•è§„å˜æ›´",category:"external",description:"ç›¸å…³æ”¿ç­–æ³•è§„å˜æ›´ï¼Œè¦æ±‚é¡¹ç›®è°ƒæ•´åˆè§„æ€§",probability:2,impact:4,mitigationStrategy:"æŒç»­å…³æ³¨æ”¿ç­–åŠ¨æ€ï¼Œå’¨è¯¢æ³•å¾‹é¡¾é—®ï¼Œè®¾è®¡çµæ´»çš„æ¶æ„ä»¥é€‚åº”å˜åŒ–",contingencyPlan:"å¿«é€Ÿè°ƒæ•´ç³»ç»Ÿè®¾è®¡ï¼Œå¯»æ±‚æ³•å¾‹æ”¯æŒï¼Œç”³è¯·å»¶æœŸ",tags:["æ”¿ç­–","åˆè§„","æ³•è§„"]},{id:"tmpl-external-002",name:"å¸‚åœºéœ€æ±‚å˜åŒ–",category:"external",description:"å¸‚åœºéœ€æ±‚å¿«é€Ÿå˜åŒ–ï¼Œå¯¼è‡´é¡¹ç›®ç›®æ ‡è¿‡æ—¶",probability:3,impact:3,mitigationStrategy:"é‡‡ç”¨æ•æ·å¼€å‘æ–¹æ³•ï¼Œå®šæœŸæ”¶é›†å¸‚åœºåé¦ˆï¼Œä¿æŒäº§å“çµæ´»æ€§",contingencyPlan:"å¿«é€Ÿè°ƒæ•´äº§å“æ–¹å‘ï¼Œé‡æ–°è¯„ä¼°ä¼˜å…ˆçº§ï¼Œå‰Šå‡è¿‡æ—¶åŠŸèƒ½",tags:["å¸‚åœº","éœ€æ±‚","å˜åŒ–"],applicableProjectTypes:["web","mobile"]},{id:"tmpl-quality-001",name:"è´¨é‡æ ‡å‡†ä¸è¾¾æ ‡",category:"quality",description:"äº§å“è´¨é‡æ— æ³•æ»¡è¶³é¢„å®šæ ‡å‡†ï¼Œå¯¼è‡´è¿”å·¥æˆ–å®¢æˆ·ä¸æ»¡",probability:3,impact:4,mitigationStrategy:"å»ºç«‹æ¸…æ™°çš„è´¨é‡æ ‡å‡†ï¼Œå®æ–½æŒç»­é›†æˆå’Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå®šæœŸä»£ç å®¡æŸ¥",contingencyPlan:"å¢åŠ æµ‹è¯•èµ„æºï¼Œå»¶é•¿æµ‹è¯•å‘¨æœŸï¼Œé™ä½éƒ¨åˆ†éæ ¸å¿ƒåŠŸèƒ½çš„è´¨é‡è¦æ±‚",tags:["è´¨é‡","æµ‹è¯•","æ ‡å‡†"],applicableProjectTypes:["web","mobile","data","infrastructure"]},{id:"tmpl-quality-002",name:"æŠ€æœ¯å€ºåŠ¡ç´¯ç§¯",category:"quality",description:"ä¸ºäº†èµ¶è¿›åº¦è€Œç§¯ç´¯å¤§é‡æŠ€æœ¯å€ºåŠ¡ï¼Œå½±å“é•¿æœŸç»´æŠ¤",probability:4,impact:3,mitigationStrategy:"å¹³è¡¡é€Ÿåº¦å’Œè´¨é‡ï¼Œå®šæœŸé‡æ„ï¼Œé¢„ç•™æŠ€æœ¯å€ºåŠ¡å¿è¿˜æ—¶é—´",contingencyPlan:"å®‰æ’ä¸“é—¨çš„é‡æ„è¿­ä»£ï¼Œå¢åŠ ç»´æŠ¤é¢„ç®—ï¼Œä¼˜å…ˆå¿è¿˜é«˜é£é™©å€ºåŠ¡",tags:["æŠ€æœ¯å€ºåŠ¡","é‡æ„","ç»´æŠ¤"]},{id:"tmpl-scope-001",name:"éœ€æ±‚è”“å»¶",category:"scope",description:"é¡¹ç›®èŒƒå›´ä¸æ–­æ‰©å¤§ï¼Œå¯¼è‡´è¿›åº¦å»¶æœŸå’Œæˆæœ¬è¶…æ”¯",probability:4,impact:4,mitigationStrategy:"å»ºç«‹ä¸¥æ ¼çš„å˜æ›´æ§åˆ¶æµç¨‹ï¼Œæ˜ç¡®é¡¹ç›®è¾¹ç•Œï¼Œç®¡ç†å¹²ç³»äººæœŸæœ›ï¼Œä½¿ç”¨MoSCoWä¼˜å…ˆçº§",contingencyPlan:"å†»ç»“æ–°éœ€æ±‚ï¼Œæ¨è¿Ÿéæ ¸å¿ƒåŠŸèƒ½åˆ°ä¸‹ä¸€ç‰ˆæœ¬ï¼Œé‡æ–°è¯„ä¼°èµ„æºéœ€æ±‚",tags:["èŒƒå›´","éœ€æ±‚","å˜æ›´"],applicableProjectTypes:["web","mobile","data","infrastructure"]},{id:"tmpl-scope-002",name:"éœ€æ±‚ä¸æ˜ç¡®",category:"scope",description:"é¡¹ç›®éœ€æ±‚æ¨¡ç³Šæˆ–é¢‘ç¹å˜æ›´ï¼Œå¯¼è‡´è¿”å·¥å’Œæ··ä¹±",probability:3,impact:4,mitigationStrategy:"æŠ•å…¥è¶³å¤Ÿæ—¶é—´è¿›è¡Œéœ€æ±‚åˆ†æï¼Œä½¿ç”¨åŸå‹éªŒè¯ï¼Œå»ºç«‹éœ€æ±‚åŸºçº¿ï¼Œå®šæœŸä¸å¹²ç³»äººç¡®è®¤",contingencyPlan:"æš‚åœå¼€å‘è¿›è¡Œéœ€æ±‚æ¾„æ¸…ï¼Œé‡‡ç”¨æ•æ·æ–¹æ³•é€æ­¥æ˜ç¡®éœ€æ±‚",tags:["éœ€æ±‚","æ¾„æ¸…","å˜æ›´"]}],We=s=>{const a=s.toLowerCase();return k.filter(r=>r.name.toLowerCase().includes(a)||r.description.toLowerCase().includes(a)||r.tags.some(d=>d.toLowerCase().includes(a)))},_e=(s,a,r)=>({projectId:a,category:s.category,title:s.name,description:s.description,probability:s.probability,impact:s.impact,owner:r,ownerName:r,status:"identified",mitigationStrategy:s.mitigationStrategy,mitigationActions:[],contingencyPlan:s.contingencyPlan,tags:s.tags}),Ke=({isOpen:s,onClose:a,onSelectTemplate:r})=>{const[d,n]=f.useState(""),[l,t]=f.useState("all"),i=f.useMemo(()=>{let c=k;return d.trim()&&(c=We(d)),l!=="all"&&(c=c.filter(g=>g.category===l)),c},[d,l]),o=[{value:"all",label:"å…¨éƒ¨"},{value:"schedule",label:"è¿›åº¦é£é™©"},{value:"cost",label:"æˆæœ¬é£é™©"},{value:"resource",label:"èµ„æºé£é™©"},{value:"technical",label:"æŠ€æœ¯é£é™©"},{value:"external",label:"å¤–éƒ¨é£é™©"},{value:"quality",label:"è´¨é‡é£é™©"},{value:"scope",label:"èŒƒå›´é£é™©"}];return s?e.jsx(F,{children:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"é£é™©æ¨¡æ¿åº“"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"é€‰æ‹©å¸¸è§é£é™©æ¨¡æ¿å¿«é€Ÿåˆ›å»ºé£é™©"})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(Y,{size:20})})]}),e.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"text",value:d,onChange:c=>n(c.target.value),placeholder:"æœç´¢é£é™©æ¨¡æ¿...",className:"w-full pl-10 pr-4 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(J,{size:16,className:"text-slate-500"}),o.map(c=>e.jsx("button",{onClick:()=>t(c.value),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${l===c.value?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:c.label},c.value))]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:i.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"æœªæ‰¾åˆ°åŒ¹é…çš„é£é™©æ¨¡æ¿"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.map(c=>{const g=M(c.category);return e.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-50 dark:bg-slate-700/50 rounded-lg p-4 border border-slate-200 dark:border-slate-600 hover:border-blue-400 dark:hover:border-blue-500 transition-colors cursor-pointer group",onClick:()=>{r(c),a()},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:g.icon}),e.jsx("h3",{className:"font-semibold text-slate-800 dark:text-slate-100",children:c.name})]}),e.jsx("button",{className:"p-1.5 bg-blue-600 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(I,{size:16})})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-3 line-clamp-2",children:c.description}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["æ¦‚ç‡: ",c.probability,"/5"]}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"â€¢"}),e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["å½±å“: ",c.impact,"/5"]}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"â€¢"}),e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["åˆ†æ•°: ",c.probability*c.impact]})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:c.tags.slice(0,3).map(x=>e.jsx("span",{className:"px-2 py-0.5 bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-200 rounded text-xs",children:x},x))})]},c.id)})})}),e.jsx("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50",children:e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 text-center",children:"ğŸ’¡ æç¤ºï¼šç‚¹å‡»ä»»æ„æ¨¡æ¿å³å¯åŸºäºè¯¥æ¨¡æ¿åˆ›å»ºé£é™©ï¼Œæ‚¨å¯ä»¥åœ¨åˆ›å»ºåè¿›ä¸€æ­¥è‡ªå®šä¹‰"})})]})})}):null},Be=(s,a)=>{const r=[],d=Ge(s);r.push(...d);const n=Ye(s);r.push(...n);const l=Qe(s);r.push(...l);const t=Xe(s);r.push(...t);const i=Je(s);r.push(...i);const o=Ze(s);r.push(...o);const c=et(s,a);return r.push(...c),r.sort((g,x)=>x.confidence-g.confidence).filter((g,x,u)=>x===u.findIndex(N=>N.template.id===g.template.id)).slice(0,10)},Ge=s=>{const a=[],r=s.tasks||[];if(s.milestones,(new Date(s.endDate).getTime()-new Date(s.startDate).getTime())/(1e3*60*60*24)<90&&r.length>20){const t=k.find(i=>i.id==="tmpl-schedule-001");t&&a.push({template:t,confidence:.85,reason:"é¡¹ç›®å·¥æœŸç´§å¼ ï¼ˆå°‘äº90å¤©ï¼‰ä¸”ä»»åŠ¡æ•°é‡è¾ƒå¤šï¼ˆ>20ä¸ªï¼‰ï¼Œå­˜åœ¨é‡Œç¨‹ç¢‘å»¶æœŸé£é™©",relatedFactors:["å·¥æœŸ","ä»»åŠ¡æ•°é‡"]})}if(r.filter(t=>t.dependencies&&t.dependencies.length>0).length>r.length*.3){const t=k.find(i=>i.id==="tmpl-schedule-002");t&&a.push({template:t,confidence:.7,reason:"è¶…è¿‡30%çš„ä»»åŠ¡å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œä¾èµ–é¡¹å»¶æœŸå¯èƒ½å½±å“æ•´ä½“è¿›åº¦",relatedFactors:["ä»»åŠ¡ä¾èµ–","å…³é”®è·¯å¾„"]})}return a},Ye=s=>{const a=[],r=s.budget||0,d=s.actualCost||0,n=r>0?d/r:0;if(n>.7&&s.status!=="completed"){const l=k.find(t=>t.id==="tmpl-cost-001");l&&a.push({template:l,confidence:.9,reason:`é¢„ç®—å·²ä½¿ç”¨${(n*100).toFixed(0)}%ï¼Œä½†é¡¹ç›®å°šæœªå®Œæˆï¼Œå­˜åœ¨é¢„ç®—è¶…æ”¯é£é™©`,relatedFactors:["é¢„ç®—ä½¿ç”¨ç‡","é¡¹ç›®è¿›åº¦"]})}if(!s.costHistory||s.costHistory.length===0){const l=k.find(t=>t.id==="tmpl-cost-002");l&&a.push({template:l,confidence:.6,reason:"ç¼ºå°‘æˆæœ¬è®°å½•ï¼Œå¯èƒ½å­˜åœ¨éšè—æˆæœ¬æœªè¢«è¿½è¸ª",relatedFactors:["æˆæœ¬è¿½è¸ª","é€æ˜åº¦"]})}return a},Qe=s=>{const a=[];if((s.resourceRequirements||[]).length===0&&s.status==="active"){const d=k.find(n=>n.id==="tmpl-resource-002");d&&a.push({template:d,confidence:.75,reason:"é¡¹ç›®å·²å¯åŠ¨ä½†æœªæ˜ç¡®èµ„æºéœ€æ±‚ï¼Œå¯èƒ½å­˜åœ¨æŠ€èƒ½ä¸åŒ¹é…é£é™©",relatedFactors:["èµ„æºè§„åˆ’","æŠ€èƒ½åŒ¹é…"]})}if(s.priority==="P0"||s.priority==="P1"){const d=k.find(n=>n.id==="tmpl-resource-003");d&&a.push({template:d,confidence:.65,reason:"é«˜ä¼˜å…ˆçº§é¡¹ç›®å¯èƒ½ä¸å…¶ä»–é¡¹ç›®äº‰å¤ºå…³é”®èµ„æº",relatedFactors:["é¡¹ç›®ä¼˜å…ˆçº§","èµ„æºç«äº‰"]})}return a},Xe=s=>{var r,d;const a=[];if((r=s.factors)!=null&&r.innovation&&s.factors.innovation>7){const n=k.find(l=>l.id==="tmpl-technical-001");n&&a.push({template:n,confidence:.8,reason:"é¡¹ç›®åˆ›æ–°åº¦è¾ƒé«˜ï¼Œå¯èƒ½æ¶‰åŠæ–°æŠ€æœ¯ï¼Œå­˜åœ¨æŠ€æœ¯é€‰å‹é£é™©",relatedFactors:["åˆ›æ–°åº¦","æŠ€æœ¯å¤æ‚åº¦"]})}if((d=s.factors)!=null&&d.risk&&s.factors.risk<5){const n=k.find(l=>l.id==="tmpl-technical-003");n&&a.push({template:n,confidence:.7,reason:"æŠ€æœ¯é£é™©è¯„åˆ†è¾ƒä½ï¼Œå»ºè®®å…³æ³¨å®‰å…¨æ¼æ´å’ŒæŠ€æœ¯å€ºåŠ¡",relatedFactors:["æŠ€æœ¯é£é™©","å®‰å…¨æ€§"]})}return a},Je=s=>{const a=[],r=s.tasks||[];if((new Date(s.endDate).getTime()-new Date(s.startDate).getTime())/(1e3*60*60*24)<60&&r.length>15){const l=k.find(t=>t.id==="tmpl-quality-001");l&&a.push({template:l,confidence:.75,reason:"å¼€å‘å‘¨æœŸçŸ­ä¸”ä»»åŠ¡é‡å¤§ï¼Œå¯èƒ½å½±å“è´¨é‡æ ‡å‡†",relatedFactors:["å¼€å‘å‘¨æœŸ","ä»»åŠ¡å¤æ‚åº¦"]})}if(s.status==="active"&&s.progress&&s.progress>50){const l=k.find(t=>t.id==="tmpl-quality-002");l&&a.push({template:l,confidence:.6,reason:"é¡¹ç›®å·²è¿›è¡Œè¿‡åŠï¼Œå»ºè®®è¯„ä¼°æŠ€æœ¯å€ºåŠ¡ç´¯ç§¯æƒ…å†µ",relatedFactors:["é¡¹ç›®è¿›åº¦","ä»£ç è´¨é‡"]})}return a},Ze=s=>{const a=[];if((s.tasks||[]).length>30){const d=k.find(n=>n.id==="tmpl-scope-001");d&&a.push({template:d,confidence:.7,reason:"ä»»åŠ¡æ•°é‡è¾ƒå¤šï¼ˆ>30ä¸ªï¼‰ï¼Œéœ€è­¦æƒ•éœ€æ±‚è”“å»¶",relatedFactors:["ä»»åŠ¡æ•°é‡","èŒƒå›´ç®¡ç†"]})}if(!s.description||s.description.length<50){const d=k.find(n=>n.id==="tmpl-scope-002");d&&a.push({template:d,confidence:.65,reason:"é¡¹ç›®æè¿°ä¸å¤Ÿè¯¦ç»†ï¼Œå¯èƒ½å­˜åœ¨éœ€æ±‚ä¸æ˜ç¡®çš„é£é™©",relatedFactors:["éœ€æ±‚æ–‡æ¡£","é¡¹ç›®å®šä¹‰"]})}return a},et=(s,a)=>{const r=[],d=a.filter(l=>l.id!==s.id&&l.status==="completed"&&l.priority===s.priority&&l.risks&&l.risks.length>0);if(d.length===0)return r;const n=new Map;return d.forEach(l=>{var t;(t=l.risks)==null||t.forEach(i=>{const o=i.category,c=n.get(o)||{count:0,category:i.category};n.set(o,{count:c.count+1,category:i.category})})}),n.forEach((l,t)=>{const i=l.count/d.length;if(i>.5){const o=k.filter(c=>c.category===l.category);o.length>0&&r.push({template:o[0],confidence:Math.min(.9,i),reason:`ç±»ä¼¼é¡¹ç›®ä¸­${(i*100).toFixed(0)}%é‡åˆ°äº†${t}ç±»é£é™©`,relatedFactors:["å†å²æ•°æ®","é¡¹ç›®ç›¸ä¼¼åº¦"]})}}),r},tt=s=>{const a=[],r=s.filter(x=>x.status!=="resolved"&&x.status!=="accepted"),d=r.filter(x=>x.priority==="critical"),n=r.filter(x=>x.priority==="high");d.length>0&&a.push(`âš ï¸ å‘ç° ${d.length} ä¸ªæé«˜é£é™©ï¼Œå»ºè®®ç«‹å³é‡‡å–ç¼“è§£æªæ–½å¹¶åˆ†é…ä¸“äººè´Ÿè´£`),n.length>3&&a.push(`ğŸ”´ é«˜é£é™©æ•°é‡è¾ƒå¤šï¼ˆ${n.length}ä¸ªï¼‰ï¼Œå»ºè®®ä¼˜å…ˆå¤„ç†å¹¶å¢åŠ è¯„å®¡é¢‘ç‡`);const l=r.filter(x=>x.mitigationStrategy&&x.mitigationStrategy.length>0),t=r.length>0?l.length/r.length:0;t<.5&&a.push(`ğŸ’¡ ä»…${(t*100).toFixed(0)}%çš„æ´»è·ƒé£é™©æœ‰ç¼“è§£ç­–ç•¥ï¼Œå»ºè®®å®Œå–„é£é™©åº”å¯¹è®¡åˆ’`);const i=r.reduce((x,u)=>x+u.mitigationActions.length,0),o=r.reduce((x,u)=>x+u.mitigationActions.filter(N=>N.status==="completed").length,0);if(i>0){const x=o/i;x<.3&&a.push(`ğŸ“‹ ç¼“è§£æªæ–½å®Œæˆç‡è¾ƒä½ï¼ˆ${(x*100).toFixed(0)}%ï¼‰ï¼Œå»ºè®®åŠ å¿«æ‰§è¡Œè¿›åº¦`)}const c={schedule:0,cost:0,resource:0,technical:0,external:0,quality:0,scope:0};r.forEach(x=>{c[x.category]++});const g=Object.entries(c).reduce((x,[u,N])=>N>x[1]?[u,N]:x,["",0]);return g[1]>r.length*.4&&a.push(`ğŸ“Š ${g[0]}ç±»é£é™©å æ¯”è¾ƒé«˜ï¼ˆ${g[1]}ä¸ªï¼‰ï¼Œå»ºè®®é’ˆå¯¹æ€§åŠ å¼ºç®¡ç†`),a},st=({project:s,allProjects:a,existingRisks:r,onAcceptSuggestion:d})=>{const n=f.useMemo(()=>Be(s,a),[s,a]),l=f.useMemo(()=>tt(r),[r]),t=o=>o>=.8?"text-red-600 bg-red-50 border-red-200":o>=.6?"text-orange-600 bg-orange-50 border-orange-200":"text-yellow-600 bg-yellow-50 border-yellow-200",i=o=>o>=.8?"é«˜":o>=.6?"ä¸­":"ä½";return e.jsxs("div",{className:"space-y-6",children:[l.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-6 border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ne,{className:"text-blue-600 dark:text-blue-400",size:20}),e.jsx("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100",children:"AI æ´å¯Ÿ"})]}),e.jsx("div",{className:"space-y-2",children:l.map((o,c)=>e.jsxs($.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:c*.1},className:"flex items-start gap-3 text-sm text-blue-800 dark:text-blue-200",children:[e.jsx(xe,{size:16,className:"mt-0.5 flex-shrink-0"}),e.jsx("span",{children:o})]},c))})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"text-purple-600 dark:text-purple-400",size:20}),e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"AI é£é™©å»ºè®®"})]}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"åŸºäºé¡¹ç›®ç‰¹å¾å’Œå†å²æ•°æ®åˆ†æ"})]}),n.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"mx-auto h-12 w-12 text-green-500 mb-3"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 font-medium",children:"æš‚æ— é£é™©å»ºè®®"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"é¡¹ç›®çŠ¶æ€è‰¯å¥½ï¼Œç»§ç»­ä¿æŒï¼"})]}):e.jsx("div",{className:"space-y-3",children:n.map((o,c)=>{const g=M(o.template.category),x=t(o.confidence);return e.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:c*.05},className:"border border-slate-200 dark:border-slate-700 rounded-lg p-4 hover:border-purple-300 dark:hover:border-purple-600 transition-colors group",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("span",{className:"text-xl",children:g.icon}),e.jsx("h4",{className:"font-semibold text-slate-800 dark:text-slate-100",children:o.template.name}),e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium border ${x}`,children:["ç½®ä¿¡åº¦: ",i(o.confidence)]})]}),e.jsxs("button",{onClick:()=>d(o.template.id),className:"flex items-center gap-1 px-3 py-1.5 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors opacity-0 group-hover:opacity-100",children:[e.jsx(I,{size:14}),e.jsx("span",{className:"text-xs",children:"é‡‡çº³"})]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-3",children:o.template.description}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 mb-3",children:[e.jsx("p",{className:"text-xs font-medium text-purple-900 dark:text-purple-100 mb-1",children:"ğŸ’¡ AI åˆ†æåŸå› "}),e.jsx("p",{className:"text-xs text-purple-800 dark:text-purple-200",children:o.reason})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"ç›¸å…³å› ç´ :"}),o.relatedFactors.map(u=>e.jsx("span",{className:"px-2 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200 rounded text-xs",children:u},u))]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200",children:"æŸ¥çœ‹å»ºè®®çš„ç¼“è§£ç­–ç•¥"}),e.jsxs("div",{className:"mt-2 pl-4 space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-700 dark:text-slate-200",children:"ç¼“è§£ç­–ç•¥:"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:o.template.mitigationStrategy})]}),o.template.contingencyPlan&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-700 dark:text-slate-200",children:"åº”æ€¥è®¡åˆ’:"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:o.template.contingencyPlan})]})]})]})})]},o.template.id)})}),n.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-slate-50 dark:bg-slate-900/50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:["ğŸ’¡ ",e.jsx("strong",{children:"æç¤º:"})," AI å»ºè®®åŸºäºé¡¹ç›®ç‰¹å¾ã€å†å²æ•°æ®å’Œè¡Œä¸šæœ€ä½³å®è·µç”Ÿæˆã€‚ æ‚¨å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©æ€§é‡‡çº³ï¼Œå¹¶è¿›ä¸€æ­¥è‡ªå®šä¹‰é£é™©è¯¦æƒ…ã€‚"]})})]})]})},at=({risks:s,months:a=6})=>{const r=f.useMemo(()=>{const t=new Date,i=Ie(Ce(t),a-1),o=Se(t);return X({start:i,end:o}).map(g=>{const x=s.filter(m=>{const R=new Date(m.identifiedDate),z=m.resolvedDate?new Date(m.resolvedDate):null;return R<=g&&(!z||z>g)}),u=x.reduce((m,R)=>m+R.riskScore,0),N=x.length>0?u/x.length:0,h=x.filter(m=>m.priority==="critical").length,y=x.filter(m=>m.priority==="high").length,v=x.filter(m=>m.priority==="medium").length,w=x.filter(m=>m.priority==="low").length;return{date:g,count:x.length,avgScore:N,critical:h,high:y,medium:v,low:w}})},[s,a]),d=f.useMemo(()=>{const t=new Map;return r.forEach(i=>{const o=C(i.date,"yyyy-MM");t.has(o)||t.set(o,[]),t.get(o).push(i)}),Array.from(t.entries()).map(([i,o])=>({month:i,monthLabel:C(new Date(i+"-01"),"yyyyå¹´MMæœˆ"),days:o}))},[r]),n=(t,i)=>i===0?"bg-slate-100 dark:bg-slate-800":t>=16?"bg-red-600":t>=12?"bg-red-500":t>=10?"bg-orange-500":t>=7?"bg-orange-400":t>=5?"bg-yellow-400":t>=3?"bg-yellow-300":"bg-green-300",l=Math.max(...r.map(t=>t.count),1);return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100 mb-2",children:"é£é™©çƒ­åŠ›å›¾ï¼ˆæ—¶é—´ç»´åº¦ï¼‰"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["è¿‡å» ",a," ä¸ªæœˆçš„é£é™©åˆ†å¸ƒå’Œå¼ºåº¦å˜åŒ–"]})]}),e.jsx("div",{className:"space-y-6 overflow-x-auto",children:d.map(t=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3",children:t.monthLabel}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"].map(i=>e.jsx("div",{className:"text-xs text-center text-slate-500 dark:text-slate-400 font-medium pb-1",children:i},i)),Array.from({length:t.days[0].date.getDay()}).map((i,o)=>e.jsx("div",{},`empty-${o}`)),t.days.map(i=>{const o=n(i.avgScore,i.count),c=ze(i.date,new Date);return e.jsxs("div",{className:"group relative",title:`${C(i.date,"yyyy-MM-dd")}: ${i.count} ä¸ªé£é™©`,children:[e.jsx("div",{className:`aspect-square rounded ${o} ${c?"ring-2 ring-blue-500":""} transition-transform hover:scale-110 cursor-pointer`}),e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:e.jsxs("div",{className:"bg-slate-900 text-white text-xs rounded-lg p-3 shadow-xl min-w-[200px]",children:[e.jsx("div",{className:"font-semibold mb-2",children:C(i.date,"yyyyå¹´MMæœˆddæ—¥")}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["æ´»è·ƒé£é™©: ",i.count," ä¸ª"]}),i.count>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["å¹³å‡åˆ†æ•°: ",i.avgScore.toFixed(1)]}),e.jsxs("div",{className:"pt-1 border-t border-slate-700",children:[i.critical>0&&e.jsxs("div",{className:"text-red-400",children:["æé«˜: ",i.critical]}),i.high>0&&e.jsxs("div",{className:"text-orange-400",children:["é«˜: ",i.high]}),i.medium>0&&e.jsxs("div",{className:"text-yellow-400",children:["ä¸­: ",i.medium]}),i.low>0&&e.jsxs("div",{className:"text-green-400",children:["ä½: ",i.low]})]})]})]})]})})]},i.date.toISOString())})]})]},t.month))}),e.jsx("div",{className:"mt-6 pt-6 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-700 dark:text-slate-200 mb-2",children:"é£é™©å¼ºåº¦"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"ä½"}),e.jsx("div",{className:"w-4 h-4 bg-green-300 rounded"}),e.jsx("div",{className:"w-4 h-4 bg-yellow-300 rounded"}),e.jsx("div",{className:"w-4 h-4 bg-yellow-400 rounded"}),e.jsx("div",{className:"w-4 h-4 bg-orange-400 rounded"}),e.jsx("div",{className:"w-4 h-4 bg-orange-500 rounded"}),e.jsx("div",{className:"w-4 h-4 bg-red-500 rounded"}),e.jsx("div",{className:"w-4 h-4 bg-red-600 rounded"}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"é«˜"})]})]}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-slate-100 dark:bg-slate-800 rounded"}),e.jsx("span",{children:"æ— é£é™©"})]})})]})}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"æœ€é«˜é£é™©æ—¥"}),e.jsxs("p",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:[l," ä¸ª"]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"å¹³å‡æ´»è·ƒé£é™©"}),e.jsx("p",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:(r.reduce((t,i)=>t+i.count,0)/r.length).toFixed(1)})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"æ— é£é™©å¤©æ•°"}),e.jsx("p",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:r.filter(t=>t.count===0).length})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"é«˜é£é™©å¤©æ•°"}),e.jsx("p",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:r.filter(t=>t.avgScore>=10).length})]})]})]})},lt=(s,a,r)=>{const d=[];return r.forEach(n=>{if(n.id===a.id)return;(n.risks||[]).forEach(t=>{const i=it(s,t,a,n);i.score>.3&&d.push({risk:t,project:n,correlationScore:i.score,correlationType:i.type,reason:i.reason})})}),d.sort((n,l)=>l.correlationScore-n.correlationScore),{sourceRisk:s,sourceProject:a,relatedRisks:d}},it=(s,a,r,d)=>{let n=0,l="indirect";const t=[];s.category===a.category&&(n+=.4,t.push(`ç›¸åŒç±»åˆ«ï¼ˆ${s.category}ï¼‰`)),s.priority===a.priority&&(n+=.2,t.push(`ç›¸åŒä¼˜å…ˆçº§ï¼ˆ${s.priority}ï¼‰`)),ae(r,d)&&(n+=.3,l="direct",t.push("é¡¹ç›®é—´å­˜åœ¨èµ„æºå…±äº«")),rt(r,d)>.5&&(n+=.2,t.push("é¡¹ç›®æ—¶é—´çº¿é‡å "));const o=nt(s.title+" "+s.description,a.title+" "+a.description);return o>.3&&(n+=o*.3,t.push("é£é™©æè¿°ç›¸ä¼¼")),ot(s,a)&&(n+=.4,l="cascading",t.push("å¯èƒ½äº§ç”Ÿè¿é”ååº”")),s.owner===a.owner&&(n+=.15,t.push("ç›¸åŒè´Ÿè´£äºº")),{score:Math.min(n,1),type:l,reason:t.join("ï¼›")}},ae=(s,a)=>{const r=new Set((s.resourceRequirements||[]).map(n=>n.resourceId)),d=new Set((a.resourceRequirements||[]).map(n=>n.resourceId));for(const n of r)if(d.has(n))return!0;return!1},rt=(s,a)=>{const r=new Date(s.startDate).getTime(),d=new Date(s.endDate).getTime(),n=new Date(a.startDate).getTime(),l=new Date(a.endDate).getTime(),t=Math.max(r,n),i=Math.min(d,l);if(t>=i)return 0;const o=i-t,c=Math.max(d-r,l-n);return o/c},nt=(s,a)=>{const r=new Set(s.toLowerCase().split(/\s+/)),d=new Set(a.toLowerCase().split(/\s+/));let n=0;for(const t of r)d.has(t)&&t.length>2&&n++;const l=Math.max(r.size,d.size);return l>0?n/l:0},ot=(s,a,r,d)=>s.category==="schedule"&&a.category==="cost"||s.category==="resource"&&a.category==="schedule"||s.category==="technical"&&a.category==="quality"||s.category==="scope"&&(a.category==="schedule"||a.category==="cost"),ct=s=>{const a=new Map;return s.forEach(r=>{const d=[],n=[];s.forEach(t=>{if(t.id===r.id)return;const i=t.risks||[],o=[];if(i.forEach(c=>{G(c,t,r)&&o.push(c)}),o.length>0){const c=o.reduce((x,u)=>x+u.impact,0)/o.length,g=o.filter(x=>x.priority==="critical");d.push({sourceProject:t,riskCount:o.length,avgImpact:c,criticalRisks:g})}});const l=r.risks||[];s.forEach(t=>{if(t.id===r.id)return;const i=l.filter(o=>G(o,r,t));if(i.length>0){const o=i.reduce((g,x)=>g+x.impact,0)/i.length,c=i.filter(g=>g.priority==="critical");n.push({targetProject:t,riskCount:i.length,avgImpact:o,criticalRisks:c})}}),a.set(r.id,{project:r,impactedBy:d,impacting:n})}),a},G=(s,a,r)=>!!(s.category==="resource"&&ae(a,r)||s.category==="schedule"&&a.priority==="P0"&&s.priority==="critical"||s.category==="external"&&s.impact>=4),dt=({currentProject:s,allProjects:a,currentRisk:r})=>{const d=f.useMemo(()=>ct(a).get(s.id),[s,a]),n=f.useMemo(()=>r?lt(r,s,a):null,[r,s,a]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(be,{className:"text-indigo-600 dark:text-indigo-400",size:20}),e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"è·¨é¡¹ç›®é£é™©å…³è”åˆ†æ"})]}),d&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3 flex items-center gap-2",children:[e.jsx(T,{size:16,className:"text-orange-500"}),"å—å…¶ä»–é¡¹ç›®å½±å“"]}),d.impactedBy.length===0?e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 italic",children:"æš‚æ— æ¥è‡ªå…¶ä»–é¡¹ç›®çš„é£é™©å½±å“"}):e.jsx("div",{className:"space-y-3",children:d.impactedBy.map(l=>e.jsxs($.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"border border-orange-200 dark:border-orange-800 rounded-lg p-3 bg-orange-50 dark:bg-orange-900/20",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-100 text-sm",children:l.sourceProject.name}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 mt-1",children:[l.riskCount," ä¸ªé£é™©å¯èƒ½å½±å“æœ¬é¡¹ç›®"]})]}),e.jsxs("span",{className:"px-2 py-1 bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-200 rounded text-xs font-medium",children:["å½±å“åº¦: ",l.avgImpact.toFixed(1),"/5"]})]}),l.criticalRisks.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-orange-300 dark:border-orange-700",children:[e.jsxs("p",{className:"text-xs font-medium text-red-600 dark:text-red-400 mb-1",children:["âš ï¸ æé«˜é£é™© (",l.criticalRisks.length,")"]}),l.criticalRisks.slice(0,2).map(t=>e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 truncate",children:["â€¢ ",t.title]},t.id))]})]},l.sourceProject.id))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3 flex items-center gap-2",children:[e.jsx(pe,{size:16,className:"text-blue-500"}),"å½±å“å…¶ä»–é¡¹ç›®"]}),d.impacting.length===0?e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 italic",children:"æœ¬é¡¹ç›®é£é™©æš‚ä¸å½±å“å…¶ä»–é¡¹ç›®"}):e.jsx("div",{className:"space-y-3",children:d.impacting.map(l=>e.jsxs($.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"border border-blue-200 dark:border-blue-800 rounded-lg p-3 bg-blue-50 dark:bg-blue-900/20",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-100 text-sm",children:l.targetProject.name}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 mt-1",children:[l.riskCount," ä¸ªé£é™©å¯èƒ½å½±å“è¯¥é¡¹ç›®"]})]}),e.jsxs("span",{className:"px-2 py-1 bg-blue-200 dark:bg-blue-800 text-blue-800 dark:text-blue-200 rounded text-xs font-medium",children:["å½±å“åº¦: ",l.avgImpact.toFixed(1),"/5"]})]}),l.criticalRisks.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-blue-300 dark:border-blue-700",children:[e.jsxs("p",{className:"text-xs font-medium text-red-600 dark:text-red-400 mb-1",children:["âš ï¸ æé«˜é£é™© (",l.criticalRisks.length,")"]}),l.criticalRisks.slice(0,2).map(t=>e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 truncate",children:["â€¢ ",t.title]},t.id))]})]},l.targetProject.id))})]})]})]}),n&&n.relatedRisks.length>0&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(A,{className:"text-purple-600 dark:text-purple-400",size:20}),e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"é£é™©å…³è”è¯¦æƒ…"})]}),e.jsxs("div",{className:"mb-4 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800",children:[e.jsxs("p",{className:"text-sm font-medium text-purple-900 dark:text-purple-100",children:["å½“å‰é£é™©: ",n.sourceRisk.title]}),e.jsxs("p",{className:"text-xs text-purple-700 dark:text-purple-200 mt-1",children:["åœ¨å…¶ä»–é¡¹ç›®ä¸­å‘ç° ",n.relatedRisks.length," ä¸ªç›¸å…³é£é™©"]})]}),e.jsx("div",{className:"space-y-3",children:n.relatedRisks.slice(0,5).map(l=>{const t=M(l.risk.category),i=te(l.risk.priority);return e.jsxs($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"border border-slate-200 dark:border-slate-700 rounded-lg p-4 hover:border-purple-300 dark:hover:border-purple-600 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("span",{className:"text-lg",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-100 text-sm",children:l.risk.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:l.project.name})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${i}`,children:l.risk.priority}),e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["å…³è”åº¦: ",(l.correlationScore*100).toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"mt-2 p-2 bg-slate-50 dark:bg-slate-900/50 rounded",children:[e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300",children:[e.jsx("span",{className:"font-medium",children:"å…³è”ç±»å‹:"})," ",l.correlationType==="direct"&&"ç›´æ¥å…³è”",l.correlationType==="indirect"&&"é—´æ¥å…³è”",l.correlationType==="cascading"&&"è¿é”ååº”"]}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 mt-1",children:[e.jsx("span",{className:"font-medium",children:"åŸå› :"})," ",l.reason]})]})]},l.risk.id)})}),n.relatedRisks.length>5&&e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 text-center mt-4",children:["è¿˜æœ‰ ",n.relatedRisks.length-5," ä¸ªç›¸å…³é£é™©æœªæ˜¾ç¤º"]})]}),e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg p-4 border border-indigo-200 dark:border-indigo-800",children:e.jsxs("p",{className:"text-sm text-indigo-900 dark:text-indigo-100",children:["ğŸ’¡ ",e.jsx("strong",{children:"æç¤º:"})," è·¨é¡¹ç›®é£é™©å…³è”åˆ†æå¯ä»¥å¸®åŠ©æ‚¨è¯†åˆ«é¡¹ç›®é—´çš„ä¾èµ–å…³ç³»å’Œæ½œåœ¨è¿é”ååº”ã€‚ å»ºè®®å®šæœŸè¯„å®¡è¿™äº›å…³è”ï¼Œå¹¶ä¸ç›¸å…³é¡¹ç›®å›¢é˜Ÿåè°ƒé£é™©åº”å¯¹æªæ–½ã€‚"]})})]})},$t=()=>{const{projectId:s}=ge(),a=he(),{projects:r,updateProject:d,user:n}=ue(),l=r.find(p=>p.id===s),[t,i]=f.useState(null),[o,c]=f.useState(!1),[g,x]=f.useState(!1),[u,N]=f.useState("all"),[h,y]=f.useState("all"),[v,w]=f.useState(new Set);if(!l)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(A,{className:"mx-auto h-12 w-12 text-yellow-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-700 dark:text-slate-200",children:"é¡¹ç›®æœªæ‰¾åˆ°"}),e.jsx("button",{onClick:()=>a("/projects"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"è¿”å›é¡¹ç›®åˆ—è¡¨"})]})});const m=l.risks||[],R=f.useMemo(()=>{const p=m.filter(S=>S.status!=="resolved"&&S.status!=="accepted"),b=p.filter(S=>S.priority==="critical"),j=Te(m),D=Fe(m);return{total:m.length,active:p.length,critical:b.length,resolved:m.filter(S=>S.status==="resolved").length,projectRiskScore:j,distribution:D}},[m]),z=f.useMemo(()=>m.filter(p=>!(u!=="all"&&p.category!==u||h!=="all"&&p.status!==h)),[m,u,h]),le=p=>{w(b=>{const j=new Set(b);return j.has(p)?j.delete(p):j.add(p),j})},L=p=>{const b=[...m,p];d(l.id,{risks:b}),c(!1)},ie=(p,b)=>{const j=m.map(D=>D.id===p?Ae(D,b,(n==null?void 0:n.id)||"system",(n==null?void 0:n.name)||"ç³»ç»Ÿ"):D);d(l.id,{risks:j})},re=p=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé£é™©å—ï¼Ÿ")){const b=m.filter(j=>j.id!==p);d(l.id,{risks:b})}},E=p=>{const b=_e(p,l.id,(n==null?void 0:n.id)||"system"),D={...se(l.id,b.title,b.category,b.probability,b.impact,b.owner,b.description),mitigationStrategy:b.mitigationStrategy,contingencyPlan:b.contingencyPlan,tags:b.tags};L(D)},ne=p=>{const b=k.find(j=>j.id===p);b&&E(b)};return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:["é£é™©ç®¡ç† - ",l.name]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"è¯†åˆ«ã€è¯„ä¼°å’Œç¼“è§£é¡¹ç›®é£é™©"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors",children:[e.jsx(Re,{size:18}),e.jsx("span",{children:"å¯¼å‡º"})]}),e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50",children:[e.jsx("button",{onClick:()=>Oe(m,l.name),className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm text-slate-700 dark:text-slate-200 rounded-t-lg",children:"ğŸ“„ å¯¼å‡ºä¸º CSV"}),e.jsx("button",{onClick:()=>Le(m,l.name),className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm text-slate-700 dark:text-slate-200",children:"ğŸ“Š å¯¼å‡ºä¸º Excel"}),e.jsx("button",{onClick:()=>qe(m,l),className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm text-slate-700 dark:text-slate-200 rounded-b-lg",children:"ğŸ–¨ï¸ æ‰“å° / PDF"})]})]}),e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{children:"ä»æ¨¡æ¿åˆ›å»º"})]}),e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(I,{size:18}),e.jsx("span",{children:"æ·»åŠ é£é™©"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"æ€»é£é™©æ•°"}),e.jsx("p",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 mt-1",children:R.total})]}),e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(A,{className:"text-blue-600 dark:text-blue-400",size:24})})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"æ´»è·ƒé£é™©"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400 mt-1",children:R.active})]}),e.jsx("div",{className:"p-3 bg-orange-100 dark:bg-orange-900/30 rounded-lg",children:e.jsx(T,{className:"text-orange-600 dark:text-orange-400",size:24})})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"æé«˜é£é™©"}),e.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400 mt-1",children:R.critical})]}),e.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 rounded-lg",children:e.jsx(H,{className:"text-red-600 dark:text-red-400",size:24})})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"å·²è§£å†³"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400 mt-1",children:R.resolved})]}),e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(B,{className:"text-green-600 dark:text-green-400",size:24})})]})})]}),e.jsx("div",{className:"mb-6",children:e.jsx(He,{risks:m,onRiskClick:p=>i(p)})}),m.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx(Ve,{risks:m})}),e.jsx("div",{className:"mb-6",children:e.jsx(st,{project:l,allProjects:r,existingRisks:m,onAcceptSuggestion:ne})}),m.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx(at,{risks:m,months:6})}),r.length>1&&e.jsx("div",{className:"mb-6",children:e.jsx(dt,{currentProject:l,allProjects:r,currentRisk:t||void 0})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(J,{size:18,className:"text-slate-500"}),e.jsxs("select",{value:u,onChange:p=>N(p.target.value),className:"px-3 py-1.5 border border-slate-200 dark:border-slate-600 rounded-lg text-sm bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200",children:[e.jsx("option",{value:"all",children:"æ‰€æœ‰ç±»åˆ«"}),e.jsx("option",{value:"schedule",children:"è¿›åº¦é£é™©"}),e.jsx("option",{value:"cost",children:"æˆæœ¬é£é™©"}),e.jsx("option",{value:"resource",children:"èµ„æºé£é™©"}),e.jsx("option",{value:"technical",children:"æŠ€æœ¯é£é™©"}),e.jsx("option",{value:"external",children:"å¤–éƒ¨é£é™©"}),e.jsx("option",{value:"quality",children:"è´¨é‡é£é™©"}),e.jsx("option",{value:"scope",children:"èŒƒå›´é£é™©"})]}),e.jsxs("select",{value:h,onChange:p=>y(p.target.value),className:"px-3 py-1.5 border border-slate-200 dark:border-slate-600 rounded-lg text-sm bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200",children:[e.jsx("option",{value:"all",children:"æ‰€æœ‰çŠ¶æ€"}),e.jsx("option",{value:"identified",children:"å·²è¯†åˆ«"}),e.jsx("option",{value:"analyzing",children:"åˆ†æä¸­"}),e.jsx("option",{value:"mitigating",children:"ç¼“è§£ä¸­"}),e.jsx("option",{value:"monitoring",children:"ç›‘æ§ä¸­"}),e.jsx("option",{value:"resolved",children:"å·²è§£å†³"}),e.jsx("option",{value:"accepted",children:"å·²æ¥å—"})]}),e.jsxs("div",{className:"ml-auto text-sm text-slate-500 dark:text-slate-400",children:["æ˜¾ç¤º ",z.length," / ",m.length," ä¸ªé£é™©"]})]})}),e.jsx("div",{className:"space-y-4",children:z.length===0?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-12 text-center",children:[e.jsx(H,{className:"mx-auto h-12 w-12 text-slate-300 dark:text-slate-600 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"æš‚æ— é£é™©"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:'ç‚¹å‡»"æ·»åŠ é£é™©"æŒ‰é’®å¼€å§‹è¯†åˆ«é¡¹ç›®é£é™©'})]}):z.map(p=>{const b=v.has(p.id),j=M(p.category),D=O(p.status);return e.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-lg",children:j.icon}),e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:p.title}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${te(p.priority)}`,children:p.priority.toUpperCase()}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${D.color}`,children:D.label})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-3",children:p.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("span",{children:["æ¦‚ç‡: ",p.probability,"/5"]}),e.jsxs("span",{children:["å½±å“: ",p.impact,"/5"]}),e.jsxs("span",{children:["é£é™©åˆ†æ•°: ",p.riskScore]}),e.jsx("span",{className:j.color,children:j.label})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>le(p.id),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:b?e.jsx(Me,{size:18}):e.jsx(De,{size:18})}),e.jsx("button",{onClick:()=>i(p),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx($e,{size:18})}),e.jsx("button",{onClick:()=>re(p.id),className:"p-2 hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 rounded-lg transition-colors",children:e.jsx(Q,{size:18})})]})]})}),e.jsx(F,{children:b&&e.jsxs($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"ç¼“è§£ç­–ç•¥"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:p.mitigationStrategy||"æš‚æ— ç¼“è§£ç­–ç•¥"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"åº”æ€¥è®¡åˆ’"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:p.contingencyPlan||"æš‚æ— åº”æ€¥è®¡åˆ’"})]})]}),p.mitigationActions.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2",children:["ç¼“è§£æªæ–½ (",p.mitigationActions.length,")"]}),e.jsx("div",{className:"space-y-2",children:p.mitigationActions.map(S=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white dark:bg-slate-800 rounded-lg",children:[e.jsx(B,{size:16,className:S.status==="completed"?"text-green-600":"text-slate-300"}),e.jsx("span",{className:"flex-1 text-sm text-slate-700 dark:text-slate-200",children:S.description}),e.jsx("span",{className:"text-xs text-slate-500",children:S.status})]},S.id))})]})]})})]},p.id)})}),e.jsx(Ue,{isOpen:o||t!==null,onClose:()=>{c(!1),i(null)},onSave:p=>{t?ie(p.id,p):L(p),i(null)},projectId:l.id,existingRisk:t,currentUserId:(n==null?void 0:n.id)||"system"}),e.jsx(Ke,{isOpen:g,onClose:()=>x(!1),onSelectTemplate:E})]})};export{$t as default};
