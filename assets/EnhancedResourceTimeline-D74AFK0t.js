import{o as Y,J as Q,ao as v,p as M,ax as O,G as z,ay as R,H as _,r as T,j as h,az as E,g as F}from"./index-BvQyAdiV.js";import{s as N,f as I}from"./format-BaDDL2Yc.js";import{a as A}from"./addWeeks-DBFXsJNP.js";import{e as H}from"./endOfWeek-BLqtcsTo.js";import{a as B,e as G}from"./eachDayOfInterval-B8Wvjce2.js";import{C as V}from"./chevron-left-IrjyfQG2.js";import{C as J}from"./chevron-right-DFoHNZMg.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=Y("SlidersVertical",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]);function X(c,i){const t=i*3;return Q(c,t)}function K(c,i){const t=v(c.start),e=v(c.end);let o=+t>+e;const s=o?+t:+e,n=o?e:t;n.setHours(0,0,0,0),n.setDate(1);let u=1;const l=[];for(;+n<=s;)l.push(v(n)),n.setMonth(n.getMonth()+u);return o?l.reverse():l}function j(c){const i=v(c),t=i.getMonth(),e=t-t%3;return i.setMonth(e,1),i.setHours(0,0,0,0),i}function U(c,i){const t=v(c.start),e=v(c.end);let o=+t>+e;const s=o?+j(t):+j(e);let n=j(o?e:t),u=1;const l=[];for(;+n<=s;)l.push(v(n)),n=X(n,u);return o?l.reverse():l}function Z(c,i){const t=v(c.start),e=v(c.end);let o=+t>+e;const s=o?N(e,i):N(t,i),n=o?N(t,i):N(e,i);s.setHours(15),n.setHours(15);const u=+n.getTime();let l=s,r=1;const d=[];for(;+l<=u;)l.setHours(0),d.push(v(l)),l=A(l,r),l.setHours(15);return o?d.reverse():d}function C(c){const i=v(c),t=i.getMonth(),e=t-t%3+3;return i.setMonth(e,0),i.setHours(23,59,59,999),i}const ee=c=>{const i=[],t=new Set,e=new Set,o=s=>{if(e.has(s))return!1;if(t.has(s))return!0;e.add(s);const n=c.find(u=>u.id===s);if(n!=null&&n.dependencies){for(const u of n.dependencies)if(!o(u))return!1}return e.delete(s),t.add(s),n&&i.push(n),!0};for(const s of c)if(!t.has(s.id)&&!o(s.id))return console.error("Circular dependency detected"),c;return i.reverse()},fe=c=>{const i={},t={},e={},o={},s={},n=ee(c);for(const r of n){const d=r.startDate?new Date(r.startDate):new Date,g=r.endDate?new Date(r.endDate):new Date,p=Math.max(1,Math.ceil((g.getTime()-d.getTime())/(1e3*60*60*24)));if(!r.dependencies||r.dependencies.length===0)i[r.id]=d;else{let w=d;for(const x of r.dependencies){const a=t[x];a&&a>w&&(w=a)}i[r.id]=w}t[r.id]=new Date(i[r.id].getTime()+p*24*60*60*1e3)}const u=new Date(Math.max(...Object.values(t).map(r=>r.getTime())));for(let r=n.length-1;r>=0;r--){const d=n[r],g=d.startDate?new Date(d.startDate):new Date,p=d.endDate?new Date(d.endDate):new Date,w=Math.max(1,Math.ceil((p.getTime()-g.getTime())/(1e3*60*60*24))),x=n.filter(a=>{var m;return(m=a.dependencies)==null?void 0:m.includes(d.id)});if(x.length===0)o[d.id]=u;else{let a=u;for(const m of x){const y=e[m.id];y&&y<a&&(a=y)}o[d.id]=a}e[d.id]=new Date(o[d.id].getTime()-w*24*60*60*1e3),s[d.id]=Math.ceil((e[d.id].getTime()-i[d.id].getTime())/(1e3*60*60*24))}return{criticalPath:n.filter(r=>s[r.id]===0).map(r=>r.id),earliestStart:i,latestStart:e,slack:s}},te=(c,i=3)=>{if(c.length===0)return 0;c.length<i&&(i=c.length);const t=c.slice(-i);return t.reduce((e,o)=>e+o,0)/t.length},P=c=>{const i=c.length;if(i===0)return{slope:0,intercept:0};let t=0,e=0,o=0,s=0;for(let l=0;l<i;l++)t+=l,e+=c[l],o+=l*c[l],s+=l*l;const n=(i*o-t*e)/(i*s-t*t),u=(e-n*t)/i;return{slope:n,intercept:u}},se=(c,i,t=12)=>{var s;const e=new Date,o=[];for(let n=t;n>0;n--){const u=Q(e,-n),l=I(u,"yyyy-MM");let r=0;for(const d of i){if(!d.startDate||!d.endDate)continue;const g=M(d.startDate),p=M(d.endDate),w=new Date(u.getFullYear(),u.getMonth(),1),x=new Date(u.getFullYear(),u.getMonth()+1,0);if(g<=x&&p>=w){const a=(s=d.resourceRequirements)==null?void 0:s.find(m=>m.resourceId===c.id);a&&(r+=a.count)}}o.push({month:l,load:r})}return o},ne=(c,i,t=6,e="sma")=>{const o=se(c,i,12),s=o.map(x=>x.load),{slope:n}=P(s);let u="stable";n>.5?u="increasing":n<-.5&&(u="decreasing");const l=[],r=new Date;for(let x=1;x<=t;x++){const a=Q(r,x),m=I(a,"yyyy-MM");let y=0,f=100;if(e==="sma")y=te(s,3),f=Math.max(50,100-x*10);else{const{slope:b,intercept:D}=P(s);y=b*(s.length+x)+D,f=Math.max(40,100-x*12)}y=Math.max(0,Math.round(y)),y=Math.min(c.totalQuantity*1.5,y),l.push({month:m,predicted:y,confidence:f})}const d=[...s,...l.map(x=>x.predicted)],g=Math.max(...d),p=d.indexOf(g),w=p<s.length?o[p].month:l[p-s.length].month;return{resourceId:c.id,resourceName:c.name,predictions:l,trend:u,peakMonth:w,peakLoad:g}},me=(c,i,t=6)=>c.map(e=>ne(e,i,t)),xe=(c,i)=>{const t=[],e=[];for(const s of c){const n=i.find(r=>r.id===s.resourceId);if(!n)continue;const u=s.predictions.filter(r=>r.predicted>n.totalQuantity);u.length>0&&t.push(`${s.resourceName} 预计在 ${u[0].month} 开始超载，峰值 ${s.peakLoad}/${n.totalQuantity}`);const l=s.predictions.filter(r=>r.predicted<n.totalQuantity*.3);l.length>=3&&e.push(`${s.resourceName} 未来 ${l.length} 个月利用率较低，可承接新项目`),s.trend==="increasing"&&s.predictions[s.predictions.length-1].predicted>n.totalQuantity*.8&&t.push(`${s.resourceName} 需求呈上升趋势，建议提前规划扩充`)}let o="";return t.length>0&&(o+=`发现 ${t.length} 个潜在风险。`),e.length>0&&(o+=`发现 ${e.length} 个优化机会。`),t.length===0&&e.length===0&&(o="资源负载预测正常，无明显风险。"),{warnings:t,opportunities:e,summary:o}},ge=(c,i=12,t="month")=>{const e=new Date;let o,s;if(t==="day"?(o=O(e),s=B(o,i)):t==="week"?(o=N(e),s=A(o,i)):t==="quarter"?(o=j(e),s=X(o,i)):(o=z(e),s=Q(o,i)),c.length>0){const l=c.map(d=>d.startDate?M(d.startDate).getTime():1/0).filter(d=>d!==1/0),r=c.map(d=>d.endDate?M(d.endDate).getTime():-1/0).filter(d=>d!==-1/0);if(l.length>0){const d=new Date(Math.min(...l));let g;t==="day"?g=O(d):t==="week"?g=N(d):t==="quarter"?g=j(d):g=z(d),g<o&&(o=g)}if(r.length>0){const d=new Date(Math.max(...r));let g;t==="day"?g=R(d):t==="week"?g=H(d):t==="quarter"?g=C(d):g=_(d),g>s&&(s=g)}}let n,u;return t==="day"?(n=G({start:o,end:s}),u="MM-dd"):t==="week"?(n=Z({start:o,end:s}),u="'W'w yyyy"):t==="quarter"?(n=U({start:o,end:s}),u="'Q'Q yyyy"):(n=K({start:o,end:s}),u="MMM yyyy"),n.slice(0,i).map(l=>({label:I(l,u),date:l}))},ae=(c,i,t,e="month")=>i.map(o=>{const s={};return t.forEach(n=>{let u,l;e==="day"?(u=O(n.date),l=R(n.date)):e==="week"?(u=N(n.date),l=H(n.date)):e==="quarter"?(u=j(n.date),l=C(n.date)):(u=z(n.date),l=_(n.date));let r=0,d=0;const g=[];c.forEach(p=>{if(!p.startDate||!p.endDate)return;const w=M(p.startDate),x=(p.resourceRequirements||[]).find(a=>a.resourceId===o.id);if(x){let a=x.duration;x.unit==="day"&&(a=x.duration/30),x.unit==="year"&&(a=x.duration*12);const m=Q(w,a);w<=l&&m>=u&&(p.status==="active"?r+=x.count:p.status==="planning"&&(d+=x.count),g.push({id:p.id,name:p.name,amount:x.count,status:p.status}))}}),s[n.label]={active:r,planning:d,total:r+d,projects:g}}),{resourceId:o.id,resourceName:o.name,capacity:o.totalQuantity,allocations:s}}),pe=({projects:c,resources:i,onProjectClick:t})=>{var w,x;const[e,o]=T.useState("month"),[s,n]=T.useState(0),u=T.useRef(null),l=T.useMemo(()=>{switch(e){case"day":return{count:30,width:40,format:"dd"};case"week":return{count:12,width:100,format:"'W'w"};case"month":return{count:12,width:120,format:"MMM yyyy"};case"quarter":return{count:4,width:150,format:"'Q'Q yyyy"}}},[e]),r=T.useMemo(()=>{const a=new Date;let m=a;s!==0&&(e==="day"?m=new Date(a.setDate(a.getDate()+s*l.count)):e==="week"?m=new Date(a.setDate(a.getDate()+s*l.count*7)):e==="month"?m=new Date(a.setMonth(a.getMonth()+s*l.count)):e==="quarter"&&(m=new Date(a.setMonth(a.getMonth()+s*l.count*3))));const y=[];let f=m;for(let b=0;b<l.count;b++)y.push(new Date(f)),e==="day"?f.setDate(f.getDate()+1):e==="week"?f.setDate(f.getDate()+7):e==="month"?f.setMonth(f.getMonth()+1):e==="quarter"&&f.setMonth(f.getMonth()+3);return y.map(b=>({date:b,label:I(b,l.format),fullLabel:I(b,"yyyy-MM-dd")}))},[e,s,l]),d=T.useMemo(()=>ae(c,i,r,e),[c,i,r,e]),g=(a,m)=>{if(!a.startDate||!a.endDate)return!1;const y=M(a.startDate),f=M(a.endDate);let b,D;return e==="day"?(b=O(m),D=R(m)):e==="week"?(b=N(m),D=H(m)):e==="month"?(b=z(m),D=_(m)):(b=j(m),D=C(m)),y<=D&&f>=b},p=a=>{switch(a){case"active":return"bg-blue-500 border-blue-600";case"planning":return"bg-purple-500 border-purple-600";case"completed":return"bg-green-500 border-green-600";case"on-hold":return"bg-gray-400 border-gray-500";default:return"bg-slate-500 border-slate-600"}};return h.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col h-[600px]",children:[h.jsxs("div",{className:"p-4 border-b border-slate-200 flex items-center justify-between bg-slate-50 rounded-t-xl",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("h3",{className:"font-bold text-slate-800",children:"资源时间线"}),h.jsx("div",{className:"flex bg-white rounded-lg border border-slate-200 p-1",children:["day","week","month","quarter"].map(a=>h.jsx("button",{onClick:()=>{o(a),n(0)},className:E("px-3 py-1 text-xs font-medium rounded-md transition-colors",e===a?"bg-blue-100 text-blue-700":"text-slate-600 hover:bg-slate-50"),children:a==="day"?"日":a==="week"?"周":a==="month"?"月":"季"},a))})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("button",{onClick:()=>n(a=>a-1),className:"p-2 hover:bg-white rounded-lg border border-transparent hover:border-slate-200 transition-all",children:h.jsx(V,{size:20,className:"text-slate-600"})}),h.jsxs("span",{className:"text-sm font-medium text-slate-600 min-w-[100px] text-center",children:[(w=r[0])==null?void 0:w.label," - ",(x=r[r.length-1])==null?void 0:x.label]}),h.jsx("button",{onClick:()=>n(a=>a+1),className:"p-2 hover:bg-white rounded-lg border border-transparent hover:border-slate-200 transition-all",children:h.jsx(J,{size:20,className:"text-slate-600"})})]})]}),h.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",ref:u,children:[h.jsxs("div",{className:"flex border-b border-slate-200 bg-slate-50",children:[h.jsx("div",{className:"w-48 flex-shrink-0 p-3 font-semibold text-slate-700 border-r border-slate-200 sticky left-0 bg-slate-50 z-20 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:"资源名称"}),h.jsx("div",{className:"flex flex-1 overflow-hidden",children:r.map((a,m)=>h.jsx("div",{className:"flex-shrink-0 border-r border-slate-200 p-2 text-center text-xs font-medium text-slate-600",style:{width:`${l.width}px`},children:a.label},m))})]}),h.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden",children:i.map(a=>{var y;const m=d.find(f=>f.resourceId===a.id);return h.jsxs("div",{className:"flex border-b border-slate-100 hover:bg-slate-50/50 transition-colors group",children:[h.jsxs("div",{className:"w-48 flex-shrink-0 p-3 border-r border-slate-200 bg-white sticky left-0 z-10 group-hover:bg-slate-50 transition-colors shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:[h.jsx("div",{className:"font-medium text-slate-900 text-sm truncate",children:a.name}),h.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-1 mt-1",children:[h.jsxs("span",{children:["容量: ",a.totalQuantity]}),((y=a.skills)==null?void 0:y[0])&&h.jsx("span",{className:"bg-slate-100 px-1.5 rounded text-[10px]",children:a.skills[0].name})]})]}),h.jsxs("div",{className:"flex flex-1 relative",children:[h.jsx("div",{className:"absolute inset-0 flex",children:r.map((f,b)=>{const D=m==null?void 0:m.allocations[f.label],q=(D==null?void 0:D.total)||0,k=q>a.totalQuantity,L=a.totalQuantity>0?q/a.totalQuantity*100:0;return h.jsxs("div",{className:E("flex-shrink-0 border-r border-slate-100 h-full relative transition-colors",k?"bg-red-50/50":""),style:{width:`${l.width}px`},children:[k&&h.jsx("div",{className:"absolute top-1 right-1 z-0",children:h.jsx(F,{size:12,className:"text-red-500 opacity-50"})}),h.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-slate-100",children:h.jsx("div",{className:E("h-full transition-all",k?"bg-red-500":L>80?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(L,100)}%`}})})]},b)})}),h.jsx("div",{className:"relative w-full h-16 pointer-events-none",children:c.filter(f=>(f.resourceRequirements||[]).some(b=>b.resourceId===a.id)&&(g(f,r[0].date)||g(f,r[r.length-1].date)||M(f.startDate)>=r[0].date&&M(f.endDate)<=r[r.length-1].date)).map((f,b)=>{const D=M(f.startDate),q=M(f.endDate),k=r[0].date,W=r[r.length-1].date.getTime()-k.getTime();let S=(D.getTime()-k.getTime())/W*100,$=(q.getTime()-D.getTime())/W*100;return S<0&&($+=S,S=0),S+$>100&&($=100-S),$<=0?null:h.jsx("div",{className:E("absolute h-6 rounded border shadow-sm flex items-center px-2 pointer-events-auto cursor-pointer hover:brightness-95 hover:z-20 transition-all",p(f.status)),style:{left:`${S}%`,width:`${$}%`,top:`${4+b%2*28}px`,zIndex:5},onClick:()=>t==null?void 0:t(f.id),title:`${f.name} (${f.status})
${f.startDate} - ${f.endDate}`,children:h.jsx("span",{className:"text-xs font-bold text-white truncate",children:f.name})},f.id)})})]})]},a.id)})})]}),h.jsxs("div",{className:"p-3 bg-slate-50 border-t border-slate-200 flex gap-6 text-xs text-slate-600",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(F,{size:14,className:"text-red-500"}),h.jsx("span",{children:"超额分配警告"})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),h.jsx("span",{children:"进行中项目"})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded"}),h.jsx("span",{children:"计划中项目"})]})]})]})};export{pe as E,ue as S,me as a,xe as b,fe as c,ae as d,K as e,ge as g,ne as p};
