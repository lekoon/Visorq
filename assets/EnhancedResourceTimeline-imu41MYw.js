import{e as P,t as v,D as I,p as M,r as S,j as i,E as O,c as F}from"./index-BPZO1skf.js";import{a as A,e as $}from"./endOfWeek-BW9UvitI.js";import{a as C,s as Q,e as R}from"./startOfMonth-BKlLoj-l.js";import{e as W}from"./endOfDay-DEfQ40bB.js";import{a as V,e as G}from"./eachDayOfInterval-CycTZIQ-.js";import{s as N,f as _}from"./format-O7vSG95s.js";import{C as J}from"./chevron-right-X76iA8q1.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=P("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=P("SlidersVertical",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]);function B(f,d){const n=d*3;return C(f,n)}function U(f,d){const n=v(f.start),t=v(f.end);let o=+n>+t;const l=o?+n:+t,s=o?t:n;s.setHours(0,0,0,0),s.setDate(1);let u=1;const c=[];for(;+s<=l;)c.push(v(s)),s.setMonth(s.getMonth()+u);return o?c.reverse():c}function j(f){const d=v(f),n=d.getMonth(),t=n-n%3;return d.setMonth(t,1),d.setHours(0,0,0,0),d}function X(f,d){const n=v(f.start),t=v(f.end);let o=+n>+t;const l=o?+j(n):+j(t);let s=j(o?t:n),u=1;const c=[];for(;+s<=l;)c.push(v(s)),s=B(s,u);return o?c.reverse():c}function Y(f,d){const n=v(f.start),t=v(f.end);let o=+n>+t;const l=o?N(t,d):N(n,d),s=o?N(n,d):N(t,d);l.setHours(15),s.setHours(15);const u=+s.getTime();let c=l,a=1;const r=[];for(;+c<=u;)c.setHours(0),r.push(v(c)),c=A(c,a),c.setHours(15);return o?r.reverse():r}function H(f){const d=v(f),n=d.getMonth(),t=n-n%3+3;return d.setMonth(t,0),d.setHours(23,59,59,999),d}const Z=f=>{const d=[],n=new Set,t=new Set,o=l=>{if(t.has(l))return!1;if(n.has(l))return!0;t.add(l);const s=f.find(u=>u.id===l);if(s!=null&&s.dependencies){for(const u of s.dependencies)if(!o(u))return!1}return t.delete(l),n.add(l),s&&d.push(s),!0};for(const l of f)if(!n.has(l.id)&&!o(l.id))return console.error("Circular dependency detected"),f;return d.reverse()},de=f=>{const d={},n={},t={},o={},l={},s=Z(f);for(const a of s){const r=a.startDate?new Date(a.startDate):new Date,x=a.endDate?new Date(a.endDate):new Date,p=Math.max(1,Math.ceil((x.getTime()-r.getTime())/(1e3*60*60*24)));if(!a.dependencies||a.dependencies.length===0)d[a.id]=r;else{let D=r;for(const y of a.dependencies){const e=n[y];e&&e>D&&(D=e)}d[a.id]=D}n[a.id]=new Date(d[a.id].getTime()+p*24*60*60*1e3)}const u=new Date(Math.max(...Object.values(n).map(a=>a.getTime())));for(let a=s.length-1;a>=0;a--){const r=s[a],x=r.startDate?new Date(r.startDate):new Date,p=r.endDate?new Date(r.endDate):new Date,D=Math.max(1,Math.ceil((p.getTime()-x.getTime())/(1e3*60*60*24))),y=s.filter(e=>{var m;return(m=e.dependencies)==null?void 0:m.includes(r.id)});if(y.length===0)o[r.id]=u;else{let e=u;for(const m of y){const b=t[m.id];b&&b<e&&(e=b)}o[r.id]=e}t[r.id]=new Date(o[r.id].getTime()-D*24*60*60*1e3),l[r.id]=Math.ceil((t[r.id].getTime()-d[r.id].getTime())/(1e3*60*60*24))}return{criticalPath:s.filter(a=>l[a.id]===0).map(a=>a.id),earliestStart:d,latestStart:t,slack:l}},ce=(f,d=12,n="month")=>{const t=new Date;let o,l;if(n==="day"?(o=I(t),l=V(o,d)):n==="week"?(o=N(t),l=A(o,d)):n==="quarter"?(o=j(t),l=B(o,d)):(o=Q(t),l=C(o,d)),f.length>0){const c=f.map(r=>r.startDate?M(r.startDate).getTime():1/0).filter(r=>r!==1/0),a=f.map(r=>r.endDate?M(r.endDate).getTime():-1/0).filter(r=>r!==-1/0);if(c.length>0){const r=new Date(Math.min(...c));let x;n==="day"?x=I(r):n==="week"?x=N(r):n==="quarter"?x=j(r):x=Q(r),x<o&&(o=x)}if(a.length>0){const r=new Date(Math.max(...a));let x;n==="day"?x=W(r):n==="week"?x=$(r):n==="quarter"?x=H(r):x=R(r),x>l&&(l=x)}}let s,u;return n==="day"?(s=G({start:o,end:l}),u="MM-dd"):n==="week"?(s=Y({start:o,end:l}),u="'W'w yyyy"):n==="quarter"?(s=X({start:o,end:l}),u="'Q'Q yyyy"):(s=U({start:o,end:l}),u="MMM yyyy"),s.slice(0,d).map(c=>({label:_(c,u),date:c}))},ee=(f,d,n,t="month")=>d.map(o=>{const l={};return n.forEach(s=>{let u,c;t==="day"?(u=I(s.date),c=W(s.date)):t==="week"?(u=N(s.date),c=$(s.date)):t==="quarter"?(u=j(s.date),c=H(s.date)):(u=Q(s.date),c=R(s.date));let a=0,r=0;const x=[];f.forEach(p=>{if(!p.startDate||!p.endDate)return;const D=M(p.startDate),y=(p.resourceRequirements||[]).find(e=>e.resourceId===o.id);if(y){let e=y.duration;y.unit==="day"&&(e=y.duration/30),y.unit==="year"&&(e=y.duration*12);const m=C(D,e);D<=c&&m>=u&&(p.status==="active"?a+=y.count:p.status==="planning"&&(r+=y.count),x.push({id:p.id,name:p.name,amount:y.count,status:p.status}))}}),l[s.label]={active:a,planning:r,total:a+r,projects:x}}),{resourceId:o.id,resourceName:o.name,capacity:o.totalQuantity,allocations:l}}),he=({projects:f,resources:d,onProjectClick:n})=>{var D,y;const[t,o]=S.useState("month"),[l,s]=S.useState(0),u=S.useRef(null),c=S.useMemo(()=>{switch(t){case"day":return{count:30,width:40,format:"dd"};case"week":return{count:12,width:100,format:"'W'w"};case"month":return{count:12,width:120,format:"MMM yyyy"};case"quarter":return{count:4,width:150,format:"'Q'Q yyyy"}}},[t]),a=S.useMemo(()=>{const e=new Date;let m=e;l!==0&&(t==="day"?m=new Date(e.setDate(e.getDate()+l*c.count)):t==="week"?m=new Date(e.setDate(e.getDate()+l*c.count*7)):t==="month"?m=new Date(e.setMonth(e.getMonth()+l*c.count)):t==="quarter"&&(m=new Date(e.setMonth(e.getMonth()+l*c.count*3))));const b=[];let h=m;for(let g=0;g<c.count;g++)b.push(new Date(h)),t==="day"?h.setDate(h.getDate()+1):t==="week"?h.setDate(h.getDate()+7):t==="month"?h.setMonth(h.getMonth()+1):t==="quarter"&&h.setMonth(h.getMonth()+3);return b.map(g=>({date:g,label:_(g,c.format),fullLabel:_(g,"yyyy-MM-dd")}))},[t,l,c]),r=S.useMemo(()=>ee(f,d,a,t),[f,d,a,t]),x=(e,m)=>{if(!e.startDate||!e.endDate)return!1;const b=M(e.startDate),h=M(e.endDate);let g,w;return t==="day"?(g=I(m),w=W(m)):t==="week"?(g=N(m),w=$(m)):t==="month"?(g=Q(m),w=R(m)):(g=j(m),w=H(m)),b<=w&&h>=g},p=e=>{switch(e){case"active":return"bg-blue-500 border-blue-600";case"planning":return"bg-purple-500 border-purple-600";case"completed":return"bg-green-500 border-green-600";case"on-hold":return"bg-gray-400 border-gray-500";default:return"bg-slate-500 border-slate-600"}};return i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col h-[600px]",children:[i.jsxs("div",{className:"p-4 border-b border-slate-200 flex items-center justify-between bg-slate-50 rounded-t-xl",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("h3",{className:"font-bold text-slate-800",children:"资源时间线"}),i.jsx("div",{className:"flex bg-white rounded-lg border border-slate-200 p-1",children:["day","week","month","quarter"].map(e=>i.jsx("button",{onClick:()=>{o(e),s(0)},className:O("px-3 py-1 text-xs font-medium rounded-md transition-colors",t===e?"bg-blue-100 text-blue-700":"text-slate-600 hover:bg-slate-50"),children:e==="day"?"日":e==="week"?"周":e==="month"?"月":"季"},e))})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:()=>s(e=>e-1),className:"p-2 hover:bg-white rounded-lg border border-transparent hover:border-slate-200 transition-all",children:i.jsx(K,{size:20,className:"text-slate-600"})}),i.jsxs("span",{className:"text-sm font-medium text-slate-600 min-w-[100px] text-center",children:[(D=a[0])==null?void 0:D.label," - ",(y=a[a.length-1])==null?void 0:y.label]}),i.jsx("button",{onClick:()=>s(e=>e+1),className:"p-2 hover:bg-white rounded-lg border border-transparent hover:border-slate-200 transition-all",children:i.jsx(J,{size:20,className:"text-slate-600"})})]})]}),i.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",ref:u,children:[i.jsxs("div",{className:"flex border-b border-slate-200 bg-slate-50",children:[i.jsx("div",{className:"w-48 flex-shrink-0 p-3 font-semibold text-slate-700 border-r border-slate-200 sticky left-0 bg-slate-50 z-20 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:"资源名称"}),i.jsx("div",{className:"flex flex-1 overflow-hidden",children:a.map((e,m)=>i.jsx("div",{className:"flex-shrink-0 border-r border-slate-200 p-2 text-center text-xs font-medium text-slate-600",style:{width:`${c.width}px`},children:e.label},m))})]}),i.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden",children:d.map(e=>{var b;const m=r.find(h=>h.resourceId===e.id);return i.jsxs("div",{className:"flex border-b border-slate-100 hover:bg-slate-50/50 transition-colors group",children:[i.jsxs("div",{className:"w-48 flex-shrink-0 p-3 border-r border-slate-200 bg-white sticky left-0 z-10 group-hover:bg-slate-50 transition-colors shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:[i.jsx("div",{className:"font-medium text-slate-900 text-sm truncate",children:e.name}),i.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-1 mt-1",children:[i.jsxs("span",{children:["容量: ",e.totalQuantity]}),((b=e.skills)==null?void 0:b[0])&&i.jsx("span",{className:"bg-slate-100 px-1.5 rounded text-[10px]",children:e.skills[0].name})]})]}),i.jsxs("div",{className:"flex flex-1 relative",children:[i.jsx("div",{className:"absolute inset-0 flex",children:a.map((h,g)=>{const w=m==null?void 0:m.allocations[h.label],q=(w==null?void 0:w.total)||0,k=q>e.totalQuantity,z=e.totalQuantity>0?q/e.totalQuantity*100:0;return i.jsxs("div",{className:O("flex-shrink-0 border-r border-slate-100 h-full relative transition-colors",k?"bg-red-50/50":""),style:{width:`${c.width}px`},children:[k&&i.jsx("div",{className:"absolute top-1 right-1 z-0",children:i.jsx(F,{size:12,className:"text-red-500 opacity-50"})}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-slate-100",children:i.jsx("div",{className:O("h-full transition-all",k?"bg-red-500":z>80?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(z,100)}%`}})})]},g)})}),i.jsx("div",{className:"relative w-full h-16 pointer-events-none",children:f.filter(h=>(h.resourceRequirements||[]).some(g=>g.resourceId===e.id)&&(x(h,a[0].date)||x(h,a[a.length-1].date)||M(h.startDate)>=a[0].date&&M(h.endDate)<=a[a.length-1].date)).map((h,g)=>{const w=M(h.startDate),q=M(h.endDate),k=a[0].date,L=a[a.length-1].date.getTime()-k.getTime();let T=(w.getTime()-k.getTime())/L*100,E=(q.getTime()-w.getTime())/L*100;return T<0&&(E+=T,T=0),T+E>100&&(E=100-T),E<=0?null:i.jsx("div",{className:O("absolute h-6 rounded border shadow-sm flex items-center px-2 pointer-events-auto cursor-pointer hover:brightness-95 hover:z-20 transition-all",p(h.status)),style:{left:`${T}%`,width:`${E}%`,top:`${4+g%2*28}px`,zIndex:5},onClick:()=>n==null?void 0:n(h.id),title:`${h.name} (${h.status})
${h.startDate} - ${h.endDate}`,children:i.jsx("span",{className:"text-xs font-bold text-white truncate",children:h.name})},h.id)})})]})]},e.id)})})]}),i.jsxs("div",{className:"p-3 bg-slate-50 border-t border-slate-200 flex gap-6 text-xs text-slate-600",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(F,{size:14,className:"text-red-500"}),i.jsx("span",{children:"超额分配警告"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),i.jsx("span",{children:"进行中项目"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded"}),i.jsx("span",{children:"计划中项目"})]})]})]})};export{he as E,oe as S,ee as a,de as c,U as e,ce as g};
