import{Z as c,_ as g,$ as S}from"./index-BISNuQBy.js";const v=c()(g((a,p)=>({changeRequests:[],environmentResources:[],requirements:[],approvalWorkflows:[],simulations:[],ghostTaskReports:[],addChangeRequest:e=>{const t={...e,id:`cr-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString()};a(n=>({changeRequests:[...n.changeRequests,t]}))},updateChangeRequest:(e,t)=>{a(n=>({changeRequests:n.changeRequests.map(r=>r.id===e?{...r,...t,updatedAt:new Date().toISOString()}:r)}))},approveChangeRequest:(e,t,n)=>{a(r=>({changeRequests:r.changeRequests.map(o=>o.id===e?{...o,status:"approved",approvedBy:t,approvedByName:n,approvalDate:new Date().toISOString(),updatedAt:new Date().toISOString()}:o)}))},rejectChangeRequest:(e,t,n,r)=>{a(o=>({changeRequests:o.changeRequests.map(s=>s.id===e?{...s,status:"rejected",approvedBy:t,approvedByName:n,rejectionReason:r,approvalDate:new Date().toISOString(),updatedAt:new Date().toISOString()}:s)}))},getChangeRequestsByProject:e=>p().changeRequests.filter(t=>t.projectId===e),addEnvironmentResource:e=>{const t={...e,id:`env-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,bookings:[],createdAt:new Date().toISOString()};a(n=>({environmentResources:[...n.environmentResources,t]}))},updateEnvironmentResource:(e,t)=>{a(n=>({environmentResources:n.environmentResources.map(r=>r.id===e?{...r,...t,updatedAt:new Date().toISOString()}:r)}))},deleteEnvironmentResource:e=>{a(t=>({environmentResources:t.environmentResources.filter(n=>n.id!==e)}))},bookEnvironment:e=>{const t={...e,id:`booking-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString()};a(n=>({environmentResources:n.environmentResources.map(r=>r.id===e.environmentId?{...r,bookings:[...r.bookings,t]}:r)}))},cancelEnvironmentBooking:(e,t)=>{a(n=>({environmentResources:n.environmentResources.map(r=>r.id===e?{...r,bookings:r.bookings.map(o=>o.id===t?{...o,status:"cancelled",updatedAt:new Date().toISOString()}:o)}:r)}))},getAvailableEnvironments:(e,t,n)=>{const r=new Date(e),o=new Date(t);return p().environmentResources.filter(s=>n&&s.type!==n||s.status!=="available"?!1:!s.bookings.some(u=>{if(u.status==="cancelled"||u.status==="completed")return!1;const l=new Date(u.startDate),d=new Date(u.endDate);return r<d&&o>l}))},addRequirement:e=>{const t={...e,id:`req-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString()};a(n=>({requirements:[...n.requirements,t]}))},updateRequirement:(e,t)=>{a(n=>({requirements:n.requirements.map(r=>r.id===e?{...r,...t,updatedAt:new Date().toISOString()}:r)}))},deleteRequirement:e=>{a(t=>({requirements:t.requirements.filter(n=>n.id!==e)}))},linkRequirementToTask:(e,t)=>{a(n=>({requirements:n.requirements.map(r=>r.id===e?{...r,relatedTaskIds:[...r.relatedTaskIds,t],updatedAt:new Date().toISOString()}:r)}))},unlinkRequirementFromTask:(e,t)=>{a(n=>({requirements:n.requirements.map(r=>r.id===e?{...r,relatedTaskIds:r.relatedTaskIds.filter(o=>o!==t),updatedAt:new Date().toISOString()}:r)}))},getRequirementsByProject:e=>p().requirements.filter(t=>t.projectId===e),createApprovalWorkflow:e=>{const t={...e,id:`wf-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString()};a(n=>({approvalWorkflows:[...n.approvalWorkflows,t]}))},updateApprovalStep:(e,t,n,r)=>{a(o=>({approvalWorkflows:o.approvalWorkflows.map(s=>{if(s.id!==e)return s;const m=s.approvers.map(i=>i.stepNumber!==t?i:{...i,status:n==="approve"?"approved":"rejected",decision:n,comments:r,decidedAt:new Date().toISOString()}),u=m.some(i=>i.status==="rejected"),l=m.every(i=>!i.isRequired||i.status==="approved");let d="pending";return u?d="rejected":l&&(d="approved"),{...s,approvers:m,currentStepIndex:t,overallStatus:d,completedAt:d!=="pending"?new Date().toISOString():void 0}})}))},getWorkflowsByEntity:e=>p().approvalWorkflows.filter(t=>t.entityId===e),createSimulation:e=>{const t={...e,id:`sim-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString()};a(n=>({simulations:[...n.simulations,t]}))},updateSimulation:(e,t)=>{a(n=>({simulations:n.simulations.map(r=>r.id===e?{...r,...t}:r)}))},deleteSimulation:e=>{a(t=>({simulations:t.simulations.filter(n=>n.id!==e)}))},setActiveSimulation:e=>{a(t=>({simulations:t.simulations.map(n=>({...n,isActive:n.id===e}))}))},getActiveSimulation:()=>p().simulations.find(e=>e.isActive)||null,generateGhostTaskReport:e=>{a(t=>({ghostTaskReports:[...t.ghostTaskReports.filter(n=>n.projectId!==e.projectId),e]}))},clearGhostTaskReports:e=>{a(t=>({ghostTaskReports:t.ghostTaskReports.filter(n=>n.projectId!==e)}))}}),{name:"pmo-storage",storage:S(()=>localStorage)}));export{v as u};
