import{e as Ie,D as ne,R as C,E as ve,r as w,j as e,X as je,i as ke,Q as ze,b as Ee,T as ie,C as Te,A as Le,c as Z,s as Fe,g as _e,u as qe,S as oe}from"./index-dM0Tvs4N.js";import{f as O}from"./format-DaYFs9xj.js";import{A as re,N as Be}from"./index-DGSMrxCN.js";import{m as T}from"./proxy-fGNb34j1.js";import{P as Q}from"./plus-BQKv2ZLr.js";import{a as Ve,e as Ne}from"./eachDayOfInterval-CTXPt2iQ.js";import{f as V,a as U,t as Y,v as H,r as J,A as We,b as W,e as ce,w as He,c as de,x as Ke,d as Ue,u as Ge,i as ee,G as Ye,g as me,s as xe,D as Xe,h as Qe,k as Je,R as pe,T as ue,L as Ze}from"./generateCategoricalChart-CycQoIDe.js";import{X as te,Y as se,C as he}from"./YAxis-6aTld0XY.js";import{L as et,a as tt}from"./LineChart-B44fpJ8Y.js";import{F as we}from"./filter-VBr4Ix3j.js";import{S as st}from"./sparkles-7J4IiUmo.js";import{a as at,s as it,e as rt}from"./startOfMonth-CiTB22RR.js";import{D as lt}from"./download-CO6xY2iH.js";import{C as ge}from"./circle-check-BeHIu1W4.js";import{C as nt}from"./chevron-down-laDWTAXi.js";import{P as ot}from"./pen-Ch77BJq9.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=Ie("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);function dt(t,s){const i=ne(t),r=ne(s);return+i==+r}function mt(t,s){return Ve(t,-30)}function xt(t,s){return at(t,-s)}var pt=["layout","type","stroke","connectNulls","isRange","ref"],ut=["key"],Ce;function K(t){"@babel/helpers - typeof";return K=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},K(t)}function Se(t,s){if(t==null)return{};var i=ht(t,s),r,l;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(l=0;l<n.length;l++)r=n[l],!(s.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function ht(t,s){if(t==null)return{};var i={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(s.indexOf(r)>=0)continue;i[r]=t[r]}return i}function q(){return q=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var i=arguments[s];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},q.apply(this,arguments)}function be(t,s){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);s&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),i.push.apply(i,r)}return i}function _(t){for(var s=1;s<arguments.length;s++){var i=arguments[s]!=null?arguments[s]:{};s%2?be(Object(i),!0).forEach(function(r){E(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):be(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function gt(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}function fe(t,s){for(var i=0;i<s.length;i++){var r=s[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Re(r.key),r)}}function bt(t,s,i){return s&&fe(t.prototype,s),i&&fe(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function ft(t,s,i){return s=X(s),yt(t,Ae()?Reflect.construct(s,i||[],X(t).constructor):s.apply(t,i))}function yt(t,s){if(s&&(K(s)==="object"||typeof s=="function"))return s;if(s!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vt(t)}function vt(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ae(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ae=function(){return!!t})()}function X(t){return X=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},X(t)}function jt(t,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(s&&s.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),s&&ae(t,s)}function ae(t,s){return ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,l){return r.__proto__=l,r},ae(t,s)}function E(t,s,i){return s=Re(s),s in t?Object.defineProperty(t,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[s]=i,t}function Re(t){var s=kt(t,"string");return K(s)=="symbol"?s:s+""}function kt(t,s){if(K(t)!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var r=i.call(t,s);if(K(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var z=function(t){function s(){var i;gt(this,s);for(var r=arguments.length,l=new Array(r),n=0;n<r;n++)l[n]=arguments[n];return i=ft(this,s,[].concat(l)),E(i,"state",{isAnimationFinished:!0}),E(i,"id",Ge("recharts-area-")),E(i,"handleAnimationEnd",function(){var a=i.props.onAnimationEnd;i.setState({isAnimationFinished:!0}),ee(a)&&a()}),E(i,"handleAnimationStart",function(){var a=i.props.onAnimationStart;i.setState({isAnimationFinished:!1}),ee(a)&&a()}),i}return jt(s,t),bt(s,[{key:"renderDots",value:function(r,l,n){var a=this.props.isAnimationActive,o=this.state.isAnimationFinished;if(a&&!o)return null;var c=this.props,d=c.dot,p=c.points,m=c.dataKey,g=V(this.props,!1),v=V(d,!0),h=p.map(function(b,k){var x=_(_(_({key:"dot-".concat(k),r:3},g),v),{},{index:k,cx:b.x,cy:b.y,dataKey:m,value:b.value,payload:b.payload,points:p});return s.renderDotItem(d,x)}),f={clipPath:r?"url(#clipPath-".concat(l?"":"dots-").concat(n,")"):null};return C.createElement(U,q({className:"recharts-area-dots"},f),h)}},{key:"renderHorizontalRect",value:function(r){var l=this.props,n=l.baseLine,a=l.points,o=l.strokeWidth,c=a[0].x,d=a[a.length-1].x,p=r*Math.abs(c-d),m=Y(a.map(function(g){return g.y||0}));return H(n)&&typeof n=="number"?m=Math.max(n,m):n&&Array.isArray(n)&&n.length&&(m=Math.max(Y(n.map(function(g){return g.y||0})),m)),H(m)?C.createElement("rect",{x:c<d?c:c-p,y:0,width:p,height:Math.floor(m+(o?parseInt("".concat(o),10):1))}):null}},{key:"renderVerticalRect",value:function(r){var l=this.props,n=l.baseLine,a=l.points,o=l.strokeWidth,c=a[0].y,d=a[a.length-1].y,p=r*Math.abs(c-d),m=Y(a.map(function(g){return g.x||0}));return H(n)&&typeof n=="number"?m=Math.max(n,m):n&&Array.isArray(n)&&n.length&&(m=Math.max(Y(n.map(function(g){return g.x||0})),m)),H(m)?C.createElement("rect",{x:0,y:c<d?c:c-p,width:m+(o?parseInt("".concat(o),10):1),height:Math.floor(p)}):null}},{key:"renderClipRect",value:function(r){var l=this.props.layout;return l==="vertical"?this.renderVerticalRect(r):this.renderHorizontalRect(r)}},{key:"renderAreaStatically",value:function(r,l,n,a){var o=this.props,c=o.layout,d=o.type,p=o.stroke,m=o.connectNulls,g=o.isRange;o.ref;var v=Se(o,pt);return C.createElement(U,{clipPath:n?"url(#clipPath-".concat(a,")"):null},C.createElement(J,q({},V(v,!0),{points:r,connectNulls:m,type:d,baseLine:l,layout:c,stroke:"none",className:"recharts-area-area"})),p!=="none"&&C.createElement(J,q({},V(this.props,!1),{className:"recharts-area-curve",layout:c,type:d,connectNulls:m,fill:"none",points:r})),p!=="none"&&g&&C.createElement(J,q({},V(this.props,!1),{className:"recharts-area-curve",layout:c,type:d,connectNulls:m,fill:"none",points:l})))}},{key:"renderAreaWithAnimation",value:function(r,l){var n=this,a=this.props,o=a.points,c=a.baseLine,d=a.isAnimationActive,p=a.animationBegin,m=a.animationDuration,g=a.animationEasing,v=a.animationId,h=this.state,f=h.prevPoints,b=h.prevBaseLine;return C.createElement(We,{begin:p,duration:m,isActive:d,easing:g,from:{t:0},to:{t:1},key:"area-".concat(v),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(k){var x=k.t;if(f){var A=f.length/o.length,j=o.map(function(P,L){var F=Math.floor(L*A);if(f[F]){var u=f[F],y=W(u.x,P.x),N=W(u.y,P.y);return _(_({},P),{},{x:y(x),y:N(x)})}return P}),S;if(H(c)&&typeof c=="number"){var R=W(b,c);S=R(x)}else if(ce(c)||He(c)){var I=W(b,0);S=I(x)}else S=c.map(function(P,L){var F=Math.floor(L*A);if(b[F]){var u=b[F],y=W(u.x,P.x),N=W(u.y,P.y);return _(_({},P),{},{x:y(x),y:N(x)})}return P});return n.renderAreaStatically(j,S,r,l)}return C.createElement(U,null,C.createElement("defs",null,C.createElement("clipPath",{id:"animationClipPath-".concat(l)},n.renderClipRect(x))),C.createElement(U,{clipPath:"url(#animationClipPath-".concat(l,")")},n.renderAreaStatically(o,c,r,l)))})}},{key:"renderArea",value:function(r,l){var n=this.props,a=n.points,o=n.baseLine,c=n.isAnimationActive,d=this.state,p=d.prevPoints,m=d.prevBaseLine,g=d.totalLength;return c&&a&&a.length&&(!p&&g>0||!de(p,a)||!de(m,o))?this.renderAreaWithAnimation(r,l):this.renderAreaStatically(a,o,r,l)}},{key:"render",value:function(){var r,l=this.props,n=l.hide,a=l.dot,o=l.points,c=l.className,d=l.top,p=l.left,m=l.xAxis,g=l.yAxis,v=l.width,h=l.height,f=l.isAnimationActive,b=l.id;if(n||!o||!o.length)return null;var k=this.state.isAnimationFinished,x=o.length===1,A=ve("recharts-area",c),j=m&&m.allowDataOverflow,S=g&&g.allowDataOverflow,R=j||S,I=ce(b)?this.id:b,P=(r=V(a,!1))!==null&&r!==void 0?r:{r:3,strokeWidth:2},L=P.r,F=L===void 0?3:L,u=P.strokeWidth,y=u===void 0?2:u,N=Ke(a)?a:{},M=N.clipDot,$=M===void 0?!0:M,G=F*2+y;return C.createElement(U,{className:A},j||S?C.createElement("defs",null,C.createElement("clipPath",{id:"clipPath-".concat(I)},C.createElement("rect",{x:j?p:p-v/2,y:S?d:d-h/2,width:j?v:v*2,height:S?h:h*2})),!$&&C.createElement("clipPath",{id:"clipPath-dots-".concat(I)},C.createElement("rect",{x:p-G/2,y:d-G/2,width:v+G,height:h+G}))):null,x?null:this.renderArea(R,I),(a||x)&&this.renderDots(R,$,I),(!f||k)&&Ue.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(r,l){return r.animationId!==l.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,curBaseLine:r.baseLine,prevPoints:l.curPoints,prevBaseLine:l.curBaseLine}:r.points!==l.curPoints||r.baseLine!==l.curBaseLine?{curPoints:r.points,curBaseLine:r.baseLine}:null}}])}(w.PureComponent);Ce=z;E(z,"displayName","Area");E(z,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!Ye.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});E(z,"getBaseValue",function(t,s,i,r){var l=t.layout,n=t.baseValue,a=s.props.baseValue,o=a??n;if(H(o)&&typeof o=="number")return o;var c=l==="horizontal"?r:i,d=c.scale.domain();if(c.type==="number"){var p=Math.max(d[0],d[1]),m=Math.min(d[0],d[1]);return o==="dataMin"?m:o==="dataMax"||p<0?p:Math.max(Math.min(d[0],d[1]),0)}return o==="dataMin"?d[0]:o==="dataMax"?d[1]:d[0]});E(z,"getComposedData",function(t){var s=t.props,i=t.item,r=t.xAxis,l=t.yAxis,n=t.xAxisTicks,a=t.yAxisTicks,o=t.bandSize,c=t.dataKey,d=t.stackedData,p=t.dataStartIndex,m=t.displayedData,g=t.offset,v=s.layout,h=d&&d.length,f=Ce.getBaseValue(s,i,r,l),b=v==="horizontal",k=!1,x=m.map(function(j,S){var R;h?R=d[p+S]:(R=me(j,c),Array.isArray(R)?k=!0:R=[f,R]);var I=R[1]==null||h&&me(j,c)==null;return b?{x:xe({axis:r,ticks:n,bandSize:o,entry:j,index:S}),y:I?null:l.scale(R[1]),value:R,payload:j}:{x:I?null:r.scale(R[1]),y:xe({axis:l,ticks:a,bandSize:o,entry:j,index:S}),value:R,payload:j}}),A;return h||k?A=x.map(function(j){var S=Array.isArray(j.value)?j.value[0]:null;return b?{x:j.x,y:S!=null&&j.y!=null?l.scale(S):null}:{x:S!=null?r.scale(S):null,y:j.y}}):A=b?l.scale(f):r.scale(f),_({points:x,baseLine:A,layout:v,isRange:k},g)});E(z,"renderDotItem",function(t,s){var i;if(C.isValidElement(t))i=C.cloneElement(t,s);else if(ee(t))i=t(s);else{var r=ve("recharts-area-dot",typeof t!="boolean"?t.className:""),l=s.key,n=Se(s,ut);i=C.createElement(Xe,q({},n,{key:l,className:r}))}return i});var Nt=Qe({chartName:"AreaChart",GraphicalChild:z,axisComponents:[{axisType:"xAxis",AxisComp:te},{axisType:"yAxis",AxisComp:se}],formatAxisMap:Je});const De=(t,s)=>t*s,Pe=t=>t>=16?"critical":t>=10?"high":t>=5?"medium":"low",$e=t=>({critical:"bg-red-500 text-white",high:"bg-orange-500 text-white",medium:"bg-yellow-500 text-white",low:"bg-green-500 text-white"})[t],B=t=>({schedule:{label:"è¿›åº¦é£é™©",color:"text-blue-600",icon:"ğŸ“…"},cost:{label:"æˆæœ¬é£é™©",color:"text-green-600",icon:"ğŸ’°"},resource:{label:"èµ„æºé£é™©",color:"text-purple-600",icon:"ğŸ‘¥"},technical:{label:"æŠ€æœ¯é£é™©",color:"text-red-600",icon:"âš™ï¸"},external:{label:"å¤–éƒ¨é£é™©",color:"text-orange-600",icon:"ğŸŒ"},quality:{label:"è´¨é‡é£é™©",color:"text-pink-600",icon:"âœ¨"},scope:{label:"èŒƒå›´é£é™©",color:"text-indigo-600",icon:"ğŸ“Š"}})[t],le=t=>({identified:{label:"å·²è¯†åˆ«",color:"bg-gray-100 text-gray-700"},analyzing:{label:"åˆ†æä¸­",color:"bg-blue-100 text-blue-700"},mitigating:{label:"ç¼“è§£ä¸­",color:"bg-yellow-100 text-yellow-700"},monitoring:{label:"ç›‘æ§ä¸­",color:"bg-purple-100 text-purple-700"},resolved:{label:"å·²è§£å†³",color:"bg-green-100 text-green-700"},accepted:{label:"å·²æ¥å—",color:"bg-orange-100 text-orange-700"}})[t],Me=(t,s,i,r,l,n,a="")=>{const o=De(r,l),c=Pe(o),d=new Date().toISOString();return{id:`risk-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,projectId:t,category:i,title:s,description:a,probability:r,impact:l,riskScore:o,priority:c,owner:n,status:"identified",mitigationStrategy:"",mitigationActions:[],identifiedDate:d,history:[{id:`history-${Date.now()}`,date:d,userId:n,userName:"å½“å‰ç”¨æˆ·",action:"created",description:`åˆ›å»ºé£é™©: ${s}`}]}},wt=(t,s,i,r)=>{const l=new Date().toISOString(),n=[];s.probability!==void 0&&s.probability!==t.probability&&n.push({id:`history-${Date.now()}-prob`,date:l,userId:i,userName:r,action:"probability_changed",description:`æ¦‚ç‡ä» ${t.probability} å˜æ›´ä¸º ${s.probability}`,oldValue:t.probability,newValue:s.probability}),s.impact!==void 0&&s.impact!==t.impact&&n.push({id:`history-${Date.now()}-impact`,date:l,userId:i,userName:r,action:"impact_changed",description:`å½±å“ä» ${t.impact} å˜æ›´ä¸º ${s.impact}`,oldValue:t.impact,newValue:s.impact}),s.status&&s.status!==t.status&&n.push({id:`history-${Date.now()}-status`,date:l,userId:i,userName:r,action:"status_changed",description:`çŠ¶æ€ä» "${t.status}" å˜æ›´ä¸º "${s.status}"`,oldValue:t.status,newValue:s.status});const a=s.probability??t.probability,o=s.impact??t.impact,c=De(a,o),d=Pe(c);return{...t,...s,probability:a,impact:o,riskScore:c,priority:d,lastReviewDate:l,history:[...t.history,...n]}},Ct=t=>{if(t.length===0)return 0;const s=t.filter(n=>n.status!=="resolved"&&n.status!=="accepted");if(s.length===0)return 0;const i={critical:4,high:3,medium:2,low:1},r=s.reduce((n,a)=>n+a.riskScore*i[a.priority],0),l=s.reduce((n,a)=>n+i[a.priority],0);return Math.round(r/l*10)/10},St=t=>{const s={critical:0,high:0,medium:0,low:0};return t.forEach(i=>{s[i.priority]++}),s},At=(t,s)=>{const i=["ID","æ ‡é¢˜","ç±»åˆ«","çŠ¶æ€","ä¼˜å…ˆçº§","æ¦‚ç‡","å½±å“","é£é™©åˆ†æ•°","æè¿°","ç¼“è§£ç­–ç•¥","åº”æ€¥è®¡åˆ’","è´Ÿè´£äºº","è¯†åˆ«æ—¥æœŸ","é¢„ä¼°æˆæœ¬å½±å“","ç¼“è§£æˆæœ¬"],r=t.map(d=>{const p=B(d.category),m=le(d.status);return[d.id,d.title,p.label,m.label,d.priority.toUpperCase(),d.probability,d.impact,d.riskScore,`"${d.description.replace(/"/g,'""')}"`,`"${(d.mitigationStrategy||"").replace(/"/g,'""')}"`,`"${(d.contingencyPlan||"").replace(/"/g,'""')}"`,d.ownerName||d.owner,O(new Date(d.identifiedDate),"yyyy-MM-dd"),d.estimatedCostImpact||0,d.mitigationCost||0]}),l=[i,...r].map(d=>d.join(",")).join(`
`),n="\uFEFF",a=new Blob([n+l],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),c=URL.createObjectURL(a);o.setAttribute("href",c),o.setAttribute("download",`${s}_é£é™©æ¸…å•_${O(new Date,"yyyyMMdd")}.csv`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)},Rt=(t,s)=>{const i=c=>B(c).label,r=c=>le(c).label,l=`
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        table { border-collapse: collapse; width: 100%; font-family: Arial, sans-serif; }
        th { background-color: #4472C4; color: white; padding: 12px; text-align: left; font-weight: bold; border: 1px solid #ddd; }
        td { padding: 10px; border: 1px solid #ddd; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        .critical { background-color: #ffebee; }
        .high { background-color: #fff3e0; }
        .medium { background-color: #fff9c4; }
        .low { background-color: #e8f5e9; }
        h1 { color: #333; font-family: Arial, sans-serif; }
        .meta { color: #666; font-size: 14px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>${s} - é£é™©æ¸…å•</h1>
    <div class="meta">
        <p>å¯¼å‡ºæ—¶é—´: ${O(new Date,"yyyyå¹´MMæœˆddæ—¥ HH:mm:ss")}</p>
        <p>æ€»é£é™©æ•°: ${t.length} | æ´»è·ƒé£é™©: ${t.filter(c=>c.status!=="resolved"&&c.status!=="accepted").length}</p>
    </div>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>æ ‡é¢˜</th>
                <th>ç±»åˆ«</th>
                <th>çŠ¶æ€</th>
                <th>ä¼˜å…ˆçº§</th>
                <th>æ¦‚ç‡</th>
                <th>å½±å“</th>
                <th>é£é™©åˆ†æ•°</th>
                <th>æè¿°</th>
                <th>ç¼“è§£ç­–ç•¥</th>
                <th>è´Ÿè´£äºº</th>
                <th>è¯†åˆ«æ—¥æœŸ</th>
                <th>é¢„ä¼°æˆæœ¬å½±å“</th>
            </tr>
        </thead>
        <tbody>
            ${t.map(c=>`
                <tr class="${c.priority}">
                    <td>${c.id}</td>
                    <td><strong>${c.title}</strong></td>
                    <td>${i(c.category)}</td>
                    <td>${r(c.status)}</td>
                    <td>${c.priority.toUpperCase()}</td>
                    <td>${c.probability}/5</td>
                    <td>${c.impact}/5</td>
                    <td><strong>${c.riskScore}</strong></td>
                    <td>${c.description}</td>
                    <td>${c.mitigationStrategy||"-"}</td>
                    <td>${c.ownerName||c.owner}</td>
                    <td>${O(new Date(c.identifiedDate),"yyyy-MM-dd")}</td>
                    <td>${c.estimatedCostImpact?`Â¥${c.estimatedCostImpact.toLocaleString()}`:"-"}</td>
                </tr>
            `).join("")}
        </tbody>
    </table>
</body>
</html>
    `,n=new Blob([l],{type:"application/vnd.ms-excel"}),a=document.createElement("a"),o=URL.createObjectURL(n);a.setAttribute("href",o),a.setAttribute("download",`${s}_é£é™©æ¸…å•_${O(new Date,"yyyyMMdd")}.xls`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)},Dt=(t,s)=>{const i=t.filter(a=>a.status!=="resolved"&&a.status!=="accepted"),r=i.filter(a=>a.priority==="critical"),l=i.filter(a=>a.priority==="high"),n=a=>B(a);return`
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>${s.name} - é£é™©è¯„ä¼°æŠ¥å‘Š</title>
    <style>
        @page { size: A4; margin: 2cm; }
        body { font-family: 'Microsoft YaHei', Arial, sans-serif; line-height: 1.6; color: #333; }
        .header { text-align: center; border-bottom: 3px solid #4472C4; padding-bottom: 20px; margin-bottom: 30px; }
        .header h1 { color: #4472C4; margin: 0; font-size: 28px; }
        .header .subtitle { color: #666; margin-top: 10px; font-size: 14px; }
        .summary { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        .summary-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 15px; }
        .summary-card { background: white; padding: 15px; border-radius: 6px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .summary-card .number { font-size: 32px; font-weight: bold; color: #4472C4; }
        .summary-card .label { font-size: 12px; color: #666; margin-top: 5px; }
        .section { margin-bottom: 30px; page-break-inside: avoid; }
        .section-title { font-size: 20px; color: #4472C4; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; margin-bottom: 15px; }
        .risk-card { background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 15px; page-break-inside: avoid; }
        .risk-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; }
        .risk-title { font-size: 18px; font-weight: bold; color: #333; }
        .risk-badges { display: flex; gap: 8px; }
        .badge { padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: bold; }
        .badge.critical { background: #ffebee; color: #c62828; }
        .badge.high { background: #fff3e0; color: #e65100; }
        .badge.medium { background: #fff9c4; color: #f57f17; }
        .badge.low { background: #e8f5e9; color: #2e7d32; }
        .risk-meta { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 6px; }
        .risk-meta-item { font-size: 13px; }
        .risk-meta-item .label { color: #666; font-weight: 500; }
        .risk-meta-item .value { color: #333; font-weight: bold; margin-top: 3px; }
        .risk-description { margin-bottom: 15px; font-size: 14px; line-height: 1.8; }
        .risk-mitigation { background: #e3f2fd; padding: 15px; border-radius: 6px; border-left: 4px solid #2196f3; }
        .risk-mitigation .title { font-weight: bold; color: #1976d2; margin-bottom: 8px; }
        .footer { text-align: center; color: #999; font-size: 12px; margin-top: 50px; padding-top: 20px; border-top: 1px solid #e0e0e0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>${s.name}</h1>
        <div class="subtitle">é£é™©è¯„ä¼°æŠ¥å‘Š</div>
        <div class="subtitle">ç”Ÿæˆæ—¶é—´: ${O(new Date,"yyyyå¹´MMæœˆddæ—¥ HH:mm")}</div>
    </div>

    <div class="summary">
        <h2 style="margin-top: 0; color: #333;">æ‰§è¡Œæ‘˜è¦</h2>
        <div class="summary-grid">
            <div class="summary-card">
                <div class="number">${t.length}</div>
                <div class="label">æ€»é£é™©æ•°</div>
            </div>
            <div class="summary-card">
                <div class="number" style="color: #f57c00;">${i.length}</div>
                <div class="label">æ´»è·ƒé£é™©</div>
            </div>
            <div class="summary-card">
                <div class="number" style="color: #d32f2f;">${r.length}</div>
                <div class="label">æé«˜é£é™©</div>
            </div>
            <div class="summary-card">
                <div class="number" style="color: #388e3c;">${t.filter(a=>a.status==="resolved").length}</div>
                <div class="label">å·²è§£å†³</div>
            </div>
        </div>
    </div>

    ${r.length>0?`
    <div class="section">
        <div class="section-title">ğŸ”´ æé«˜é£é™© (Critical)</div>
        ${r.map(a=>`
        <div class="risk-card">
            <div class="risk-header">
                <div class="risk-title">${a.title}</div>
                <div class="risk-badges">
                    <span class="badge critical">CRITICAL</span>
                    <span class="badge" style="background: #e1f5fe; color: #0277bd;">${n(a.category).label}</span>
                </div>
            </div>
            <div class="risk-meta">
                <div class="risk-meta-item">
                    <div class="label">æ¦‚ç‡</div>
                    <div class="value">${a.probability}/5</div>
                </div>
                <div class="risk-meta-item">
                    <div class="label">å½±å“</div>
                    <div class="value">${a.impact}/5</div>
                </div>
                <div class="risk-meta-item">
                    <div class="label">é£é™©åˆ†æ•°</div>
                    <div class="value">${a.riskScore}</div>
                </div>
            </div>
            <div class="risk-description">
                <strong>æè¿°:</strong> ${a.description}
            </div>
            ${a.mitigationStrategy?`
            <div class="risk-mitigation">
                <div class="title">ç¼“è§£ç­–ç•¥</div>
                <div>${a.mitigationStrategy}</div>
            </div>
            `:""}
        </div>
        `).join("")}
    </div>
    `:""}

    ${l.length>0?`
    <div class="section">
        <div class="section-title">ğŸŸ  é«˜é£é™© (High)</div>
        ${l.map(a=>`
        <div class="risk-card">
            <div class="risk-header">
                <div class="risk-title">${a.title}</div>
                <div class="risk-badges">
                    <span class="badge high">HIGH</span>
                    <span class="badge" style="background: #e1f5fe; color: #0277bd;">${n(a.category).label}</span>
                </div>
            </div>
            <div class="risk-meta">
                <div class="risk-meta-item">
                    <div class="label">æ¦‚ç‡</div>
                    <div class="value">${a.probability}/5</div>
                </div>
                <div class="risk-meta-item">
                    <div class="label">å½±å“</div>
                    <div class="value">${a.impact}/5</div>
                </div>
                <div class="risk-meta-item">
                    <div class="label">é£é™©åˆ†æ•°</div>
                    <div class="value">${a.riskScore}</div>
                </div>
            </div>
            <div class="risk-description">
                <strong>æè¿°:</strong> ${a.description}
            </div>
        </div>
        `).join("")}
    </div>
    `:""}

    <div class="footer">
        <p>æœ¬æŠ¥å‘Šç”± Visorq é¡¹ç›®ç®¡ç†ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ</p>
        <p>Â© 2025 Visorq Team. All rights reserved.</p>
    </div>
</body>
</html>
    `},Pt=(t,s)=>{const i=Dt(t,s),r=window.open("","_blank");r&&(r.document.write(i),r.document.close(),r.focus(),setTimeout(()=>{r.print()},500))},$t=({risks:t,onRiskClick:s})=>{const i=t.filter(o=>o.status!=="resolved"&&o.status!=="accepted"),r=(o,c)=>i.filter(d=>d.probability===o&&d.impact===c),l=(o,c)=>{const d=o*c;return d>=16?"bg-red-100 hover:bg-red-200 border-red-300":d>=10?"bg-orange-100 hover:bg-orange-200 border-orange-300":d>=5?"bg-yellow-100 hover:bg-yellow-200 border-yellow-300":"bg-green-50 hover:bg-green-100 border-green-200"},n=["æä½","ä½","ä¸­","é«˜","æé«˜"],a=["æä½","ä½","ä¸­","é«˜","æé«˜"];return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"é£é™©çŸ©é˜µ"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"æ ¹æ®æ¦‚ç‡å’Œå½±å“è¯„ä¼°é£é™©ç­‰çº§"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"inline-block min-w-full",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-1",children:[e.jsx("div",{className:"flex items-center justify-center p-2 bg-slate-50 dark:bg-slate-700 rounded-tl-lg",children:e.jsx("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-300",children:"æ¦‚ç‡ â†“ / å½±å“ â†’"})}),n.map((o,c)=>e.jsx("div",{className:"flex items-center justify-center p-2 bg-slate-50 dark:bg-slate-700 border-b border-slate-200 dark:border-slate-600",children:e.jsx("span",{className:"text-xs font-medium text-slate-700 dark:text-slate-200",children:o})},`impact-${c}`)),[5,4,3,2,1].map(o=>e.jsxs(C.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-center p-2 bg-slate-50 dark:bg-slate-700 border-r border-slate-200 dark:border-slate-600",children:e.jsx("span",{className:"text-xs font-medium text-slate-700 dark:text-slate-200",children:a[o-1]})}),[1,2,3,4,5].map(c=>{const d=r(o,c),p=l(o,c);return e.jsxs("div",{className:`relative min-h-[80px] p-2 border ${p} transition-colors cursor-pointer group`,onClick:()=>{d.length>0&&s&&s(d[0])},children:[d.length>0&&e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 text-xs font-bold text-white bg-slate-700 dark:bg-slate-600 rounded-full",children:d.length})}),e.jsxs("div",{className:"space-y-1",children:[d.slice(0,2).map(m=>e.jsx("div",{className:"text-xs text-slate-700 dark:text-slate-200 truncate bg-white dark:bg-slate-700 px-1.5 py-0.5 rounded shadow-sm",title:m.title,children:m.title},m.id)),d.length>2&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 italic",children:["+",d.length-2," æ›´å¤š..."]})]}),d.length>0&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block z-10",children:e.jsxs("div",{className:"bg-slate-900 text-white text-xs rounded-lg py-2 px-3 shadow-xl max-w-xs",children:[e.jsxs("div",{className:"font-semibold mb-1",children:[d.length," ä¸ªé£é™©"]}),d.slice(0,3).map(m=>e.jsxs("div",{className:"truncate",children:["â€¢ ",m.title]},m.id))]})})]},`cell-${o}-${c}`)})]},`row-${o}`))]}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-100 border border-green-200 rounded"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"ä½é£é™© (1-4)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-yellow-100 border border-yellow-200 rounded"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"ä¸­é£é™© (5-9)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-orange-100 border border-orange-200 rounded"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"é«˜é£é™© (10-15)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-100 border border-red-200 rounded"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"æé«˜é£é™© (16-25)"})]})]})]})})]})},Mt=({isOpen:t,onClose:s,onSave:i,projectId:r,existingRisk:l,currentUserId:n})=>{const[a,o]=w.useState({title:"",description:"",category:"technical",probability:3,impact:3,status:"identified",owner:n,mitigationStrategy:"",contingencyPlan:"",estimatedCostImpact:void 0,mitigationCost:void 0}),[c,d]=w.useState([]);w.useEffect(()=>{l?(o(l),d(l.mitigationActions||[])):(o({title:"",description:"",category:"technical",probability:3,impact:3,status:"identified",owner:n,mitigationStrategy:"",contingencyPlan:""}),d([]))},[l,n,t]);const p=h=>{if(h.preventDefault(),!a.title||!a.description){alert("è¯·å¡«å†™æ ‡é¢˜å’Œæè¿°");return}let f;l?f={...l,...a,mitigationActions:c.map((b,k)=>({...b,id:b.id||`action-${Date.now()}-${k}`}))}:(f=Me(r,a.title,a.category,a.probability,a.impact,a.owner,a.description),f={...f,mitigationStrategy:a.mitigationStrategy||"",contingencyPlan:a.contingencyPlan,estimatedCostImpact:a.estimatedCostImpact,mitigationCost:a.mitigationCost,status:a.status,mitigationActions:c.map((b,k)=>({...b,id:`action-${Date.now()}-${k}`}))}),i(f),s()},m=()=>{d([...c,{description:"",owner:n,dueDate:new Date().toISOString().split("T")[0],status:"pending"}])},g=(h,f,b)=>{const k=[...c];k[h]={...k[h],[f]:b},d(k)},v=h=>{d(c.filter((f,b)=>b!==h))};return t?e.jsx(re,{children:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs(T.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:l?"ç¼–è¾‘é£é™©":"æ·»åŠ æ–°é£é™©"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(je,{size:20})})]}),e.jsxs("form",{onSubmit:p,className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"é£é™©æ ‡é¢˜ *"}),e.jsx("input",{type:"text",value:a.title,onChange:h=>o({...a,title:h.target.value}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",placeholder:"ä¾‹å¦‚ï¼šå…³é”®æŠ€æœ¯äººå‘˜ç¦»èŒé£é™©",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"é£é™©ç±»åˆ« *"}),e.jsxs("select",{value:a.category,onChange:h=>o({...a,category:h.target.value}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",children:[e.jsx("option",{value:"schedule",children:"è¿›åº¦é£é™©"}),e.jsx("option",{value:"cost",children:"æˆæœ¬é£é™©"}),e.jsx("option",{value:"resource",children:"èµ„æºé£é™©"}),e.jsx("option",{value:"technical",children:"æŠ€æœ¯é£é™©"}),e.jsx("option",{value:"external",children:"å¤–éƒ¨é£é™©"}),e.jsx("option",{value:"quality",children:"è´¨é‡é£é™©"}),e.jsx("option",{value:"scope",children:"èŒƒå›´é£é™©"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"çŠ¶æ€"}),e.jsxs("select",{value:a.status,onChange:h=>o({...a,status:h.target.value}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",children:[e.jsx("option",{value:"identified",children:"å·²è¯†åˆ«"}),e.jsx("option",{value:"analyzing",children:"åˆ†æä¸­"}),e.jsx("option",{value:"mitigating",children:"ç¼“è§£ä¸­"}),e.jsx("option",{value:"monitoring",children:"ç›‘æ§ä¸­"}),e.jsx("option",{value:"resolved",children:"å·²è§£å†³"}),e.jsx("option",{value:"accepted",children:"å·²æ¥å—"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"é£é™©æè¿° *"}),e.jsx("textarea",{value:a.description,onChange:h=>o({...a,description:h.target.value}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",rows:3,placeholder:"è¯¦ç»†æè¿°é£é™©çš„å…·ä½“æƒ…å†µ...",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"å‘ç”Ÿæ¦‚ç‡ (1-5) *"}),e.jsx("input",{type:"range",min:"1",max:"5",value:a.probability,onChange:h=>o({...a,probability:parseInt(h.target.value)}),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:"æä½"}),e.jsx("span",{className:"font-semibold text-slate-700 dark:text-slate-200",children:a.probability}),e.jsx("span",{children:"æé«˜"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"å½±å“ç¨‹åº¦ (1-5) *"}),e.jsx("input",{type:"range",min:"1",max:"5",value:a.impact,onChange:h=>o({...a,impact:parseInt(h.target.value)}),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:"å¯å¿½ç•¥"}),e.jsx("span",{className:"font-semibold text-slate-700 dark:text-slate-200",children:a.impact}),e.jsx("span",{children:"ä¸¥é‡"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"é¢„ä¼°æˆæœ¬å½±å“ (Â¥)"}),e.jsx("input",{type:"number",value:a.estimatedCostImpact||"",onChange:h=>o({...a,estimatedCostImpact:h.target.value?parseFloat(h.target.value):void 0}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"ç¼“è§£æˆæœ¬ (Â¥)"}),e.jsx("input",{type:"number",value:a.mitigationCost||"",onChange:h=>o({...a,mitigationCost:h.target.value?parseFloat(h.target.value):void 0}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",placeholder:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"ç¼“è§£ç­–ç•¥"}),e.jsx("textarea",{value:a.mitigationStrategy,onChange:h=>o({...a,mitigationStrategy:h.target.value}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",rows:3,placeholder:"æè¿°å¦‚ä½•ç¼“è§£è¿™ä¸ªé£é™©..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200 mb-2",children:"åº”æ€¥è®¡åˆ’"}),e.jsx("textarea",{value:a.contingencyPlan,onChange:h=>o({...a,contingencyPlan:h.target.value}),className:"w-full px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100",rows:2,placeholder:"å¦‚æœç¼“è§£æªæ–½å¤±è´¥ï¼Œå¤‡ç”¨è®¡åˆ’æ˜¯ä»€ä¹ˆ..."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-200",children:"ç¼“è§£æªæ–½"}),e.jsxs("button",{type:"button",onClick:m,className:"flex items-center gap-1 px-3 py-1 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(Q,{size:14}),"æ·»åŠ æªæ–½"]})]}),e.jsx("div",{className:"space-y-3",children:c.map((h,f)=>e.jsx("div",{className:"p-3 border border-slate-200 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-700/50",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("input",{type:"text",value:h.description,onChange:b=>g(f,"description",b.target.value),className:"flex-1 px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100 text-sm",placeholder:"æªæ–½æè¿°..."}),e.jsx("input",{type:"date",value:h.dueDate,onChange:b=>g(f,"dueDate",b.target.value),className:"px-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100 text-sm"}),e.jsx("button",{type:"button",onClick:()=>v(f),className:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg",children:e.jsx(ke,{size:16})})]})},f))})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:l?"ä¿å­˜æ›´æ”¹":"åˆ›å»ºé£é™©"})]})]})})}):null},Ot=({risks:t})=>{var n,a;const s=w.useMemo(()=>{const o=new Date,c=mt(o);return Ne({start:c,end:o}).map(p=>{const g=t.filter(x=>new Date(x.identifiedDate)<=p).filter(x=>!x.resolvedDate||new Date(x.resolvedDate)>p).filter(x=>x.status!=="resolved"&&x.status!=="accepted"),v=g.filter(x=>x.priority==="critical").length,h=g.filter(x=>x.priority==="high").length,f=g.filter(x=>x.priority==="medium").length,b=g.filter(x=>x.priority==="low").length,k=g.length>0?g.reduce((x,A)=>x+A.riskScore,0)/g.length:0;return{date:O(p,"MM-dd"),fullDate:O(p,"yyyy-MM-dd"),total:g.length,critical:v,high:h,medium:f,low:b,avgScore:Math.round(k*10)/10}})},[t]),i=w.useMemo(()=>{if(s.length<2)return"stable";const o=s.slice(-7).reduce((d,p)=>d+p.total,0)/7,c=s.slice(-14,-7).reduce((d,p)=>d+p.total,0)/7;return o>c*1.1?"increasing":o<c*.9?"decreasing":"stable"},[s]),r=()=>{switch(i){case"increasing":return"text-red-600";case"decreasing":return"text-green-600";default:return"text-blue-600"}},l=()=>{switch(i){case"increasing":return"ğŸ“ˆ";case"decreasing":return"ğŸ“‰";default:return"â¡ï¸"}};return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"é£é™©è¶‹åŠ¿åˆ†æ"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"è¿‡å» 30 å¤©çš„é£é™©å˜åŒ–è¶‹åŠ¿"})]}),e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg bg-slate-50 dark:bg-slate-700 ${r()}`,children:[e.jsx("span",{className:"text-2xl",children:l()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium",children:"è¶‹åŠ¿"}),e.jsxs("div",{className:"text-sm font-bold",children:[i==="increasing"&&"ä¸Šå‡",i==="decreasing"&&"ä¸‹é™",i==="stable"&&"ç¨³å®š"]})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3",children:"æ´»è·ƒé£é™©æ•°é‡è¶‹åŠ¿"}),e.jsx(pe,{width:"100%",height:250,children:e.jsxs(Nt,{data:s,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorCritical",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#ef4444",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#ef4444",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorHigh",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#f97316",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#f97316",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorMedium",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#eab308",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#eab308",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorLow",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#22c55e",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#22c55e",stopOpacity:0})]})]}),e.jsx(he,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(te,{dataKey:"date",stroke:"#64748b",style:{fontSize:"12px"}}),e.jsx(se,{stroke:"#64748b",style:{fontSize:"12px"}}),e.jsx(ue,{contentStyle:{backgroundColor:"#1e293b",border:"none",borderRadius:"8px",color:"#fff"}}),e.jsx(Ze,{}),e.jsx(z,{type:"monotone",dataKey:"critical",stackId:"1",stroke:"#ef4444",fillOpacity:1,fill:"url(#colorCritical)",name:"æé«˜é£é™©"}),e.jsx(z,{type:"monotone",dataKey:"high",stackId:"1",stroke:"#f97316",fillOpacity:1,fill:"url(#colorHigh)",name:"é«˜é£é™©"}),e.jsx(z,{type:"monotone",dataKey:"medium",stackId:"1",stroke:"#eab308",fillOpacity:1,fill:"url(#colorMedium)",name:"ä¸­é£é™©"}),e.jsx(z,{type:"monotone",dataKey:"low",stackId:"1",stroke:"#22c55e",fillOpacity:1,fill:"url(#colorLow)",name:"ä½é£é™©"})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3",children:"å¹³å‡é£é™©åˆ†æ•°è¶‹åŠ¿"}),e.jsx(pe,{width:"100%",height:200,children:e.jsxs(et,{data:s,children:[e.jsx(he,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(te,{dataKey:"date",stroke:"#64748b",style:{fontSize:"12px"}}),e.jsx(se,{stroke:"#64748b",style:{fontSize:"12px"},domain:[0,25]}),e.jsx(ue,{contentStyle:{backgroundColor:"#1e293b",border:"none",borderRadius:"8px",color:"#fff"}}),e.jsx(tt,{type:"monotone",dataKey:"avgScore",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",r:4},activeDot:{r:6},name:"å¹³å‡é£é™©åˆ†æ•°"})]})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"ğŸ’¡ è¶‹åŠ¿æ´å¯Ÿ"}),e.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[i==="increasing"&&e.jsx("li",{children:"â€¢ é£é™©æ•°é‡å‘ˆä¸Šå‡è¶‹åŠ¿ï¼Œå»ºè®®åŠ å¼ºé£é™©è¯†åˆ«å’Œç¼“è§£æªæ–½"}),i==="decreasing"&&e.jsx("li",{children:"â€¢ é£é™©æ•°é‡å‘ˆä¸‹é™è¶‹åŠ¿ï¼Œé£é™©ç®¡ç†å·¥ä½œæˆæ•ˆæ˜¾è‘—"}),i==="stable"&&e.jsx("li",{children:"â€¢ é£é™©æ•°é‡ä¿æŒç¨³å®šï¼ŒæŒç»­ç›‘æ§å³å¯"}),e.jsxs("li",{children:["â€¢ å½“å‰æ´»è·ƒé£é™©: ",((n=s[s.length-1])==null?void 0:n.total)||0," ä¸ªï¼Œå¹³å‡é£é™©åˆ†æ•°:"," ",((a=s[s.length-1])==null?void 0:a.avgScore)||0]})]})]})]})},D=[{id:"tmpl-schedule-001",name:"å…³é”®é‡Œç¨‹ç¢‘å»¶æœŸ",category:"schedule",description:"ç”±äºéœ€æ±‚å˜æ›´ã€æŠ€æœ¯éš¾é¢˜æˆ–èµ„æºä¸è¶³ï¼Œå…³é”®é‡Œç¨‹ç¢‘å¯èƒ½æ— æ³•æŒ‰æ—¶å®Œæˆ",probability:3,impact:4,mitigationStrategy:"å»ºç«‹ä¸¥æ ¼çš„å˜æ›´æ§åˆ¶æµç¨‹ï¼Œæå‰è¯†åˆ«æŠ€æœ¯é£é™©ï¼Œé¢„ç•™ç¼“å†²æ—¶é—´ï¼Œå®šæœŸè¯„å®¡è¿›åº¦",contingencyPlan:"å¯åŠ¨å¿«é€Ÿé€šé“å®¡æ‰¹æµç¨‹ï¼Œå¢åŠ èµ„æºæŠ•å…¥ï¼Œè°ƒæ•´åç»­é‡Œç¨‹ç¢‘è®¡åˆ’",tags:["è¿›åº¦","é‡Œç¨‹ç¢‘","å»¶æœŸ"],applicableProjectTypes:["web","mobile","infrastructure"]},{id:"tmpl-schedule-002",name:"ä¾èµ–é¡¹ç›®å»¶æœŸ",category:"schedule",description:"å¤–éƒ¨ä¾èµ–é¡¹ç›®æˆ–ç¬¬ä¸‰æ–¹æœåŠ¡å»¶æœŸäº¤ä»˜ï¼Œå½±å“æœ¬é¡¹ç›®è¿›åº¦",probability:3,impact:3,mitigationStrategy:"æå‰ä¸ä¾èµ–æ–¹ç¡®è®¤äº¤ä»˜æ—¶é—´ï¼Œå»ºç«‹å®šæœŸæ²Ÿé€šæœºåˆ¶ï¼Œå‡†å¤‡å¤‡é€‰æ–¹æ¡ˆ",contingencyPlan:"å¯ç”¨å¤‡é€‰ä¾›åº”å•†æˆ–ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼Œè°ƒæ•´é¡¹ç›®è®¡åˆ’ä»¥é€‚åº”å»¶æœŸ",tags:["ä¾èµ–","å¤–éƒ¨","è¿›åº¦"]},{id:"tmpl-cost-001",name:"é¢„ç®—è¶…æ”¯",category:"cost",description:"ç”±äºèŒƒå›´è”“å»¶ã€èµ„æºæˆæœ¬ä¸Šæ¶¨æˆ–æ„å¤–æ”¯å‡ºï¼Œé¡¹ç›®é¢„ç®—å¯èƒ½è¶…æ”¯",probability:3,impact:4,mitigationStrategy:"ä¸¥æ ¼æ§åˆ¶èŒƒå›´å˜æ›´ï¼Œå»ºç«‹æˆæœ¬ç›‘æ§æœºåˆ¶ï¼Œé¢„ç•™åº”æ€¥é¢„ç®—ï¼ˆ10-15%ï¼‰ï¼Œå®šæœŸå®¡æŸ¥æˆæœ¬",contingencyPlan:"å‰Šå‡éæ ¸å¿ƒåŠŸèƒ½ï¼Œå¯»æ±‚é¢å¤–é¢„ç®—æ‰¹å‡†ï¼Œä¼˜åŒ–èµ„æºé…ç½®",tags:["é¢„ç®—","æˆæœ¬","è¶…æ”¯"],applicableProjectTypes:["web","mobile","data","infrastructure"]},{id:"tmpl-cost-002",name:"éšè—æˆæœ¬",category:"cost",description:"æœªé¢„è§çš„è®¸å¯è´¹ç”¨ã€åŸºç¡€è®¾æ–½æˆæœ¬æˆ–ç»´æŠ¤æˆæœ¬",probability:2,impact:3,mitigationStrategy:"å…¨é¢è¯„ä¼°æ‰€æœ‰æ½œåœ¨æˆæœ¬ï¼ŒåŒ…æ‹¬è®¸å¯ã€åŸºç¡€è®¾æ–½ã€åŸ¹è®­å’Œç»´æŠ¤ï¼Œé¢„ç•™åº”æ€¥èµ„é‡‘",contingencyPlan:"é‡æ–°è¯„ä¼°æŠ€æœ¯é€‰å‹ï¼Œå¯»æ‰¾å¼€æºæ›¿ä»£æ–¹æ¡ˆï¼Œç”³è¯·é¢å¤–é¢„ç®—",tags:["éšè—æˆæœ¬","è®¸å¯","åŸºç¡€è®¾æ–½"]},{id:"tmpl-resource-001",name:"å…³é”®äººå‘˜ç¦»èŒ",category:"resource",description:"æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜ç¦»èŒï¼Œå¯¼è‡´çŸ¥è¯†æµå¤±å’Œé¡¹ç›®å»¶æœŸ",probability:2,impact:5,mitigationStrategy:"å»ºç«‹çŸ¥è¯†å…±äº«æœºåˆ¶ï¼Œæ–‡æ¡£åŒ–å…³é”®æµç¨‹ï¼Œäº¤å‰åŸ¹è®­å›¢é˜Ÿæˆå‘˜ï¼Œæä¾›æœ‰ç«äº‰åŠ›çš„è–ªé…¬",contingencyPlan:"å¿«é€Ÿæ‹›è˜æ›¿ä»£äººå‘˜ï¼Œå†…éƒ¨è°ƒé…èµ„æºï¼Œå¤–åŒ…å…³é”®ä»»åŠ¡",tags:["äººå‘˜","ç¦»èŒ","çŸ¥è¯†æµå¤±"],applicableProjectTypes:["web","mobile","data","infrastructure"]},{id:"tmpl-resource-002",name:"èµ„æºæŠ€èƒ½ä¸åŒ¹é…",category:"resource",description:"å›¢é˜Ÿæˆå‘˜ç¼ºä¹é¡¹ç›®æ‰€éœ€çš„å…³é”®æŠ€èƒ½æˆ–ç»éªŒ",probability:3,impact:3,mitigationStrategy:"æå‰è¿›è¡ŒæŠ€èƒ½è¯„ä¼°ï¼Œæä¾›åŸ¹è®­å’ŒæŒ‡å¯¼ï¼Œå¼•å…¥å¤–éƒ¨ä¸“å®¶ï¼Œè°ƒæ•´ä»»åŠ¡åˆ†é…",contingencyPlan:"å¤–åŒ…ä¸“ä¸šä»»åŠ¡ï¼Œè˜è¯·é¡¾é—®ï¼Œå»¶é•¿å­¦ä¹ æ›²çº¿æ—¶é—´",tags:["æŠ€èƒ½","åŸ¹è®­","èƒ½åŠ›"]},{id:"tmpl-resource-003",name:"èµ„æºå†²çª",category:"resource",description:"å…³é”®èµ„æºè¢«å¤šä¸ªé¡¹ç›®äº‰å¤ºï¼Œå¯¼è‡´åˆ†é…ä¸è¶³",probability:4,impact:3,mitigationStrategy:"å»ºç«‹èµ„æºä¼˜å…ˆçº§æœºåˆ¶ï¼Œæå‰é¢„è®¢èµ„æºï¼Œä¸å…¶ä»–é¡¹ç›®åè°ƒï¼Œå¢åŠ èµ„æºæ± ",contingencyPlan:"è°ƒæ•´é¡¹ç›®ä¼˜å…ˆçº§ï¼Œå»¶é•¿æ—¶é—´çº¿ï¼Œä¸´æ—¶æ‹›è˜å¤–éƒ¨èµ„æº",tags:["èµ„æºå†²çª","ä¼˜å…ˆçº§","åˆ†é…"]},{id:"tmpl-technical-001",name:"æŠ€æœ¯é€‰å‹é”™è¯¯",category:"technical",description:"é€‰æ‹©çš„æŠ€æœ¯æ ˆä¸é€‚åˆé¡¹ç›®éœ€æ±‚ï¼Œå¯¼è‡´æ€§èƒ½é—®é¢˜æˆ–å¼€å‘å›°éš¾",probability:2,impact:4,mitigationStrategy:"è¿›è¡Œå……åˆ†çš„æŠ€æœ¯è°ƒç ”å’ŒPOCéªŒè¯ï¼Œå’¨è¯¢ä¸“å®¶æ„è§ï¼Œè¯„ä¼°é•¿æœŸç»´æŠ¤æ€§",contingencyPlan:"é‡æ–°è¯„ä¼°æŠ€æœ¯é€‰å‹ï¼Œè¿›è¡ŒæŠ€æœ¯è¿ç§»ï¼Œå¯»æ±‚ä¸“å®¶æ”¯æŒ",tags:["æŠ€æœ¯é€‰å‹","æ¶æ„","æ€§èƒ½"],applicableProjectTypes:["web","mobile","data"]},{id:"tmpl-technical-002",name:"ç¬¬ä¸‰æ–¹APIä¸ç¨³å®š",category:"technical",description:"ä¾èµ–çš„ç¬¬ä¸‰æ–¹APIæœåŠ¡ä¸ç¨³å®šæˆ–é¢‘ç¹å˜æ›´",probability:3,impact:3,mitigationStrategy:"é€‰æ‹©å¯é çš„æœåŠ¡æä¾›å•†ï¼Œå®ç°é‡è¯•å’Œé™çº§æœºåˆ¶ï¼Œç›‘æ§APIå¥åº·çŠ¶æ€ï¼Œå‡†å¤‡å¤‡é€‰æ–¹æ¡ˆ",contingencyPlan:"åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡å•†ï¼Œå®ç°æœ¬åœ°ç¼“å­˜ï¼Œå¼€å‘æ›¿ä»£åŠŸèƒ½",tags:["API","ç¬¬ä¸‰æ–¹","ç¨³å®šæ€§"]},{id:"tmpl-technical-003",name:"å®‰å…¨æ¼æ´",category:"technical",description:"ç³»ç»Ÿå­˜åœ¨å®‰å…¨æ¼æ´ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²æˆ–æ”»å‡»",probability:2,impact:5,mitigationStrategy:"å®šæœŸå®‰å…¨å®¡è®¡ï¼Œéµå¾ªå®‰å…¨æœ€ä½³å®è·µï¼Œä½¿ç”¨å®‰å…¨æ‰«æå·¥å…·ï¼ŒåŠæ—¶æ›´æ–°ä¾èµ–",contingencyPlan:"ç«‹å³ä¿®å¤æ¼æ´ï¼Œé€šçŸ¥å—å½±å“ç”¨æˆ·ï¼ŒåŠ å¼ºå®‰å…¨ç›‘æ§",tags:["å®‰å…¨","æ¼æ´","æ•°æ®ä¿æŠ¤"],applicableProjectTypes:["web","mobile","data"]},{id:"tmpl-external-001",name:"æ”¿ç­–æ³•è§„å˜æ›´",category:"external",description:"ç›¸å…³æ”¿ç­–æ³•è§„å˜æ›´ï¼Œè¦æ±‚é¡¹ç›®è°ƒæ•´åˆè§„æ€§",probability:2,impact:4,mitigationStrategy:"æŒç»­å…³æ³¨æ”¿ç­–åŠ¨æ€ï¼Œå’¨è¯¢æ³•å¾‹é¡¾é—®ï¼Œè®¾è®¡çµæ´»çš„æ¶æ„ä»¥é€‚åº”å˜åŒ–",contingencyPlan:"å¿«é€Ÿè°ƒæ•´ç³»ç»Ÿè®¾è®¡ï¼Œå¯»æ±‚æ³•å¾‹æ”¯æŒï¼Œç”³è¯·å»¶æœŸ",tags:["æ”¿ç­–","åˆè§„","æ³•è§„"]},{id:"tmpl-external-002",name:"å¸‚åœºéœ€æ±‚å˜åŒ–",category:"external",description:"å¸‚åœºéœ€æ±‚å¿«é€Ÿå˜åŒ–ï¼Œå¯¼è‡´é¡¹ç›®ç›®æ ‡è¿‡æ—¶",probability:3,impact:3,mitigationStrategy:"é‡‡ç”¨æ•æ·å¼€å‘æ–¹æ³•ï¼Œå®šæœŸæ”¶é›†å¸‚åœºåé¦ˆï¼Œä¿æŒäº§å“çµæ´»æ€§",contingencyPlan:"å¿«é€Ÿè°ƒæ•´äº§å“æ–¹å‘ï¼Œé‡æ–°è¯„ä¼°ä¼˜å…ˆçº§ï¼Œå‰Šå‡è¿‡æ—¶åŠŸèƒ½",tags:["å¸‚åœº","éœ€æ±‚","å˜åŒ–"],applicableProjectTypes:["web","mobile"]},{id:"tmpl-quality-001",name:"è´¨é‡æ ‡å‡†ä¸è¾¾æ ‡",category:"quality",description:"äº§å“è´¨é‡æ— æ³•æ»¡è¶³é¢„å®šæ ‡å‡†ï¼Œå¯¼è‡´è¿”å·¥æˆ–å®¢æˆ·ä¸æ»¡",probability:3,impact:4,mitigationStrategy:"å»ºç«‹æ¸…æ™°çš„è´¨é‡æ ‡å‡†ï¼Œå®æ–½æŒç»­é›†æˆå’Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå®šæœŸä»£ç å®¡æŸ¥",contingencyPlan:"å¢åŠ æµ‹è¯•èµ„æºï¼Œå»¶é•¿æµ‹è¯•å‘¨æœŸï¼Œé™ä½éƒ¨åˆ†éæ ¸å¿ƒåŠŸèƒ½çš„è´¨é‡è¦æ±‚",tags:["è´¨é‡","æµ‹è¯•","æ ‡å‡†"],applicableProjectTypes:["web","mobile","data","infrastructure"]},{id:"tmpl-quality-002",name:"æŠ€æœ¯å€ºåŠ¡ç´¯ç§¯",category:"quality",description:"ä¸ºäº†èµ¶è¿›åº¦è€Œç§¯ç´¯å¤§é‡æŠ€æœ¯å€ºåŠ¡ï¼Œå½±å“é•¿æœŸç»´æŠ¤",probability:4,impact:3,mitigationStrategy:"å¹³è¡¡é€Ÿåº¦å’Œè´¨é‡ï¼Œå®šæœŸé‡æ„ï¼Œé¢„ç•™æŠ€æœ¯å€ºåŠ¡å¿è¿˜æ—¶é—´",contingencyPlan:"å®‰æ’ä¸“é—¨çš„é‡æ„è¿­ä»£ï¼Œå¢åŠ ç»´æŠ¤é¢„ç®—ï¼Œä¼˜å…ˆå¿è¿˜é«˜é£é™©å€ºåŠ¡",tags:["æŠ€æœ¯å€ºåŠ¡","é‡æ„","ç»´æŠ¤"]},{id:"tmpl-scope-001",name:"éœ€æ±‚è”“å»¶",category:"scope",description:"é¡¹ç›®èŒƒå›´ä¸æ–­æ‰©å¤§ï¼Œå¯¼è‡´è¿›åº¦å»¶æœŸå’Œæˆæœ¬è¶…æ”¯",probability:4,impact:4,mitigationStrategy:"å»ºç«‹ä¸¥æ ¼çš„å˜æ›´æ§åˆ¶æµç¨‹ï¼Œæ˜ç¡®é¡¹ç›®è¾¹ç•Œï¼Œç®¡ç†å¹²ç³»äººæœŸæœ›ï¼Œä½¿ç”¨MoSCoWä¼˜å…ˆçº§",contingencyPlan:"å†»ç»“æ–°éœ€æ±‚ï¼Œæ¨è¿Ÿéæ ¸å¿ƒåŠŸèƒ½åˆ°ä¸‹ä¸€ç‰ˆæœ¬ï¼Œé‡æ–°è¯„ä¼°èµ„æºéœ€æ±‚",tags:["èŒƒå›´","éœ€æ±‚","å˜æ›´"],applicableProjectTypes:["web","mobile","data","infrastructure"]},{id:"tmpl-scope-002",name:"éœ€æ±‚ä¸æ˜ç¡®",category:"scope",description:"é¡¹ç›®éœ€æ±‚æ¨¡ç³Šæˆ–é¢‘ç¹å˜æ›´ï¼Œå¯¼è‡´è¿”å·¥å’Œæ··ä¹±",probability:3,impact:4,mitigationStrategy:"æŠ•å…¥è¶³å¤Ÿæ—¶é—´è¿›è¡Œéœ€æ±‚åˆ†æï¼Œä½¿ç”¨åŸå‹éªŒè¯ï¼Œå»ºç«‹éœ€æ±‚åŸºçº¿ï¼Œå®šæœŸä¸å¹²ç³»äººç¡®è®¤",contingencyPlan:"æš‚åœå¼€å‘è¿›è¡Œéœ€æ±‚æ¾„æ¸…ï¼Œé‡‡ç”¨æ•æ·æ–¹æ³•é€æ­¥æ˜ç¡®éœ€æ±‚",tags:["éœ€æ±‚","æ¾„æ¸…","å˜æ›´"]}],It=t=>{const s=t.toLowerCase();return D.filter(i=>i.name.toLowerCase().includes(s)||i.description.toLowerCase().includes(s)||i.tags.some(r=>r.toLowerCase().includes(s)))},zt=(t,s,i)=>({projectId:s,category:t.category,title:t.name,description:t.description,probability:t.probability,impact:t.impact,owner:i,ownerName:i,status:"identified",mitigationStrategy:t.mitigationStrategy,mitigationActions:[],contingencyPlan:t.contingencyPlan,tags:t.tags}),Et=({isOpen:t,onClose:s,onSelectTemplate:i})=>{const[r,l]=w.useState(""),[n,a]=w.useState("all"),o=w.useMemo(()=>{let d=D;return r.trim()&&(d=It(r)),n!=="all"&&(d=d.filter(p=>p.category===n)),d},[r,n]),c=[{value:"all",label:"å…¨éƒ¨"},{value:"schedule",label:"è¿›åº¦é£é™©"},{value:"cost",label:"æˆæœ¬é£é™©"},{value:"resource",label:"èµ„æºé£é™©"},{value:"technical",label:"æŠ€æœ¯é£é™©"},{value:"external",label:"å¤–éƒ¨é£é™©"},{value:"quality",label:"è´¨é‡é£é™©"},{value:"scope",label:"èŒƒå›´é£é™©"}];return t?e.jsx(re,{children:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs(T.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"é£é™©æ¨¡æ¿åº“"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"é€‰æ‹©å¸¸è§é£é™©æ¨¡æ¿å¿«é€Ÿåˆ›å»ºé£é™©"})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(je,{size:20})})]}),e.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"text",value:r,onChange:d=>l(d.target.value),placeholder:"æœç´¢é£é™©æ¨¡æ¿...",className:"w-full pl-10 pr-4 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(we,{size:16,className:"text-slate-500"}),c.map(d=>e.jsx("button",{onClick:()=>a(d.value),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${n===d.value?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:d.label},d.value))]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:o.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"æœªæ‰¾åˆ°åŒ¹é…çš„é£é™©æ¨¡æ¿"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map(d=>{const p=B(d.category);return e.jsxs(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-50 dark:bg-slate-700/50 rounded-lg p-4 border border-slate-200 dark:border-slate-600 hover:border-blue-400 dark:hover:border-blue-500 transition-colors cursor-pointer group",onClick:()=>{i(d),s()},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:p.icon}),e.jsx("h3",{className:"font-semibold text-slate-800 dark:text-slate-100",children:d.name})]}),e.jsx("button",{className:"p-1.5 bg-blue-600 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Q,{size:16})})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-3 line-clamp-2",children:d.description}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["æ¦‚ç‡: ",d.probability,"/5"]}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"â€¢"}),e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["å½±å“: ",d.impact,"/5"]}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"â€¢"}),e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["åˆ†æ•°: ",d.probability*d.impact]})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:d.tags.slice(0,3).map(m=>e.jsx("span",{className:"px-2 py-0.5 bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-200 rounded text-xs",children:m},m))})]},d.id)})})}),e.jsx("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50",children:e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 text-center",children:"ğŸ’¡ æç¤ºï¼šç‚¹å‡»ä»»æ„æ¨¡æ¿å³å¯åŸºäºè¯¥æ¨¡æ¿åˆ›å»ºé£é™©ï¼Œæ‚¨å¯ä»¥åœ¨åˆ›å»ºåè¿›ä¸€æ­¥è‡ªå®šä¹‰"})})]})})}):null},Tt=(t,s)=>{const i=[],r=Lt(t);i.push(...r);const l=Ft(t);i.push(...l);const n=_t(t);i.push(...n);const a=qt(t);i.push(...a);const o=Bt(t);i.push(...o);const c=Vt(t);i.push(...c);const d=Wt(t,s);return i.push(...d),i.sort((p,m)=>m.confidence-p.confidence).filter((p,m,g)=>m===g.findIndex(v=>v.template.id===p.template.id)).slice(0,10)},Lt=t=>{const s=[],i=t.tasks||[];if(t.milestones,(new Date(t.endDate).getTime()-new Date(t.startDate).getTime())/(1e3*60*60*24)<90&&i.length>20){const a=D.find(o=>o.id==="tmpl-schedule-001");a&&s.push({template:a,confidence:.85,reason:"é¡¹ç›®å·¥æœŸç´§å¼ ï¼ˆå°‘äº90å¤©ï¼‰ä¸”ä»»åŠ¡æ•°é‡è¾ƒå¤šï¼ˆ>20ä¸ªï¼‰ï¼Œå­˜åœ¨é‡Œç¨‹ç¢‘å»¶æœŸé£é™©",relatedFactors:["å·¥æœŸ","ä»»åŠ¡æ•°é‡"]})}if(i.filter(a=>a.dependencies&&a.dependencies.length>0).length>i.length*.3){const a=D.find(o=>o.id==="tmpl-schedule-002");a&&s.push({template:a,confidence:.7,reason:"è¶…è¿‡30%çš„ä»»åŠ¡å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œä¾èµ–é¡¹å»¶æœŸå¯èƒ½å½±å“æ•´ä½“è¿›åº¦",relatedFactors:["ä»»åŠ¡ä¾èµ–","å…³é”®è·¯å¾„"]})}return s},Ft=t=>{const s=[],i=t.budget||0,r=t.actualCost||0,l=i>0?r/i:0;if(l>.7&&t.status!=="completed"){const n=D.find(a=>a.id==="tmpl-cost-001");n&&s.push({template:n,confidence:.9,reason:`é¢„ç®—å·²ä½¿ç”¨${(l*100).toFixed(0)}%ï¼Œä½†é¡¹ç›®å°šæœªå®Œæˆï¼Œå­˜åœ¨é¢„ç®—è¶…æ”¯é£é™©`,relatedFactors:["é¢„ç®—ä½¿ç”¨ç‡","é¡¹ç›®è¿›åº¦"]})}if(!t.costHistory||t.costHistory.length===0){const n=D.find(a=>a.id==="tmpl-cost-002");n&&s.push({template:n,confidence:.6,reason:"ç¼ºå°‘æˆæœ¬è®°å½•ï¼Œå¯èƒ½å­˜åœ¨éšè—æˆæœ¬æœªè¢«è¿½è¸ª",relatedFactors:["æˆæœ¬è¿½è¸ª","é€æ˜åº¦"]})}return s},_t=t=>{const s=[];if((t.resourceRequirements||[]).length===0&&t.status==="active"){const r=D.find(l=>l.id==="tmpl-resource-002");r&&s.push({template:r,confidence:.75,reason:"é¡¹ç›®å·²å¯åŠ¨ä½†æœªæ˜ç¡®èµ„æºéœ€æ±‚ï¼Œå¯èƒ½å­˜åœ¨æŠ€èƒ½ä¸åŒ¹é…é£é™©",relatedFactors:["èµ„æºè§„åˆ’","æŠ€èƒ½åŒ¹é…"]})}if(t.priority==="P0"||t.priority==="P1"){const r=D.find(l=>l.id==="tmpl-resource-003");r&&s.push({template:r,confidence:.65,reason:"é«˜ä¼˜å…ˆçº§é¡¹ç›®å¯èƒ½ä¸å…¶ä»–é¡¹ç›®äº‰å¤ºå…³é”®èµ„æº",relatedFactors:["é¡¹ç›®ä¼˜å…ˆçº§","èµ„æºç«äº‰"]})}return s},qt=t=>{var i,r;const s=[];if((i=t.factors)!=null&&i.innovation&&t.factors.innovation>7){const l=D.find(n=>n.id==="tmpl-technical-001");l&&s.push({template:l,confidence:.8,reason:"é¡¹ç›®åˆ›æ–°åº¦è¾ƒé«˜ï¼Œå¯èƒ½æ¶‰åŠæ–°æŠ€æœ¯ï¼Œå­˜åœ¨æŠ€æœ¯é€‰å‹é£é™©",relatedFactors:["åˆ›æ–°åº¦","æŠ€æœ¯å¤æ‚åº¦"]})}if((r=t.factors)!=null&&r.risk&&t.factors.risk<5){const l=D.find(n=>n.id==="tmpl-technical-003");l&&s.push({template:l,confidence:.7,reason:"æŠ€æœ¯é£é™©è¯„åˆ†è¾ƒä½ï¼Œå»ºè®®å…³æ³¨å®‰å…¨æ¼æ´å’ŒæŠ€æœ¯å€ºåŠ¡",relatedFactors:["æŠ€æœ¯é£é™©","å®‰å…¨æ€§"]})}return s},Bt=t=>{const s=[],i=t.tasks||[];if((new Date(t.endDate).getTime()-new Date(t.startDate).getTime())/(1e3*60*60*24)<60&&i.length>15){const n=D.find(a=>a.id==="tmpl-quality-001");n&&s.push({template:n,confidence:.75,reason:"å¼€å‘å‘¨æœŸçŸ­ä¸”ä»»åŠ¡é‡å¤§ï¼Œå¯èƒ½å½±å“è´¨é‡æ ‡å‡†",relatedFactors:["å¼€å‘å‘¨æœŸ","ä»»åŠ¡å¤æ‚åº¦"]})}if(t.status==="active"&&t.progress&&t.progress>50){const n=D.find(a=>a.id==="tmpl-quality-002");n&&s.push({template:n,confidence:.6,reason:"é¡¹ç›®å·²è¿›è¡Œè¿‡åŠï¼Œå»ºè®®è¯„ä¼°æŠ€æœ¯å€ºåŠ¡ç´¯ç§¯æƒ…å†µ",relatedFactors:["é¡¹ç›®è¿›åº¦","ä»£ç è´¨é‡"]})}return s},Vt=t=>{const s=[];if((t.tasks||[]).length>30){const r=D.find(l=>l.id==="tmpl-scope-001");r&&s.push({template:r,confidence:.7,reason:"ä»»åŠ¡æ•°é‡è¾ƒå¤šï¼ˆ>30ä¸ªï¼‰ï¼Œéœ€è­¦æƒ•éœ€æ±‚è”“å»¶",relatedFactors:["ä»»åŠ¡æ•°é‡","èŒƒå›´ç®¡ç†"]})}if(!t.description||t.description.length<50){const r=D.find(l=>l.id==="tmpl-scope-002");r&&s.push({template:r,confidence:.65,reason:"é¡¹ç›®æè¿°ä¸å¤Ÿè¯¦ç»†ï¼Œå¯èƒ½å­˜åœ¨éœ€æ±‚ä¸æ˜ç¡®çš„é£é™©",relatedFactors:["éœ€æ±‚æ–‡æ¡£","é¡¹ç›®å®šä¹‰"]})}return s},Wt=(t,s)=>{const i=[],r=s.filter(n=>n.id!==t.id&&n.status==="completed"&&n.priority===t.priority&&n.risks&&n.risks.length>0);if(r.length===0)return i;const l=new Map;return r.forEach(n=>{var a;(a=n.risks)==null||a.forEach(o=>{const c=o.category,d=l.get(c)||{count:0,category:o.category};l.set(c,{count:d.count+1,category:o.category})})}),l.forEach((n,a)=>{const o=n.count/r.length;if(o>.5){const c=D.filter(d=>d.category===n.category);c.length>0&&i.push({template:c[0],confidence:Math.min(.9,o),reason:`ç±»ä¼¼é¡¹ç›®ä¸­${(o*100).toFixed(0)}%é‡åˆ°äº†${a}ç±»é£é™©`,relatedFactors:["å†å²æ•°æ®","é¡¹ç›®ç›¸ä¼¼åº¦"]})}}),i},Ht=t=>{const s=[],i=t.filter(m=>m.status!=="resolved"&&m.status!=="accepted"),r=i.filter(m=>m.priority==="critical"),l=i.filter(m=>m.priority==="high");r.length>0&&s.push(`âš ï¸ å‘ç° ${r.length} ä¸ªæé«˜é£é™©ï¼Œå»ºè®®ç«‹å³é‡‡å–ç¼“è§£æªæ–½å¹¶åˆ†é…ä¸“äººè´Ÿè´£`),l.length>3&&s.push(`ğŸ”´ é«˜é£é™©æ•°é‡è¾ƒå¤šï¼ˆ${l.length}ä¸ªï¼‰ï¼Œå»ºè®®ä¼˜å…ˆå¤„ç†å¹¶å¢åŠ è¯„å®¡é¢‘ç‡`);const n=i.filter(m=>m.mitigationStrategy&&m.mitigationStrategy.length>0),a=i.length>0?n.length/i.length:0;a<.5&&s.push(`ğŸ’¡ ä»…${(a*100).toFixed(0)}%çš„æ´»è·ƒé£é™©æœ‰ç¼“è§£ç­–ç•¥ï¼Œå»ºè®®å®Œå–„é£é™©åº”å¯¹è®¡åˆ’`);const o=i.reduce((m,g)=>m+g.mitigationActions.length,0),c=i.reduce((m,g)=>m+g.mitigationActions.filter(v=>v.status==="completed").length,0);if(o>0){const m=c/o;m<.3&&s.push(`ğŸ“‹ ç¼“è§£æªæ–½å®Œæˆç‡è¾ƒä½ï¼ˆ${(m*100).toFixed(0)}%ï¼‰ï¼Œå»ºè®®åŠ å¿«æ‰§è¡Œè¿›åº¦`)}const d={schedule:0,cost:0,resource:0,technical:0,external:0,quality:0,scope:0};i.forEach(m=>{d[m.category]++});const p=Object.entries(d).reduce((m,[g,v])=>v>m[1]?[g,v]:m,["",0]);return p[1]>i.length*.4&&s.push(`ğŸ“Š ${p[0]}ç±»é£é™©å æ¯”è¾ƒé«˜ï¼ˆ${p[1]}ä¸ªï¼‰ï¼Œå»ºè®®é’ˆå¯¹æ€§åŠ å¼ºç®¡ç†`),s},Kt=({project:t,allProjects:s,existingRisks:i,onAcceptSuggestion:r})=>{const l=w.useMemo(()=>Tt(t,s),[t,s]),n=w.useMemo(()=>Ht(i),[i]),a=c=>c>=.8?"text-red-600 bg-red-50 border-red-200":c>=.6?"text-orange-600 bg-orange-50 border-orange-200":"text-yellow-600 bg-yellow-50 border-yellow-200",o=c=>c>=.8?"é«˜":c>=.6?"ä¸­":"ä½";return e.jsxs("div",{className:"space-y-6",children:[n.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-6 border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(st,{className:"text-blue-600 dark:text-blue-400",size:20}),e.jsx("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100",children:"AI æ´å¯Ÿ"})]}),e.jsx("div",{className:"space-y-2",children:n.map((c,d)=>e.jsxs(T.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:d*.1},className:"flex items-start gap-3 text-sm text-blue-800 dark:text-blue-200",children:[e.jsx(Ee,{size:16,className:"mt-0.5 flex-shrink-0"}),e.jsx("span",{children:c})]},d))})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"text-purple-600 dark:text-purple-400",size:20}),e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"AI é£é™©å»ºè®®"})]}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"åŸºäºé¡¹ç›®ç‰¹å¾å’Œå†å²æ•°æ®åˆ†æ"})]}),l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Te,{className:"mx-auto h-12 w-12 text-green-500 mb-3"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 font-medium",children:"æš‚æ— é£é™©å»ºè®®"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"é¡¹ç›®çŠ¶æ€è‰¯å¥½ï¼Œç»§ç»­ä¿æŒï¼"})]}):e.jsx("div",{className:"space-y-3",children:l.map((c,d)=>{const p=B(c.template.category),m=a(c.confidence);return e.jsxs(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:d*.05},className:"border border-slate-200 dark:border-slate-700 rounded-lg p-4 hover:border-purple-300 dark:hover:border-purple-600 transition-colors group",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("span",{className:"text-xl",children:p.icon}),e.jsx("h4",{className:"font-semibold text-slate-800 dark:text-slate-100",children:c.template.name}),e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium border ${m}`,children:["ç½®ä¿¡åº¦: ",o(c.confidence)]})]}),e.jsxs("button",{onClick:()=>r(c.template.id),className:"flex items-center gap-1 px-3 py-1.5 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors opacity-0 group-hover:opacity-100",children:[e.jsx(Q,{size:14}),e.jsx("span",{className:"text-xs",children:"é‡‡çº³"})]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-3",children:c.template.description}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 mb-3",children:[e.jsx("p",{className:"text-xs font-medium text-purple-900 dark:text-purple-100 mb-1",children:"ğŸ’¡ AI åˆ†æåŸå› "}),e.jsx("p",{className:"text-xs text-purple-800 dark:text-purple-200",children:c.reason})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"ç›¸å…³å› ç´ :"}),c.relatedFactors.map(g=>e.jsx("span",{className:"px-2 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200 rounded text-xs",children:g},g))]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200",children:"æŸ¥çœ‹å»ºè®®çš„ç¼“è§£ç­–ç•¥"}),e.jsxs("div",{className:"mt-2 pl-4 space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-700 dark:text-slate-200",children:"ç¼“è§£ç­–ç•¥:"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:c.template.mitigationStrategy})]}),c.template.contingencyPlan&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-700 dark:text-slate-200",children:"åº”æ€¥è®¡åˆ’:"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:c.template.contingencyPlan})]})]})]})})]},c.template.id)})}),l.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-slate-50 dark:bg-slate-900/50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:["ğŸ’¡ ",e.jsx("strong",{children:"æç¤º:"})," AI å»ºè®®åŸºäºé¡¹ç›®ç‰¹å¾ã€å†å²æ•°æ®å’Œè¡Œä¸šæœ€ä½³å®è·µç”Ÿæˆã€‚ æ‚¨å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©æ€§é‡‡çº³ï¼Œå¹¶è¿›ä¸€æ­¥è‡ªå®šä¹‰é£é™©è¯¦æƒ…ã€‚"]})})]})]})},Ut=({risks:t,months:s=6})=>{const i=w.useMemo(()=>{const a=new Date,o=xt(it(a),s-1),c=rt(a);return Ne({start:o,end:c}).map(p=>{const m=t.filter(x=>{const A=new Date(x.identifiedDate),j=x.resolvedDate?new Date(x.resolvedDate):null;return A<=p&&(!j||j>p)}),g=m.reduce((x,A)=>x+A.riskScore,0),v=m.length>0?g/m.length:0,h=m.filter(x=>x.priority==="critical").length,f=m.filter(x=>x.priority==="high").length,b=m.filter(x=>x.priority==="medium").length,k=m.filter(x=>x.priority==="low").length;return{date:p,count:m.length,avgScore:v,critical:h,high:f,medium:b,low:k}})},[t,s]),r=w.useMemo(()=>{const a=new Map;return i.forEach(o=>{const c=O(o.date,"yyyy-MM");a.has(c)||a.set(c,[]),a.get(c).push(o)}),Array.from(a.entries()).map(([o,c])=>({month:o,monthLabel:O(new Date(o+"-01"),"yyyyå¹´MMæœˆ"),days:c}))},[i]),l=(a,o)=>o===0?"bg-slate-100 dark:bg-slate-800":a>=16?"bg-red-600":a>=12?"bg-red-500":a>=10?"bg-orange-500":a>=7?"bg-orange-400":a>=5?"bg-yellow-400":a>=3?"bg-yellow-300":"bg-green-300",n=Math.max(...i.map(a=>a.count),1);return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100 mb-2",children:"é£é™©çƒ­åŠ›å›¾ï¼ˆæ—¶é—´ç»´åº¦ï¼‰"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["è¿‡å» ",s," ä¸ªæœˆçš„é£é™©åˆ†å¸ƒå’Œå¼ºåº¦å˜åŒ–"]})]}),e.jsx("div",{className:"space-y-6 overflow-x-auto",children:r.map(a=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3",children:a.monthLabel}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"].map(o=>e.jsx("div",{className:"text-xs text-center text-slate-500 dark:text-slate-400 font-medium pb-1",children:o},o)),Array.from({length:a.days[0].date.getDay()}).map((o,c)=>e.jsx("div",{},`empty-${c}`)),a.days.map(o=>{const c=l(o.avgScore,o.count),d=dt(o.date,new Date);return e.jsxs("div",{className:"group relative",title:`${O(o.date,"yyyy-MM-dd")}: ${o.count} ä¸ªé£é™©`,children:[e.jsx("div",{className:`aspect-square rounded ${c} ${d?"ring-2 ring-blue-500":""} transition-transform hover:scale-110 cursor-pointer`}),e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:e.jsxs("div",{className:"bg-slate-900 text-white text-xs rounded-lg p-3 shadow-xl min-w-[200px]",children:[e.jsx("div",{className:"font-semibold mb-2",children:O(o.date,"yyyyå¹´MMæœˆddæ—¥")}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["æ´»è·ƒé£é™©: ",o.count," ä¸ª"]}),o.count>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["å¹³å‡åˆ†æ•°: ",o.avgScore.toFixed(1)]}),e.jsxs("div",{className:"pt-1 border-t border-slate-700",children:[o.critical>0&&e.jsxs("div",{className:"text-red-400",children:["æé«˜: ",o.critical]}),o.high>0&&e.jsxs("div",{className:"text-orange-400",children:["é«˜: ",o.high]}),o.medium>0&&e.jsxs("div",{className:"text-yellow-400",children:["ä¸­: ",o.medium]}),o.low>0&&e.jsxs("div",{className:"text-green-400",children:["ä½: ",o.low]})]})]})]})]})})]},o.date.toISOString())})]})]},a.month))}),e.jsx("div",{className:"mt-6 pt-6 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-slate-700 dark:text-slate-200 mb-2",children:"é£é™©å¼ºåº¦"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"ä½"}),e.jsx("div",{className:"w-4 h-4 bg-green-300 rounded"}),e.jsx("div",{className:"w-4 h-4 bg-yellow-300 rounded"}),e.jsx("div",{className:"w-4 h-4 bg-yellow-400 rounded"}),e.jsx("div",{className:"w-4 h-4 bg-orange-400 rounded"}),e.jsx("div",{className:"w-4 h-4 bg-orange-500 rounded"}),e.jsx("div",{className:"w-4 h-4 bg-red-500 rounded"}),e.jsx("div",{className:"w-4 h-4 bg-red-600 rounded"}),e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"é«˜"})]})]}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-slate-100 dark:bg-slate-800 rounded"}),e.jsx("span",{children:"æ— é£é™©"})]})})]})}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"æœ€é«˜é£é™©æ—¥"}),e.jsxs("p",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:[n," ä¸ª"]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"å¹³å‡æ´»è·ƒé£é™©"}),e.jsx("p",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:(i.reduce((a,o)=>a+o.count,0)/i.length).toFixed(1)})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"æ— é£é™©å¤©æ•°"}),e.jsx("p",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:i.filter(a=>a.count===0).length})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"é«˜é£é™©å¤©æ•°"}),e.jsx("p",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:i.filter(a=>a.avgScore>=10).length})]})]})]})},Gt=(t,s,i)=>{const r=[];return i.forEach(l=>{if(l.id===s.id)return;(l.risks||[]).forEach(a=>{const o=Yt(t,a,s,l);o.score>.3&&r.push({risk:a,project:l,correlationScore:o.score,correlationType:o.type,reason:o.reason})})}),r.sort((l,n)=>n.correlationScore-l.correlationScore),{sourceRisk:t,sourceProject:s,relatedRisks:r}},Yt=(t,s,i,r)=>{let l=0,n="indirect";const a=[];t.category===s.category&&(l+=.4,a.push(`ç›¸åŒç±»åˆ«ï¼ˆ${t.category}ï¼‰`)),t.priority===s.priority&&(l+=.2,a.push(`ç›¸åŒä¼˜å…ˆçº§ï¼ˆ${t.priority}ï¼‰`)),Oe(i,r)&&(l+=.3,n="direct",a.push("é¡¹ç›®é—´å­˜åœ¨èµ„æºå…±äº«")),Xt(i,r)>.5&&(l+=.2,a.push("é¡¹ç›®æ—¶é—´çº¿é‡å "));const c=Qt(t.title+" "+t.description,s.title+" "+s.description);return c>.3&&(l+=c*.3,a.push("é£é™©æè¿°ç›¸ä¼¼")),Jt(t,s)&&(l+=.4,n="cascading",a.push("å¯èƒ½äº§ç”Ÿè¿é”ååº”")),t.owner===s.owner&&(l+=.15,a.push("ç›¸åŒè´Ÿè´£äºº")),{score:Math.min(l,1),type:n,reason:a.join("ï¼›")}},Oe=(t,s)=>{const i=new Set((t.resourceRequirements||[]).map(l=>l.resourceId)),r=new Set((s.resourceRequirements||[]).map(l=>l.resourceId));for(const l of i)if(r.has(l))return!0;return!1},Xt=(t,s)=>{const i=new Date(t.startDate).getTime(),r=new Date(t.endDate).getTime(),l=new Date(s.startDate).getTime(),n=new Date(s.endDate).getTime(),a=Math.max(i,l),o=Math.min(r,n);if(a>=o)return 0;const c=o-a,d=Math.max(r-i,n-l);return c/d},Qt=(t,s)=>{const i=new Set(t.toLowerCase().split(/\s+/)),r=new Set(s.toLowerCase().split(/\s+/));let l=0;for(const a of i)r.has(a)&&a.length>2&&l++;const n=Math.max(i.size,r.size);return n>0?l/n:0},Jt=(t,s,i,r)=>t.category==="schedule"&&s.category==="cost"||t.category==="resource"&&s.category==="schedule"||t.category==="technical"&&s.category==="quality"||t.category==="scope"&&(s.category==="schedule"||s.category==="cost"),Zt=t=>{const s=new Map;return t.forEach(i=>{const r=[],l=[];t.forEach(a=>{if(a.id===i.id)return;const o=a.risks||[],c=[];if(o.forEach(d=>{ye(d,a,i)&&c.push(d)}),c.length>0){const d=c.reduce((m,g)=>m+g.impact,0)/c.length,p=c.filter(m=>m.priority==="critical");r.push({sourceProject:a,riskCount:c.length,avgImpact:d,criticalRisks:p})}});const n=i.risks||[];t.forEach(a=>{if(a.id===i.id)return;const o=n.filter(c=>ye(c,i,a));if(o.length>0){const c=o.reduce((p,m)=>p+m.impact,0)/o.length,d=o.filter(p=>p.priority==="critical");l.push({targetProject:a,riskCount:o.length,avgImpact:c,criticalRisks:d})}}),s.set(i.id,{project:i,impactedBy:r,impacting:l})}),s},ye=(t,s,i)=>!!(t.category==="resource"&&Oe(s,i)||t.category==="schedule"&&s.priority==="P0"&&t.priority==="critical"||t.category==="external"&&t.impact>=4),es=({currentProject:t,allProjects:s,currentRisk:i})=>{const r=w.useMemo(()=>Zt(s).get(t.id),[t,s]),l=w.useMemo(()=>i?Gt(i,t,s):null,[i,t,s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Be,{className:"text-indigo-600 dark:text-indigo-400",size:20}),e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"è·¨é¡¹ç›®é£é™©å…³è”åˆ†æ"})]}),r&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3 flex items-center gap-2",children:[e.jsx(ie,{size:16,className:"text-orange-500"}),"å—å…¶ä»–é¡¹ç›®å½±å“"]}),r.impactedBy.length===0?e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 italic",children:"æš‚æ— æ¥è‡ªå…¶ä»–é¡¹ç›®çš„é£é™©å½±å“"}):e.jsx("div",{className:"space-y-3",children:r.impactedBy.map(n=>e.jsxs(T.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"border border-orange-200 dark:border-orange-800 rounded-lg p-3 bg-orange-50 dark:bg-orange-900/20",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-100 text-sm",children:n.sourceProject.name}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 mt-1",children:[n.riskCount," ä¸ªé£é™©å¯èƒ½å½±å“æœ¬é¡¹ç›®"]})]}),e.jsxs("span",{className:"px-2 py-1 bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-200 rounded text-xs font-medium",children:["å½±å“åº¦: ",n.avgImpact.toFixed(1),"/5"]})]}),n.criticalRisks.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-orange-300 dark:border-orange-700",children:[e.jsxs("p",{className:"text-xs font-medium text-red-600 dark:text-red-400 mb-1",children:["âš ï¸ æé«˜é£é™© (",n.criticalRisks.length,")"]}),n.criticalRisks.slice(0,2).map(a=>e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 truncate",children:["â€¢ ",a.title]},a.id))]})]},n.sourceProject.id))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3 flex items-center gap-2",children:[e.jsx(Le,{size:16,className:"text-blue-500"}),"å½±å“å…¶ä»–é¡¹ç›®"]}),r.impacting.length===0?e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 italic",children:"æœ¬é¡¹ç›®é£é™©æš‚ä¸å½±å“å…¶ä»–é¡¹ç›®"}):e.jsx("div",{className:"space-y-3",children:r.impacting.map(n=>e.jsxs(T.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"border border-blue-200 dark:border-blue-800 rounded-lg p-3 bg-blue-50 dark:bg-blue-900/20",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-100 text-sm",children:n.targetProject.name}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 mt-1",children:[n.riskCount," ä¸ªé£é™©å¯èƒ½å½±å“è¯¥é¡¹ç›®"]})]}),e.jsxs("span",{className:"px-2 py-1 bg-blue-200 dark:bg-blue-800 text-blue-800 dark:text-blue-200 rounded text-xs font-medium",children:["å½±å“åº¦: ",n.avgImpact.toFixed(1),"/5"]})]}),n.criticalRisks.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-blue-300 dark:border-blue-700",children:[e.jsxs("p",{className:"text-xs font-medium text-red-600 dark:text-red-400 mb-1",children:["âš ï¸ æé«˜é£é™© (",n.criticalRisks.length,")"]}),n.criticalRisks.slice(0,2).map(a=>e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 truncate",children:["â€¢ ",a.title]},a.id))]})]},n.targetProject.id))})]})]})]}),l&&l.relatedRisks.length>0&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Z,{className:"text-purple-600 dark:text-purple-400",size:20}),e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"é£é™©å…³è”è¯¦æƒ…"})]}),e.jsxs("div",{className:"mb-4 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800",children:[e.jsxs("p",{className:"text-sm font-medium text-purple-900 dark:text-purple-100",children:["å½“å‰é£é™©: ",l.sourceRisk.title]}),e.jsxs("p",{className:"text-xs text-purple-700 dark:text-purple-200 mt-1",children:["åœ¨å…¶ä»–é¡¹ç›®ä¸­å‘ç° ",l.relatedRisks.length," ä¸ªç›¸å…³é£é™©"]})]}),e.jsx("div",{className:"space-y-3",children:l.relatedRisks.slice(0,5).map(n=>{const a=B(n.risk.category),o=$e(n.risk.priority);return e.jsxs(T.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"border border-slate-200 dark:border-slate-700 rounded-lg p-4 hover:border-purple-300 dark:hover:border-purple-600 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("span",{className:"text-lg",children:a.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-100 text-sm",children:n.risk.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:n.project.name})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${o}`,children:n.risk.priority}),e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["å…³è”åº¦: ",(n.correlationScore*100).toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"mt-2 p-2 bg-slate-50 dark:bg-slate-900/50 rounded",children:[e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300",children:[e.jsx("span",{className:"font-medium",children:"å…³è”ç±»å‹:"})," ",n.correlationType==="direct"&&"ç›´æ¥å…³è”",n.correlationType==="indirect"&&"é—´æ¥å…³è”",n.correlationType==="cascading"&&"è¿é”ååº”"]}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 mt-1",children:[e.jsx("span",{className:"font-medium",children:"åŸå› :"})," ",n.reason]})]})]},n.risk.id)})}),l.relatedRisks.length>5&&e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 text-center mt-4",children:["è¿˜æœ‰ ",l.relatedRisks.length-5," ä¸ªç›¸å…³é£é™©æœªæ˜¾ç¤º"]})]}),e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg p-4 border border-indigo-200 dark:border-indigo-800",children:e.jsxs("p",{className:"text-sm text-indigo-900 dark:text-indigo-100",children:["ğŸ’¡ ",e.jsx("strong",{children:"æç¤º:"})," è·¨é¡¹ç›®é£é™©å…³è”åˆ†æå¯ä»¥å¸®åŠ©æ‚¨è¯†åˆ«é¡¹ç›®é—´çš„ä¾èµ–å…³ç³»å’Œæ½œåœ¨è¿é”ååº”ã€‚ å»ºè®®å®šæœŸè¯„å®¡è¿™äº›å…³è”ï¼Œå¹¶ä¸ç›¸å…³é¡¹ç›®å›¢é˜Ÿåè°ƒé£é™©åº”å¯¹æªæ–½ã€‚"]})})]})},bs=()=>{const{projectId:t}=Fe(),s=_e(),{projects:i,updateProject:r,user:l}=qe(),n=i.find(u=>u.id===t),[a,o]=w.useState(null),[c,d]=w.useState(!1),[p,m]=w.useState(!1),[g,v]=w.useState("all"),[h,f]=w.useState("all"),[b,k]=w.useState(new Set);if(!n)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Z,{className:"mx-auto h-12 w-12 text-yellow-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-700 dark:text-slate-200",children:"é¡¹ç›®æœªæ‰¾åˆ°"}),e.jsx("button",{onClick:()=>s("/projects"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"è¿”å›é¡¹ç›®åˆ—è¡¨"})]})});const x=n.risks||[],A=w.useMemo(()=>{const u=x.filter($=>$.status!=="resolved"&&$.status!=="accepted"),y=u.filter($=>$.priority==="critical"),N=Ct(x),M=St(x);return{total:x.length,active:u.length,critical:y.length,resolved:x.filter($=>$.status==="resolved").length,projectRiskScore:N,distribution:M}},[x]),j=w.useMemo(()=>x.filter(u=>!(g!=="all"&&u.category!==g||h!=="all"&&u.status!==h)),[x,g,h]),S=u=>{k(y=>{const N=new Set(y);return N.has(u)?N.delete(u):N.add(u),N})},R=u=>{const y=[...x,u];r(n.id,{risks:y}),d(!1)},I=(u,y)=>{const N=x.map(M=>M.id===u?wt(M,y,(l==null?void 0:l.id)||"system",(l==null?void 0:l.name)||"ç³»ç»Ÿ"):M);r(n.id,{risks:N})},P=u=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé£é™©å—ï¼Ÿ")){const y=x.filter(N=>N.id!==u);r(n.id,{risks:y})}},L=u=>{const y=zt(u,n.id,(l==null?void 0:l.id)||"system"),M={...Me(n.id,y.title,y.category,y.probability,y.impact,y.owner,y.description),mitigationStrategy:y.mitigationStrategy,contingencyPlan:y.contingencyPlan,tags:y.tags};R(M)},F=u=>{const y=D.find(N=>N.id===u);y&&L(y)};return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:["é£é™©ç®¡ç† - ",n.name]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"è¯†åˆ«ã€è¯„ä¼°å’Œç¼“è§£é¡¹ç›®é£é™©"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors",children:[e.jsx(lt,{size:18}),e.jsx("span",{children:"å¯¼å‡º"})]}),e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50",children:[e.jsx("button",{onClick:()=>At(x,n.name),className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm text-slate-700 dark:text-slate-200 rounded-t-lg",children:"ğŸ“„ å¯¼å‡ºä¸º CSV"}),e.jsx("button",{onClick:()=>Rt(x,n.name),className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm text-slate-700 dark:text-slate-200",children:"ğŸ“Š å¯¼å‡ºä¸º Excel"}),e.jsx("button",{onClick:()=>Pt(x,n),className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm text-slate-700 dark:text-slate-200 rounded-b-lg",children:"ğŸ–¨ï¸ æ‰“å° / PDF"})]})]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{children:"ä»æ¨¡æ¿åˆ›å»º"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Q,{size:18}),e.jsx("span",{children:"æ·»åŠ é£é™©"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"æ€»é£é™©æ•°"}),e.jsx("p",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 mt-1",children:A.total})]}),e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(Z,{className:"text-blue-600 dark:text-blue-400",size:24})})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"æ´»è·ƒé£é™©"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400 mt-1",children:A.active})]}),e.jsx("div",{className:"p-3 bg-orange-100 dark:bg-orange-900/30 rounded-lg",children:e.jsx(ie,{className:"text-orange-600 dark:text-orange-400",size:24})})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"æé«˜é£é™©"}),e.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400 mt-1",children:A.critical})]}),e.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 rounded-lg",children:e.jsx(oe,{className:"text-red-600 dark:text-red-400",size:24})})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"å·²è§£å†³"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400 mt-1",children:A.resolved})]}),e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(ge,{className:"text-green-600 dark:text-green-400",size:24})})]})})]}),e.jsx("div",{className:"mb-6",children:e.jsx($t,{risks:x,onRiskClick:u=>o(u)})}),x.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx(Ot,{risks:x})}),e.jsx("div",{className:"mb-6",children:e.jsx(Kt,{project:n,allProjects:i,existingRisks:x,onAcceptSuggestion:F})}),x.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx(Ut,{risks:x,months:6})}),i.length>1&&e.jsx("div",{className:"mb-6",children:e.jsx(es,{currentProject:n,allProjects:i,currentRisk:a||void 0})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(we,{size:18,className:"text-slate-500"}),e.jsxs("select",{value:g,onChange:u=>v(u.target.value),className:"px-3 py-1.5 border border-slate-200 dark:border-slate-600 rounded-lg text-sm bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200",children:[e.jsx("option",{value:"all",children:"æ‰€æœ‰ç±»åˆ«"}),e.jsx("option",{value:"schedule",children:"è¿›åº¦é£é™©"}),e.jsx("option",{value:"cost",children:"æˆæœ¬é£é™©"}),e.jsx("option",{value:"resource",children:"èµ„æºé£é™©"}),e.jsx("option",{value:"technical",children:"æŠ€æœ¯é£é™©"}),e.jsx("option",{value:"external",children:"å¤–éƒ¨é£é™©"}),e.jsx("option",{value:"quality",children:"è´¨é‡é£é™©"}),e.jsx("option",{value:"scope",children:"èŒƒå›´é£é™©"})]}),e.jsxs("select",{value:h,onChange:u=>f(u.target.value),className:"px-3 py-1.5 border border-slate-200 dark:border-slate-600 rounded-lg text-sm bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200",children:[e.jsx("option",{value:"all",children:"æ‰€æœ‰çŠ¶æ€"}),e.jsx("option",{value:"identified",children:"å·²è¯†åˆ«"}),e.jsx("option",{value:"analyzing",children:"åˆ†æä¸­"}),e.jsx("option",{value:"mitigating",children:"ç¼“è§£ä¸­"}),e.jsx("option",{value:"monitoring",children:"ç›‘æ§ä¸­"}),e.jsx("option",{value:"resolved",children:"å·²è§£å†³"}),e.jsx("option",{value:"accepted",children:"å·²æ¥å—"})]}),e.jsxs("div",{className:"ml-auto text-sm text-slate-500 dark:text-slate-400",children:["æ˜¾ç¤º ",j.length," / ",x.length," ä¸ªé£é™©"]})]})}),e.jsx("div",{className:"space-y-4",children:j.length===0?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-12 text-center",children:[e.jsx(oe,{className:"mx-auto h-12 w-12 text-slate-300 dark:text-slate-600 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"æš‚æ— é£é™©"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:'ç‚¹å‡»"æ·»åŠ é£é™©"æŒ‰é’®å¼€å§‹è¯†åˆ«é¡¹ç›®é£é™©'})]}):j.map(u=>{const y=b.has(u.id),N=B(u.category),M=le(u.status);return e.jsxs(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-lg",children:N.icon}),e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:u.title}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${$e(u.priority)}`,children:u.priority.toUpperCase()}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${M.color}`,children:M.label})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-3",children:u.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("span",{children:["æ¦‚ç‡: ",u.probability,"/5"]}),e.jsxs("span",{children:["å½±å“: ",u.impact,"/5"]}),e.jsxs("span",{children:["é£é™©åˆ†æ•°: ",u.riskScore]}),e.jsx("span",{className:N.color,children:N.label})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>S(u.id),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:y?e.jsx(ct,{size:18}):e.jsx(nt,{size:18})}),e.jsx("button",{onClick:()=>o(u),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(ot,{size:18})}),e.jsx("button",{onClick:()=>P(u.id),className:"p-2 hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 rounded-lg transition-colors",children:e.jsx(ke,{size:18})})]})]})}),e.jsx(re,{children:y&&e.jsxs(T.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"ç¼“è§£ç­–ç•¥"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:u.mitigationStrategy||"æš‚æ— ç¼“è§£ç­–ç•¥"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"åº”æ€¥è®¡åˆ’"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:u.contingencyPlan||"æš‚æ— åº”æ€¥è®¡åˆ’"})]})]}),u.mitigationActions.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2",children:["ç¼“è§£æªæ–½ (",u.mitigationActions.length,")"]}),e.jsx("div",{className:"space-y-2",children:u.mitigationActions.map($=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white dark:bg-slate-800 rounded-lg",children:[e.jsx(ge,{size:16,className:$.status==="completed"?"text-green-600":"text-slate-300"}),e.jsx("span",{className:"flex-1 text-sm text-slate-700 dark:text-slate-200",children:$.description}),e.jsx("span",{className:"text-xs text-slate-500",children:$.status})]},$.id))})]})]})})]},u.id)})}),e.jsx(Mt,{isOpen:c||a!==null,onClose:()=>{d(!1),o(null)},onSave:u=>{a?I(u.id,u):R(u),o(null)},projectId:n.id,existingRisk:a,currentUserId:(l==null?void 0:l.id)||"system"}),e.jsx(Et,{isOpen:p,onClose:()=>m(!1),onSelectTemplate:L})]})};export{bs as default};
