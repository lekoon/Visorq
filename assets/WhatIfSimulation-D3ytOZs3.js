import{e as k,u as H,r as u,j as e,I as J,U as A,T as v,i as K,b as Q,A as V}from"./index-DrQGA_Lj.js";import{u as X}from"./usePMOStore-ZHq7-OUm.js";import{B as y,C as g,a as j}from"./Badge-DPYknI8G.js";import{C as E}from"./calendar-DsZ1-ytb.js";import{C as U}from"./circle-check-CTCD94vi.js";import{C as Z}from"./chart-no-axes-column-kfImGh1t.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=k("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=k("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=k("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),ce=()=>{var D,_,T,M,$;const{createSimulation:P,getActiveSimulation:R}=X(),{projects:i,resourcePool:O,user:o}=H(),[h,w]=u.useState(""),[I,B]=u.useState("delay_simulation"),[C,z]=u.useState(!1),[l,b]=u.useState([{id:"1",type:"delay_project",value:14,targetId:(D=i[0])==null?void 0:D.id,targetName:(_=i[0])==null?void 0:_.name}]),x=R(),S=s=>i.map(a=>{const r=s.some(p=>p.targetId===a.id),n=Math.random();let t="none",d=0,c=!1;if(r){const p=s.find(G=>G.targetId===a.id);t="delay",d=Number((p==null?void 0:p.value)||0)}else n>.7&&(t=n>.9?"critical":"resource",d=Math.floor(n*10),c=n>.85);const m=new Date(a.endDate);return m.setDate(m.getDate()+d),{projectId:a.id,projectName:a.name,impactType:t,delayDays:d,resourceConflict:c,riskTrend:d>5?"increasing":"stable",newEndDate:m.toISOString().split("T")[0]}}),W=s=>O.map(a=>{const r=s.some(c=>c.type==="add_project")?15:0,n=s.filter(c=>c.type==="resource_cut").reduce((c,m)=>c+Number(m.value),0),t=60+Math.random()*20,d=Math.min(100,t+r+n);return{resourceType:a.name,originalUtilization:Math.round(t),newUtilization:Math.round(d),isOverloaded:d>90}}),q=()=>{h.trim()&&(z(!0),setTimeout(()=>{const s=S(l),a=Math.max(...s.map(t=>t.delayDays)),r=s.filter(t=>t.resourceConflict).length,n=l.length*5e4+a*2e3;P({name:h,description:`包含 ${l.length} 项变更事项`,scenarioType:I,changes:l.map(t=>({changeType:t.type,targetEntityId:t.targetId||"",targetEntityName:t.targetName||"New Entity",changeDetails:{value:t.value}})),impactAnalysis:{affectedProjects:s.filter(t=>t.impactType!=="none").map(t=>t.projectId),totalDelayDays:a,resourceConflicts:r,budgetImpact:n},createdBy:"current-user",createdByName:"管理员",isActive:!0}),z(!1)},1500))},Y=()=>{var a,r;const s={id:Date.now().toString(),type:"delay_project",value:0,targetId:(a=i[0])==null?void 0:a.id,targetName:(r=i[0])==null?void 0:r.name};b([...l,s])},F=s=>{b(l.filter(a=>a.id!==s))},f=(s,a)=>{b(l.map(r=>{var n;if(r.id===s){const t={...r,...a};return a.targetId&&(t.targetName=(n=i.find(d=>d.id===a.targetId))==null?void 0:n.name),t}return r}))},N=u.useMemo(()=>x?{projects:S(l),resources:W(l)}:null,[x,l]);return e.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-extrabold text-slate-900 dark:text-slate-100 tracking-tight",children:"What-If 沙盘推演中心"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400 mt-1 flex items-center gap-2",children:[e.jsx(J,{size:16})," 模拟复杂环境下的多重决策，量化全局影响与资源瓶颈"]})]}),e.jsx("div",{className:"flex gap-3",children:(o==null?void 0:o.role)==="admin"&&e.jsxs(y,{onClick:()=>{w(""),b([])},variant:"secondary",className:"bg-white dark:bg-slate-800 border-slate-200",children:[e.jsx(se,{className:"w-4 h-4 mr-2"})," 重置画布"]})})]}),e.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-12 gap-8",children:e.jsxs("div",{className:"xl:col-span-12 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsxs(g,{className:"lg:col-span-4 p-6 shadow-sm border-slate-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100 mb-6 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-5 bg-blue-600 rounded-full"}),"1. 模拟基础设定"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wider text-slate-500 mb-2",children:"方案名称"}),e.jsx("input",{type:"text",value:h,onChange:s=>w(s.target.value),className:"w-full px-4 py-2.5 bg-slate-50 dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-700 rounded-xl focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all outline-none",placeholder:"如：双11促销期间资源抽调分析"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wider text-slate-500 mb-2",children:"核心模拟方向"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{value:"new_project",label:"新项准入",icon:e.jsx(L,{size:18})},{value:"delay_simulation",label:"项目波动",icon:e.jsx(E,{size:18})},{value:"resource_change",label:"资源调整",icon:e.jsx(A,{size:18})},{value:"priority_change",label:"优先级洗牌",icon:e.jsx(v,{size:18})}].map(s=>e.jsxs("button",{onClick:()=>B(s.value),className:`flex flex-col items-center justify-center p-4 rounded-xl border-2 transition-all ${I===s.value?"border-blue-600 bg-blue-50 dark:bg-blue-900/20 text-blue-600":"border-slate-100 dark:border-slate-800 hover:border-slate-300"}`,children:[e.jsx("div",{className:"mb-2 opacity-80",children:s.icon}),e.jsx("div",{className:"text-xs font-bold leading-none text-center",children:s.label})]},s.value))})]}),e.jsx("div",{className:"pt-4",children:e.jsx(y,{onClick:q,disabled:C||!h||l.length===0,className:"w-full py-6 rounded-xl shadow-lg shadow-blue-500/20 bg-blue-600 hover:bg-blue-700 group",children:C?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-3 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"正在进行全局拓扑计算..."})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"group-hover:translate-x-1 transition-transform",size:20}),e.jsx("span",{className:"text-lg font-bold",children:"开始运行模拟"})]})})})]})]}),e.jsxs(g,{className:"lg:col-span-8 p-6 shadow-sm border-slate-200 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-5 bg-purple-600 rounded-full"}),"2. 变更影响事项录入"]}),(o==null?void 0:o.role)==="admin"&&e.jsxs(y,{onClick:Y,variant:"secondary",size:"sm",className:"rounded-full gap-2",children:[e.jsx(L,{size:14})," 添加事项"]})]}),e.jsx("div",{className:"flex-1 overflow-auto rounded-xl border border-slate-200 dark:border-slate-800",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800/50 sticky top-0 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-bold uppercase text-slate-500",children:"事项类型"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold uppercase text-slate-500",children:"影响对象"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold uppercase text-slate-500",children:"参数值"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold uppercase text-slate-500"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:[l.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50/50 dark:hover:bg-slate-800/30 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("select",{value:s.type,onChange:a=>f(s.id,{type:a.target.value}),className:"w-full bg-transparent border-none focus:ring-0 p-0 text-sm font-medium text-slate-900 dark:text-slate-100",children:[e.jsx("option",{value:"delay_project",children:"项目延期 (天)"}),e.jsx("option",{value:"add_project",children:"新项准入需求"}),e.jsx("option",{value:"resource_cut",children:"资源削减 (%)"}),e.jsx("option",{value:"priority_shift",children:"优先级异动"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("select",{value:s.targetId||"",onChange:a=>f(s.id,{targetId:a.target.value}),className:"w-full bg-transparent border-none focus:ring-0 p-0 text-sm font-medium text-slate-600 dark:text-slate-400",children:[e.jsx("option",{value:"",children:"选择项目或资源..."}),i.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"number",value:s.value,onChange:a=>f(s.id,{value:a.target.value}),className:"w-20 bg-slate-100 dark:bg-slate-800/50 border-none rounded px-2 py-1 text-sm font-bold text-center"})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>F(s.id),className:"p-1 hover:bg-red-50 text-red-400 hover:text-red-600 rounded-lg transition-colors",children:e.jsx(K,{size:16})})})]},s.id)),l.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-12 text-center text-slate-400 italic",children:"点击右上角添加模拟事项开始分析..."})})]})]})})]})]}),x&&N&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500 space-y-8 mt-12",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[{label:"交付延期波动",value:(T=x.impactAnalysis)==null?void 0:T.totalDelayDays,unit:"天",icon:e.jsx(E,{}),color:"red"},{label:"新增资源冲突",value:(M=x.impactAnalysis)==null?void 0:M.resourceConflicts,unit:"个",icon:e.jsx(A,{}),color:"orange"},{label:"预估预算超支",value:($=x.impactAnalysis)==null?void 0:$.budgetImpact,unit:"CNY",icon:e.jsx(v,{}),color:"blue"},{label:"模拟置信度",value:"88",unit:"%",icon:e.jsx(U,{}),color:"green"}].map((s,a)=>e.jsxs("div",{className:`p-5 rounded-2xl border bg-${s.color}-50/30 border-${s.color}-100 dark:border-${s.color}-900/30`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3 text-slate-500 dark:text-slate-400",children:[e.jsx("span",{className:`text-${s.color}-600`,children:s.icon}),e.jsx("span",{className:"text-xs font-bold uppercase",children:s.label})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:`text-3xl font-black text-${s.color}-600`,children:typeof s.value=="number"?s.value.toLocaleString():s.value}),e.jsx("span",{className:"text-xs font-bold text-slate-400",children:s.unit})]})]},a))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsxs(g,{className:"lg:col-span-5 p-6 shadow-sm border-slate-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100 mb-6 flex items-center gap-2",children:[e.jsx(Z,{size:20,className:"text-blue-600"}),"全局资源占用变化"]}),e.jsx("div",{className:"space-y-6",children:N.resources.map((s,a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm items-center",children:[e.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-300",children:s.resourceType}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-slate-400",children:[s.originalUtilization,"% →"]}),e.jsxs("span",{className:`font-black ${s.isOverloaded?"text-red-600":"text-slate-900 dark:text-slate-100"}`,children:[s.newUtilization,"%"]}),s.isOverloaded&&e.jsx(Q,{size:14,className:"text-red-500 animate-pulse"})]})]}),e.jsxs("div",{className:"h-3 w-full bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden relative",children:[e.jsx("div",{className:"h-full bg-slate-300 dark:bg-slate-600 absolute transition-all duration-1000",style:{width:`${s.originalUtilization}%`}}),e.jsx("div",{className:`h-full absolute transition-all duration-1000 ${s.isOverloaded?"bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.5)]":"bg-blue-500"}`,style:{width:`${s.newUtilization}%`,opacity:.6}})]})]},a))}),e.jsx("div",{className:"mt-8 p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-dashed border-slate-300 dark:border-slate-700",children:e.jsxs("p",{className:"text-xs text-slate-500 leading-relaxed font-medium",children:["分析引擎提示：当前场景下资源瓶颈主要集中在 ",e.jsx("span",{className:"font-bold text-red-600",children:"后端工程师"})," 开发周期内，建议考虑优先级对齐或外部人力补充。"]})})]}),e.jsxs(g,{className:"lg:col-span-7 p-6 shadow-sm border-slate-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100 mb-6 flex items-center gap-2",children:[e.jsx(v,{size:20,className:"text-purple-600"}),"所有项目受影响清单 (Impact List)"]}),e.jsx("div",{className:"overflow-auto max-h-[500px] border border-slate-100 dark:border-slate-800 rounded-xl",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800/80 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-bold text-slate-500",children:"项目名称"}),e.jsx("th",{className:"px-4 py-3 font-bold text-slate-500",children:"模拟排期"}),e.jsx("th",{className:"px-4 py-3 font-bold text-slate-500",children:"差异"}),e.jsx("th",{className:"px-4 py-3 font-bold text-slate-500 text-center",children:"风险指标"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:N.projects.map((s,a)=>e.jsxs("tr",{className:"hover:bg-slate-50/50 dark:hover:bg-slate-800/30 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 font-bold text-slate-900 dark:text-slate-100",children:s.projectName}),e.jsx("td",{className:"px-4 py-4 text-slate-500",children:e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(V,{size:12}),s.newEndDate]})}),e.jsx("td",{className:"px-4 py-4",children:s.delayDays>0?e.jsxs(j,{variant:"danger",size:"sm",children:["+",s.delayDays,"d"]}):e.jsx(j,{variant:"success",size:"sm",children:"无变动"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[s.resourceConflict&&e.jsx(j,{variant:"warning",children:"资源告警"}),s.impactType==="critical"&&e.jsx(j,{variant:"danger",children:"关键路径受损"}),!s.resourceConflict&&s.impactType!=="critical"&&e.jsx("span",{className:"text-green-500",children:e.jsx(U,{size:16})})]})})]},a))})]})})]})]})]})]})})]})})};export{ce as default};
