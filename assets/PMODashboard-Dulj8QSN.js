import{r as k,j as e,C as b,c as h,T as y,g as S,u as T,F as $,U as q}from"./index-DFYgDfrC.js";import{u as F}from"./usePMOStore-BgRtXv76.js";import{C as r}from"./Card-BT7Oa4e6.js";import{a as C,B as j}from"./Badge-BayJ1GXh.js";import{C as D}from"./clock-DNY-RZ--.js";import{T as I}from"./trending-down-DW_L4HxP.js";import{G as P}from"./git-branch-DR_T5a7c.js";const E=({projects:c})=>{const n=k.useMemo(()=>c.filter(s=>s.status==="active").map(s=>{const t=[];let a=100;const f=new Date(s.endDate),v=new Date,i=Math.ceil((f.getTime()-v.getTime())/(1e3*60*60*24));i<0?(t.push({type:"schedule",severity:"high",message:`已延期 ${Math.abs(i)} 天`}),a-=30):i<7&&(t.push({type:"schedule",severity:"medium",message:`即将到期（${i} 天）`}),a-=15);const m=s.actualCost&&s.budget?s.actualCost/s.budget*100:0;m>100?(t.push({type:"budget",severity:"high",message:`预算超支 ${(m-100).toFixed(1)}%`}),a-=25):m>90&&(t.push({type:"budget",severity:"medium",message:`预算使用率 ${m.toFixed(1)}%`}),a-=10);const x=s.tasks||[],d=x.filter(M=>M.status==="completed").length,R=x.length>0?d/x.length*100:0;R<30&&i<30&&(t.push({type:"quality",severity:"high",message:`任务完成率仅 ${R.toFixed(0)}%`}),a-=20),(x.length>20?Math.floor(x.length/4):0)>5&&(t.push({type:"scope",severity:"medium",message:`任务数量较多（${x.length} 个）`}),a-=10);let w="healthy";return a<50?w="critical":a<75&&(w="warning"),{projectId:s.id,projectName:s.name,healthScore:Math.max(0,a),status:w,issues:t}}).sort((s,t)=>s.healthScore-t.healthScore),[c]),o=n.filter(s=>s.status==="critical"),g=n.filter(s=>s.status==="warning"),u=n.filter(s=>s.status==="healthy"),p=s=>{switch(s){case"healthy":return e.jsx(b,{className:"w-5 h-5 text-green-600 dark:text-green-400"});case"warning":return e.jsx(h,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"});case"critical":return e.jsx(h,{className:"w-5 h-5 text-red-600 dark:text-red-400"});default:return e.jsx(D,{className:"w-5 h-5 text-slate-400"})}},l=s=>{switch(s){case"healthy":return"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800";case"warning":return"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800";case"critical":return"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800";default:return"bg-slate-50 dark:bg-slate-800 border-slate-200 dark:border-slate-700"}},N=s=>{switch(s){case"schedule":return e.jsx(D,{className:"w-4 h-4"});case"budget":return e.jsx(I,{className:"w-4 h-4"});case"scope":return e.jsx(y,{className:"w-4 h-4"});default:return e.jsx(h,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(r,{className:"p-4 bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(b,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-sm font-medium text-green-900 dark:text-green-100",children:"健康项目"})]}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:u.length})]}),e.jsxs(r,{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(h,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"}),e.jsx("span",{className:"text-sm font-medium text-yellow-900 dark:text-yellow-100",children:"需关注"})]}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600 dark:text-yellow-400",children:g.length})]}),e.jsxs(r,{className:"p-4 bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(h,{className:"w-5 h-5 text-red-600 dark:text-red-400"}),e.jsx("span",{className:"text-sm font-medium text-red-900 dark:text-red-100",children:"严重问题"})]}),e.jsx("p",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:o.length})]})]}),e.jsxs("div",{className:"space-y-3",children:[n.slice(0,10).map(s=>e.jsxs(r,{className:`p-4 ${l(s.status)}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[p(s.status),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-slate-100",children:s.projectName}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex-1 bg-slate-200 dark:bg-slate-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${s.status==="healthy"?"bg-green-600":s.status==="warning"?"bg-yellow-600":"bg-red-600"}`,style:{width:`${s.healthScore}%`}})}),e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:s.healthScore.toFixed(0)})]})]})]}),e.jsx(C,{variant:s.status==="healthy"?"success":s.status==="warning"?"warning":"danger",children:s.status==="healthy"?"健康":s.status==="warning"?"警告":"严重"})]}),s.issues.length>0&&e.jsx("div",{className:"space-y-1",children:s.issues.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700 dark:text-slate-300",children:[N(t.type),e.jsx("span",{children:t.message}),e.jsx(C,{variant:t.severity==="high"?"danger":t.severity==="medium"?"warning":"neutral",size:"sm",children:t.severity})]},a))})]},s.projectId)),n.length===0&&e.jsxs(r,{className:"p-8 text-center",children:[e.jsx(b,{className:"w-12 h-12 text-slate-300 dark:text-slate-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"暂无活跃项目"})]})]})]})},W=()=>{const c=S(),{projects:n}=T(),{changeRequests:o,environmentResources:g,requirements:u,simulations:p}=F(),l=k.useMemo(()=>{const s=n.filter(d=>d.status==="active"),t=n.length,a=n.filter(d=>d.status==="completed").length,f=o.filter(d=>d.status==="pending").length,v=o.length,i=u.length,m=u.filter(d=>d.status==="completed").length,x=g.filter(d=>d.status==="available").length;return{activeProjects:s.length,totalProjects:t,completedProjects:a,completionRate:t>0?a/t*100:0,pendingChangeRequests:f,totalChangeRequests:v,totalRequirements:i,completedRequirements:m,requirementCompletionRate:i>0?m/i*100:0,availableEnvironments:x,totalEnvironments:g.length,totalSimulations:p.length}},[n,o,u,g,p]),N=k.useMemo(()=>[...o].sort((s,t)=>new Date(t.requestDate).getTime()-new Date(s.requestDate).getTime()).slice(0,5),[o]);return e.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100 mb-2",children:"PMO 战略管控中心"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"项目组合管理、范围防御、资源冲突管控一站式平台"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{onClick:()=>c("/projects"),className:"cursor-pointer",children:e.jsx(r,{className:"p-4 hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(P,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"活跃项目"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:l.activeProjects}),e.jsxs("p",{className:"text-xs text-slate-500",children:["总计 ",l.totalProjects," 个项目"]})]})]})})}),e.jsx(r,{className:"p-4 hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-orange-100 dark:bg-orange-900/30 rounded-lg",children:e.jsx(y,{className:"w-6 h-6 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"待审批变更"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:l.pendingChangeRequests}),e.jsxs("p",{className:"text-xs text-slate-500",children:["总计 ",l.totalChangeRequests," 个变更"]})]})]})}),e.jsx(r,{className:"p-4 hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx($,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"需求完成率"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[l.requirementCompletionRate.toFixed(0),"%"]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[l.completedRequirements," / ",l.totalRequirements]})]})]})}),e.jsx("div",{onClick:()=>c("/environments"),className:"cursor-pointer",children:e.jsx(r,{className:"p-4 hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(q,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"可用环境"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:l.availableEnvironments}),e.jsxs("p",{className:"text-xs text-slate-500",children:["总计 ",l.totalEnvironments," 个环境"]})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(r,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"最近变更请求"}),e.jsx(j,{variant:"ghost",size:"sm",children:"查看全部"})]}),e.jsx("div",{className:"space-y-3",children:N.length>0?N.map(s=>e.jsx("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-slate-900 dark:text-slate-100 text-sm",children:s.title}),e.jsx(C,{variant:s.status==="approved"?"success":s.status==="rejected"?"danger":"warning",size:"sm",children:s.status})]}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:[s.projectName," • ",new Date(s.requestDate).toLocaleDateString()]}),e.jsxs("div",{className:"flex gap-3 mt-1 text-xs text-slate-500",children:[e.jsxs("span",{children:["+",s.estimatedEffortHours,"h"]}),e.jsxs("span",{children:["+¥",s.estimatedCostIncrease]}),e.jsxs("span",{children:["+",s.scheduleImpactDays,"天"]})]})]})},s.id)):e.jsx("div",{className:"text-center py-8 text-slate-400",children:"暂无变更请求"})})]}),e.jsxs(r,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4",children:"项目健康度监控"}),e.jsx(E,{projects:n})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(r,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4",children:"快速操作"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{onClick:()=>c("/simulation"),variant:"primary",className:"w-full justify-start",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"What-If 沙盘推演"]}),e.jsxs(j,{onClick:()=>c("/environments"),variant:"secondary",className:"w-full justify-start",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"环境资源管理"]}),e.jsxs(j,{onClick:()=>c("/portfolio"),variant:"secondary",className:"w-full justify-start",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"项目组合视图"]}),e.jsxs(j,{onClick:()=>c("/dependencies"),variant:"secondary",className:"w-full justify-start",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"依赖关系分析"]})]})]}),e.jsxs(r,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4",children:"系统状态"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"项目完成率"}),e.jsxs("span",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:[l.completionRate.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full transition-all",style:{width:`${l.completionRate}%`}})}),e.jsx("div",{className:"pt-3 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(b,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"系统运行正常"})]})})]})]})]})]})]})})};export{W as default};
