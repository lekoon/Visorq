import{r as h,j as e,C as f,b,z as p,F as k,T as N}from"./index-C4k-wXvD.js";import{c as v,g as C,a as V,f as r,b as w,d as y,e as P,h as E}from"./pmoExportUtils-BI1dYGXZ.js";import{A as j}from"./activity-Dm1QkDHE.js";import{C as A}from"./calendar-DR3tkqjj.js";import{T as S}from"./target-D_67XLam.js";import{D as z}from"./dollar-sign-DqEi0JK_.js";import{R as M,T as I,L as T,y as D}from"./generateCategoricalChart-BPuH_2Ut.js";import{L as $,a as g}from"./LineChart-Baq-u4AD.js";import{C as F,X as L,Y as H}from"./YAxis-BhaWMMQY.js";import{m as K}from"./proxy-B-tCcShI.js";import{D as R}from"./download-DYkczrJR.js";const W=({project:d})=>{const s=h.useMemo(()=>v(d),[d]),x=h.useMemo(()=>C(d,12),[d]),n=h.useMemo(()=>V(s),[s]),l=({icon:a,label:i,value:o,subtitle:c,status:m})=>{const u={good:"border-green-500 bg-green-50 dark:bg-green-900/20",warning:"border-orange-500 bg-orange-50 dark:bg-orange-900/20",critical:"border-red-500 bg-red-50 dark:bg-red-900/20"};return e.jsxs("div",{className:`p-4 rounded-lg border-2 ${m?u[m]:"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"text-slate-600 dark:text-slate-400",children:a}),e.jsx("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:i})]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:o}),c&&e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:c})]})},t=({label:a,value:i,threshold:o})=>{const c=Math.min(i/o*100,150),m=y(i);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:a}),e.jsx("span",{className:`text-lg font-bold ${m}`,children:w(i)})]}),e.jsxs("div",{className:"relative h-3 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:[e.jsx(K.div,{initial:{width:0},animate:{width:`${c}%`},transition:{duration:1,ease:"easeOut"},className:`absolute top-0 left-0 h-full rounded-full ${i>=1.05?"bg-green-500":i>=.95?"bg-blue-500":i>=.85?"bg-orange-500":"bg-red-500"}`}),e.jsx("div",{className:"absolute top-0 h-full w-0.5 bg-slate-900 dark:bg-slate-100",style:{left:`${o/1.5*100}%`}})]}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 dark:text-slate-400",children:[e.jsx("span",{children:"0.0"}),e.jsx("span",{children:"1.0 (目标)"}),e.jsx("span",{children:"1.5"})]})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 flex items-center gap-2",children:[e.jsx(j,{className:"text-blue-600 dark:text-blue-400",size:28}),"挣值管理 (EVM)"]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"Earned Value Management - 财务绩效分析"})]}),e.jsx("div",{className:`px-4 py-2 rounded-lg ${n.overallHealth==="good"?"bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-400":n.overallHealth==="warning"?"bg-orange-100 dark:bg-orange-900/20 text-orange-700 dark:text-orange-400":"bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-400"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[n.overallHealth==="good"?e.jsx(f,{size:20}):n.overallHealth==="warning"?e.jsx(b,{size:20}):e.jsx(b,{size:20}),e.jsx("span",{className:"font-bold",children:n.overallHealth==="good"?"健康":n.overallHealth==="warning"?"警告":"风险"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(l,{icon:e.jsx(A,{size:20}),label:"计划价值 (PV)",value:r(s.plannedValue),subtitle:"应该完成的工作价值"}),e.jsx(l,{icon:e.jsx(S,{size:20}),label:"挣值 (EV)",value:r(s.earnedValue),subtitle:"实际完成的工作价值",status:s.earnedValue>=s.plannedValue?"good":s.earnedValue>=s.plannedValue*.9?"warning":"critical"}),e.jsx(l,{icon:e.jsx(z,{size:20}),label:"实际成本 (AC)",value:r(s.actualCost),subtitle:"实际花费的成本",status:s.actualCost<=s.earnedValue?"good":s.actualCost<=s.earnedValue*1.1?"warning":"critical"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100 mb-4",children:"S 曲线分析"}),e.jsx(M,{width:"100%",height:350,children:e.jsxs($,{data:x,children:[e.jsx(F,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(L,{dataKey:"date",tick:{fontSize:12},tickFormatter:a=>new Date(a).toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}),e.jsx(H,{tick:{fontSize:12},tickFormatter:a=>`¥${(a/1e4).toFixed(0)}万`}),e.jsx(I,{formatter:a=>r(a),labelFormatter:a=>new Date(a).toLocaleDateString("zh-CN")}),e.jsx(T,{}),e.jsx(D,{y:d.budget||0,stroke:"#94a3b8",strokeDasharray:"3 3",label:"预算"}),e.jsx(g,{type:"monotone",dataKey:"pv",stroke:"#3b82f6",strokeWidth:2,name:"计划价值 (PV)",dot:!1}),e.jsx(g,{type:"monotone",dataKey:"ev",stroke:"#10b981",strokeWidth:2,name:"挣值 (EV)",dot:!1}),e.jsx(g,{type:"monotone",dataKey:"ac",stroke:"#ef4444",strokeWidth:2,name:"实际成本 (AC)",dot:!1})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:"绩效指数"}),e.jsx(t,{label:"进度绩效指数 (SPI)",value:s.schedulePerformanceIndex,threshold:1}),e.jsx(t,{label:"成本绩效指数 (CPI)",value:s.costPerformanceIndex,threshold:1}),e.jsxs("div",{className:"pt-4 border-t border-slate-200 dark:border-slate-700 text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"SPI > 1.0:"})," 进度超前 | ",e.jsx("strong",{children:"SPI < 1.0:"})," 进度落后"]}),e.jsxs("p",{className:"mt-1",children:[e.jsx("strong",{children:"CPI > 1.0:"})," 成本节约 | ",e.jsx("strong",{children:"CPI < 1.0:"})," 成本超支"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100 mb-4",children:"偏差与预测"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-900/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"进度偏差 (SV)"}),e.jsxs("span",{className:`text-lg font-bold ${s.scheduleVariance>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[s.scheduleVariance>=0?"+":"",r(s.scheduleVariance)]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-900/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"成本偏差 (CV)"}),e.jsxs("span",{className:`text-lg font-bold ${s.costVariance>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[s.costVariance>=0?"+":"",r(s.costVariance)]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-900/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"完工估算 (EAC)"}),e.jsx("span",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:r(s.estimateAtCompletion)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-900/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"完工尚需估算 (ETC)"}),e.jsx("span",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:r(s.estimateToComplete)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-900/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"完工偏差 (VAC)"}),e.jsxs("span",{className:`text-lg font-bold ${s.varianceAtCompletion>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[s.varianceAtCompletion>=0?"+":"",r(s.varianceAtCompletion)]})]})]})]})]})]})},ee=()=>{const d=p(),s=d.filter(t=>t.status==="active"||t.status==="planning"),[x,n]=h.useState(s.length>0?s[0].id:""),l=d.find(t=>t.id===x);return s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-96 bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsx(b,{size:64,className:"text-slate-300 dark:text-slate-600 mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-slate-100 mb-2",children:"暂无活跃项目"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"创建项目后即可查看挣值管理分析"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100 flex items-center gap-3",children:[e.jsx(j,{className:"text-blue-600 dark:text-blue-400",size:32}),"挣值管理分析"]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Earned Value Management - 项目财务绩效可视化"})]}),l&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>P(l),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(R,{size:16}),"导出 CSV"]}),e.jsxs("button",{onClick:()=>E(l),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(k,{size:16}),"导出 PDF"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"选择项目"}),e.jsx("select",{value:x,onChange:t=>n(t.target.value),className:"w-full md:w-96 px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:s.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - ",t.manager||"未分配"]},t.id))})]}),l&&e.jsx(W,{project:l}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-xl shadow-sm border border-blue-200 dark:border-blue-800 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100 mb-4 flex items-center gap-2",children:[e.jsx(N,{className:"text-blue-600 dark:text-blue-400",size:20}),"EVM 指标说明"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"核心指标"}),e.jsxs("ul",{className:"space-y-1 text-slate-700 dark:text-slate-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"PV (计划价值):"})," 按计划应该完成的工作价值"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"EV (挣值):"})," 实际完成的工作价值"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"AC (实际成本):"})," 实际花费的成本"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"绩效指数"}),e.jsxs("ul",{className:"space-y-1 text-slate-700 dark:text-slate-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"SPI (进度绩效指数):"})," EV / PV，衡量进度效率"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"CPI (成本绩效指数):"})," EV / AC，衡量成本效率"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"TCPI (完工尚需绩效指数):"})," 剩余工作需要的效率"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"偏差指标"}),e.jsxs("ul",{className:"space-y-1 text-slate-700 dark:text-slate-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"SV (进度偏差):"})," EV - PV，正值表示进度超前"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"CV (成本偏差):"})," EV - AC，正值表示成本节约"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"预测指标"}),e.jsxs("ul",{className:"space-y-1 text-slate-700 dark:text-slate-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"EAC (完工估算):"})," 预计项目总成本"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"ETC (完工尚需估算):"})," 完成项目还需多少成本"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"VAC (完工偏差):"})," 预算 - EAC，预计的成本偏差"]})]})]})]})]})]})};export{ee as default};
