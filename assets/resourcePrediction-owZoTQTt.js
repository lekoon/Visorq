import{a as x}from"./addMonths-BTXB9jOG.js";import{f as L}from"./format-BhZiItnY.js";import{p as $}from"./index-DJ7gcr39.js";const S=(n,s=3)=>{if(n.length===0)return 0;n.length<s&&(s=n.length);const e=n.slice(-s);return e.reduce((r,i)=>r+i,0)/e.length},D=n=>{const s=n.length;if(s===0)return{slope:0,intercept:0};let e=0,r=0,i=0,t=0;for(let o=0;o<s;o++)e+=o,r+=n[o],i+=o*n[o],t+=o*o;const c=(s*i-e*r)/(s*t-e*e),a=(r-c*e)/s;return{slope:c,intercept:a}},k=(n,s,e=12)=>{var t;const r=new Date,i=[];for(let c=e;c>0;c--){const a=x(r,-c),o=L(a,"yyyy-MM");let h=0;for(const d of s){if(!d.startDate||!d.endDate)continue;const m=$(d.startDate),u=$(d.endDate),g=new Date(a.getFullYear(),a.getMonth(),1),l=new Date(a.getFullYear(),a.getMonth()+1,0);if(m<=l&&u>=g){const f=(t=d.resourceRequirements)==null?void 0:t.find(M=>M.resourceId===n.id);f&&(h+=f.count)}}i.push({month:o,load:h})}return i},N=(n,s,e=6,r="sma")=>{const i=k(n,s,12),t=i.map(l=>l.load),{slope:c}=D(t);let a="stable";c>.5?a="increasing":c<-.5&&(a="decreasing");const o=[],h=new Date;for(let l=1;l<=e;l++){const f=x(h,l),M=L(f,"yyyy-MM");let p=0,y=100;if(r==="sma")p=S(t,3),y=Math.max(50,100-l*10);else{const{slope:I,intercept:Q}=D(t);p=I*(t.length+l)+Q,y=Math.max(40,100-l*12)}p=Math.max(0,Math.round(p)),p=Math.min(n.totalQuantity*1.5,p),o.push({month:M,predicted:p,confidence:y})}const d=[...t,...o.map(l=>l.predicted)],m=Math.max(...d),u=d.indexOf(m),g=u<t.length?i[u].month:o[u-t.length].month;return{resourceId:n.id,resourceName:n.name,predictions:o,trend:a,peakMonth:g,peakLoad:m}},j=(n,s,e=6)=>n.map(r=>N(r,s,e)),v=(n,s)=>{const e=[],r=[];for(const t of n){const c=s.find(h=>h.id===t.resourceId);if(!c)continue;const a=t.predictions.filter(h=>h.predicted>c.totalQuantity);a.length>0&&e.push(`${t.resourceName} 预计在 ${a[0].month} 开始超载，峰值 ${t.peakLoad}/${c.totalQuantity}`);const o=t.predictions.filter(h=>h.predicted<c.totalQuantity*.3);o.length>=3&&r.push(`${t.resourceName} 未来 ${o.length} 个月利用率较低，可承接新项目`),t.trend==="increasing"&&t.predictions[t.predictions.length-1].predicted>c.totalQuantity*.8&&e.push(`${t.resourceName} 需求呈上升趋势，建议提前规划扩充`)}let i="";return e.length>0&&(i+=`发现 ${e.length} 个潜在风险。`),r.length>0&&(i+=`发现 ${r.length} 个优化机会。`),e.length===0&&r.length===0&&(i="资源负载预测正常，无明显风险。"),{warnings:e,opportunities:r,summary:i}};export{j as a,v as b,N as p};
