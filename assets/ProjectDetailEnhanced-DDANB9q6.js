import{e as H,r as C,j as e,X as le,p as L,d as X,U as me,T as ae,b as J,C as oe,S as ge,c as Ce,F as Me,u as Ve,h as Ie,I as st,k as lt,f as De,l as at,m as rt,n as nt,o as it,q as ot,R as dt,s as ct,g as xt,v as mt,P as ut,w as ht}from"./index-DSFjr4LC.js";import{G as pt}from"./grip-vertical-BG96XePY.js";import{f as I,s as fe}from"./format-ct7SPijh.js";import{c as bt,E as gt,S as ft}from"./EnhancedResourceTimeline-3jFpocQn.js";import{a as O}from"./eachDayOfInterval-DW-xx3sg.js";import{D as Se}from"./download-CxXFJODp.js";import{m as V}from"./proxy-Bhx3FPuK.js";import{A as ze,N as jt}from"./index-CaiY4BTd.js";import{s as je}from"./startOfMonth-mNF6d_xI.js";import{C as ue}from"./calendar-DV25Uk9k.js";import{P as de}from"./plus-CeETbQg1.js";import{C as vt}from"./chevron-down-D9b3n4d0.js";import{C as We}from"./chevron-right-CZbCw5Jy.js";import{C as yt}from"./circle-check-DpgtuQ6L.js";import{C as Xe}from"./clock-DM8iXjrD.js";import{Z as ee}from"./zap-BCkgjk6T.js";import{C as Nt}from"./chart-no-axes-column-BTZciVyh.js";import{D as se}from"./dollar-sign-BAYeXQUA.js";import{R as ye,C as wt,T as Ne,L as Ye}from"./generateCategoricalChart-DOu4sEKH.js";import{P as kt,a as Ct,b as Mt,c as Dt}from"./PieChart-0xBMv0O7.js";import{L as St,a as zt}from"./LineChart-CTVxPC7B.js";import{C as $t,X as Pt,Y as Rt}from"./YAxis-DYKocO6l.js";import{T as $e}from"./target-Br11xYyw.js";import{R as Bt,P as It,a as Ft}from"./RadarChart-DfUxw34b.js";import{T as Ue}from"./trending-down-Ds5j0a5S.js";import{A as Fe}from"./activity-oOeqT2p4.js";import{a as Ae,B as At}from"./Badge-DXvP_LPB.js";import{P as Tt}from"./pen-Bo95hL54.js";import"./endOfWeek-DN8d9PiE.js";import"./endOfDay-CMbOZJYO.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=H("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=H("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=H("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=H("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=H("GitMerge",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=H("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=H("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=H("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=H("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=H("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=H("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=H("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=H("Redo2",[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=H("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=H("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=H("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Ut=({task:r,onSave:c,onDelete:l,onClose:i})=>{const[o,t]=C.useState(r),a=()=>{c(o),i()},d=()=>{l&&window.confirm("确定要删除这个任务吗？")&&(l(r.id),i())};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm",onClick:i,children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl shadow-2xl p-6 max-h-[90vh] overflow-y-auto",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"编辑任务"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(le,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"任务名称"}),e.jsx("input",{type:"text",value:o.name,onChange:s=>t({...o,name:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"描述"}),e.jsx("textarea",{value:o.description||"",onChange:s=>t({...o,description:s.target.value}),rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"开始日期"}),e.jsx("input",{type:"date",value:o.startDate,onChange:s=>t({...o,startDate:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"结束日期"}),e.jsx("input",{type:"date",value:o.endDate,onChange:s=>t({...o,endDate:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"状态"}),e.jsxs("select",{value:o.status,onChange:s=>t({...o,status:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[e.jsx("option",{value:"planning",children:"规划中"}),e.jsx("option",{value:"active",children:"进行中"}),e.jsx("option",{value:"completed",children:"已完成"}),e.jsx("option",{value:"on-hold",children:"暂停"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"优先级"}),e.jsxs("select",{value:o.priority,onChange:s=>t({...o,priority:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[e.jsx("option",{value:"P0",children:"P0 - 紧急"}),e.jsx("option",{value:"P1",children:"P1 - 高"}),e.jsx("option",{value:"P2",children:"P2 - 中"}),e.jsx("option",{value:"P3",children:"P3 - 低"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"类型"}),e.jsxs("select",{value:o.type,onChange:s=>t({...o,type:s.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[e.jsx("option",{value:"task",children:"任务"}),e.jsx("option",{value:"milestone",children:"里程碑"}),e.jsx("option",{value:"group",children:"任务组"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["进度: ",o.progress||0,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:o.progress||0,onChange:s=>t({...o,progress:parseInt(s.target.value)}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"颜色"}),e.jsx("div",{className:"flex gap-2",children:["#3B82F6","#8B5CF6","#10B981","#F59E0B","#EF4444","#6B7280"].map(s=>e.jsx("button",{onClick:()=>t({...o,color:s}),className:`w-10 h-10 rounded-lg border-2 transition-all ${o.color===s?"border-slate-900 scale-110":"border-slate-200"}`,style:{backgroundColor:s}},s))})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-slate-200",children:[l&&e.jsx("button",{onClick:d,className:"px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:"删除任务"}),e.jsxs("div",{className:"flex gap-3 ml-auto",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:"取消"}),e.jsx("button",{onClick:a,className:"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors",children:"保存"})]})]})]})]})})},_t=({tasks:r,onTaskUpdate:c,onTaskClick:l})=>{const[i,o]=C.useState(null),t=[{id:"planning",label:"规划中",color:"bg-blue-50 border-blue-200"},{id:"active",label:"进行中",color:"bg-green-50 border-green-200"},{id:"completed",label:"已完成",color:"bg-purple-50 border-purple-200"},{id:"on-hold",label:"暂停",color:"bg-orange-50 border-orange-200"}],a=m=>r.filter(b=>(b.status||"planning")===m),d=(m,b)=>{o(b),m.dataTransfer.effectAllowed="move"},s=m=>{m.preventDefault(),m.dataTransfer.dropEffect="move"},f=(m,b)=>{m.preventDefault(),i&&i.status!==b&&c({...i,status:b}),o(null)};return e.jsx("div",{className:"h-full overflow-x-auto p-4 bg-slate-50",children:e.jsx("div",{className:"flex gap-4 min-w-max h-full",children:t.map(m=>{const b=a(m.id);return e.jsxs("div",{className:"flex-1 min-w-[300px] flex flex-col",onDragOver:s,onDrop:x=>f(x,m.id),children:[e.jsx("div",{className:`rounded-t-lg border-2 ${m.color} p-3 mb-2`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:m.label}),e.jsx("span",{className:"px-2 py-0.5 bg-white rounded-full text-xs font-medium text-slate-600",children:b.length})]})}),e.jsxs("div",{className:"flex-1 space-y-2 overflow-y-auto",children:[b.map(x=>e.jsx("div",{draggable:!0,onDragStart:w=>d(w,x),onClick:()=>l(x),className:`bg-white rounded-lg border border-slate-200 p-3 cursor-move hover:shadow-md transition-all ${(i==null?void 0:i.id)===x.id?"opacity-50":""}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(pt,{size:16,className:"text-slate-400 mt-1 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-slate-900 mb-1 truncate",children:x.name}),x.description&&e.jsx("p",{className:"text-xs text-slate-600 mb-2 line-clamp-2",children:x.description}),e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[x.priority&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${x.priority==="P0"?"bg-red-100 text-red-700":x.priority==="P1"?"bg-orange-100 text-orange-700":x.priority==="P2"?"bg-yellow-100 text-yellow-700":"bg-slate-100 text-slate-700"}`,children:x.priority}),x.type&&x.type!=="task"&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs font-medium",children:x.type==="milestone"?"里程碑":"任务组"})]}),e.jsxs("div",{className:"text-xs text-slate-500 mb-2",children:[I(L(x.startDate),"MM/dd")," - ",I(L(x.endDate),"MM/dd")]}),x.progress!==void 0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs text-slate-600",children:"进度"}),e.jsxs("span",{className:"text-xs font-medium text-slate-900",children:[x.progress,"%"]})]}),e.jsx("div",{className:"h-1.5 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${x.progress}%`,backgroundColor:x.color||"#3B82F6"}})})]})]})]})},x.id)),b.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 text-sm",children:"暂无任务"})]})]},m.id)})})})},Ee=180,xe=80,Ge=250,Zt=120,Qt=({tasks:r})=>{const[c,l]=C.useState(1),[i,o]=C.useState({x:50,y:50}),[t,a]=C.useState(!1),[d,s]=C.useState({x:0,y:0}),{nodes:f,edges:m,width:b,height:x}=C.useMemo(()=>{const N=bt(r),j=new Map,h=new Map,n=(v,S=new Set)=>{if(S.has(v))return 0;S.add(v);const R=r.find(Y=>Y.id===v);if(!R)return 0;const F=R.dependencies||[];if(F.length===0)return 0;let z=-1;return F.forEach(Y=>{z=Math.max(z,n(Y,new Set(S)))}),z+1};r.forEach(v=>{const S=n(v.id),R=N.criticalPath.includes(v.id),F={id:v.id,task:v,x:0,y:0,width:Ee,height:xe,level:S,isCritical:R};j.set(v.id,F),h.has(S)||h.set(S,[]),h.get(S).push(F)});let g=0,y=0;h.forEach((v,S)=>{g=Math.max(g,S),v.sort((F,z)=>F.task.startDate.localeCompare(z.task.startDate));const R=50;v.forEach((F,z)=>{F.x=S*Ge,F.y=R+z*Zt,y=Math.max(y,F.y+xe)})});const p=[];return r.forEach(v=>{v.dependencies&&v.dependencies.forEach(S=>{if(j.has(S)){const R=N.criticalPath.includes(v.id)&&N.criticalPath.includes(S);p.push({from:S,to:v.id,isCritical:R})}})}),{nodes:Array.from(j.values()),edges:p,width:(g+1)*Ge+100,height:y+100}},[r]),w=N=>{a(!0),s({x:N.clientX-i.x,y:N.clientY-i.y})},$=N=>{t&&o({x:N.clientX-d.x,y:N.clientY-d.y})},B=()=>{a(!1)},M=N=>{if(N.ctrlKey||N.metaKey){N.preventDefault();const j=N.deltaY>0?.9:1.1;l(h=>Math.min(2,Math.max(.2,h*j)))}};return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 shadow-sm flex flex-col h-[600px]",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 bg-slate-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ht,{size:20,className:"text-blue-600"}),e.jsx("h3",{className:"font-semibold text-slate-900",children:"任务网络图 (PERT)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>l(N=>Math.max(.2,N-.1)),className:"p-2 hover:bg-slate-200 rounded text-slate-600",title:"缩小",children:e.jsx(Ze,{size:18})}),e.jsxs("span",{className:"text-sm text-slate-500 w-12 text-center",children:[Math.round(c*100),"%"]}),e.jsx("button",{onClick:()=>l(N=>Math.min(2,N+.1)),className:"p-2 hover:bg-slate-200 rounded text-slate-600",title:"放大",children:e.jsx(_e,{size:18})}),e.jsx("button",{onClick:()=>{l(1),o({x:50,y:50})},className:"p-2 hover:bg-slate-200 rounded text-slate-600",title:"重置视图",children:e.jsx(Vt,{size:18})})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden relative cursor-grab active:cursor-grabbing bg-slate-50",onMouseDown:w,onMouseMove:$,onMouseUp:B,onMouseLeave:B,onWheel:M,children:e.jsxs("div",{style:{transform:`translate(${i.x}px, ${i.y}px) scale(${c})`,transformOrigin:"0 0",transition:t?"none":"transform 0.1s ease-out"},children:[e.jsxs("svg",{width:b,height:x,className:"pointer-events-none",children:[e.jsxs("defs",{children:[e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#94a3b8"})}),e.jsx("marker",{id:"arrowhead-critical",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#ef4444"})})]}),m.map((N,j)=>{const h=f.find(U=>U.id===N.from),n=f.find(U=>U.id===N.to),g=h.x+Ee,y=h.y+xe/2,p=n.x,v=n.y+xe/2,S=g+(p-g)/2,R=y,F=g+(p-g)/2,Y=`M ${g} ${y} C ${S} ${R}, ${F} ${v}, ${p} ${v}`;return e.jsx("path",{d:Y,stroke:N.isCritical?"#ef4444":"#94a3b8",strokeWidth:N.isCritical?3:2,fill:"none",markerEnd:N.isCritical?"url(#arrowhead-critical)":"url(#arrowhead)",strokeDasharray:N.isCritical?"none":"5,5"},j)})]}),f.map(N=>e.jsxs("div",{className:`absolute rounded-lg border-2 shadow-sm p-3 flex flex-col justify-between transition-colors hover:shadow-md pointer-events-auto ${N.isCritical?"bg-red-50 border-red-500":"bg-white border-slate-300 hover:border-blue-400"}`,style:{left:N.x,top:N.y,width:N.width,height:N.height},children:[e.jsx("div",{className:"font-medium text-sm text-slate-900 truncate",title:N.task.name,children:N.task.name}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500",children:[e.jsx("span",{children:N.task.startDate}),e.jsxs("span",{children:[X(L(N.task.endDate),L(N.task.startDate)),"天"]})]}),N.isCritical&&e.jsx("div",{className:"absolute -top-2 -right-2 w-4 h-4 bg-red-500 rounded-full border-2 border-white",title:"关键路径"})]},N.id))]})}),e.jsxs("div",{className:"p-2 bg-white border-t border-slate-200 flex gap-4 text-xs justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-white border-2 border-slate-300 rounded"}),e.jsx("span",{children:"普通任务"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-50 border-2 border-red-500 rounded"}),e.jsx("span",{children:"关键路径任务"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-slate-400 border-t border-dashed"}),e.jsx("span",{children:"依赖关系"})]})]})]})},te=48,Jt=({tasks:r,milestones:c=[],onTaskUpdate:l,onTaskDelete:i,onTaskAdd:o,onMilestoneAdd:t,onMilestoneUpdate:a,onMilestoneDelete:d,onDependencyAdd:s,onDependencyDelete:f,onEditTask:m})=>{const b=C.useRef(null),[x,w]=C.useState("Day"),[$,B]=C.useState(1),[M,N]=C.useState({x:0,y:0}),[j,h]=C.useState(!1),[n,g]=C.useState({x:0,y:0}),[y,p]=C.useState(new Set),[v,S]=C.useState(!0),[R,F]=C.useState(null),[z,Y]=C.useState(!1),[U,Pe]=C.useState(null),[_,ce]=C.useState(null),{startDate:Z,totalDays:K}=C.useMemo(()=>{if(r.length===0){const A=fe(new Date);return{startDate:A,endDate:O(A,30),totalDays:30}}const u=r.flatMap(A=>[new Date(A.startDate).getTime(),new Date(A.endDate).getTime()]),k=new Date(Math.min(...u)),P=new Date(Math.max(...u)),T=O(fe(k),-7),E=O(P,14);return{startDate:T,endDate:E,totalDays:X(E,T)}},[r]),G=(()=>{switch(x){case"Week":return 20;case"Month":return 8;default:return 50}})()*$,Q=u=>{const k=typeof u=="string"?L(u):u;return X(k,Z)*G},Qe=u=>{(u.target===b.current||u.target.tagName==="svg")&&u.button===0&&(h(!0),g({x:u.clientX+M.x,y:u.clientY+M.y}))},Je=u=>{if(j){N({x:n.x-u.clientX,y:n.y-u.clientY});return}if(_&&b.current){const k=b.current.getBoundingClientRect();ce(P=>P?{...P,endX:u.clientX-k.left-M.x,endY:u.clientY-k.top-M.y}:null)}if(U){const k=r.find(E=>E.id===U.id);if(!k)return;const P=u.clientX-U.startX,T=Math.round(P/G);if(T===0)return;try{const E=JSON.parse(U.status||"{}");if(!E.start||!E.end)return;const A=L(E.start),q=L(E.end);if(U.type==="move"){const D=O(A,T),W=O(q,T);I(D,"yyyy-MM-dd")!==k.startDate&&l({...k,startDate:I(D,"yyyy-MM-dd"),endDate:I(W,"yyyy-MM-dd")})}else if(U.type==="resize-l"){const D=O(A,T);X(q,D)>0&&l({...k,startDate:I(D,"yyyy-MM-dd")})}else if(U.type==="resize-r"){const D=O(q,T);X(D,A)>0&&l({...k,endDate:I(D,"yyyy-MM-dd")})}}catch(E){console.error(E)}}},Re=()=>{j&&h(!1),_&&ce(null),U&&Pe(null)},Ke=u=>{if(u.ctrlKey||u.metaKey){u.preventDefault();const k=-u.deltaY;B(P=>Math.min(3,Math.max(.1,P+k*.001)))}else N(k=>({x:k.x+u.deltaX,y:k.y+u.deltaY}))},he=(u,k,P)=>{u.stopPropagation(),Pe({id:k.id,type:P,startX:u.clientX,status:JSON.stringify({start:k.startDate,end:k.endDate})})},et=(u,k)=>{if(u.stopPropagation(),b.current){const P=b.current.getBoundingClientRect();ce({sourceId:k,endX:u.clientX-P.left-M.x,endY:u.clientY-P.top-M.y})}},Be=(u,k)=>{u.stopPropagation(),_&&_.sourceId!==k&&s&&s(_.sourceId,k),ce(null)},tt=()=>{const u=[];let k=je(Z);const P=O(Z,K);for(;k<=P;)u.push(k),k=O(k,32),k=je(k);const T=G>=20,E=G>=5&&G<20;return e.jsx("div",{className:"h-12 bg-white border-b flex-shrink-0 relative overflow-hidden z-20 shadow-sm select-none",children:e.jsxs("div",{className:"absolute top-0 left-0 h-full",style:{transform:`translate(${-M.x}px, 0px)`,width:K*G},children:[e.jsx("div",{className:"h-1/2 border-b flex relative bg-slate-50 text-xs font-semibold text-slate-600",children:u.map((A,q)=>{const D=Q(A),W=O(A,32),pe=je(W);let be=X(pe,A)*G;return e.jsx("div",{className:"absolute top-0 border-r flex items-center px-2 whitespace-nowrap overflow-hidden",style:{left:D,width:be,height:"100%"},children:I(A,"yyyy年 M月")},q)})}),e.jsx("div",{className:"h-1/2 relative bg-white text-[10px] text-slate-500",children:T?Array.from({length:K}).map((A,q)=>{const D=O(Z,q),W=D.getDay()===0||D.getDay()===6;return e.jsx("div",{className:`absolute border-r h-full flex items-center justify-center ${W?"bg-slate-50 text-slate-400":""}`,style:{left:q*G,width:G},children:I(D,"d")},q)}):E?(()=>{const A=[];let q=fe(Z,{weekStartsOn:1});const D=O(Z,K);for(;q<D;)A.push(q),q=O(q,7);return A.map((W,pe)=>{const be=Q(W);return e.jsx("div",{className:"absolute border-r h-full flex items-center justify-center px-1",style:{left:be,width:7*G},children:I(W,"d")},pe)})})():e.jsx("div",{className:"w-full h-full flex items-center pl-2 text-slate-300",children:"..."})})]})})};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-50 border rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"h-12 bg-white border-b flex items-center px-4 justify-between z-30 relative shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex bg-slate-100 p-0.5 rounded-lg mr-2",children:["Day","Week","Month"].map(u=>e.jsx("button",{onClick:()=>{var P;const k=((P=b.current)==null?void 0:P.clientWidth)||800;M.x+k/2,w(u)},className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${x===u?"bg-white shadow-sm text-blue-600":"text-slate-500 hover:text-slate-700"}`,children:u==="Day"?"日":u==="Week"?"周":"月"},u))}),e.jsx("button",{onClick:()=>B(u=>Math.max(.1,u-.1)),className:"p-1.5 hover:bg-slate-100 rounded text-slate-600",children:e.jsx(Ze,{size:18})}),e.jsxs("span",{className:"text-sm font-medium w-12 text-center",children:[($*100).toFixed(0),"%"]}),e.jsx("button",{onClick:()=>B(u=>Math.min(3,u+.1)),className:"p-1.5 hover:bg-slate-100 rounded text-slate-600",children:e.jsx(_e,{size:18})}),e.jsx("div",{className:"w-px h-6 bg-slate-200 mx-1"}),e.jsx("button",{onClick:()=>S(!v),className:`p-1.5 rounded transition-colors ${v?"bg-blue-50 text-blue-600 hover:bg-blue-100":"text-slate-600 hover:bg-slate-100"}`,title:v?"隐藏网格线":"显示网格线",children:e.jsx(qt,{size:18})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-1.5 hover:bg-slate-100 rounded text-slate-600",children:e.jsx(Yt,{size:18})}),e.jsx("button",{className:"p-1.5 hover:bg-slate-100 rounded text-slate-600",children:e.jsx(Xt,{size:18})}),e.jsx("div",{className:"w-px h-6 bg-slate-200 mx-1"}),e.jsx("button",{className:"p-1.5 hover:bg-slate-100 rounded text-slate-600",children:e.jsx(Se,{size:18})})]})]}),tt(),e.jsx("div",{className:"flex-1 relative overflow-hidden cursor-grab active:cursor-grabbing select-none bg-slate-50",ref:b,onMouseDown:Qe,onMouseMove:Je,onMouseUp:Re,onMouseLeave:Re,onWheel:Ke,onContextMenu:u=>u.preventDefault(),children:e.jsxs("div",{className:"absolute transition-transform duration-75 ease-out origin-top-left",style:{transform:`translate(${-M.x}px, ${-M.y}px)`},children:[e.jsxs("div",{className:"absolute top-0 bottom-0 left-0 right-0 flex pointer-events-none z-0",children:[Array.from({length:K}).map((u,k)=>{const P=O(Z,k);return P.getDay()===0||P.getDay()===6?e.jsx("div",{className:"absolute top-0 bottom-0 bg-slate-100/20",style:{left:k*G,width:G}},`weekend-${k}`):null}),v&&G>5&&Array.from({length:K}).map((u,k)=>{const P=O(Z,k),T=P.getDate()===1,E=P.getDay()===1;return T||G>20&&E?e.jsx("div",{className:"absolute top-0 bottom-0",style:{left:k*G,borderLeft:T?"1px solid rgba(148, 163, 184, 0.3)":"1px dashed rgba(203, 213, 225, 0.3)"}},`grid-${k}`):null}),e.jsx("div",{className:"absolute top-0 bottom-0 border-l-2 border-red-500 z-10 pointer-events-none",style:{left:Q(new Date)},children:e.jsx("div",{className:"absolute -top-1 -left-1 w-2 h-2 rounded-full bg-red-500"})})]}),e.jsxs("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none overflow-visible z-0",children:[e.jsx("defs",{children:e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#94a3b8"})})}),r.flatMap(u=>(u.dependencies||[]).map(k=>{const P=r.find(W=>W.id===k);if(!P)return null;const T=Q(u.endDate)+G,E=r.findIndex(W=>W.id===u.id)*te+20+16,A=Q(P.startDate),q=r.findIndex(W=>W.id===P.id)*te+20+16,D=`M ${T} ${E} C ${T+50} ${E}, ${A-50} ${q}, ${A} ${q}`;return e.jsx("path",{d:D,stroke:"#cbd5e1",strokeWidth:"2",fill:"none",markerEnd:"url(#arrowhead)"},`${u.id}-${P.id}`)})),_&&(()=>{const u=r.find(T=>T.id===_.sourceId);if(!u)return null;const k=Q(u.endDate)+G,P=r.findIndex(T=>T.id===u.id)*te+20+16;return e.jsx("line",{x1:k,y1:P,x2:_.endX,y2:_.endY,stroke:"#3b82f6",strokeWidth:"2",strokeDasharray:"5 5",markerEnd:"url(#arrowhead)"})})()]}),e.jsxs("div",{className:"relative z-1 pt-4 pb-20 select-none",style:{minHeight:"100%"},children:[r.map((u,k)=>{const P=Q(u.startDate),T=Math.max(G,X(L(u.endDate),L(u.startDate))*G+G),E=k*te+20,A=y.has(u.id);return u.type==="milestone"?e.jsx(V.div,{className:`absolute group cursor-pointer z-30 ${A?"ring-2 ring-blue-500 rounded-full":""}`,style:{left:P-16,top:E-4},whileHover:{scale:1.1},onMouseDown:D=>{D.stopPropagation(),p(new Set([u.id]))},onDoubleClick:D=>{D.stopPropagation(),m==null||m(u)},children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"text-4xl",style:{color:u.color||"#fbbf24"},children:"⭐"}),e.jsxs("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-2 bg-amber-500 text-white text-xs rounded-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none shadow-lg z-50",children:[e.jsx("div",{className:"font-bold",children:u.name}),e.jsx("div",{className:"text-[10px] mt-1",children:I(L(u.startDate),"yyyy-MM-dd")}),u.description&&e.jsx("div",{className:"text-[10px] mt-1 max-w-xs",children:u.description})]}),e.jsx("div",{className:"absolute top-10 left-1/2 transform -translate-x-1/2 w-0.5 bg-amber-400/50 pointer-events-none",style:{height:`${(r.length-k)*te}px`}})]})},u.id):e.jsxs(V.div,{className:`absolute group h-8 rounded-lg shadow-sm border border-black/10 flex items-center ${A?"ring-2 ring-blue-500 z-20":"hover:shadow-md z-10"}`,style:{left:P,width:T,top:E,backgroundColor:u.color||"#3b82f6",cursor:"move"},onMouseDown:D=>he(D,u,"move"),onDoubleClick:D=>{D.stopPropagation(),m==null||m(u)},onContextMenu:D=>{D.stopPropagation(),D.preventDefault(),F({x:D.clientX,y:D.clientY,taskId:u.id}),p(new Set([u.id]))},children:[e.jsxs("div",{className:"px-2 text-xs text-white font-medium truncate w-full drop-shadow-md pointer-events-none flex items-center gap-1",children:[u.priority&&e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-bold ${u.priority==="P0"?"bg-red-600/90":u.priority==="P1"?"bg-orange-500/90":u.priority==="P2"?"bg-blue-500/90":"bg-slate-500/90"}`,children:u.priority}),e.jsx("span",{className:"truncate",children:u.name})]}),e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-3 cursor-col-resize hover:bg-white/20 z-20",onMouseDown:D=>he(D,u,"resize-l")}),e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-3 cursor-col-resize hover:bg-white/20 z-20",onMouseDown:D=>he(D,u,"resize-r")}),e.jsx("div",{className:"absolute -right-3 w-5 h-5 rounded-full bg-transparent flex items-center justify-center cursor-crosshair z-30 group-hover:opacity-100 opacity-0 transition-opacity",onMouseDown:D=>et(D,u.id),onMouseUp:D=>Be(D,u.id),children:e.jsx("div",{className:"w-3 h-3 bg-white border border-blue-500 rounded-full shadow-sm"})}),e.jsx("div",{className:"absolute -left-3 w-5 h-5 rounded-full bg-transparent flex items-center justify-center cursor-crosshair z-30 group-hover:opacity-100 opacity-0 transition-opacity",onMouseUp:D=>Be(D,u.id),children:e.jsx("div",{className:"w-3 h-3 bg-white border border-slate-400 rounded-full shadow-sm"})})]},u.id)}),c.map(u=>{const k=Q(u.date);return e.jsxs(V.div,{className:"absolute group cursor-pointer z-30",style:{left:k-12,top:10},whileHover:{scale:1.2},title:`${u.name}
${u.date}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"text-2xl",children:"⭐"}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-1 px-2 py-1 bg-amber-500 text-white text-xs rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none shadow-lg",children:u.name})]}),e.jsx("div",{className:"absolute top-6 left-1/2 transform -translate-x-1/2 w-0.5 bg-amber-400/50 pointer-events-none",style:{height:`${r.length*te+20}px`}})]},u.id)})]})]})}),e.jsx(ze,{children:R&&e.jsxs("div",{className:"fixed bg-white shadow-xl border rounded-md py-1 z-50 w-32",style:{top:R.y,left:R.x},children:[e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm hover:bg-slate-50",onClick:()=>{m==null||m(r.find(u=>u.id===R.taskId)),F(null)},children:"编辑"}),e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-slate-50",onClick:()=>{i(R.taskId),F(null)},children:"删除"}),e.jsx("div",{className:"border-t my-1"}),e.jsx("button",{className:"w-full text-left px-4 py-2 text-sm text-slate-400",onClick:()=>F(null),children:"取消"})]})})]})},Kt=()=>{window.print()},es=(r,c)=>{const l=["任务名称","描述","开始日期","结束日期","状态","优先级","类型","进度(%)"],i=r.map(d=>[d.name,d.description||"",d.startDate,d.endDate,d.status||"planning",d.priority||"P2",d.type||"task",(d.progress||0).toString()]),o=[l.join(","),...i.map(d=>d.map(s=>`"${s}"`).join(","))].join(`
`),t=new Blob(["\uFEFF"+o],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(t),a.download=`${c}_tasks_${I(new Date,"yyyyMMdd")}.csv`,a.click()},ts=(r,c)=>{const l={projectName:c,exportDate:I(new Date,"yyyy-MM-dd HH:mm:ss"),tasks:r.map(a=>({id:a.id,name:a.name,description:a.description,startDate:a.startDate,endDate:a.endDate,status:a.status,priority:a.priority,type:a.type,progress:a.progress,color:a.color,dependencies:a.dependencies||[]}))},i=JSON.stringify(l,null,2),o=new Blob([i],{type:"application/json"}),t=document.createElement("a");t.href=URL.createObjectURL(o),t.download=`${c}_gantt_${I(new Date,"yyyyMMdd")}.json`,t.click()},ss=(r,c)=>{const l=["资源名称","分配数量","总容量","利用率(%)","工期","预估成本(元)","技能要求","状态"],i=(r.resourceRequirements||[]).map(d=>{const s=c.find(w=>w.id===d.resourceId);if(!s)return null;const f=d.unit==="day"?d.duration:d.unit==="month"?d.duration*22:d.unit==="year"?d.duration*260:0,m=s.hourlyRate?s.hourlyRate*f*8*d.count:s.costPerUnit?s.costPerUnit*d.duration*d.count:0,b=d.count/s.totalQuantity*100,x=d.count>s.totalQuantity;return[s.name,d.count.toString(),s.totalQuantity.toString(),b.toFixed(1),`${d.duration}${d.unit==="day"?"天":d.unit==="month"?"月":"年"}`,m.toFixed(2),(d.requiredSkills||[]).join("; "),x?"超额":"正常"]}).filter(Boolean),o=[l.join(","),...i.map(d=>d.map(s=>`"${s}"`).join(","))].join(`
`),t=new Blob(["\uFEFF"+o],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(t),a.download=`${r.name}_resources_${I(new Date,"yyyyMMdd")}.csv`,a.click()},ls=({tasks:r,projectName:c="Project",onTaskUpdate:l,onTaskAdd:i,onTaskDelete:o})=>{const[t,a]=C.useState("gantt"),[d,s]=C.useState("status"),[f,m]=C.useState(new Set(["active","planning"])),[b,x]=C.useState(null),[w,$]=C.useState(null),B=C.useMemo(()=>{const p={};return r.forEach(v=>{let S="ungrouped";switch(d){case"status":S=v.status||"planning";break;case"priority":S=v.priority||"P2";break;case"type":S=v.type||"task";break;default:S="all"}p[S]||(p[S]=[]),p[S].push(v)}),Object.keys(p).forEach(v=>{p[v].sort((S,R)=>{const F=L(S.startDate),z=L(R.startDate);return F.getTime()-z.getTime()})}),p},[r,d]),M=p=>{const v=new Set(f);v.has(p)?v.delete(p):v.add(p),m(v)},N=p=>d==="status"?{planning:{label:"规划中",color:"bg-blue-100 text-blue-700",icon:ie},active:{label:"进行中",color:"bg-green-100 text-green-700",icon:Xe},completed:{label:"已完成",color:"bg-purple-100 text-purple-700",icon:yt},"on-hold":{label:"暂停",color:"bg-orange-100 text-orange-700",icon:ie}}[p]||{label:p,color:"bg-slate-100 text-slate-700",icon:ie}:d==="priority"?{P0:{label:"紧急",color:"bg-red-100 text-red-700",icon:ee},P1:{label:"高",color:"bg-orange-100 text-orange-700",icon:ee},P2:{label:"中",color:"bg-yellow-100 text-yellow-700",icon:ee},P3:{label:"低",color:"bg-slate-100 text-slate-700",icon:ee}}[p]||{label:p,color:"bg-slate-100 text-slate-700",icon:ee}:d==="type"?{task:{label:"任务",color:"bg-blue-100 text-blue-700",icon:ne},milestone:{label:"里程碑",color:"bg-purple-100 text-purple-700",icon:ee},group:{label:"任务组",color:"bg-green-100 text-green-700",icon:Le}}[p]||{label:p,color:"bg-slate-100 text-slate-700",icon:ne}:{label:"全部任务",color:"bg-slate-100 text-slate-700",icon:ne},j=(p,v)=>{$(v),p.dataTransfer.effectAllowed="move"},h=p=>{p.preventDefault(),p.dataTransfer.dropEffect="move"},n=(p,v)=>{if(p.preventDefault(),!w||w.id===v.id)return;const S=[...r],R=S.findIndex(z=>z.id===w.id),F=S.findIndex(z=>z.id===v.id);if(R!==-1&&F!==-1){const z=w.y||0,Y=v.y||0;l({...w,y:Y}),l({...v,y:z})}$(null)},g=()=>e.jsx("div",{className:"h-full overflow-hidden",children:e.jsx(Jt,{tasks:r,onTaskUpdate:l,onTaskDelete:o,onEditTask:x,onTaskAdd:p=>{const v={id:Date.now().toString(),name:"新任务",status:"planning",priority:"P2",progress:0,startDate:p.startDate||I(new Date,"yyyy-MM-dd"),endDate:p.endDate||I(O(new Date,2),"yyyy-MM-dd"),type:"task",dependencies:[],...p};i(v)}})}),y=()=>e.jsx("div",{className:"overflow-auto h-full p-4",children:Object.entries(B).map(([p,v])=>{const S=N(p),R=f.has(p),F=S.icon;return e.jsxs("div",{className:"mb-6",children:[d!=="none"&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 cursor-pointer",onClick:()=>M(p),children:[R?e.jsx(vt,{size:18}):e.jsx(We,{size:18}),e.jsx(F,{size:18}),e.jsx("h3",{className:"font-semibold text-slate-900",children:S.label}),e.jsxs("span",{className:"text-sm text-slate-500",children:["(",v.length,")"]})]}),(R||d==="none")&&e.jsx("div",{className:"space-y-2",children:v.map(z=>e.jsxs("div",{draggable:!0,onDragStart:Y=>j(Y,z),onDragOver:h,onDrop:Y=>n(Y,z),className:`bg-white rounded-lg border border-slate-200 p-4 hover:shadow-md transition-all cursor-move ${(w==null?void 0:w.id)===z.id?"opacity-50":""}`,onClick:()=>x(z),children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-medium text-slate-900",children:z.name}),z.priority&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${z.priority==="P0"?"bg-red-100 text-red-700":z.priority==="P1"?"bg-orange-100 text-orange-700":z.priority==="P2"?"bg-yellow-100 text-yellow-700":"bg-slate-100 text-slate-700"}`,children:z.priority})]}),z.description&&e.jsx("p",{className:"text-sm text-slate-600 mb-2",children:z.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ue,{size:12}),I(L(z.startDate),"yyyy-MM-dd")," - ",I(L(z.endDate),"yyyy-MM-dd")]}),z.progress!==void 0&&e.jsxs("span",{children:["进度: ",z.progress,"%"]})]})]})}),z.progress!==void 0&&e.jsx("div",{className:"mt-3 h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all",style:{width:`${z.progress}%`}})})]},z.id))})]},p)})});return e.jsxs("div",{className:"flex flex-col h-full bg-slate-50",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 p-4 shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex bg-slate-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>a("gantt"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${t==="gantt"?"bg-white text-slate-900 shadow-sm":"text-slate-600"}`,children:[e.jsx(ue,{size:16,className:"inline mr-1"}),"时间总览"]}),e.jsxs("button",{onClick:()=>a("list"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${t==="list"?"bg-white text-slate-900 shadow-sm":"text-slate-600"}`,children:[e.jsx(ne,{size:16,className:"inline mr-1"}),"列表"]}),e.jsxs("button",{onClick:()=>a("board"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${t==="board"?"bg-white text-slate-900 shadow-sm":"text-slate-600"}`,children:[e.jsx(Le,{size:16,className:"inline mr-1"}),"看板"]}),e.jsxs("button",{onClick:()=>a("network"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${t==="network"?"bg-white text-slate-900 shadow-sm":"text-slate-600"}`,children:[e.jsx(jt,{size:16,className:"inline mr-1"}),"网络图"]})]}),t!=="board"&&t!=="network"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"分组:"}),e.jsxs("select",{value:d,onChange:p=>s(p.target.value),className:"px-3 py-1.5 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"none",children:"不分组"}),e.jsx("option",{value:"status",children:"按状态"}),e.jsx("option",{value:"priority",children:"按优先级"}),e.jsx("option",{value:"type",children:"按类型"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mr-2 border-r border-slate-200 pr-3",children:[e.jsx("button",{onClick:()=>es(r,c),className:"p-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",title:"导出 CSV",children:e.jsx(Se,{size:18})}),e.jsx("button",{onClick:()=>ts(r,c),className:"p-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",title:"导出 JSON",children:e.jsx(ne,{size:18})}),e.jsx("button",{onClick:Kt,className:"p-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",title:"打印",children:e.jsx(Wt,{size:18})})]}),e.jsxs("button",{onClick:()=>{const p={id:Date.now().toString(),name:"新任务",startDate:I(new Date,"yyyy-MM-dd"),endDate:I(O(new Date,7),"yyyy-MM-dd"),progress:0,type:"task",status:"planning",priority:"P2",color:"#3B82F6"};i(p)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(de,{size:18}),"新建任务"]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[t==="gantt"&&g(),t==="list"&&y(),t==="board"&&e.jsx(_t,{tasks:r,onTaskUpdate:l,onTaskClick:x}),t==="network"&&e.jsx(Qt,{tasks:r})]}),b&&e.jsx(Ut,{task:b,onSave:p=>{l(p),x(null)},onDelete:p=>{o(p),x(null)},onClose:()=>x(null)})]})},as=({project:r,resourcePool:c})=>{const[l,i]=C.useState(!1),o=C.useMemo(()=>(r.resourceRequirements||[]).map(a=>{const d=c.find(x=>x.id===a.resourceId);if(!d)return null;const s=a.unit==="day"?a.duration:a.unit==="month"?a.duration*22:a.unit==="year"?a.duration*260:0,f=d.hourlyRate?d.hourlyRate*s*8*a.count:d.costPerUnit?d.costPerUnit*a.duration*a.count:0,m=d.totalQuantity,b=a.count/m*100;return{requirement:a,resource:d,workDays:s,estimatedCost:f,utilization:b,isOverAllocated:a.count>m}}).filter(Boolean),[r.resourceRequirements,c]),t=C.useMemo(()=>{const a=o.reduce((m,b)=>m+((b==null?void 0:b.estimatedCost)||0),0),d=o.reduce((m,b)=>m+((b==null?void 0:b.requirement.count)||0),0),s=o.filter(m=>m==null?void 0:m.isOverAllocated).length,f=o.length>0?o.reduce((m,b)=>m+((b==null?void 0:b.utilization)||0),0)/o.length:0;return{totalCost:a,totalHeadcount:d,overAllocatedCount:s,avgUtilization:f}},[o]);return e.jsx("div",{className:"h-full overflow-auto p-6 bg-slate-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"资源详情"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>i(!l),className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors ${l?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-slate-200 text-slate-700 hover:bg-slate-50"}`,children:[e.jsx(Nt,{size:18}),l?"隐藏时间线":"显示时间线"]}),e.jsxs("button",{onClick:()=>ss(r,c),className:"flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors",children:[e.jsx(Se,{size:18}),"导出报表"]})]})]}),l&&e.jsx("div",{className:"bg-white rounded-lg border border-slate-200 p-4 h-[400px]",children:e.jsx(gt,{resources:c,projects:[r]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(me,{size:20,className:"text-blue-600"}),e.jsx("span",{className:"text-sm text-slate-600",children:"总人力"})]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:t.totalHeadcount}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"分配人数"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{size:20,className:"text-green-600"}),e.jsx("span",{className:"text-sm text-slate-600",children:"平均利用率"})]}),e.jsxs("div",{className:"text-2xl font-bold text-slate-900",children:[t.avgUtilization.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"资源占用率"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ue,{size:20,className:"text-purple-600"}),e.jsx("span",{className:"text-sm text-slate-600",children:"预估成本"})]}),e.jsxs("div",{className:"text-2xl font-bold text-slate-900",children:["¥",(t.totalCost/1e4).toFixed(1),"万"]}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"人力成本"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.overAllocatedCount>0?e.jsx(J,{size:20,className:"text-red-600"}):e.jsx(oe,{size:20,className:"text-green-600"}),e.jsx("span",{className:"text-sm text-slate-600",children:"资源状态"})]}),e.jsx("div",{className:`text-2xl font-bold ${t.overAllocatedCount>0?"text-red-600":"text-green-600"}`,children:t.overAllocatedCount>0?"超额":"正常"}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:t.overAllocatedCount>0?`${t.overAllocatedCount} 项超额`:"资源充足"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-slate-200",children:e.jsx("h3",{className:"font-semibold text-slate-900",children:"资源分配详情"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600",children:"资源名称"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600",children:"分配数量"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600",children:"总容量"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600",children:"利用率"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600",children:"工期"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600",children:"工作日"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600",children:"预估成本"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600",children:"技能要求"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600",children:"状态"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:o.map((a,d)=>{var s;return a?e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(me,{size:16,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900",children:a.resource.name}),a.resource.hourlyRate&&e.jsxs("div",{className:"text-xs text-slate-500",children:["¥",a.resource.hourlyRate,"/小时"]})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium text-slate-900",children:a.requirement.count})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-slate-600",children:a.resource.totalQuantity})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-100 rounded-full overflow-hidden max-w-[100px]",children:e.jsx("div",{className:`h-full rounded-full ${a.utilization>100?"bg-red-500":a.utilization>80?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(a.utilization,100)}%`}})}),e.jsxs("span",{className:`text-sm font-medium ${a.utilization>100?"text-red-600":a.utilization>80?"text-yellow-600":"text-green-600"}`,children:[a.utilization.toFixed(0),"%"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"text-slate-600",children:[a.requirement.duration," ",a.requirement.unit==="day"?"天":a.requirement.unit==="month"?"月":a.requirement.unit==="year"?"年":""]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"text-slate-600",children:[a.workDays," 天"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"font-medium text-slate-900",children:["¥",(a.estimatedCost/1e4).toFixed(2),"万"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:((s=a.requirement.requiredSkills)==null?void 0:s.map((f,m)=>e.jsx("span",{className:"px-2 py-0.5 bg-blue-50 text-blue-700 text-xs rounded",children:f},m)))||e.jsx("span",{className:"text-slate-400 text-xs",children:"无要求"})})}),e.jsx("td",{className:"px-4 py-3",children:a.isOverAllocated?e.jsxs("span",{className:"flex items-center gap-1 text-red-600 text-sm",children:[e.jsx(J,{size:14}),"超额"]}):e.jsxs("span",{className:"flex items-center gap-1 text-green-600 text-sm",children:[e.jsx(oe,{size:14}),"正常"]})})]},d):null})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-6",children:[e.jsx("h3",{className:"font-semibold text-slate-900 mb-4",children:"技能匹配分析"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map((a,d)=>{if(!a||!a.resource.skills)return null;const s=a.requirement.requiredSkills||[],f=a.resource.skills.map(x=>x.name),m=s.filter(x=>f.includes(x)),b=s.length>0?m.length/s.length*100:100;return e.jsxs("div",{className:"border border-slate-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-slate-900",children:a.resource.name}),e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${b===100?"bg-green-100 text-green-700":b>=50?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:["匹配度 ",b.toFixed(0),"%"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"需要技能:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.length>0?s.map((x,w)=>e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${m.includes(x)?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:x},w)):e.jsx("span",{className:"text-xs text-slate-400",children:"无特殊要求"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"拥有技能:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:a.resource.skills.map((x,w)=>e.jsxs("span",{className:"px-2 py-0.5 bg-blue-50 text-blue-700 text-xs rounded",children:[x.name," (",x.level,")"]},w))})]})]})]},d)})})]}),t.totalCost>(r.budget||0)&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(J,{size:20,className:"text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-900 mb-1",children:"成本预警"}),e.jsxs("p",{className:"text-sm text-red-700",children:["预估人力成本 ¥",(t.totalCost/1e4).toFixed(2),"万 超出项目预算 ¥",((r.budget||0)/1e4).toFixed(2),"万， 超支 ¥",((t.totalCost-(r.budget||0))/1e4).toFixed(2),"万"]})]})]})})]})})},rs=({project:r,risks:c,onRisksChange:l,onClose:i})=>{const[o,t]=C.useState("all"),[a,d]=C.useState(!1),[s,f]=C.useState({category:"schedule",probability:3,impact:3,status:"identified",owner:""}),m=[{id:"all",label:"全部",icon:ge,color:"slate"},{id:"schedule",label:"进度",icon:Xe,color:"blue"},{id:"cost",label:"成本",icon:se,color:"green"},{id:"resource",label:"资源",icon:me,color:"purple"},{id:"technical",label:"技术",icon:ae,color:"orange"},{id:"external",label:"外部",icon:Ce,color:"red"}],b=h=>h.probability*h.impact,x=h=>h>=20?{label:"极高",color:"text-red-700",bgColor:"bg-red-100 border-red-300"}:h>=15?{label:"高",color:"text-orange-700",bgColor:"bg-orange-100 border-orange-300"}:h>=10?{label:"中",color:"text-yellow-700",bgColor:"bg-yellow-100 border-yellow-300"}:h>=5?{label:"低",color:"text-blue-700",bgColor:"bg-blue-100 border-blue-300"}:{label:"极低",color:"text-slate-700",bgColor:"bg-slate-100 border-slate-300"},w=C.useMemo(()=>{if(c.length===0)return{score:0,level:x(0)};const h=c.filter(y=>y.status!=="resolved"),g=h.reduce((y,p)=>y+b(p),0)/h.length;return{score:g,level:x(g)}},[c]),$=o==="all"?c:c.filter(h=>h.category===o),B=C.useMemo(()=>{const h={极高:[],高:[],中:[],低:[],极低:[]};return $.forEach(n=>{const g=b(n),y=x(g);h[y.label].push(n)}),h},[$]),M=()=>{if(!s.title||!s.description){alert("请填写风险标题和描述");return}const h={id:Date.now().toString(),category:s.category,title:s.title,description:s.description,probability:s.probability||3,impact:s.impact||3,mitigation:s.mitigation||"",owner:s.owner||"",status:"identified"};l([...c,h]),f({category:"schedule",probability:3,impact:3,status:"identified"}),d(!1)},N=h=>{l(c.filter(n=>n.id!==h))},j=(h,n)=>{l(c.map(g=>g.id===h?{...g,status:n}:g))};return e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ge,{size:32,className:"text-blue-600"}),e.jsx("h2",{className:"text-3xl font-bold text-slate-900",children:"风险评估"})]}),e.jsxs("p",{className:"text-sm text-slate-500",children:["项目: ",r.name]})]}),e.jsxs("div",{className:`px-6 py-4 rounded-xl border-2 ${w.level.bgColor}`,children:[e.jsx("div",{className:"text-xs font-semibold text-slate-600 mb-1",children:"综合风险等级"}),e.jsx("div",{className:`text-3xl font-bold ${w.level.color}`,children:w.level.label}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["评分: ",w.score.toFixed(1)," / 25"]})]}),i&&e.jsx("button",{onClick:i,className:"ml-4 p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(le,{size:24})})]}),e.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:m.map(h=>{const n=h.icon,g=h.id==="all"?c.length:c.filter(y=>y.category===h.id).length;return e.jsxs("button",{onClick:()=>t(h.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap ${o===h.id?`bg-${h.color}-600 text-white shadow-lg`:`bg-${h.color}-100 text-${h.color}-700 hover:bg-${h.color}-200`}`,children:[e.jsx(n,{size:16}),h.label,e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-white/30 rounded-full text-xs",children:g})]},h.id)})}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>d(!a),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors shadow-lg",children:[e.jsx(de,{size:18}),"添加风险"]})}),a&&e.jsxs("div",{className:"mb-6 p-6 bg-blue-50 rounded-xl border-2 border-blue-200",children:[e.jsx("h3",{className:"font-bold text-slate-900 mb-4",children:"新增风险"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"风险类别"}),e.jsxs("select",{value:s.category,onChange:h=>f({...s,category:h.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"schedule",children:"进度风险"}),e.jsx("option",{value:"cost",children:"成本风险"}),e.jsx("option",{value:"resource",children:"资源风险"}),e.jsx("option",{value:"technical",children:"技术风险"}),e.jsx("option",{value:"external",children:"外部风险"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"负责人"}),e.jsx("input",{type:"text",value:s.owner||"",onChange:h=>f({...s,owner:h.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"风险负责人"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"风险标题"}),e.jsx("input",{type:"text",value:s.title||"",onChange:h=>f({...s,title:h.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"简要描述风险"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"风险描述"}),e.jsx("textarea",{value:s.description||"",onChange:h=>f({...s,description:h.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"详细描述风险情况"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["发生概率 (1-5): ",s.probability]}),e.jsx("input",{type:"range",min:"1",max:"5",value:s.probability,onChange:h=>f({...s,probability:parseInt(h.target.value)}),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:"极低"}),e.jsx("span",{children:"极高"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["影响程度 (1-5): ",s.impact]}),e.jsx("input",{type:"range",min:"1",max:"5",value:s.impact,onChange:h=>f({...s,impact:parseInt(h.target.value)}),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:"极低"}),e.jsx("span",{children:"极高"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"缓解措施"}),e.jsx("textarea",{value:s.mitigation||"",onChange:h=>f({...s,mitigation:h.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2,placeholder:"如何降低或消除此风险"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:M,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium",children:"添加"}),e.jsx("button",{onClick:()=>d(!1),className:"px-6 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg transition-colors",children:"取消"})]})]}),e.jsxs("div",{className:"space-y-6",children:[Object.entries(B).map(([h,n])=>{if(n.length===0)return null;const g=x(h==="极高"?25:h==="高"?18:h==="中"?12:h==="低"?7:3);return e.jsxs("div",{children:[e.jsxs("h3",{className:`font-bold text-lg mb-3 ${g.color}`,children:[h,"风险 (",n.length,")"]}),e.jsx("div",{className:"space-y-3",children:n.map(y=>{var S;const p=b(y),v=x(p);return e.jsxs("div",{className:`p-5 rounded-xl border-2 ${v.bgColor} transition-all hover:shadow-lg`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-bold text-lg text-slate-900",children:y.title}),e.jsx("span",{className:`text-xs font-semibold px-2 py-1 rounded uppercase ${v.color} ${v.bgColor}`,children:v.label}),e.jsx("span",{className:"text-xs bg-slate-200 text-slate-700 px-2 py-1 rounded",children:(S=m.find(R=>R.id===y.category))==null?void 0:S.label})]}),e.jsx("p",{className:"text-sm text-slate-700 mb-2",children:y.description}),y.mitigation&&e.jsxs("div",{className:"text-sm text-slate-600 bg-white/50 p-2 rounded",children:[e.jsx("strong",{children:"缓解措施:"})," ",y.mitigation]})]}),e.jsx("button",{onClick:()=>N(y.id),className:"ml-4 p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",children:e.jsx(le,{size:18})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"概率:"}),e.jsxs("span",{className:"ml-2 font-bold",children:[y.probability,"/5"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"影响:"}),e.jsxs("span",{className:"ml-2 font-bold",children:[y.impact,"/5"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"评分:"}),e.jsxs("span",{className:"ml-2 font-bold",children:[p,"/25"]})]}),y.owner&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"负责人:"}),e.jsx("span",{className:"ml-2 font-medium",children:y.owner})]})]}),e.jsxs("select",{value:y.status,onChange:R=>j(y.id,R.target.value),className:"px-3 py-1 rounded-lg border border-slate-300 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"identified",children:"已识别"}),e.jsx("option",{value:"mitigating",children:"缓解中"}),e.jsx("option",{value:"resolved",children:"已解决"})]})]})]},y.id)})})]},h)}),$.length===0&&e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(ge,{size:64,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"暂无风险记录"})]})]})]})},ns=({projectName:r,budget:c,existingCosts:l=[],onSave:i,onClose:o})=>{const[t,a]=C.useState(c||0),[d,s]=C.useState(l),[f,m]=C.useState({date:new Date().toISOString().split("T")[0],amount:0,category:"labor",description:""}),b=[{id:"labor",label:"人力成本",color:"#3b82f6"},{id:"equipment",label:"设备成本",color:"#8b5cf6"},{id:"materials",label:"材料成本",color:"#10b981"},{id:"overhead",label:"管理费用",color:"#f59e0b"},{id:"other",label:"其他",color:"#6b7280"}],x=d.reduce((n,g)=>n+g.amount,0),w=t-x,$=t>0?x/t*100:0,B=b.map(n=>({name:n.label,value:d.filter(g=>g.category===n.id).reduce((g,y)=>g+y.amount,0),color:n.color})).filter(n=>n.value>0),M=d.sort((n,g)=>new Date(n.date).getTime()-new Date(g.date).getTime()).reduce((n,g)=>{const y=n.find(p=>p.date===g.date);if(y)y.amount+=g.amount;else{const p=n.length>0?n[n.length-1].cumulative:0;n.push({date:g.date,amount:g.amount,cumulative:p+g.amount})}return n},[]),N=()=>{if(f.amount&&f.amount>0&&f.description){const n={id:Date.now().toString(),date:f.date,amount:f.amount,category:f.category,description:f.description};s([...d,n]),m({date:new Date().toISOString().split("T")[0],amount:0,category:"labor",description:""})}},j=n=>{s(d.filter(g=>g.id!==n))},h=()=>{i(d,t),o()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"成本登记"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["项目: ",r]})]}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(le,{size:24,className:"text-slate-500"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-6 text-white",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-blue-100",children:"项目预算"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{size:24}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:t,onChange:n=>a(parseFloat(n.target.value)||0),className:"flex-1 px-4 py-3 rounded-lg bg-white/20 backdrop-blur border border-white/30 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50 text-xl font-bold",placeholder:"输入预算金额"}),e.jsx("span",{className:"text-xl font-bold",children:"元"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-lg p-3",children:[e.jsx("div",{className:"text-blue-100",children:"已用"}),e.jsxs("div",{className:"font-bold text-lg",children:["¥",x.toLocaleString()]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-lg p-3",children:[e.jsx("div",{className:"text-blue-100",children:"剩余"}),e.jsxs("div",{className:`font-bold text-lg ${w<0?"text-red-300":""}`,children:["¥",w.toLocaleString()]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-lg p-3",children:[e.jsx("div",{className:"text-blue-100",children:"使用率"}),e.jsxs("div",{className:`font-bold text-lg ${$>100?"text-red-300":""}`,children:[$.toFixed(1),"%"]})]})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900 rounded-xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-4 flex items-center gap-2",children:[e.jsx(de,{size:20}),"添加成本记录"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"日期"}),e.jsx("input",{type:"date",value:f.date,onChange:n=>m({...f,date:n.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"金额"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:f.amount,onChange:n=>m({...f,amount:parseFloat(n.target.value)}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"类别"}),e.jsx("select",{value:f.category,onChange:n=>m({...f,category:n.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500",children:b.map(n=>e.jsx("option",{value:n.id,children:n.label},n.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"说明"}),e.jsx("textarea",{value:f.description,onChange:n=>m({...f,description:n.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:2,placeholder:"描述此项成本..."})]}),e.jsxs("button",{onClick:N,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx(de,{size:18}),"添加记录"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 flex items-center gap-2",children:[e.jsx(Me,{size:20}),"成本记录 (",d.length,")"]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:d.length===0?e.jsx("div",{className:"p-8 text-center text-slate-400",children:"暂无成本记录"}):e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:d.map(n=>{const g=b.find(y=>y.id===n.category);return e.jsx("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors group",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${g==null?void 0:g.color}20`,color:g==null?void 0:g.color},children:g==null?void 0:g.label}),e.jsx("span",{className:"text-xs text-slate-400",children:n.date})]}),e.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 mb-1",children:n.description}),e.jsxs("div",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:["¥",n.amount.toLocaleString()]})]}),e.jsx("button",{onClick:()=>j(n.id),className:"opacity-0 group-hover:opacity-100 p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all",children:e.jsx(le,{size:16})})]})},n.id)})})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-4",children:"成本构成"}),B.length>0?e.jsx(ye,{width:"100%",height:250,children:e.jsxs(kt,{children:[e.jsx(Ct,{data:B,cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:5,dataKey:"value",label:({name:n,percent:g})=>`${n} ${((g||0)*100).toFixed(0)}%`,children:B.map((n,g)=>e.jsx(wt,{fill:n.color},`cell-${g}`))}),e.jsx(Ne,{formatter:n=>`¥${n.toLocaleString()}`})]})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-slate-400",children:"暂无数据"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-4",children:"成本趋势"}),M.length>0?e.jsx(ye,{width:"100%",height:250,children:e.jsxs(St,{data:M,children:[e.jsx($t,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(Pt,{dataKey:"date",tick:{fill:"#64748b",fontSize:12}}),e.jsx(Rt,{tick:{fill:"#64748b",fontSize:12}}),e.jsx(Ne,{formatter:n=>`¥${n.toLocaleString()}`}),e.jsx(Ye,{}),e.jsx(zt,{type:"monotone",dataKey:"cumulative",stroke:"#3b82f6",strokeWidth:2,name:"累计成本",dot:{fill:"#3b82f6",r:4}})]})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-slate-400",children:"暂无数据"})]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-slate-200 dark:border-slate-700 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:["总计: ",e.jsxs("strong",{className:"text-slate-900 dark:text-slate-100 text-lg",children:["¥",x.toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:o,className:"px-6 py-2 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg font-medium transition-colors",children:"取消"}),e.jsx("button",{onClick:h,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors shadow-lg shadow-blue-600/20",children:"保存成本数据"})]})]})]})})},is=({project:r,onUpdate:c})=>{const{factorDefinitions:l}=Ve(),i=r.factors||{},{totalScore:o,maxPossibleScore:t,normalizedScore:a}=C.useMemo(()=>{const m=Ie(i,l);return{totalScore:m,maxPossibleScore:10,normalizedScore:m*10}},[i,l]),d=(m,b)=>{const x={...i,[m]:b},w=Ie(x,l);c({factors:x,score:w})},f=(m=>m>=80?"text-green-600 bg-green-50 border-green-200":m>=60?"text-blue-600 bg-blue-50 border-blue-200":m>=40?"text-orange-600 bg-orange-50 border-orange-200":"text-red-600 bg-red-50 border-red-200")(a);return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full p-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:`p-6 rounded-2xl border-2 ${f} flex flex-col items-center justify-center text-center shadow-sm`,children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-700 mb-2",children:"项目战略评分"}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx("span",{className:"text-6xl font-black tracking-tighter",children:a.toFixed(0)}),e.jsx("span",{className:"text-sm font-medium text-slate-500 absolute -top-1 -right-6",children:"/100"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm font-medium opacity-80",children:[a>=80&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:16})," 极具潜力"]}),a>=60&&a<80&&e.jsxs(e.Fragment,{children:[e.jsx($e,{size:16})," 值得关注"]}),a<60&&e.jsxs(e.Fragment,{children:[e.jsx(J,{size:16})," 需重新评估"]})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-xl border border-slate-200 shadow-sm",children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(st,{size:16,className:"text-blue-500"}),"评分说明"]}),e.jsx("p",{className:"text-sm text-slate-500 leading-relaxed",children:"该评分用于评估项目的战略价值和优先级。 请根据下方定义的各项影响因素，为本项目进行打分（0-10分）。 系统将根据设定的权重自动计算最终得分。"})]})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ft,{size:18,className:"text-slate-500"}),"评分因素配置"]}),e.jsxs("span",{className:"text-xs font-medium text-slate-500 bg-slate-200 px-2 py-1 rounded",children:["共 ",l.length," 项指标"]})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1 space-y-6",children:l.length===0?e.jsxs("div",{className:"text-center py-10 text-slate-400",children:[e.jsx("p",{children:"尚未定义评分因素。"}),e.jsx("p",{className:"text-sm mt-2",children:'请前往 "设置" 页面配置评分模型。'})]}):l.map(m=>{const b=i[m.id]||0;return e.jsxs(V.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"group",children:[e.jsxs("div",{className:"flex justify-between items-end mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-slate-800",children:m.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:["权重: ",m.weight,"%"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`text-2xl font-bold ${b>8?"text-green-600":b>5?"text-blue-600":"text-slate-400"}`,children:b}),e.jsx("span",{className:"text-xs text-slate-400",children:" / 10"})]})]}),e.jsxs("div",{className:"relative h-6 flex items-center",children:[e.jsx("input",{type:"range",min:"0",max:"10",step:"1",value:b,onChange:x=>d(m.id,parseInt(x.target.value)),className:"w-full h-2 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-blue-600 z-10 relative"}),e.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 h-2 rounded-l-lg pointer-events-none transition-all duration-3000 bg-blue-100",style:{width:`${b*10}%`}})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-300 mt-1 px-1 font-mono",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"5"}),e.jsx("span",{children:"10"})]})]},m.id)})})]})]})},os=(r,c)=>{if(!c.length)return 1;const l=new Date;let i=0,o=0;return c.forEach(t=>{const a=L(t.startDate),d=L(t.endDate),s=X(d,a);if(s<=0)return;const f=X(l,a),m=Math.min(100,Math.max(0,f/s*100));i+=m,o+=t.progress||0}),i===0?1:o/i},ds=r=>{const c=r.actualCost||r.budgetUsed||0,l=r.totalBudget||0;if(c===0||l===0)return 1;const i=r.progress||0,o=l*(i/100);return o===0?1:o/c},re=r=>r>=80?"excellent":r>=60?"good":r>=40?"warning":"critical",cs=(r,c)=>{const l=os(r,c),i=[];let o=100;l>=.95?o=100:l>=.85?(o=80,i.push(`进度稍慢，SPI=${l.toFixed(2)}`)):l>=.75?(o=60,i.push(`进度明显落后，SPI=${l.toFixed(2)}`)):(o=40,i.push(`进度严重滞后，SPI=${l.toFixed(2)}`));const t=new Date,a=c.filter(f=>L(f.endDate)<t&&(f.progress||0)<100);a.length>0&&(o-=a.length*5,i.push(`${a.length} 个任务已逾期`));const d=c.filter(f=>{if(f.type!=="milestone")return!1;const m=L(f.endDate),b=X(m,t);return b>0&&b<=7&&(f.progress||0)<100});d.length>0&&i.push(`${d.length} 个里程碑即将到期`);const s=re(o);return{score:Math.max(0,Math.min(100,o)),spi:l,status:s,issues:i}},xs=r=>{const c=ds(r),l=[];let i=100;c>=.95?i=100:c>=.85?(i=80,l.push(`成本稍微超支，CPI=${c.toFixed(2)}`)):c>=.75?(i=60,l.push(`成本明显超支，CPI=${c.toFixed(2)}`)):(i=40,l.push(`成本严重超支，CPI=${c.toFixed(2)}`));const o=r.budgetUsed||0,t=r.totalBudget||0,a=r.progress||0;if(t>0){const s=o/t*100;s>a+10&&(i-=10,l.push(`预算使用率(${s.toFixed(0)}%)超过进度(${a.toFixed(0)}%)`)),s>90&&l.push("预算即将耗尽")}const d=re(i);return{score:Math.max(0,Math.min(100,i)),cpi:c,status:d,issues:l}},ms=(r,c)=>{const l=[];let i=100,o=0;const t=r.resourceRequirements||[];let a=0,d=0;t.forEach(b=>{a+=b.count,d+=b.count});const s=a>0?d/a*100:100;s<70?(i-=15,l.push(`资源利用率偏低(${s.toFixed(0)}%)`)):s>110&&(i-=20,l.push(`资源过度分配(${s.toFixed(0)}%)`),o++);const f=t.filter(b=>(b.requiredSkills||[]).length>0&&!b.resourceId);f.length>0&&(i-=f.length*5,l.push(`${f.length} 个资源需求未匹配合适技能`));const m=re(i);return{score:Math.max(0,Math.min(100,i)),utilization:s,conflicts:o,status:m,issues:l}},us=r=>{const c=[],l=r.risks||[];let i=100;const o=l.filter(s=>s.impact===5||typeof s.impact=="string"&&(s.impact==="critical"||s.impact==="high")),t=l.length;if(t===0)return{score:100,total:0,critical:0,status:"excellent",issues:[]};i-=o.length*15,i-=(t-o.length)*5,o.length>0&&c.push(`存在 ${o.length} 个高危风险`),t>10&&c.push(`风险数量较多(${t}个)`);const a=l.filter(s=>!s.mitigation||s.mitigation.trim()==="");a.length>0&&(i-=a.length*3,c.push(`${a.length} 个风险缺少应对措施`));const d=re(i);return{score:Math.max(0,Math.min(100,i)),total:t,critical:o.length,status:d,issues:c}},hs=(r,c)=>{const l=[];let i=100;const o=c.length;if(o===0)return{score:100,defectRate:0,status:"excellent",issues:[]};const t=0,a=c.filter(s=>s.status==="active"&&(s.progress||0)>50);if(a.length>0){const s=a.length/o*100;i-=s,l.push(`${a.length} 个任务需要返工`)}const d=re(i);return{score:Math.max(0,Math.min(100,i)),defectRate:t,status:d,issues:l}},ps=(r,c)=>{const l=[];let i=100;const o=c.filter(m=>(m.progress||0)===100),t=c.length,a=t>0?o.length/t*100:0;a<30&&(i-=20,l.push(`团队速率较低(${a.toFixed(0)}%)`));const d=75,s=new Map;if(c.forEach(m=>{m.assignee&&s.set(m.assignee,(s.get(m.assignee)||0)+1)}),s.size>0){const m=Array.from(s.values()),b=m.reduce((w,$)=>w+$,0)/m.length;Math.max(...m.map(w=>Math.abs(w-b)))>b*.5&&(i-=10,l.push("任务分配不均衡"))}const f=re(i);return{score:Math.max(0,Math.min(100,i)),morale:d,velocity:a,status:f,issues:l}},we=(r,c,l=[])=>{const i=cs(r,c),o=xs(r),t=ms(r),a=us(r),d=hs(r,c),s=ps(r,c),f=i.score*.25+o.score*.2+t.score*.2+a.score*.15+d.score*.1+s.score*.1;return{overall:Math.round(f),schedule:i,cost:o,resources:t,risks:a,quality:d,team:s}},bs=({project:r,tasks:c,allProjects:l,showComparison:i=!1})=>{var m,b;const o=C.useMemo(()=>{const x=we(r,c,l);return[{dimension:"进度",value:x.schedule.score,fullMark:100},{dimension:"成本",value:x.cost.score,fullMark:100},{dimension:"资源",value:x.resources.score,fullMark:100},{dimension:"风险",value:x.risks.score,fullMark:100},{dimension:"质量",value:x.quality.score,fullMark:100},{dimension:"团队",value:x.team.score,fullMark:100}]},[r,c,l]),t=C.useMemo(()=>we(r,c,l),[r,c,l]),a=x=>x>=80?{label:"优秀",color:"text-green-600",bg:"bg-green-100",icon:oe}:x>=60?{label:"良好",color:"text-blue-600",bg:"bg-blue-100",icon:ae}:x>=40?{label:"警告",color:"text-yellow-600",bg:"bg-yellow-100",icon:J}:{label:"危险",color:"text-red-600",bg:"bg-red-100",icon:Ue},d=a(t.overall),s=d.icon,f=({active:x,payload:w})=>{if(x&&w&&w.length){const $=w[0];return e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-lg border border-slate-200",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:$.payload.dimension}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:$.value}),e.jsxs("p",{className:"text-xs text-slate-500",children:["满分: ",$.payload.fullMark]})]})}return null};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"项目健康度"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"text-5xl font-bold text-blue-600",children:t.overall}),e.jsxs("div",{children:[e.jsxs("div",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full ${d.bg} ${d.color} text-sm font-semibold`,children:[e.jsx(s,{size:16}),d.label]}),e.jsxs("p",{className:"text-xs text-slate-600 mt-1",children:[((m=t.schedule)==null?void 0:m.spi)>0&&`SPI: ${t.schedule.spi.toFixed(2)}`,((b=t.cost)==null?void 0:b.cpi)>0&&` | CPI: ${t.cost.cpi.toFixed(2)}`]})]})]})]}),e.jsxs("div",{className:"relative w-32 h-32",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"#E5E7EB",strokeWidth:"8",fill:"none"}),e.jsx(V.circle,{cx:"64",cy:"64",r:"56",stroke:"url(#healthGradient)",strokeWidth:"8",fill:"none",strokeLinecap:"round",initial:{strokeDasharray:"0 352"},animate:{strokeDasharray:`${t.overall/100*352} 352`},transition:{duration:1,ease:"easeOut"}}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"healthGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#3B82F6"}),e.jsx("stop",{offset:"100%",stopColor:"#8B5CF6"})]})})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-2xl font-bold text-slate-700",children:[t.overall,"%"]})})]})]})}),e.jsxs(V.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.3,duration:.5},className:"bg-white rounded-xl p-6 shadow-sm border border-slate-200",children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-900 mb-4",children:"六维健康度分析"}),e.jsx(ye,{width:"100%",height:400,children:e.jsxs(Bt,{data:o,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"radarGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#3B82F6",stopOpacity:.8}),e.jsx("stop",{offset:"100%",stopColor:"#8B5CF6",stopOpacity:.3})]})}),e.jsx(It,{stroke:"#E5E7EB"}),e.jsx(Mt,{dataKey:"dimension",tick:{fill:"#64748B",fontSize:14,fontWeight:500}}),e.jsx(Dt,{angle:90,domain:[0,100],tick:{fill:"#94A3B8",fontSize:12}}),e.jsx(Ft,{name:"健康度",dataKey:"value",stroke:"#3B82F6",fill:"url(#radarGradient)",fillOpacity:.6,strokeWidth:2,dot:{fill:"#3B82F6",r:4},animationDuration:1e3,animationEasing:"ease-out"}),e.jsx(Ne,{content:e.jsx(f,{})}),e.jsx(Ye,{wrapperStyle:{paddingTop:"20px",fontSize:"14px",fontWeight:500}})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map((x,w)=>{const $=a(x.value),B=$.icon;return e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4+w*.1,duration:.4},className:"bg-white rounded-lg p-4 shadow-sm border border-slate-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700",children:x.dimension}),e.jsx(B,{size:18,className:$.color})]}),e.jsxs("div",{className:"flex items-end gap-2 mb-2",children:[e.jsx("span",{className:"text-3xl font-bold text-slate-900",children:x.value}),e.jsx("span",{className:"text-sm text-slate-500 mb-1",children:"/ 100"})]}),e.jsx("div",{className:"w-full h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx(V.div,{initial:{width:0},animate:{width:`${x.value}%`},transition:{delay:.5+w*.1,duration:.8,ease:"easeOut"},className:`h-full rounded-full ${x.value>=80?"bg-gradient-to-r from-green-400 to-green-600":x.value>=60?"bg-gradient-to-r from-blue-400 to-blue-600":x.value>=40?"bg-gradient-to-r from-yellow-400 to-yellow-600":"bg-gradient-to-r from-red-400 to-red-600"}`})})]},x.dimension)})}),e.jsxs(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1,duration:.5},className:"bg-amber-50 rounded-xl p-6 border border-amber-200",children:[e.jsxs("h4",{className:"text-lg font-semibold text-amber-900 mb-4 flex items-center gap-2",children:[e.jsx(J,{size:20}),"改进建议"]}),(()=>{const x=[...t.schedule.issues,...t.cost.issues,...t.resources.issues,...t.risks.issues,...t.quality.issues,...t.team.issues];return x.length===0?e.jsx("p",{className:"text-amber-800 text-sm",children:"当前项目健康状况良好，暂无改进建议。"}):e.jsx("ul",{className:"space-y-2",children:x.slice(0,5).map((w,$)=>e.jsxs(V.li,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:1.1+$*.1,duration:.3},className:"flex items-start gap-2 text-amber-800",children:[e.jsx("span",{className:"text-amber-600 mt-1",children:"•"}),e.jsx("span",{children:w})]},$))})})()]})]})},gs=(r,c)=>{const l=new Date,i=r.totalBudget||0,o=r.actualCost||r.budgetUsed||0;let t=0,a=0;if(c.length===0||i===0)return{pv:0,ev:0,ac:o,sv:0,cv:0,spi:1,cpi:1,bac:i,eac:i,etc:0,vac:0,status:{schedule:"on_track",cost:"on_track"}};const d=c.reduce((j,h)=>{const n=L(h.startDate),g=L(h.endDate);return j+Math.max(1,X(g,n))},0),s=d>0?i/d:0;c.forEach(j=>{const h=L(j.startDate),n=L(j.endDate),g=Math.max(1,X(n,h)),y=g*s;if(l>=h){const S=Math.min(g,Math.max(0,X(l,h)))/g;t+=y*S}const p=j.progress||0;a+=y*(p/100)});const f=a-t,m=a-o,b=t>0?a/t:1,x=o>0?a/o:1,w=x>.1?o+(i-a)/x:o+(i-a),$=w-o,B=i-w,M=b>=1?"ahead":b>=.9?"on_track":"behind",N=x>=1?"under_budget":x>=.9?"on_track":"over_budget";return{pv:t,ev:a,ac:o,sv:f,cv:m,spi:b,cpi:x,bac:i,eac:w,etc:$,vac:B,status:{schedule:M,cost:N}}},fs=(r,c=6)=>{const l=[],i=new Date;for(let a=3;a>0;a--){const d=new Date(i.getFullYear(),i.getMonth()-a,1),s=1-a*.1;l.push({date:I(d,"yyyy-MM"),ac:r.ac*s,ev:r.ev*s,pv:r.pv*s,type:"history"})}l.push({date:I(i,"yyyy-MM"),ac:r.ac,ev:r.ev,pv:r.pv,type:"current"});const o=c,t=r.etc/o;for(let a=1;a<=o;a++){const d=new Date(i.getFullYear(),i.getMonth()+a,1);l.push({date:I(d,"yyyy-MM"),ac:r.ac+t*a,bac:r.bac,type:"forecast"})}return l},js=({project:r,tasks:c})=>{const l=C.useMemo(()=>gs(r,c),[r,c]),i=C.useMemo(()=>fs(l),[l]),o=t=>`¥${Math.round(t).toLocaleString()}`;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-lg border-2 ${l.cpi>=1?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"成本绩效 (CPI)"}),e.jsx(Fe,{size:18,className:l.cpi>=1?"text-green-600":"text-red-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:l.cpi.toFixed(2)}),e.jsx("div",{className:"text-xs mt-1 text-slate-500",children:l.cpi>=1?"预算内":`超支 ${((1-l.cpi)*100).toFixed(0)}%`})]}),e.jsxs("div",{className:`p-4 rounded-lg border-2 ${l.spi>=1?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"进度绩效 (SPI)"}),e.jsx(Fe,{size:18,className:l.spi>=1?"text-green-600":"text-yellow-600"})]}),e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:l.spi.toFixed(2)}),e.jsx("div",{className:"text-xs mt-1 text-slate-500",children:l.spi>=1?"提前":`滞后 ${((1-l.spi)*100).toFixed(0)}%`})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"成本偏差 (CV)"}),e.jsx(se,{size:18,className:l.cv>=0?"text-green-600":"text-red-600"})]}),e.jsxs("div",{className:`text-2xl font-bold ${l.cv>=0?"text-green-600":"text-red-600"}`,children:[l.cv>=0?"+":"",o(l.cv)]}),e.jsx("div",{className:"text-xs mt-1 text-slate-500",children:"EV - AC"})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"进度偏差 (SV)"}),e.jsx($e,{size:18,className:l.sv>=0?"text-green-600":"text-yellow-600"})]}),e.jsxs("div",{className:`text-2xl font-bold ${l.sv>=0?"text-green-600":"text-yellow-600"}`,children:[l.sv>=0?"+":"",o(l.sv)]}),e.jsx("div",{className:"text-xs mt-1 text-slate-500",children:"EV - PV"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white rounded-lg border border-slate-200 p-6",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(ae,{size:20,className:"text-blue-600"}),"完工预测 (EAC)"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-500",children:"完工预算 (BAC)"}),e.jsx("span",{className:"font-medium text-slate-900",children:o(l.bac)})]}),e.jsx("div",{className:"w-full bg-slate-100 rounded-full h-2",children:e.jsx("div",{className:"bg-slate-400 h-2 rounded-full w-full opacity-30"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-500",children:"完工估算 (EAC)"}),e.jsx("span",{className:`font-bold ${l.vac>=0?"text-green-600":"text-red-600"}`,children:o(l.eac)})]}),e.jsxs("div",{className:"w-full bg-slate-100 rounded-full h-2 relative",children:[e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-slate-900 z-10",style:{left:"80%"},title:"BAC"}),e.jsx("div",{className:`h-2 rounded-full ${l.vac>=0?"bg-green-500":"bg-red-500"}`,style:{width:`${Math.min(100,l.eac/(l.bac*1.2)*100)}%`}})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["预计",l.vac>=0?"结余":"超支"," ",o(Math.abs(l.vac))]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900 mb-2",children:"完工尚需 (ETC)"}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:o(l.etc)}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"还需要投入的资金以完成剩余工作"})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-lg border border-slate-200 p-6 flex flex-col",children:[e.jsx("h3",{className:"font-semibold text-slate-900 mb-4",children:"成本趋势预测"}),e.jsxs("div",{className:"flex-1 flex items-end gap-4 min-h-[200px] relative pt-8",children:[i.map((t,a)=>{const d=Math.max(l.eac,l.bac)*1.1,s=(t.ac||t.bac||0)/d*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center group relative",children:[e.jsx("div",{className:`w-full max-w-[40px] rounded-t transition-all ${t.type==="history"?"bg-slate-300":t.type==="current"?"bg-blue-600":"bg-blue-100 border-t-2 border-dashed border-blue-400"}`,style:{height:`${s}%`}}),e.jsx("div",{className:"text-xs text-slate-500 mt-2 rotate-45 origin-top-left",children:t.date}),e.jsxs("div",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-slate-900 text-white text-xs p-2 rounded z-10 whitespace-nowrap",children:[e.jsx("div",{children:t.date}),e.jsxs("div",{children:[t.type==="forecast"?"预测":"实际",": ",o(t.ac||t.bac||0)]})]})]},a)}),e.jsx("div",{className:"absolute left-0 right-0 border-t-2 border-dashed border-slate-400 pointer-events-none flex items-center",style:{bottom:`${l.bac/(Math.max(l.eac,l.bac)*1.1)*100}%`},children:e.jsx("span",{className:"bg-white text-xs text-slate-500 px-1 ml-2",children:"BAC (预算)"})})]})]})]}),l.vac<0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(Ce,{className:"text-red-600 mt-0.5 flex-shrink-0",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-900 mb-1",children:"成本超支预警"}),e.jsxs("p",{className:"text-sm text-red-700 mb-2",children:["按照当前绩效 (CPI = ",l.cpi.toFixed(2),")，项目预计将超支 ",o(Math.abs(l.vac)),"。"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-3 py-1 bg-red-100 text-red-700 rounded text-xs font-medium hover:bg-red-200 transition-colors",children:"查看详细支出"}),e.jsx("button",{className:"px-3 py-1 bg-white border border-red-200 text-red-700 rounded text-xs font-medium hover:bg-red-50 transition-colors",children:"申请预算变更"})]})]})]})]})},vs=({project:r,onCreateBaseline:c,onSetActiveBaseline:l,currentUserId:i,currentUserName:o})=>{const[t,a]=C.useState(!1),[d,s]=C.useState(""),[f,m]=C.useState(""),b=r.baselines||[],x=lt(r),w=()=>{if(!d.trim())return;const M=rt(r,d,f,i,o);c(M),a(!1),s(""),m("")},$=M=>M?nt(r,M):null,B=({variance:M,unit:N})=>{const j=ot(M),h=j==="good"?"text-green-600":j==="warning"?"text-orange-600":"text-red-600",n=M>0?ae:M<0?Ue:J;return e.jsxs("div",{className:`flex items-center gap-1 ${h} text-sm font-medium`,children:[e.jsx(n,{size:14}),e.jsx("span",{children:it(M,N)})]})};return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ot,{className:"text-blue-600 dark:text-blue-400",size:20}),e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:"基线管理"}),e.jsxs("span",{className:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs font-medium rounded-full",children:[b.length," 个基线"]})]}),e.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(de,{size:16}),"创建基线"]})]})}),e.jsx(ze,{children:t&&e.jsx(V.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 overflow-hidden",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"基线名称 *"}),e.jsx("input",{type:"text",value:d,onChange:M=>s(M.target.value),placeholder:"例如: Baseline 1.0",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"描述"}),e.jsx("textarea",{value:f,onChange:M=>m(M.target.value),placeholder:"说明创建此基线的原因...",rows:2,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:w,disabled:!d.trim(),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(De,{size:16}),"创建"]}),e.jsxs("button",{onClick:()=>{a(!1),s(""),m("")},className:"flex items-center gap-2 px-4 py-2 bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg text-sm font-medium transition-colors",children:[e.jsx(le,{size:16}),"取消"]})]})]})})}),e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:b.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-500 dark:text-slate-400",children:[e.jsx(Me,{size:48,className:"mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"暂无基线"}),e.jsx("p",{className:"text-xs mt-1",children:"创建基线以跟踪项目变更和偏差"})]}):b.map(M=>{const N=(x==null?void 0:x.id)===M.id,j=$(M);return e.jsx("div",{className:`p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors ${N?"bg-blue-50/50 dark:bg-blue-900/10 border-l-4 border-blue-600":""}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-slate-100",children:M.name}),N&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-600 text-white text-xs font-medium rounded-full",children:"当前基线"})]}),M.description&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:M.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{size:12}),I(new Date(M.createdDate),"yyyy-MM-dd HH:mm")]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(at,{size:12}),M.createdByName||M.createdBy]})]}),N&&j&&e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-2 border border-slate-200 dark:border-slate-600",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"进度偏差"}),e.jsx(B,{variance:j.scheduleVariance,unit:"days"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-2 border border-slate-200 dark:border-slate-600",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"成本偏差"}),e.jsx(B,{variance:j.costVariance,unit:"currency"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-2 border border-slate-200 dark:border-slate-600",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"预算偏差"}),e.jsx(B,{variance:j.budgetVariancePercent,unit:"percent"})]})]})]}),!N&&e.jsx("button",{onClick:()=>l(M.id),className:"ml-4 px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:hover:bg-blue-900/20 rounded-lg transition-colors",children:"设为当前"})]})},M.id)})})]})},qe={standard:[{id:"gate-1",stage:"initiation",name:"Gate 1: 项目启动审批",description:"项目章程和初步范围定义",requirements:[{id:"req-1-1",description:"项目章程已编制",required:!0,completed:!1},{id:"req-1-2",description:"干系人已识别",required:!0,completed:!1},{id:"req-1-3",description:"初步预算已批准",required:!0,completed:!1}],status:"pending"},{id:"gate-2",stage:"planning",name:"Gate 2: 计划审批",description:"详细项目计划和资源分配",requirements:[{id:"req-2-1",description:"项目计划已完成",required:!0,completed:!1},{id:"req-2-2",description:"风险评估已完成",required:!0,completed:!1},{id:"req-2-3",description:"资源已分配",required:!0,completed:!1},{id:"req-2-4",description:"质量标准已定义",required:!1,completed:!1}],status:"pending"},{id:"gate-3",stage:"execution",name:"Gate 3: 执行审批",description:"开始项目执行",requirements:[{id:"req-3-1",description:"团队已组建",required:!0,completed:!1},{id:"req-3-2",description:"启动会议已召开",required:!0,completed:!1},{id:"req-3-3",description:"基线已建立",required:!0,completed:!1}],status:"pending"},{id:"gate-4",stage:"monitoring",name:"Gate 4: 监控审批",description:"项目进度和质量监控",requirements:[{id:"req-4-1",description:"进度报告机制已建立",required:!0,completed:!1},{id:"req-4-2",description:"变更控制流程已实施",required:!0,completed:!1},{id:"req-4-3",description:"质量检查点已设置",required:!1,completed:!1}],status:"pending"},{id:"gate-5",stage:"closing",name:"Gate 5: 项目收尾",description:"项目验收和总结",requirements:[{id:"req-5-1",description:"所有交付物已完成",required:!0,completed:!1},{id:"req-5-2",description:"客户验收已获得",required:!0,completed:!1},{id:"req-5-3",description:"经验教训已总结",required:!0,completed:!1},{id:"req-5-4",description:"项目文档已归档",required:!1,completed:!1}],status:"pending"}]};function ve(r){return{initiation:"启动",planning:"计划",execution:"执行",monitoring:"监控",closing:"收尾"}[r]}function ke(r){const c=["initiation","planning","execution","monitoring","closing"],l=c.indexOf(r);return l<c.length-1?c[l+1]:null}function ys(r){return r.requirements.filter(l=>l.required).every(l=>l.completed)}function Ns(r){const c=r.requirements.length;if(c===0)return 100;const l=r.requirements.filter(i=>i.completed).length;return Math.round(l/c*100)}function Oe(r){return{pending:"text-slate-600 bg-slate-100 dark:text-slate-400 dark:bg-slate-700",approved:"text-green-600 bg-green-100 dark:text-green-400 dark:bg-green-900/20",rejected:"text-red-600 bg-red-100 dark:text-red-400 dark:bg-red-900/20",conditional:"text-orange-600 bg-orange-100 dark:text-orange-400 dark:bg-orange-900/20"}[r]}function He(r){return{pending:"待审批",approved:"已批准",rejected:"已拒绝",conditional:"有条件批准"}[r]}function ws(r,c,l,i,o){return{...r,status:o&&o.length>0?"conditional":"approved",approvedBy:c,approvedByName:l,approvalDate:new Date().toISOString(),comments:i,conditions:o}}function ks(r,c,l,i){return{...r,status:"rejected",approvedBy:c,approvedByName:l,approvalDate:new Date().toISOString(),comments:i}}function Cs(r,c,l,i,o){return{...r,requirements:r.requirements.map(t=>t.id===c?{...t,completed:l,completedDate:l?new Date().toISOString():void 0,completedBy:l?i:void 0,evidence:l?o:void 0}:t)}}const Ms=({project:r,onUpdateGate:c,onMoveToNextStage:l,currentUserId:i,currentUserName:o,userRole:t})=>{const[a,d]=C.useState(null),[s,f]=C.useState(""),[m,b]=C.useState(""),x=t==="admin"||t==="manager",w=["initiation","planning","execution","monitoring","closing"].indexOf(r.currentStage),$=(j,h,n)=>{const g=Cs(j,h,n,i);c(g)},B=j=>{const h=m.trim()?m.split(`
`).filter(g=>g.trim()):void 0,n=ws(j,i,o,s||void 0,h);c(n),d(null),f(""),b("")},M=j=>{if(!s.trim()){alert("请输入拒绝原因");return}const h=ks(j,i,o,s);c(h),d(null),f("")},N=({stage:j,index:h})=>{const n=h===w,g=h<w,y=r.gates.find(p=>p.stage===j);return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`relative flex items-center justify-center w-16 h-16 rounded-full border-4 ${g?"border-green-500 bg-green-100 dark:bg-green-900/20":n?"border-blue-500 bg-blue-100 dark:bg-blue-900/20":"border-slate-300 dark:border-slate-600 bg-slate-100 dark:bg-slate-800"}`,children:g?e.jsx(oe,{className:"text-green-600 dark:text-green-400",size:32}):n?e.jsx(ie,{className:"text-blue-600 dark:text-blue-400",size:32}):e.jsx(ie,{className:"text-slate-400 dark:text-slate-600",size:32})}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("div",{className:`text-sm font-semibold ${n?"text-blue-600 dark:text-blue-400":"text-slate-700 dark:text-slate-300"}`,children:ve(j)}),y&&e.jsx("div",{className:`text-xs mt-1 px-2 py-0.5 rounded-full inline-block ${Oe(y.status)}`,children:He(y.status)})]})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-slate-100 mb-6",children:"项目阶段进度"}),e.jsx("div",{className:"flex items-center justify-between",children:["initiation","planning","execution","monitoring","closing"].map((j,h)=>e.jsxs(dt.Fragment,{children:[e.jsx(N,{stage:j,index:h}),h<4&&e.jsx(We,{className:`mx-2 ${h<w?"text-green-600 dark:text-green-400":"text-slate-300 dark:text-slate-600"}`,size:24})]},j))})]}),e.jsx("div",{className:"space-y-4",children:r.gates.map((j,h)=>{const n=Ns(j),g=ys(j),y=a===j.id;return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",onClick:()=>d(y?null:j.id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:j.name}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${Oe(j.status)}`,children:He(j.status)})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:j.description})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("div",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:[n,"%"]}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"完成度"})]})]}),e.jsx("div",{className:"mt-3 h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx(V.div,{initial:{width:0},animate:{width:`${n}%`},className:`h-full ${n===100?"bg-green-500":n>=50?"bg-blue-500":"bg-orange-500"}`})})]}),e.jsx(ze,{children:y&&e.jsx(V.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100 mb-3",children:"检查清单"}),e.jsx("div",{className:"space-y-2",children:j.requirements.map(p=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 dark:bg-slate-900/50 rounded-lg",children:[e.jsx("button",{onClick:()=>x&&$(j,p.id,!p.completed),disabled:!x||j.status==="approved",className:`flex-shrink-0 w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${p.completed?"bg-green-500 border-green-500":"border-slate-300 dark:border-slate-600 hover:border-green-500"} ${!x||j.status==="approved"?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:p.completed&&e.jsx(De,{size:14,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm ${p.completed?"text-slate-500 dark:text-slate-400 line-through":"text-slate-900 dark:text-slate-100"}`,children:p.description}),p.required&&e.jsx("span",{className:"px-2 py-0.5 bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-400 text-xs rounded-full",children:"必需"})]}),p.completedDate&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["完成于 ",new Date(p.completedDate).toLocaleDateString("zh-CN"),p.completedBy&&` by ${p.completedBy}`]})]})]},p.id))})]}),x&&j.status==="pending"&&e.jsxs("div",{className:"pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("h5",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100 mb-3",children:"审批决策"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"审批意见"}),e.jsx("textarea",{value:s,onChange:p=>f(p.target.value),rows:2,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 resize-none",placeholder:"输入审批意见..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"附加条件（可选，每行一个）"}),e.jsx("textarea",{value:m,onChange:p=>b(p.target.value),rows:2,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100 resize-none",placeholder:"例如：需在2周内完成XX任务"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>B(j),disabled:!g,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(oe,{size:16}),"批准通过"]}),e.jsxs("button",{onClick:()=>M(j),className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(Lt,{size:16}),"拒绝"]})]}),!g&&e.jsxs("p",{className:"text-xs text-orange-600 dark:text-orange-400 flex items-center gap-1",children:[e.jsx(J,{size:12}),"请先完成所有必需项才能批准"]})]})]}),j.status!=="pending"&&e.jsx("div",{className:"pt-4 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-slate-50 dark:bg-slate-900/50 rounded-lg",children:[e.jsx(Me,{size:16,className:"text-slate-600 dark:text-slate-400 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:[j.approvedByName||j.approvedBy," · ",new Date(j.approvalDate).toLocaleDateString("zh-CN")]}),j.comments&&e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:j.comments}),j.conditions&&j.conditions.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs font-medium text-orange-700 dark:text-orange-400 mb-1",children:"附加条件："}),e.jsx("ul",{className:"list-disc list-inside text-sm text-slate-600 dark:text-slate-400",children:j.conditions.map((p,v)=>e.jsx("li",{children:p},v))})]})]})]})})]})})})]},j.id)})}),x&&ke(r.currentStage)&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100",children:"准备进入下一阶段？"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:["当前阶段：",ve(r.currentStage)," → 下一阶段：",ve(ke(r.currentStage))]})]}),e.jsx("button",{onClick:l,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:"进入下一阶段"})]})})]})},al=()=>{const{projectId:r}=ct(),c=xt(),{projects:l,updateProject:i}=Ve(),o=mt(),t=l.find(n=>n.id===r),[a,d]=C.useState(!1),[s,f]=C.useState("diagram"),[m,b]=C.useState(!1);if(!t)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"项目未找到"}),e.jsx("button",{onClick:()=>c("/projects"),className:"text-blue-600 hover:underline",children:"返回项目列表"})]})});const x=t.costHistory||[],w=t.budget||1e6,$=C.useMemo(()=>we(t,t.tasks||[],l),[t,l]),B=n=>n>=80?"text-green-600 bg-green-50 border-green-200":n>=60?"text-blue-600 bg-blue-50 border-blue-200":n>=40?"text-orange-600 bg-orange-50 border-orange-200":"text-red-600 bg-red-50 border-red-200",M=n=>{const g=t.tasks||[],y=g.findIndex(v=>v.id===n.id);let p;y>=0?(p=[...g],p[y]=n):p=[...g,n],i(t.id,{...t,tasks:p})},N=n=>{const y=[...t.tasks||[],n];i(t.id,{...t,tasks:y})},j=n=>{const y=(t.tasks||[]).filter(p=>p.id!==n);i(t.id,{...t,tasks:y})},h=(n,g)=>{const y=n.reduce((p,v)=>p+v.amount,0);i(t.id,{...t,costHistory:n,budget:g||t.budget,actualCost:y}),b(!1)};return e.jsxs("div",{className:"flex flex-col h-screen bg-slate-50 overflow-hidden",children:[e.jsxs("div",{className:"bg-white border-b border-slate-200 px-4 py-2 flex items-center justify-between shadow-sm z-20 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>c("/projects"),className:"p-2 hover:bg-slate-100 rounded-full text-slate-500",children:e.jsx(Te,{size:20})}),e.jsx("div",{className:"h-6 w-px bg-slate-200"}),a?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:t.name,onChange:n=>i(t.id,{...t,name:n.target.value}),className:"font-bold text-lg border-b border-blue-500 focus:outline-none px-1"}),e.jsxs("select",{value:t.status,onChange:n=>i(t.id,{...t,status:n.target.value}),className:"text-sm bg-slate-50 border rounded px-2 py-1",children:[e.jsx("option",{value:"planning",children:"规划中"}),e.jsx("option",{value:"active",children:"进行中"}),e.jsx("option",{value:"completed",children:"已完成"}),e.jsx("option",{value:"on-hold",children:"暂停"})]}),e.jsxs("select",{value:t.priority,onChange:n=>i(t.id,{...t,priority:n.target.value}),className:"text-sm bg-slate-50 border rounded px-2 py-1",children:[e.jsx("option",{value:"P0",children:"P0 - 紧急"}),e.jsx("option",{value:"P1",children:"P1 - 高"}),e.jsx("option",{value:"P2",children:"P2 - 中"}),e.jsx("option",{value:"P3",children:"P3 - 低"})]})]}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"font-bold text-lg text-slate-800 dark:text-slate-100",children:t.name}),e.jsx(Ae,{variant:t.status==="active"?"success":t.status==="planning"?"primary":"neutral",size:"sm",children:t.status}),e.jsx(Ae,{variant:t.priority==="P0"?"danger":t.priority==="P1"?"warning":"primary",size:"sm",children:t.priority}),e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-0.5 rounded-full border text-xs font-bold ${B($.overall)}`,children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-current"}),e.jsxs("span",{children:[$.overall," 分"]})]})]}),e.jsx("button",{onClick:()=>d(!a),className:`p-1.5 rounded-lg transition-colors ${a?"bg-blue-100 text-blue-600":"hover:bg-slate-100 text-slate-400"}`,children:a?e.jsx(De,{size:16}):e.jsx(Tt,{size:16})})]}),e.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>f("diagram"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all ${s==="diagram"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(ut,{size:16})," 任务视图"]}),e.jsxs("button",{onClick:()=>f("resources"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all ${s==="resources"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(me,{size:16})," 资源"]}),e.jsxs("button",{onClick:()=>c(`/projects/${t.id}/risks`),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all relative ${s==="risks"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(Ce,{size:16})," 风险",t.risks&&t.risks.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-500 rounded-full",children:t.risks.filter(n=>n.status!=="resolved"&&n.status!=="accepted").length})]}),e.jsxs("button",{onClick:()=>f("costs"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all ${s==="costs"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(se,{size:16})," 成本"]}),e.jsxs("button",{onClick:()=>f("analytics"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all ${s==="analytics"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(ht,{size:16})," 高级分析"]}),e.jsxs("button",{onClick:()=>f("strategy"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all ${s==="strategy"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx($e,{size:16})," 战略评分"]}),e.jsxs("button",{onClick:()=>f("baseline"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all ${s==="baseline"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(Et,{size:16})," 基线管理"]}),e.jsxs("button",{onClick:()=>f("stagegate"),className:`px-3 py-1.5 text-sm font-medium rounded-md flex items-center gap-2 transition-all ${s==="stagegate"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(Gt,{size:16})," 阶段门径"]})]})]}),e.jsxs("div",{className:"flex-1 relative overflow-hidden bg-slate-50",children:[s==="diagram"&&e.jsx(ls,{tasks:t.tasks||[],projectName:t.name,onTaskUpdate:M,onTaskAdd:N,onTaskDelete:j}),s==="risks"&&e.jsx("div",{className:"h-full overflow-auto p-6 max-w-7xl mx-auto",children:e.jsx(rs,{project:t,risks:t.risks||[],onRisksChange:n=>i(t.id,{...t,risks:n})})}),s==="costs"&&e.jsxs("div",{className:"h-full overflow-auto p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"成本概览"}),e.jsxs("p",{className:"text-sm text-slate-500",children:["预算: $",w.toLocaleString()," | 实际: $",x.reduce((n,g)=>n+g.amount,0).toLocaleString()]})]}),e.jsx(At,{onClick:()=>b(!0),variant:"primary",icon:se,children:"登记成本"})]}),e.jsxs("div",{className:"space-y-3",children:[x.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600",children:e.jsx(se,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900",children:n.description}),e.jsxs("div",{className:"text-xs text-slate-500",children:[n.date," · ",n.category]})]})]}),e.jsxs("div",{className:"font-bold text-slate-900",children:["$",n.amount.toLocaleString()]})]},n.id)),x.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 text-sm",children:"暂无成本记录"})]})]}),s==="analytics"&&e.jsxs("div",{className:"h-full overflow-auto p-6 max-w-7xl mx-auto space-y-6",children:[e.jsx(bs,{project:t,tasks:t.tasks||[],allProjects:l}),e.jsx(js,{project:t,tasks:t.tasks||[]})]}),s==="strategy"&&e.jsx("div",{className:"h-full overflow-hidden max-w-7xl mx-auto",children:e.jsx(is,{project:t,onUpdate:n=>i(t.id,{...t,...n})})}),s==="resources"&&e.jsx(as,{project:t,resourcePool:o}),s==="baseline"&&e.jsx("div",{className:"h-full overflow-auto p-6 max-w-7xl mx-auto",children:e.jsx(vs,{project:t,onCreateBaseline:n=>{const g=[...t.baselines||[],n];i(t.id,{...t,baselines:g,activeBaselineId:n.id})},onSetActiveBaseline:n=>{i(t.id,{...t,activeBaselineId:n})},currentUserId:"current-user",currentUserName:t.manager||"项目经理"})}),s==="stagegate"&&e.jsx("div",{className:"h-full overflow-auto p-6 max-w-7xl mx-auto",children:e.jsx(Ms,{project:{...t,currentStage:t.currentStage||"initiation",gates:t.gates||qe.standard},onUpdateGate:n=>{const y=(t.gates||qe.standard).map(p=>p.id===n.id?n:p);i(t.id,{...t,gates:y})},onMoveToNextStage:()=>{const n=t.currentStage||"initiation",g=ke(n);g&&i(t.id,{...t,currentStage:g})},currentUserId:"current-user",currentUserName:t.manager||"项目经理",userRole:"admin"})})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"登记项目成本"}),e.jsx("button",{onClick:()=>b(!1),className:"text-slate-400 hover:text-slate-600",children:e.jsx(Te,{size:24,className:"rotate-180"})})]}),e.jsx(ns,{projectId:t.id,projectName:t.name,budget:w,existingCosts:x,onSave:h,onClose:()=>b(!1)})]})})})]})};export{al as default};
