import{e as _,u as A,a as H,r as p,j as e,D as W,C as X,b as Z,X as G}from"./index-2kGYW54C.js";import{D as J}from"./download-C254R4xA.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=_("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]),se=()=>{const{addProject:R,factorDefinitions:h}=A(),{t}=H(),N=p.useRef(null),[w,v]=p.useState(!1),[i,u]=p.useState(null),[y,f]=p.useState(!1),F=()=>{const a=["Name","Description","Status","Priority","Start Date","End Date","Category","Department","Budget",...h.map(m=>m.name)],r=["Sample Project","This is a sample project description","planning","P1","2025-01-01","2025-12-31","web","IT Department","1000000",...h.map(()=>"5")],l=[a.join(","),r.join(",")].join(`
`),c=new Blob([l],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(c),n.download="project_import_template.csv",n.click()},E=a=>a.split(`
`).filter(l=>l.trim()).map(l=>l.split(",").map(c=>c.trim())),I=async a=>{var r;v(!0),u(null);try{const l=await a.text(),c=E(l);if(c.length<2)throw new Error("File is empty or invalid");const n=c[0],m=c.slice(1);let C=0,D=0;const k=[],b=n.findIndex(s=>s.toLowerCase().includes("name")),P=n.findIndex(s=>s.toLowerCase().includes("desc")),T=n.findIndex(s=>s.toLowerCase().includes("status")),O=n.findIndex(s=>s.toLowerCase().includes("priority")),U=n.findIndex(s=>s.toLowerCase().includes("start")),$=n.findIndex(s=>s.toLowerCase().includes("end")),q=n.findIndex(s=>s.toLowerCase().includes("category")),B=n.findIndex(s=>s.toLowerCase().includes("dept")||s.toLowerCase().includes("部门")),L=n.findIndex(s=>s.toLowerCase().includes("budget")||s.toLowerCase().includes("预算"));for(let s=0;s<m.length;s++){const o=m[s],S=s+2;try{if(!o[b]||o[b].trim()==="")throw new Error(`Row ${S}: Name is required`);const d={};h.forEach((g,Q)=>{const j=n.findIndex(x=>x===g.name);if(j!==-1&&o[j]){const x=parseInt(o[j]);d[g.id]=isNaN(x)?5:Math.min(10,Math.max(0,x))}else d[g.id]=5});const V={id:Math.random().toString(36).substr(2,9),name:o[b],description:o[P]||"",status:((r=o[T])==null?void 0:r.toLowerCase())||"planning",priority:o[O]||"P2",startDate:o[U]||"",endDate:o[$]||"",category:o[q]||"custom",department:o[B]||"",budget:o[L]?parseInt(o[L]):0,factors:d,score:0,resourceRequirements:[]};R(V),C++}catch(d){D++,k.push(d instanceof Error?d.message:`Row ${S}: Unknown error`)}}u({success:C,failed:D,errors:k})}catch(l){u({success:0,failed:0,errors:[l instanceof Error?l.message:"Failed to parse file"]})}finally{v(!1)}},M=a=>{a.preventDefault(),f(!1);const r=a.dataTransfer.files;if(r.length>0){const l=r[0];l.type==="text/csv"||l.name.endsWith(".csv")?I(l):alert("Please upload a CSV file")}},z=a=>{const r=a.target.files;r&&r.length>0&&I(r[0])};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:t("import.title")}),e.jsx("p",{className:"text-slate-500 mt-1",children:t("import.subtitle")})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsx(K,{className:"text-blue-600",size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-slate-900 mb-1",children:t("import.downloadTemplate")}),e.jsx("p",{className:"text-sm text-slate-600 mb-3",children:t("import.templateDescription")}),e.jsxs("button",{onClick:F,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg inline-flex items-center gap-2 text-sm font-medium transition-colors",children:[e.jsx(J,{size:16}),t("import.downloadCSV")]})]})]})}),e.jsxs("div",{className:`border-2 border-dashed rounded-2xl p-12 text-center transition-all ${y?"border-blue-400 bg-blue-50":"border-slate-300 bg-white hover:border-blue-400 hover:bg-blue-50/50"}`,onDragOver:a=>{a.preventDefault(),f(!0)},onDragLeave:()=>f(!1),onDrop:M,children:[e.jsx("input",{ref:N,type:"file",accept:".csv",onChange:z,className:"hidden"}),e.jsx(W,{className:"mx-auto text-slate-400 mb-4",size:48}),e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-2",children:t(y?"import.dropFile":"import.uploadFile")}),e.jsx("p",{className:"text-slate-500 mb-4",children:t("import.dragOrClick")}),e.jsx("button",{onClick:()=>{var a;return(a=N.current)==null?void 0:a.click()},disabled:w,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:t(w?"import.importing":"import.selectFile")})]}),i&&e.jsx("div",{className:`rounded-2xl p-6 border-2 ${i.failed===0?"bg-green-50 border-green-200":"bg-orange-50 border-orange-200"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 ${i.failed===0?"bg-green-100":"bg-orange-100"}`,children:i.failed===0?e.jsx(X,{className:"text-green-600",size:24}):e.jsx(Z,{className:"text-orange-600",size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-slate-900 mb-2",children:t("import.importComplete")}),e.jsxs("div",{className:"space-y-1 text-sm mb-3",children:[e.jsxs("p",{className:"text-green-700",children:["✓ ",i.success," ",t("import.projectsImported")]}),i.failed>0&&e.jsxs("p",{className:"text-orange-700",children:["✗ ",i.failed," ",t("import.projectsFailed")]})]}),i.errors.length>0&&e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-orange-200",children:[e.jsxs("h4",{className:"font-bold text-sm text-slate-900 mb-2",children:[t("import.errors"),":"]}),e.jsx("ul",{className:"text-xs text-slate-600 space-y-1 max-h-40 overflow-y-auto",children:i.errors.map((a,r)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(G,{size:12,className:"text-red-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:a})]},r))})]})]})]})}),e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-6",children:[e.jsx("h3",{className:"font-bold text-slate-900 mb-3",children:t("import.instructions")}),e.jsxs("ol",{className:"space-y-2 text-sm text-slate-600",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-blue-600",children:"1."}),e.jsx("span",{children:t("import.step1")})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-blue-600",children:"2."}),e.jsx("span",{children:t("import.step2")})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-blue-600",children:"3."}),e.jsx("span",{children:t("import.step3")})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-bold text-blue-600",children:"4."}),e.jsx("span",{children:t("import.step4")})]})]})]})]})};export{se as default};
