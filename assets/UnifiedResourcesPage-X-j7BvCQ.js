import{o as q,ao as Z,r as N,j as e,C as D,$ as ge,g as T,a2 as Ne,_ as te,R as B,a0 as $e,i as V,X as G,Y as H,k as O,a1 as Ee,n as E,B as L,ap as ve,T as F,ah as Oe,aq as ye,m as we,a4 as K,h as ke,l as ae,u as Q,V as me,q as ie,v as he,A as X,d as ee,p as $,c as W,am as Fe,ar as Ie,as as ne,aj as ce,U as Y,al as Le,G as Te,J as ue,a as Se,f as J,at as Ue,a5 as pe,au as Be,a6 as qe,a7 as Qe,a8 as Ke,a9 as We,aa as be,D as _e,av as Ve,e as Ge,aw as He}from"./index-BvQyAdiV.js";import{a as Je,b as Xe,c as Ye,S as Ze,g as ze,d as Ce,e as es,E as ss}from"./EnhancedResourceTimeline-D74AFK0t.js";import{a as De,L as ts}from"./LineChart-DWu9qlAM.js";import{P as Me,a as Re}from"./PieChart-B80Mv7Bs.js";import{S as se}from"./save-DmJgRhpq.js";import{P as le}from"./plus-CjGNTfrT.js";import{f as I}from"./format-BaDDL2Yc.js";import{a as U}from"./eachDayOfInterval-B8Wvjce2.js";import{C as as}from"./CostAnalysis-bsa18Ti-.js";import{T as Ae}from"./target-EwM4tyRW.js";import ls from"./AIDecisionDashboard-CBVYvspD.js";import{A as rs}from"./arrow-down-right-6cuIY2cT.js";import{P as is,a as ns}from"./PageHeader-BNhrp11Q.js";import"./addWeeks-DBFXsJNP.js";import"./endOfWeek-BLqtcsTo.js";import"./chevron-left-IrjyfQG2.js";import"./chevron-right-DFoHNZMg.js";import"./lightbulb-Dk4uKlMX.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=q("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=q("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=q("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=q("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=q("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);function je(o,d){const r=+Z(o),[u,c]=[+Z(d.start),+Z(d.end)].sort((a,x)=>a-x);return r>=u&&r<=c}const hs=({projects:o,resourcePool:d})=>{const r=N.useMemo(()=>Je(d,o,6),[o,d]),u=N.useMemo(()=>Xe(r,d),[r,d]),c=N.useMemo(()=>{const a={};return r.forEach(x=>{const i=d.find(h=>h.id===x.resourceId),t=(i==null?void 0:i.totalQuantity)||0;x.predictions.forEach(h=>{a[h.month]||(a[h.month]={month:h.month,predicted:0,capacity:0}),a[h.month].predicted+=h.predicted,a[h.month].capacity+=t})}),Object.values(a).sort((x,i)=>x.month.localeCompare(i.month))},[r,d]);return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-700",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(D,{className:"p-6 bg-gradient-to-br from-indigo-900 to-slate-900 text-white border-none shadow-xl lg:col-span-2",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-indigo-500/20 rounded-lg",children:e.jsx(ge,{className:"text-indigo-400",size:24})}),e.jsx("h3",{className:"text-xl font-bold",children:"AI 资源风险预测引擎"})]}),e.jsxs("p",{className:"text-indigo-100/80 max-w-xl mb-6 leading-relaxed",children:["基于线性回归与移动平均算法，系统已对未来 6 个月的资源平衡进行了深度扫描。 预测显示 ",u.summary]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"bg-white/10 px-4 py-2 rounded-xl backdrop-blur-sm border border-white/10",children:[e.jsx("div",{className:"text-xs text-indigo-300 mb-1",children:"风险警告"}),e.jsxs("div",{className:"text-2xl font-bold flex items-center gap-2",children:[u.warnings.length,u.warnings.length>0&&e.jsx(T,{size:18,className:"text-amber-400"})]})]}),e.jsxs("div",{className:"bg-white/10 px-4 py-2 rounded-xl backdrop-blur-sm border border-white/10",children:[e.jsx("div",{className:"text-xs text-indigo-300 mb-1",children:"优化建议"}),e.jsx("div",{className:"text-2xl font-bold",children:u.opportunities.length})]}),e.jsxs("div",{className:"bg-white/10 px-4 py-2 rounded-xl backdrop-blur-sm border border-white/10",children:[e.jsx("div",{className:"text-xs text-indigo-300 mb-1",children:"预测置信度"}),e.jsx("div",{className:"text-2xl font-bold",children:"88.5%"})]})]})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(Ne,{className:"text-indigo-500/30 w-32 h-32"})})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs(D,{className:"p-4 bg-emerald-50 dark:bg-emerald-900/10 border-emerald-100 dark:border-emerald-800/20 h-full",children:[e.jsxs("h4",{className:"font-bold text-emerald-900 dark:text-emerald-400 mb-3 flex items-center gap-2",children:[e.jsx(te,{size:18}),"优化路径推荐"]}),e.jsxs("div",{className:"space-y-3",children:[u.opportunities.slice(0,3).map((a,x)=>e.jsxs("div",{className:"flex gap-2 text-sm text-emerald-800 dark:text-emerald-300/80",children:[e.jsx("div",{className:"mt-1 flex-shrink-0 animate-pulse bg-emerald-400 w-1.5 h-1.5 rounded-full"}),a]},x)),u.opportunities.length===0&&e.jsx("p",{className:"text-slate-500 text-sm",children:"暂未发现明显的资源冗余优化空间。"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(D,{className:"p-6 lg:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:"总体人力负载预测趋势 (6M)"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"未来半年总资源需求 vs 总可用容量"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-indigo-500"}),e.jsx("span",{className:"text-xs text-slate-500 font-medium",children:"预测负载"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-slate-200"}),e.jsx("span",{className:"text-xs text-slate-500 font-medium",children:"基准容量"})]})]})]}),e.jsx("div",{className:"h-[300px] w-full mt-4",children:e.jsx(B,{width:"100%",height:"100%",children:e.jsxs($e,{data:c,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorLoad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#6366f1",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#6366f1",stopOpacity:0})]})}),e.jsx(V,{strokeDasharray:"3 3",vertical:!1,stroke:"#e2e8f0"}),e.jsx(G,{dataKey:"month",axisLine:!1,tickLine:!1,tick:{fontSize:12,fill:"#64748b"},dy:10}),e.jsx(H,{axisLine:!1,tickLine:!1,tick:{fontSize:12,fill:"#64748b"}}),e.jsx(O,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.1)"},cursor:{stroke:"#6366f1",strokeWidth:2}}),e.jsx(Ee,{type:"monotone",dataKey:"predicted",stroke:"#6366f1",strokeWidth:3,fillOpacity:1,fill:"url(#colorLoad)",name:"预测需求"}),e.jsx(De,{type:"stepAfter",dataKey:"capacity",stroke:"#cbd5e1",strokeWidth:2,strokeDasharray:"5 5",dot:!1,name:"资源容量"})]})})})]}),e.jsxs(D,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center justify-between",children:["待处理风险项",e.jsx(E,{variant:"danger",children:u.warnings.length})]}),e.jsxs("div",{className:"space-y-4",children:[u.warnings.map((a,x)=>e.jsx("div",{className:"group p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-100 dark:border-slate-700 hover:border-red-200 dark:hover:border-red-900/50 transition-all cursor-pointer",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 rounded-lg",children:e.jsx(T,{size:18})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-slate-800 dark:text-slate-200 leading-snug",children:a}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-slate-500 uppercase tracking-wider font-bold",children:"高优先级"}),e.jsxs(L,{variant:"ghost",size:"sm",className:"h-6 px-1 py-0 text-blue-600 hover:text-blue-700",children:["自动寻找替补 ",e.jsx(ve,{size:12,className:"ml-1"})]})]})]})]})},x)),u.warnings.length===0&&e.jsxs("div",{className:"py-12 text-center text-slate-400",children:[e.jsx(F,{size:48,className:"mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"未来预测期内无显著负载风险"})]})]})]})]}),e.jsxs(D,{className:"p-6 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:"资源预测明细 (By Role)"}),e.jsx("p",{className:"text-sm text-slate-500",children:"分角色查看未来负载动态"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),e.jsx("input",{type:"text",placeholder:"搜索资源角色...",className:"pl-9 pr-4 py-2 border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all w-48"})]}),e.jsxs(L,{variant:"secondary",size:"sm",className:"h-9",children:[e.jsx(ye,{size:16,className:"mr-2"})," 筛选"]})]})]}),e.jsx("div",{className:"overflow-x-auto -mx-6",children:e.jsxs("table",{className:"w-full text-left border-collapse min-w-[800px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 dark:bg-slate-800/50 border-y border-slate-100 dark:border-slate-700",children:[e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-widest",children:"资源角色"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-widest text-center",children:"当前余量"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-widest text-center",children:"未来趋势"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-widest",children:"未来 6 个月预估负载"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-widest text-right",children:"风险系数"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800/50",children:r.map(a=>{const x=d.find(m=>m.id===a.resourceId),i=0,t=(x==null?void 0:x.totalQuantity)||1,h=a.peakLoad/t*100;return e.jsxs("tr",{className:"hover:bg-slate-50/50 dark:hover:bg-slate-800/30 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100",children:a.resourceName}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Total Capacity: ",t]})]}),e.jsx("td",{className:"px-6 py-4 text-center text-sm font-medium",children:e.jsx("span",{className:t-i>0?"text-emerald-600":"text-red-500",children:t-i})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex justify-center",children:a.trend==="increasing"?e.jsxs(E,{variant:"danger",className:"gap-1 animate-bounce",children:[e.jsx(F,{size:12})," 上升"]}):a.trend==="decreasing"?e.jsxs(E,{variant:"success",className:"gap-1",children:[e.jsx(F,{className:"rotate-180",size:12})," 下降"]}):e.jsx(E,{variant:"neutral",children:"稳定"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex items-end gap-1 h-12",children:a.predictions.map((m,j)=>{const s=m.predicted/(t*1.5)*100,l=m.predicted>t;return e.jsx("div",{title:`${m.month}: ${m.predicted} (Conf: ${m.confidence}%)`,className:`flex-1 min-w-[12px] rounded-t-sm transition-all duration-500 ${l?"bg-red-500 shadow-[0_-5px_10px_rgba(239,68,68,0.3)]":"bg-blue-400"}`,style:{height:`${Math.max(10,s)}%`}},j)})})}),e.jsxs("td",{className:"px-6 py-4 text-right",children:[e.jsxs("div",{className:`text-lg font-black ${h>100?"text-red-600":h>80?"text-amber-500":"text-slate-900 dark:text-slate-100"}`,children:[h.toFixed(0),"%"]}),e.jsx("div",{className:"text-[10px] text-slate-400 font-bold",children:"PEAK LOAD INDEX"})]})]},a.resourceId)})})]})})]})]})},_=N.memo(({active:o,payload:d,label:r})=>!o||!d||!d.length?null:e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-lg border border-slate-200",children:[r&&e.jsx("p",{className:"font-semibold text-slate-900 mb-1",children:r}),d.map((u,c)=>e.jsxs("p",{className:"text-sm",style:{color:u.color},children:[u.name,": ",e.jsx("span",{className:"font-semibold",children:u.value})]},c))]}));_.displayName="CustomTooltip";const re=N.memo(({type:o,data:d,dataKey:r="value",xKey:u="name",colors:c=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6"],height:a=300,showGrid:x=!0,showLegend:i=!0,showTooltip:t=!0,animate:h=!0})=>{const m=N.useMemo(()=>{if(!d||d.length===0)return[];if(d.length>100){const l=Math.ceil(d.length/100);return d.filter((n,g)=>g%l===0)}return d},[d]),j=N.useMemo(()=>({margin:{top:5,right:30,left:20,bottom:5},animationDuration:h?300:0}),[h]);if(!m||m.length===0)return e.jsx("div",{className:"flex items-center justify-center bg-slate-50 rounded-lg border border-slate-200",style:{height:a},children:e.jsx("p",{className:"text-slate-400",children:"No data available"})});const s=()=>{switch(o){case"bar":return e.jsxs(ke,{data:m,...j,children:[x&&e.jsx(V,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(G,{dataKey:u,stroke:"#64748b",tick:{fill:"#64748b",fontSize:12}}),e.jsx(H,{stroke:"#64748b",tick:{fill:"#64748b",fontSize:12}}),t&&e.jsx(O,{content:e.jsx(_,{})}),i&&e.jsx(K,{wrapperStyle:{fontSize:12}}),e.jsx(ae,{dataKey:r,fill:c[0],radius:[4,4,0,0],animationDuration:j.animationDuration})]});case"line":return e.jsxs(ts,{data:m,...j,children:[x&&e.jsx(V,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(G,{dataKey:u,stroke:"#64748b",tick:{fill:"#64748b",fontSize:12}}),e.jsx(H,{stroke:"#64748b",tick:{fill:"#64748b",fontSize:12}}),t&&e.jsx(O,{content:e.jsx(_,{})}),i&&e.jsx(K,{wrapperStyle:{fontSize:12}}),e.jsx(De,{type:"monotone",dataKey:r,stroke:c[0],strokeWidth:2,dot:{fill:c[0],r:4},activeDot:{r:6},animationDuration:j.animationDuration})]});case"pie":return e.jsxs(Me,{children:[e.jsx(Re,{data:m,dataKey:r,nameKey:u,cx:"50%",cy:"50%",outerRadius:100,label:!0,animationDuration:j.animationDuration,children:m.map((l,n)=>e.jsx(we,{fill:c[n%c.length]},`cell-${n}`))}),t&&e.jsx(O,{content:e.jsx(_,{})}),i&&e.jsx(K,{wrapperStyle:{fontSize:12}})]});default:return null}};return e.jsx(B,{width:"100%",height:a,children:s()})},(o,d)=>o.type===d.type&&o.data===d.data&&o.dataKey===d.dataKey&&o.xKey===d.xKey&&o.height===d.height&&o.animate===d.animate);re.displayName="OptimizedChart";const us=({isOpen:o,onClose:d,resourceId:r})=>{const{resourcePool:u,updateResource:c}=Q(),a=u.find(p=>p.id===r),[x,i]=N.useState("basic"),[t,h]=N.useState({}),[m,j]=N.useState([]),[s,l]=N.useState([]),[n,g]=N.useState(null);N.useEffect(()=>{a&&(h({name:a.name,totalQuantity:a.totalQuantity,costPerUnit:a.costPerUnit}),j(a.members||[]),l(a.skills||[]))},[a]);const v=()=>{var p;a&&(c(a.id,{...t,totalQuantity:parseInt(((p=t.totalQuantity)==null?void 0:p.toString())||"0")}),alert("基本信息已保存"))},k=()=>{a&&(c(a.id,{members:m}),alert("成员列表已保存"))},b=()=>{a&&(c(a.id,{skills:s}),alert("技能列表已保存"))},f=()=>{const p={id:`member-${Date.now()}`,name:"新成员",role:(a==null?void 0:a.name)||"Engineer",skills:[],availability:100,assignments:[],joinDate:new Date().toISOString().split("T")[0]};j([...m,p]),g(p)},w=p=>{confirm("确定要删除这位成员吗？")&&(j(m.filter(z=>z.id!==p)),(n==null?void 0:n.id)===p&&g(null))},y=(p,z)=>{j(m.map(C=>C.id===p?{...C,...z}:C)),(n==null?void 0:n.id)===p&&g({...n,...z})};return!o||!a?null:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl h-[80vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(me,{className:"text-blue-600",size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:a.name}),e.jsx("p",{className:"text-sm text-slate-500",children:"资源详情管理"})]})]}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(ie,{size:20,className:"text-slate-500"})})]}),e.jsxs("div",{className:"flex border-b border-slate-200 px-6",children:[e.jsx("button",{onClick:()=>i("basic"),className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${x==="basic"?"border-blue-600 text-blue-600":"border-transparent text-slate-600 hover:text-slate-900"}`,children:"基本信息"}),e.jsxs("button",{onClick:()=>i("members"),className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${x==="members"?"border-blue-600 text-blue-600":"border-transparent text-slate-600 hover:text-slate-900"}`,children:["成员管理 (",m.length,")"]}),e.jsxs("button",{onClick:()=>i("skills"),className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${x==="skills"?"border-blue-600 text-blue-600":"border-transparent text-slate-600 hover:text-slate-900"}`,children:["技能定义 (",s.length,")"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-50",children:[x==="basic"&&e.jsxs("div",{className:"max-w-2xl mx-auto bg-white p-6 rounded-xl shadow-sm border border-slate-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"基本配置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"资源名称"}),e.jsx("input",{type:"text",value:t.name||"",onChange:p=>h({...t,name:p.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"总容量 (人数)"}),e.jsx("input",{type:"number",value:t.totalQuantity||0,onChange:p=>h({...t,totalQuantity:parseInt(p.target.value)}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"注意：修改总容量不会自动添加或删除成员记录。"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"单位成本 (每人月)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2 text-slate-500",children:"$"}),e.jsx("input",{type:"number",value:t.costPerUnit||0,onChange:p=>h({...t,costPerUnit:parseFloat(p.target.value)}),className:"w-full pl-8 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"pt-4 border-t border-slate-100 flex justify-end",children:e.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(se,{size:18}),e.jsx("span",{children:"保存更改"})]})})]})]}),x==="members"&&e.jsxs("div",{className:"flex h-full gap-6",children:[e.jsxs("div",{className:"w-1/3 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:"成员列表"}),e.jsx("button",{onClick:f,className:"p-1.5 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors",children:e.jsx(le,{size:18})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:[m.map(p=>e.jsxs("div",{onClick:()=>g(p),className:`p-3 rounded-lg cursor-pointer transition-colors flex items-center justify-between group ${(n==null?void 0:n.id)===p.id?"bg-blue-50 border border-blue-200":"hover:bg-slate-50 border border-transparent"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-slate-600 text-xs font-bold",children:p.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-slate-900",children:p.name}),e.jsx("div",{className:"text-xs text-slate-500",children:p.role})]})]}),e.jsx("button",{onClick:z=>{z.stopPropagation(),w(p.id)},className:"opacity-0 group-hover:opacity-100 p-1.5 text-red-500 hover:bg-red-50 rounded transition-all",children:e.jsx(he,{size:14})})]},p.id)),m.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-500 text-sm",children:"暂无成员，点击右上角添加"})]})]}),e.jsx("div",{className:"flex-1 bg-white rounded-xl shadow-sm border border-slate-200 p-6 overflow-y-auto",children:n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"编辑成员信息"}),e.jsxs("button",{onClick:k,className:"flex items-center gap-2 px-3 py-1.5 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(se,{size:16}),e.jsx("span",{children:"保存列表"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"姓名"}),e.jsx("input",{type:"text",value:n.name,onChange:p=>y(n.id,{name:p.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"职位/角色"}),e.jsx("input",{type:"text",value:n.role,onChange:p=>y(n.id,{role:p.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"邮箱"}),e.jsxs("div",{className:"relative",children:[e.jsx(os,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),e.jsx("input",{type:"email",value:n.email||"",onChange:p=>y(n.id,{email:p.target.value}),className:"w-full pl-9 pr-3 py-2 border border-slate-300 rounded-lg",placeholder:"email@example.com"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"电话"}),e.jsxs("div",{className:"relative",children:[e.jsx(xs,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),e.jsx("input",{type:"text",value:n.phone||"",onChange:p=>y(n.id,{phone:p.target.value}),className:"w-full pl-9 pr-3 py-2 border border-slate-300 rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"入职日期"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),e.jsx("input",{type:"date",value:n.joinDate||"",onChange:p=>y(n.id,{joinDate:p.target.value}),className:"w-full pl-9 pr-3 py-2 border border-slate-300 rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"可用性 (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:n.availability,onChange:p=>y(n.id,{availability:parseInt(p.target.value)}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"技能 (逗号分隔)"}),e.jsx("textarea",{value:n.skills.join(", "),onChange:p=>y(n.id,{skills:p.target.value.split(",").map(z=>z.trim()).filter(Boolean)}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg h-24",placeholder:"React, TypeScript, Node.js..."})]})]}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400",children:[e.jsx(me,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{children:"选择左侧成员进行编辑"})]})})]}),x==="skills"&&e.jsxs("div",{className:"max-w-3xl mx-auto bg-white p-6 rounded-xl shadow-sm border border-slate-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"技能定义"}),e.jsxs("button",{onClick:()=>{const p={id:`skill-${Date.now()}`,name:"New Skill",level:"intermediate"};l([...s,p])},className:"flex items-center gap-2 px-3 py-1.5 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors",children:[e.jsx(le,{size:16}),e.jsx("span",{children:"添加技能"})]})]}),e.jsxs("div",{className:"space-y-3",children:[s.map((p,z)=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:p.name,onChange:C=>{const S=[...s];S[z].name=C.target.value,l(S)},className:"w-full px-2 py-1 bg-transparent border-b border-transparent focus:border-blue-500 focus:outline-none font-medium"})}),e.jsxs("select",{value:p.level,onChange:C=>{const S=[...s];S[z].level=C.target.value,l(S)},className:"px-2 py-1 bg-white border border-slate-200 rounded text-sm",children:[e.jsx("option",{value:"beginner",children:"初级"}),e.jsx("option",{value:"intermediate",children:"中级"}),e.jsx("option",{value:"advanced",children:"高级"}),e.jsx("option",{value:"expert",children:"专家"})]}),e.jsx("button",{onClick:()=>l(s.filter(C=>C.id!==p.id)),className:"text-red-500 hover:bg-red-50 p-1.5 rounded",children:e.jsx(he,{size:16})})]},p.id)),s.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-500",children:"暂无技能定义"})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-slate-100 flex justify-end",children:e.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(se,{size:18}),e.jsx("span",{children:"保存技能"})]})})]})]})]})})},ps=(o,d,r,u="smoothing")=>{let c=JSON.parse(JSON.stringify(d));const a=new Map(d.map(f=>[f.id,f])),x=[],i=Ye(c),t=new Date(Math.min(...c.map(f=>new Date(f.startDate).getTime()))),h=new Date(Math.max(...c.map(f=>new Date(f.endDate).getTime()))),m=ee(h,t);let j=0,s=0;c.sort((f,w)=>new Date(f.startDate).getTime()-new Date(w.startDate).getTime());const l=new Set;let n=h,g=new Date(t);const v=m*2+365;let k=0;for(;k<v&&!(g>n&&u==="smoothing"||l.size===c.length&&g>n);){const f=I(g,"yyyy-MM-dd");r.forEach(w=>{const y=w.totalQuantity,p=c.filter(z=>z.assignee===w.id&&z.startDate<=f&&z.endDate>=f);if(p.length>y){const z=p.length-y;s=Math.max(s,z),p.sort((S,M)=>{const A=i.criticalPath.includes(S.id),R=i.criticalPath.includes(M.id);if(A!==R)return A?1:-1;const de={P0:3,P1:2,P2:1,P3:0},oe=S.priority&&de[S.priority]||0,xe=M.priority&&de[M.priority]||0;return oe!==xe?oe-xe:0});let C=0;for(const S of p){if(C>=z)break;const M=i.slack[S.id]||0;if(u==="smoothing"){if(M>0){const A=U($(S.startDate),1),R=U($(S.endDate),1);S.startDate=I(A,"yyyy-MM-dd"),S.endDate=I(R,"yyyy-MM-dd"),C++,j++}}else if(u==="leveling"){const A=U($(S.startDate),1),R=U($(S.endDate),1);S.startDate=I(A,"yyyy-MM-dd"),S.endDate=I(R,"yyyy-MM-dd"),R>n&&(n=R),C++,j++}}}}),g=U(g,1),k++}c.forEach(f=>{const w=a.get(f.id);if(w&&w.startDate!==f.startDate){const y=ee($(f.startDate),$(w.startDate));x.push({taskId:f.id,taskName:f.name,originalStart:w.startDate,newStart:f.startDate,delay:y,reason:u==="smoothing"?"资源平滑（利用浮动时间）":"资源平衡（解决冲突）"})}});const b=ee(n,t);return{optimizedTasks:c,changes:x,metrics:{originalDuration:m,newDuration:b,conflictsResolved:j,resourcePeakReduced:s}}},bs=({project:o,tasks:d,resourcePool:r,onApplyChanges:u})=>{const[c,a]=N.useState("smoothing"),[x,i]=N.useState(!1),[t,h]=N.useState(null),m=()=>{i(!0),setTimeout(()=>{const s=ps(o,d,r,c);h(s),i(!1)},500)},j=()=>{t&&(u(t.optimizedTasks),h(null))};return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 bg-slate-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ze,{size:20,className:"text-blue-600"}),e.jsx("h3",{className:"font-semibold text-slate-900",children:"智能进度调度"})]}),e.jsx("p",{className:"text-sm text-slate-500",children:"自动调整任务时间以解决资源冲突并优化工期"})]}),e.jsxs("div",{className:"p-6 border-b border-slate-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>a("smoothing"),className:`p-4 rounded-lg border-2 text-left transition-all ${c==="smoothing"?"border-blue-500 bg-blue-50":"border-slate-200 hover:border-blue-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-slate-900",children:"资源平滑 (Smoothing)"}),c==="smoothing"&&e.jsx(W,{size:18,className:"text-blue-600"})]}),e.jsxs("p",{className:"text-sm text-slate-600",children:["利用任务浮动时间调整进度，",e.jsx("span",{className:"font-medium text-blue-700",children:"不延长项目工期"}),"。适用于资源有限但工期固定的场景。"]})]}),e.jsxs("button",{onClick:()=>a("leveling"),className:`p-4 rounded-lg border-2 text-left transition-all ${c==="leveling"?"border-purple-500 bg-purple-50":"border-slate-200 hover:border-purple-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-slate-900",children:"资源平衡 (Leveling)"}),c==="leveling"&&e.jsx(W,{size:18,className:"text-purple-600"})]}),e.jsxs("p",{className:"text-sm text-slate-600",children:["彻底解决资源冲突，可能",e.jsx("span",{className:"font-medium text-purple-700",children:"延长项目工期"}),"。适用于资源刚性约束的场景。"]})]})]}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("button",{onClick:m,disabled:x,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors flex items-center gap-2 font-medium",children:x?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{size:18,className:"animate-spin"}),"正在计算最优解..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{size:18}),"开始优化计算"]})})})]}),t&&e.jsxs("div",{className:"p-6 bg-slate-50 animate-in fade-in slide-in-from-top-4 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:"优化方案预览"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h(null),className:"px-3 py-1.5 text-slate-600 hover:text-slate-900 text-sm font-medium",children:"放弃"}),e.jsxs("button",{onClick:j,className:"px-4 py-1.5 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium flex items-center gap-2",children:[e.jsx(W,{size:16}),"应用方案"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[e.jsx("div",{className:"text-sm text-slate-500 mb-1",children:"项目工期"}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("span",{className:"text-xl font-bold text-slate-900",children:[t.metrics.newDuration," 天"]}),e.jsxs("span",{className:`text-xs mb-1 ${t.metrics.newDuration>t.metrics.originalDuration?"text-red-600":"text-green-600"}`,children:["(",t.metrics.newDuration-t.metrics.originalDuration>0?"+":"",t.metrics.newDuration-t.metrics.originalDuration," 天)"]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[e.jsx("div",{className:"text-sm text-slate-500 mb-1",children:"解决冲突"}),e.jsxs("div",{className:"text-xl font-bold text-green-600",children:[t.metrics.conflictsResolved," 个"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[e.jsx("div",{className:"text-sm text-slate-500 mb-1",children:"资源峰值削减"}),e.jsxs("div",{className:"text-xl font-bold text-blue-600",children:[t.metrics.resourcePeakReduced," 单位"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-slate-200 bg-slate-50 font-medium text-sm text-slate-700",children:["变更详情 (",t.changes.length,")"]}),e.jsx("div",{className:"max-h-64 overflow-y-auto divide-y divide-slate-100",children:t.changes.length===0?e.jsx("div",{className:"p-8 text-center text-slate-500 text-sm",children:"没有需要调整的任务，当前计划已是最优。"}):t.changes.map((s,l)=>e.jsxs("div",{className:"p-4 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium text-slate-900 text-sm",children:s.taskName}),e.jsxs("span",{className:"text-xs px-2 py-0.5 bg-orange-100 text-orange-700 rounded",children:["推迟 ",s.delay," 天"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[e.jsx(X,{size:12}),e.jsx("span",{children:s.originalStart}),e.jsx(ve,{size:12}),e.jsx("span",{className:"text-slate-900 font-medium",children:s.newStart})]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["原因: ",s.reason]})]},l))})]}),c==="leveling"&&t.metrics.newDuration>t.metrics.originalDuration&&e.jsxs("div",{className:"mt-4 flex items-start gap-2 p-3 bg-yellow-50 text-yellow-800 rounded-lg text-sm",children:[e.jsx(T,{size:16,className:"mt-0.5 flex-shrink-0"}),e.jsxs("p",{children:["注意：为了解决资源冲突，项目总工期延长了 ",t.metrics.newDuration-t.metrics.originalDuration," 天。 请确认这是否符合项目交付要求。"]})]})]})]})},js=()=>{var k;const o=ne(),d=ce(),{updateProject:r,addNotification:u}=Q(),[c,a]=N.useState("month"),[x,i]=N.useState(null),[t,h]=N.useState(!1),[m,j]=N.useState(null),s=N.useMemo(()=>ze(o,12,c),[o,c]),l=N.useMemo(()=>Ce(o,d,s,c),[o,d,s,c]),n=N.useMemo(()=>{var C;const b=d.reduce((S,M)=>S+(M.totalQuantity||0),0),f=(C=s[0])==null?void 0:C.label;let w=0,y=0,p=0;l.forEach(S=>{const M=S.allocations[f],A=M?M.total:0;w+=A;const R=S.capacity>0?A/S.capacity*100:0;R>100&&y++,R<50&&p++});const z=b>0?w/b*100:0;return{totalResources:b,totalUsed:w,avgUtilization:z,overallocated:y,underutilized:p,available:b-w}},[d,l,s]),g=N.useMemo(()=>l.map(b=>{var z;const f=(z=s[0])==null?void 0:z.label,w=b.allocations[f],y=w?w.total:0,p=b.capacity>0?y/b.capacity*100:0;return{id:b.resourceId,name:b.resourceName,utilization:Math.round(p),capacity:b.capacity,used:y}}),[l,s]),v=N.useMemo(()=>s.slice(0,6).map(b=>{let f=0,w=0;return l.forEach(y=>{const p=y.allocations[b.label];f+=p?p.total:0,w+=y.capacity}),{name:b.label,utilization:w>0?Math.round(f/w*100):0,used:f,capacity:w}}),[l,s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"资源总览"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"实时监控资源分配和利用情况"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("select",{value:c,onChange:b=>a(b.target.value),className:"px-4 py-2 border border-slate-200 rounded-lg bg-white",children:[e.jsx("option",{value:"week",children:"本周"}),e.jsx("option",{value:"month",children:"本月"}),e.jsx("option",{value:"quarter",children:"本季度"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(Y,{className:"text-blue-600",size:24})}),e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"总资源"})]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900",children:n.totalResources}),e.jsxs("div",{className:"text-sm text-slate-600 mt-1",children:["使用中: ",n.totalUsed," (",Math.round(n.avgUtilization),"%)"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(F,{className:"text-green-600",size:24})}),e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"平均利用率"})]}),e.jsxs("div",{className:"text-3xl font-bold text-slate-900",children:[Math.round(n.avgUtilization),"%"]}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx("div",{className:"flex-1 h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${n.avgUtilization>90?"bg-red-500":n.avgUtilization>70?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(n.avgUtilization,100)}%`}})})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:e.jsx(T,{className:"text-red-600",size:24})}),e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"超额分配"})]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900",children:n.overallocated}),e.jsx("div",{className:"text-sm text-slate-600 mt-1",children:n.overallocated>0?"需要调整":"状态良好"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(te,{className:"text-purple-600",size:24})}),e.jsx("span",{className:"text-xs font-medium text-slate-500",children:"可用资源"})]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900",children:n.available}),e.jsxs("div",{className:"text-sm text-slate-600 mt-1",children:[Math.round(n.available/n.totalResources*100),"% 可用"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"资源利用率"}),e.jsx(Le,{className:"text-slate-400",size:20})]}),e.jsx(re,{type:"bar",data:g,dataKey:"utilization",xKey:"name",height:300,colors:["#3B82F6","#10B981","#F59E0B","#EF4444"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"利用率趋势"}),e.jsx(Ne,{className:"text-slate-400",size:20})]}),e.jsx(re,{type:"line",data:v,dataKey:"utilization",xKey:"name",height:300,colors:["#8B5CF6"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200",children:[e.jsx("div",{className:"p-6 border-b border-slate-200",children:e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"资源详情"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"资源名称"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"总容量"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"已使用"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"可用"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"利用率"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"状态"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-slate-200",children:g.map((b,f)=>{const w=b.capacity-b.used,y=b.utilization>100?"overallocated":b.utilization>80?"high":b.utilization>50?"normal":"low";return e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors cursor-pointer",onClick:()=>{i(b.id),h(!0)},children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-slate-900",children:b.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-slate-900",children:b.capacity})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-slate-900",children:b.used})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-slate-900",children:w})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 max-w-[100px] h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${y==="overallocated"?"bg-red-500":y==="high"?"bg-yellow-500":y==="normal"?"bg-green-500":"bg-blue-500"}`,style:{width:`${Math.min(b.utilization,100)}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-slate-900",children:[b.utilization,"%"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${y==="overallocated"?"bg-red-100 text-red-800":y==="high"?"bg-yellow-100 text-yellow-800":y==="normal"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:y==="overallocated"?"超额":y==="high"?"高负载":y==="normal"?"正常":"低负载"})})]},f)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"智能进度调度"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"自动优化资源分配，解决冲突"})]}),e.jsxs("select",{value:m||"",onChange:b=>j(b.target.value||null),className:"px-4 py-2 border border-slate-200 rounded-lg bg-white",children:[e.jsx("option",{value:"",children:"选择项目..."}),o.filter(b=>b.status==="active").map(b=>e.jsx("option",{value:b.id,children:b.name},b.id))]})]}),m?e.jsx(bs,{project:o.find(b=>b.id===m),tasks:((k=o.find(b=>b.id===m))==null?void 0:k.tasks)||[],resourcePool:d,onApplyChanges:b=>{const f=o.find(w=>w.id===m);f&&(r(m,{...f,tasks:b}),u({message:`项目"${f.name}"的任务已根据优化方案重新调度`,type:"success",duration:5e3}))}}):e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(te,{size:48,className:"mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"请选择一个项目以开始调度优化"})]})]}),x&&e.jsx(us,{isOpen:t,onClose:()=>h(!1),resourceId:x})]})},fs=({resourceLoads:o,buckets:d})=>{const r=N.useMemo(()=>o.map(a=>{const x=d.map(i=>{const t=a.allocations[i.label],h=t?t.total:0,m=a.capacity>0?h/a.capacity*100:0;return{month:i.label,used:h,capacity:a.capacity,utilization:m,projects:t?t.projects:[]}});return{resourceName:a.resourceName,cells:x}}),[o,d]),u=a=>a===0?"bg-slate-50":a<25?"bg-blue-100":a<50?"bg-green-100":a<75?"bg-yellow-100":a<100?"bg-orange-100":"bg-red-200",c=a=>a===0?"text-slate-400":a<25?"text-blue-700":a<50?"text-green-700":a<75?"text-yellow-700":a<100?"text-orange-700":"text-red-700";return e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-slate-200",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-bold text-slate-900",children:"资源分配热力图"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"查看资源在不同时间段的分配情况"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 bg-white z-10 px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider border-b border-r border-slate-200",children:"资源"}),d.map((a,x)=>e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider border-b border-slate-200 min-w-[100px]",children:a.label},x))]})}),e.jsx("tbody",{children:r.map((a,x)=>e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"sticky left-0 bg-white z-10 px-4 py-3 font-medium text-sm text-slate-900 border-r border-slate-200",children:a.resourceName}),a.cells.map((i,t)=>e.jsxs("td",{className:`px-4 py-3 text-center border-r border-b border-slate-100 ${u(i.utilization)} transition-colors group relative`,children:[e.jsxs("div",{className:`text-sm font-semibold ${c(i.utilization)}`,children:[Math.round(i.utilization),"%"]}),e.jsxs("div",{className:"text-xs text-slate-500 mt-0.5",children:[i.used,"/",i.capacity]}),i.projects.length>0&&e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-20",children:e.jsxs("div",{className:"bg-slate-900 text-white text-xs rounded-lg p-3 shadow-xl min-w-[200px]",children:[e.jsx("div",{className:"font-semibold mb-2",children:"分配到的项目:"}),i.projects.map((h,m)=>e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsx("span",{className:"truncate",children:h.name}),e.jsx("span",{className:"ml-2 font-mono",children:h.amount})]},m))]})})]},t))]},x))})]})}),e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-6",children:[e.jsx("div",{className:"text-xs text-slate-600",children:"利用率:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-slate-50 border border-slate-200 rounded"}),e.jsx("span",{className:"text-xs text-slate-600",children:"0%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-100 rounded"}),e.jsx("span",{className:"text-xs text-slate-600",children:"1-25%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-100 rounded"}),e.jsx("span",{className:"text-xs text-slate-600",children:"26-50%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-yellow-100 rounded"}),e.jsx("span",{className:"text-xs text-slate-600",children:"51-75%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-orange-100 rounded"}),e.jsx("span",{className:"text-xs text-slate-600",children:"76-99%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-200 rounded"}),e.jsx("span",{className:"text-xs text-slate-600",children:"≥100%"})]})]})]})},gs=(o,d)=>{const r=[],c=Te(new Date),a=ue(c,12),x=es({start:c,end:a});return d.forEach(i=>{x.forEach(t=>{const h=I(t,"yyyy-MM"),m=[];let j=0;o.forEach(s=>{if(!s.startDate||!s.endDate||s.status==="completed")return;const l=$(s.startDate),n=$(s.endDate);if(!je(t,{start:l,end:n}))return;const v=(s.resourceRequirements||[]).find(w=>w.resourceId===i.id);if(!v)return;const k=v.count;let b=v.duration;v.unit==="day"&&(b=v.duration/30),v.unit==="year"&&(b=v.duration*12);const f=ue(l,b);je(t,{start:l,end:f})&&(m.push({projectId:s.id,projectName:s.name,allocation:k}),j+=k)}),j>i.totalQuantity&&r.push({resourceId:i.id,resourceName:i.name,period:h,capacity:i.totalQuantity,allocated:j,overallocation:j-i.totalQuantity,conflictingProjects:m})})}),r},Ns=()=>{const{projects:o,resourcePool:d}=Q(),{t:r}=Se(),u=N.useMemo(()=>gs(o,d),[o,d]),c=N.useMemo(()=>{const t=new Map;return u.forEach(h=>{const m=t.get(h.resourceId)||[];t.set(h.resourceId,[...m,h])}),t},[u]),a=u.length,x=c.size,i=u.filter(t=>t.overallocation>t.capacity*.5).length;return a===0?e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-2xl border-2 border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(W,{className:"text-green-600",size:28}),e.jsx("h3",{className:"text-lg font-bold text-green-900",children:r("conflicts.noConflicts")})]}),e.jsx("p",{className:"text-green-700",children:r("conflicts.allResourcesOptimal")})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-red-50 p-6 rounded-2xl border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(T,{className:"text-red-600",size:24}),e.jsx("h4",{className:"font-bold text-red-900",children:r("conflicts.totalConflicts")})]}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:a}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:r("conflicts.periodsAffected")})]}),e.jsxs("div",{className:"bg-orange-50 p-6 rounded-2xl border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Y,{className:"text-orange-600",size:24}),e.jsx("h4",{className:"font-bold text-orange-900",children:r("conflicts.affectedResources")})]}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:x}),e.jsx("p",{className:"text-sm text-orange-700 mt-1",children:r("conflicts.resourceTypes")})]}),e.jsxs("div",{className:"bg-yellow-50 p-6 rounded-2xl border border-yellow-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(T,{className:"text-yellow-600",size:24}),e.jsx("h4",{className:"font-bold text-yellow-900",children:r("conflicts.critical")})]}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:i}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:r("conflicts.over50Percent")})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 bg-gradient-to-r from-red-50 to-orange-50",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:r("conflicts.detailedView")}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:r("conflicts.reviewAndResolve")})]}),e.jsx("div",{className:"divide-y divide-slate-100",children:Array.from(c.entries()).map(([t,h])=>{const m=d.find(j=>j.id===t);return m?e.jsxs("div",{className:"p-6 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900 text-lg",children:m.name}),e.jsxs("p",{className:"text-sm text-slate-500",children:[r("conflicts.capacity"),": ",m.totalQuantity," ",r("conflicts.units")]})]}),e.jsxs("span",{className:"px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-bold",children:[h.length," ",r("conflicts.conflicts")]})]}),e.jsx("div",{className:"space-y-3",children:h.map((j,s)=>e.jsxs("div",{className:"bg-red-50 p-4 rounded-xl border border-red-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"text-red-600",size:18}),e.jsx("span",{className:"font-bold text-red-900",children:j.period})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-red-700",children:[r("conflicts.overallocated"),":",e.jsxs("span",{className:"font-bold ml-1",children:["+",j.overallocation," (",(j.overallocation/j.capacity*100).toFixed(0),"%)"]})]}),e.jsxs("div",{className:"text-xs text-red-600",children:[j.allocated," / ",j.capacity," ",r("conflicts.allocated")]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"h-3 bg-red-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-red-500 to-red-600 transition-all",style:{width:`${Math.min(j.allocated/j.capacity*100,100)}%`}})})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-bold text-red-800 mb-2",children:[r("conflicts.conflictingProjects"),":"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.conflictingProjects.map(l=>e.jsxs("div",{className:"px-3 py-1 bg-white border border-red-300 rounded-lg text-xs",children:[e.jsx("span",{className:"font-medium text-slate-900",children:l.projectName}),e.jsxs("span",{className:"text-red-600 ml-2",children:["(",l.allocation," ",r("conflicts.units"),")"]})]},l.projectId))})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-red-300",children:e.jsxs("p",{className:"text-xs text-red-800",children:[e.jsxs("span",{className:"font-bold",children:["💡 ",r("conflicts.recommendation"),":"]}),j.overallocation>j.capacity*.5?r("conflicts.criticalRecommendation"):r("conflicts.moderateRecommendation")]})})]},`${j.period}-${s}`))})]},t):null})})]})]})},fe={beginner:1,intermediate:2,advanced:3,expert:4},Pe=(o,d,r="intermediate")=>{if(!d||d.length===0)return{matchScore:100,matchedSkills:[],missingSkills:[],qualifiedSkills:[]};if(!o||o.length===0)return{matchScore:0,matchedSkills:[],missingSkills:d,qualifiedSkills:[]};const u=fe[r],c=[],a=[],x=[];d.forEach(m=>{const j=o.find(s=>s.id===m);j?(c.push(m),fe[j.level]>=u&&a.push(m)):x.push(m)});const i=c.length/d.length*100,t=a.length/d.length*20;return{matchScore:Math.min(i+t,100),matchedSkills:c,missingSkills:x,qualifiedSkills:a}},vs=(o,d,r=60)=>d.map(c=>{const a=Pe(c.skills||[],o.requiredSkills||[]);return{resourceId:c.id,resourceName:c.name,matchScore:a.matchScore,matchDetails:a}}).filter(c=>c.matchScore>=r).sort((c,a)=>a.matchScore-c.matchScore),ys=(o,d)=>{const r=new Map;let u=0,c=0,a=0,x=0;o.forEach(h=>{(h.resourceRequirements||[]).forEach(m=>{if(!m.requiredSkills||m.requiredSkills.length===0)return;u++;const j=d.find(l=>l.id===m.resourceId);if(!j){x++,m.requiredSkills.forEach(l=>{const n=r.get(l)||{occurrences:0,projects:[]};r.set(l,{occurrences:n.occurrences+1,projects:[...n.projects,h.name]})});return}const s=Pe(j.skills||[],m.requiredSkills);s.matchScore===100?c++:s.matchScore>0?(a++,s.missingSkills.forEach(l=>{const n=r.get(l)||{occurrences:0,projects:[]};r.set(l,{occurrences:n.occurrences+1,projects:[...n.projects,h.name]})})):(x++,m.requiredSkills.forEach(l=>{const n=r.get(l)||{occurrences:0,projects:[]};r.set(l,{occurrences:n.occurrences+1,projects:[...n.projects,h.name]})}))})});const i=Array.from(r.entries()).map(([h,m])=>({skillId:h,occurrences:m.occurrences,projects:m.projects})).sort((h,m)=>m.occurrences-h.occurrences),t=[];if(i.length>0){const h=i[0];t.push(`Consider hiring or training resources with "${h.skillId}" skill (needed in ${h.occurrences} projects)`)}return x>u*.3&&t.push(`High skill mismatch rate (${(x/u*100).toFixed(0)}%). Review resource allocation strategy.`),a>c&&t.push("Many partial matches detected. Consider upskilling existing resources."),{totalRequirements:u,fullyMatched:c,partiallyMatched:a,unmatched:x,missingSkills:i,recommendations:t}},ws=()=>{const{projects:o,resourcePool:d}=Q(),{t:r}=Se(),[u,c]=N.useState(""),[a,x]=N.useState(60),i=N.useMemo(()=>ys(o,d),[o,d]),t=o.find(l=>l.id===u),h=N.useMemo(()=>{var n;if(!t||!((n=t.resourceRequirements)!=null&&n.length))return[];const l=[];return(t.resourceRequirements||[]).forEach(g=>{if(g.requiredSkills&&g.requiredSkills.length>0){const v=vs(g,d,a);l.push({requirement:g,recommendations:v})}}),l},[t,d,a]),m=i.totalRequirements>0?(i.fullyMatched+i.partiallyMatched)/i.totalRequirements*100:100,j=l=>{switch(l){case"beginner":return"bg-blue-100 text-blue-700";case"intermediate":return"bg-green-100 text-green-700";case"advanced":return"bg-orange-100 text-orange-700";case"expert":return"bg-purple-100 text-purple-700";default:return"bg-slate-100 text-slate-700"}},s=l=>({beginner:r("skills.beginner"),intermediate:r("skills.intermediate"),advanced:r("skills.advanced"),expert:r("skills.expert")})[l]||l;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-cyan-50 p-6 rounded-2xl border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Ae,{className:"text-blue-600",size:24}),e.jsx("h4",{className:"font-bold text-blue-900",children:r("skills.totalRequirements")})]}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:i.totalRequirements}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:r("skills.acrossProjects")})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-2xl border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(cs,{className:"text-green-600",size:24}),e.jsx("h4",{className:"font-bold text-green-900",children:r("skills.fullyMatched")})]}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:i.fullyMatched}),e.jsxs("p",{className:"text-sm text-green-700 mt-1",children:[i.totalRequirements>0?`${(i.fullyMatched/i.totalRequirements*100).toFixed(0)}%`:"0%"," ",r("skills.perfect")]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 p-6 rounded-2xl border border-yellow-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(F,{className:"text-yellow-600",size:24}),e.jsx("h4",{className:"font-bold text-yellow-900",children:r("skills.partialMatches")})]}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:i.partiallyMatched}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:r("skills.needsImprovement")})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-pink-50 p-6 rounded-2xl border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(J,{className:"text-red-600",size:24}),e.jsx("h4",{className:"font-bold text-red-900",children:r("skills.unmatched")})]}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:i.unmatched}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:r("skills.criticalGaps")})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-4",children:r("skills.overallMatchRate")}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"h-8 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-emerald-500 transition-all duration-500 flex items-center justify-end pr-4",style:{width:`${m}%`},children:e.jsxs("span",{className:"text-white font-bold text-sm",children:[m.toFixed(1),"%"]})})})})]}),i.missingSkills.length>0&&e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ds,{className:"text-orange-600",size:24}),e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:r("skills.topMissingSkills")})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.missingSkills.slice(0,9).map((l,n)=>e.jsxs("div",{className:"p-4 bg-orange-50 rounded-xl border border-orange-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-bold text-slate-900",children:l.skillId}),e.jsxs("span",{className:"px-2 py-1 bg-orange-200 text-orange-800 rounded-full text-xs font-bold",children:["#",n+1]})]}),e.jsxs("p",{className:"text-sm text-slate-600 mb-2",children:[r("skills.neededIn")," ",e.jsx("span",{className:"font-bold text-orange-600",children:l.occurrences})," ",r("skills.projects")]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[l.projects.slice(0,3).map((g,v)=>e.jsx("span",{className:"text-xs bg-white px-2 py-1 rounded border border-orange-300",children:g.length>15?g.substring(0,15)+"...":g},v)),l.projects.length>3&&e.jsxs("span",{className:"text-xs text-orange-600 px-2 py-1",children:["+",l.projects.length-3," ",r("skills.more")]})]})]},l.skillId))})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Y,{className:"text-blue-600",size:24}),e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:r("skills.resourceRecommendations")})]}),e.jsxs("div",{className:"mb-4 flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:r("skills.selectProject")}),e.jsxs("select",{value:u,onChange:l=>c(l.target.value),className:"w-full p-3 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:r("skills.chooseProject")}),o.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]}),e.jsxs("div",{className:"w-full md:w-48",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:r("skills.minMatchScore")}),e.jsx("input",{type:"number",min:"0",max:"100",value:a,onChange:l=>x(parseInt(l.target.value)||0),className:"w-full p-3 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),t&&h.length>0?e.jsx("div",{className:"space-y-6",children:h.map((l,n)=>{const g=d.find(v=>v.id===l.requirement.resourceId);return e.jsxs("div",{className:"border border-slate-200 rounded-xl p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("h4",{className:"font-bold text-slate-900",children:[r("skills.requirement")," #",n+1,": ",(g==null?void 0:g.name)||r("skills.unknownResource")]}),l.requirement.requiredSkills&&l.requirement.requiredSkills.length>0&&e.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:[r("skills.requiredSkills"),": ",l.requirement.requiredSkills.join(", ")]})]}),l.recommendations.length>0?e.jsx("div",{className:"space-y-2",children:l.recommendations.map((v,k)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-bold text-slate-900",children:v.resourceName}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:v.matchDetails.matchedSkills.map(b=>{var y;const f=d.find(p=>p.id===v.resourceId),w=(y=f==null?void 0:f.skills)==null?void 0:y.find(p=>p.id===b);return w?e.jsxs("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${j(w.level)}`,children:[w.name," (",s(w.level),")"]},b):null})}),v.matchDetails.missingSkills.length>0&&e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:[r("skills.missing"),": ",v.matchDetails.missingSkills.join(", ")]})]}),e.jsxs("div",{className:"ml-4 text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[v.matchScore.toFixed(0),"%"]}),e.jsx("div",{className:"text-xs text-slate-500",children:r("skills.match")})]})]},k))}):e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:r("skills.noRecommendations")})]},n)})}):t?e.jsx("p",{className:"text-slate-500 text-center py-8",children:r("skills.noRequirements")}):e.jsx("p",{className:"text-slate-500 text-center py-8",children:r("skills.selectProjectPrompt")})]}),i.recommendations.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-2xl border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(J,{className:"text-purple-600",size:24}),e.jsx("h3",{className:"text-lg font-bold text-purple-900",children:r("skills.actionableRecommendations")})]}),e.jsx("div",{className:"space-y-3",children:i.recommendations.map((l,n)=>e.jsxs("div",{className:"flex gap-3 p-4 bg-white rounded-xl border border-purple-300",children:[e.jsx("div",{className:"text-2xl",children:"💡"}),e.jsx("p",{className:"text-sm text-slate-700 flex-1",children:l})]},n))})]})]})},ks=(o,d)=>{const r=["资源名称","总容量",...d.map(t=>t.label),"平均利用率"],u=o.map(t=>{const h=d.map(j=>{const s=t.allocations[j.label],l=s?s.total:0,n=t.capacity>0?l/t.capacity*100:0;return`${Math.round(n)}%`}),m=d.reduce((j,s)=>{const l=t.allocations[s.label],n=l?l.total:0,g=t.capacity>0?n/t.capacity*100:0;return j+g},0)/d.length;return[t.resourceName,t.capacity.toString(),...h,`${Math.round(m)}%`]}),c=[r.join(","),...u.map(t=>t.join(","))].join(`
`),a=new Blob(["\uFEFF"+c],{type:"text/csv;charset=utf-8;"}),x=document.createElement("a"),i=URL.createObjectURL(a);x.setAttribute("href",i),x.setAttribute("download",`资源利用率_${new Date().toISOString().split("T")[0]}.csv`),x.style.visibility="hidden",document.body.appendChild(x),x.click(),document.body.removeChild(x)},Ss=o=>{const d=["资源名称","总数量","已分配","可用","技能"],r=o.map(i=>{var j;const t=((j=i.skills)==null?void 0:j.map(s=>s.name).join("; "))||"",h=0,m=i.totalQuantity-h;return[i.name,i.totalQuantity.toString(),h.toString(),m.toString(),t]}),u=[d.join(","),...r.map(i=>i.map(t=>`"${t}"`).join(","))].join(`
`),c=new Blob(["\uFEFF"+u],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),x=URL.createObjectURL(c);a.setAttribute("href",x),a.setAttribute("download",`资源池_${new Date().toISOString().split("T")[0]}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)},zs=(o,d)=>{const r=JSON.stringify(o,null,2),u=new Blob([r],{type:"application/json"}),c=document.createElement("a"),a=URL.createObjectURL(u);c.setAttribute("href",a),c.setAttribute("download",`${d}_${new Date().toISOString().split("T")[0]}.json`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)},Cs=({isOpen:o,onClose:d})=>{const{addResource:r}=Q(),[u,c]=N.useState({name:"",totalQuantity:1}),a=i=>{if(i.preventDefault(),!u.name.trim()){alert("请输入资源名称");return}if(u.totalQuantity<=0){alert("资源数量必须大于0");return}const t={id:`resource-${Date.now()}`,name:u.name.trim(),totalQuantity:u.totalQuantity,skills:[],members:[]};r(t),c({name:"",totalQuantity:1}),d()},x=()=>{c({name:"",totalQuantity:1}),d()};return o?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:x}),e.jsxs("div",{className:"relative bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"添加资源"}),e.jsx("button",{onClick:x,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(ie,{size:20,className:"text-slate-500"})})]}),e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["资源名称 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:u.name,onChange:i=>c({...u,name:i.target.value}),placeholder:"例如：开发工程师、设计师",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["总数量 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",min:"1",value:u.totalQuantity,onChange:i=>c({...u,totalQuantity:parseInt(i.target.value)||1}),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:x,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors",children:"取消"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-sm",children:"添加"})]})]})]})]}):null},Ds=(o,d,r)=>{const u=o.resourceRequirements||[],c=o.actualResourceUsage||[],a={};return u.forEach(x=>{const i=r.find(h=>h.id===x.resourceId),t=(d==="department"?i==null?void 0:i.department:i==null?void 0:i.category)||"Other";a[t]||(a[t]={planned:0,actual:0}),a[t].planned+=x.count}),c.forEach(x=>{const i=(d==="department"?x.department:x.category)||"Other";a[i]||(a[i]={planned:0,actual:0}),a[i].actual+=x.count}),Object.entries(a).map(([x,i])=>({name:x,planned:Number(i.planned.toFixed(1)),actual:Number(i.actual.toFixed(1)),variance:Number((i.actual-i.planned).toFixed(1)),variancePercent:i.planned>0?Number(((i.actual-i.planned)/i.planned*100).toFixed(1)):0}))},P=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4"],Ms=()=>{var m,j;const o=ne(),d=ce(),[r,u]=N.useState(((m=o[0])==null?void 0:m.id)||"all"),[c,a]=N.useState("category"),x=N.useMemo(()=>o.find(s=>s.id===r),[o,r]),i=N.useMemo(()=>x?Ds(x,c,d):[],[x,c,d]),t=N.useMemo(()=>{const s={};return o.forEach(l=>{(l.actualResourceUsage||[]).forEach(g=>{const v=(c==="department"?g.department:g.category)||"Other";s[v]||(s[v]={total:0,projects:[]}),s[v].total+=g.count,s[v].projects.push({name:l.name,value:g.count})})}),Object.entries(s).map(([l,n])=>({name:l,value:Number(n.total.toFixed(1)),projects:n.projects})).sort((l,n)=>n.value-l.value)},[o,c]),h=N.useMemo(()=>t.map(s=>{const l=o.reduce((n,g)=>{var k;const v=((k=g.resourceRequirements)==null?void 0:k.filter(b=>{const f=d.find(w=>w.id===b.resourceId);return(c==="department"?f==null?void 0:f.department:f==null?void 0:f.category)===s.name}))||[];return n+v.reduce((b,f)=>b+f.count,0)},0);return{name:s.name,actual:s.value,planned:Number(l.toFixed(1)),efficiency:l>0?Number((s.value/l*100).toFixed(1)):100}}),[t,o,d,c]);return e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-700",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(D,{className:"p-5 bg-gradient-to-br from-blue-500/10 to-indigo-500/5 border-blue-100 dark:border-blue-900/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 text-blue-600 dark:text-blue-400",children:[e.jsx(Y,{size:20}),e.jsx("span",{className:"text-sm font-semibold uppercase tracking-wider",children:"总人力投入 (Actual)"})]}),e.jsxs("div",{className:"text-3xl font-extrabold text-slate-900 dark:text-slate-100",children:[h.reduce((s,l)=>s+l.actual,0).toFixed(1),e.jsx("span",{className:"text-sm font-normal text-slate-500 ml-1",children:"人天/月"})]})]}),e.jsxs(D,{className:"p-5 bg-gradient-to-br from-emerald-500/10 to-teal-500/5 border-emerald-100 dark:border-emerald-900/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 text-emerald-600 dark:text-emerald-400",children:[e.jsx(F,{size:20}),e.jsx("span",{className:"text-sm font-semibold uppercase tracking-wider",children:"资源偏差率"})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("div",{className:"text-3xl font-extrabold text-slate-900 dark:text-slate-100",children:[(()=>{const s=h.reduce((n,g)=>n+g.planned,0),l=h.reduce((n,g)=>n+g.actual,0);return s>0?((l-s)/s*100).toFixed(1):"0"})(),"%"]}),e.jsx(E,{variant:"warning",size:"sm",children:"Attention"})]})]}),e.jsxs(D,{className:"p-5 bg-gradient-to-br from-purple-500/10 to-pink-500/5 border-purple-100 dark:border-purple-900/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 text-purple-600 dark:text-purple-400",children:[e.jsx(Ue,{size:20}),e.jsx("span",{className:"text-sm font-semibold uppercase tracking-wider",children:"核心部门 (Top)"})]}),e.jsx("div",{className:"text-3xl font-extrabold text-slate-900 dark:text-slate-100",children:((j=t[0])==null?void 0:j.name)||"N/A"})]}),e.jsxs(D,{className:"p-5 bg-gradient-to-br from-amber-500/10 to-orange-500/5 border-amber-100 dark:border-amber-900/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 text-amber-600 dark:text-amber-400",children:[e.jsx(J,{size:20}),e.jsx("span",{className:"text-sm font-semibold uppercase tracking-wider",children:"负载预警"})]}),e.jsxs("div",{className:"text-3xl font-extrabold text-slate-900 dark:text-slate-100",children:[h.filter(s=>s.efficiency>110).length,e.jsx("span",{className:"text-sm font-normal text-red-500 ml-1",children:"超支分类"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-900 rounded-xl p-1 p-1",children:[e.jsx("button",{onClick:()=>a("category"),className:`px-4 py-2 text-sm font-bold rounded-lg transition-all ${c==="category"?"bg-white dark:bg-slate-700 text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"按技术栈"}),e.jsx("button",{onClick:()=>a("department"),className:`px-4 py-2 text-sm font-bold rounded-lg transition-all ${c==="department"?"bg-white dark:bg-slate-700 text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"按部门"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-500",children:"主视图项目:"}),e.jsx("select",{value:r,onChange:s=>u(s.target.value),className:"bg-slate-50 dark:bg-slate-900 border-none text-sm font-bold rounded-lg focus:ring-2 ring-blue-500 py-2 pl-3 pr-8",children:o.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx(pe,{size:16}),e.jsx("span",{className:"text-xs italic",children:"数据每 15 分钟同步一次，支持跨项目偏差分析"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs(D,{className:"p-6 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"预期 vs 实际投入 (项目级)"}),e.jsx("p",{className:"text-sm text-slate-500",children:"对比当前所选项目的资源分配效能"})]}),x&&e.jsx(E,{variant:x.status==="active"?"success":"neutral",children:x.status})]}),e.jsx("div",{className:"h-[400px]",children:e.jsx(B,{width:"100%",height:"100%",children:e.jsxs(ke,{data:i,layout:"vertical",margin:{left:20},children:[e.jsx(V,{strokeDasharray:"3 3",horizontal:!0,vertical:!1,stroke:"#e2e8f0"}),e.jsx(G,{type:"number",hide:!0}),e.jsx(H,{dataKey:"name",type:"category",width:100,tick:{fontSize:12,fontWeight:600,fill:"#64748b"},axisLine:!1,tickLine:!1}),e.jsx(O,{cursor:{fill:"#f8fafc"},contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.1)"}}),e.jsx(K,{wrapperStyle:{paddingTop:"20px"}}),e.jsx(ae,{dataKey:"planned",name:"预计投入",fill:"#94a3b8",radius:[0,4,4,0],barSize:20}),e.jsx(ae,{dataKey:"actual",name:"实际投入",fill:"#3b82f6",radius:[0,4,4,0],barSize:20})]})})}),e.jsx("div",{className:"mt-8 grid grid-cols-2 gap-4",children:i.map((s,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:P[l%P.length]}}),e.jsx("span",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:s.name})]}),e.jsxs("div",{className:`flex items-center gap-1 text-xs font-bold ${s.variance>0?"text-red-500":"text-emerald-500"}`,children:[s.variance>0?e.jsx(Be,{size:14}):e.jsx(rs,{size:14}),Math.abs(s.variancePercent),"%"]})]},l))})]}),e.jsxs(D,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"跨项目资源分布 (组合级)"}),e.jsx("p",{className:"text-sm text-slate-500",children:"显示该技术栈/部门在所有项目中的分布情况"})]})}),e.jsx("div",{className:"h-[400px]",children:e.jsx(B,{width:"100%",height:"100%",children:e.jsxs(Me,{children:[e.jsx(Re,{data:t,cx:"50%",cy:"50%",innerRadius:80,outerRadius:140,paddingAngle:5,dataKey:"value",stroke:"none",children:t.map((s,l)=>e.jsx(we,{fill:P[l%P.length]},`cell-${l}`))}),e.jsx(O,{content:({active:s,payload:l})=>{if(s&&l&&l.length){const n=l[0].payload;return e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-xl shadow-xl border border-slate-100 dark:border-slate-700",children:[e.jsx("p",{className:"font-bold text-slate-900 mb-2",children:n.name}),e.jsx("div",{className:"space-y-1",children:n.projects.map((g,v)=>e.jsxs("div",{className:"flex justify-between gap-4 text-xs",children:[e.jsx("span",{className:"text-slate-500",children:g.name}),e.jsxs("span",{className:"font-bold text-blue-600",children:[g.value,"人天"]})]},v))})]})}return null}})]})})}),e.jsx("div",{className:"mt-4 flex flex-wrap justify-center gap-4",children:t.map((s,l)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:P[l%P.length]}}),e.jsx("span",{className:"text-sm font-medium text-slate-600",children:s.name}),e.jsxs("span",{className:"text-sm font-bold text-slate-900",children:[(s.value/t.reduce((n,g)=>n+g.value,0)*100).toFixed(0),"%"]})]},l))})]})]}),e.jsxs(D,{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-extrabold text-slate-900 dark:text-slate-100",children:"资源效能雷达图 (Department/Skill Matrix)"}),e.jsx("p",{className:"text-slate-500",children:"分析各技术栈/部门的规模投入偏差与效能平衡"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500/20 border-2 border-blue-500"}),e.jsx("span",{className:"text-sm font-semibold",children:"实际消耗"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-slate-300"}),e.jsx("span",{className:"text-sm font-semibold",children:"初始计划"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-12 items-center",children:[e.jsx("div",{className:"lg:col-span-2 h-[500px]",children:e.jsx(B,{width:"100%",height:"100%",children:e.jsxs(qe,{cx:"50%",cy:"50%",outerRadius:"80%",data:h,children:[e.jsx(Qe,{stroke:"#e2e8f0"}),e.jsx(Ke,{dataKey:"name",tick:{fontSize:13,fontWeight:700,fill:"#475569"}}),e.jsx(We,{angle:30,domain:[0,"auto"],axisLine:!1,tick:!1}),e.jsx(be,{name:"Planned Assets",dataKey:"planned",stroke:"#94a3b8",fill:"#94a3b8",fillOpacity:.1,strokeWidth:2}),e.jsx(be,{name:"Actual Investment",dataKey:"actual",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.3,strokeWidth:3}),e.jsx(O,{contentStyle:{borderRadius:"16px",border:"none",boxShadow:"0 20px 25px -5px rgb(0 0 0 / 0.1)"}})]})})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"text-lg font-bold text-slate-900 dark:text-slate-100 border-b pb-4 border-slate-100 dark:border-slate-800",children:"关键偏差指标评级"}),e.jsx("div",{className:"space-y-4",children:h.map((s,l)=>e.jsxs("div",{className:"group cursor-default",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-300",children:s.name}),e.jsxs("span",{className:`text-sm font-black ${s.efficiency>110?"text-red-600":s.efficiency<90?"text-amber-600":"text-emerald-600"}`,children:[s.efficiency,"%"]})]}),e.jsx("div",{className:"h-2 bg-slate-100 dark:bg-slate-900 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-1000 ${s.efficiency>110?"bg-red-500":s.efficiency<90?"bg-amber-500":"bg-emerald-500"}`,style:{width:`${Math.min(s.efficiency,100)}%`}})}),e.jsx("p",{className:"text-[11px] text-slate-400 mt-2 opacity-0 group-hover:opacity-100 transition-opacity",children:s.efficiency>110?"⚠️ 超量投入，需审视是否存在镀金或低效":s.efficiency<90?"ℹ️ 投入不足，可能导致进度风险":"✅ 投入模型完全符合基准计划"})]},l))}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-2xl mt-8",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(pe,{className:"text-blue-600 shrink-0",size:18}),e.jsxs("div",{className:"text-xs text-blue-800 dark:text-blue-300 leading-relaxed font-medium",children:[e.jsx("strong",{children:"建议行动:"})," 系统识别到 ",e.jsx("strong",{children:h.filter(s=>s.efficiency>110).length})," 处显著超支点。建议调取项目周报，核实该技术栈在对应项目的工时填报真实性。"]})]})})]})]})]}),e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"全量项目资源矩阵 (Resource Heat Matrix)"}),e.jsx("p",{className:"text-sm text-slate-500",children:"横向对比各项目在各资源类别上的实际投入规模"})]}),e.jsx(L,{variant:"secondary",size:"sm",children:"导出矩阵"})]}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-slate-100 dark:border-slate-800",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase",children:"资源节点 / 项目"}),o.map(s=>e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase text-center min-w-[120px]",children:s.name.length>10?s.name.substring(0,10)+"...":s.name},s.id)),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-blue-600 uppercase text-center",children:"合计投入"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:t.map((s,l)=>e.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-8 rounded-full",style:{backgroundColor:P[l%P.length]}}),e.jsx("span",{className:"font-bold text-slate-900 dark:text-slate-100",children:s.name})]})}),o.map(n=>{var k;const g=(k=n.actualResourceUsage)==null?void 0:k.find(b=>(c==="department"?b.department:b.category)===s.name),v=(g==null?void 0:g.count)||0;return e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 rounded-2xl text-sm font-bold ${v>5?"bg-blue-600 text-white shadow-lg":v>2?"bg-blue-100 text-blue-700 dark:bg-blue-900/40":v>0?"bg-slate-100 text-slate-600 dark:bg-slate-800":"text-slate-300"}`,children:v||"-"})},n.id)}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:"text-lg font-black text-slate-900 dark:text-slate-100",children:s.value})})]},l))})]})})]})]})},Gs=()=>{const[o,d]=N.useState("dashboard"),[r,u]=N.useState(!1),[c,a]=N.useState(!1),[x,i]=N.useState(!1),[t,h]=N.useState("all"),m=ne(),j=ce(),s=N.useMemo(()=>ze(m,12),[m]),l=N.useMemo(()=>Ce(m,j,s),[m,j,s]),n=N.useMemo(()=>t==="all"?l:l.filter(k=>{var p;const b=(p=s[0])==null?void 0:p.label,f=k.allocations[b],w=f?f.total:0,y=k.capacity>0?w/k.capacity*100:0;switch(t){case"low":return y<50;case"normal":return y>=50&&y<=80;case"high":return y>80&&y<=100;case"over":return y>100;default:return!0}}),[l,t,s]),g=[{id:"dashboard",label:"总览",icon:Ve,color:"blue"},{id:"heatmap",label:"热力图",icon:ms,color:"purple"},{id:"gantt",label:"时间线",icon:X,color:"green"},{id:"conflicts",label:"冲突检测",icon:J,color:"red"},{id:"costs",label:"成本分析",icon:Ge,color:"yellow"},{id:"skills",label:"技能匹配",icon:Ae,color:"indigo"},{id:"decision",label:"决策支持",icon:ge,color:"rose"},{id:"prediction",label:"负荷预测",icon:F,color:"blue"},{id:"efficiency",label:"效能下钻",icon:He,color:"emerald"}],v=k=>{k==="csv"?o==="heatmap"||o==="dashboard"?ks(n,s):Ss(j):zs({resourceLoads:n,resourcePool:j,exportDate:new Date().toISOString()},"资源数据"),u(!1)};return e.jsxs(is,{children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-30 -mx-6 -mt-6 px-6 pt-6",children:[e.jsx(ns,{title:"资源管理",description:"全方位资源监控与分析",actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(L,{onClick:k=>{k.stopPropagation(),a(!c)},variant:c||t!=="all"?"primary":"secondary",icon:ye,children:["筛选",t!=="all"&&e.jsx(E,{variant:"danger",size:"sm",rounded:"full",className:"ml-2",children:"1"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{onClick:()=>u(!r),variant:"secondary",icon:_e,children:"导出"}),r&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700 py-2 z-50",children:[e.jsx("button",{onClick:()=>v("csv"),className:"w-full px-4 py-2 text-left text-sm hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"导出为 CSV"}),e.jsx("button",{onClick:()=>v("json"),className:"w-full px-4 py-2 text-left text-sm hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"导出为 JSON"}),e.jsx("button",{onClick:()=>{window.print(),u(!1)},className:"w-full px-4 py-2 text-left text-sm hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"打印报表"})]})]}),e.jsx(L,{onClick:()=>i(!0),variant:"primary",icon:le,children:"添加资源"})]})}),c&&e.jsxs("div",{className:"mb-4 p-4 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-medium text-slate-900",children:"筛选条件"}),e.jsx("button",{onClick:()=>{h("all"),a(!1)},className:"text-sm text-slate-600 hover:text-slate-900",children:e.jsx(ie,{size:16})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"利用率范围"}),e.jsx("div",{className:"flex gap-2",children:[{value:"all",label:"全部"},{value:"low",label:"低负载 (<50%)"},{value:"normal",label:"正常 (50-80%)"},{value:"high",label:"高负载 (80-100%)"},{value:"over",label:"超额 (>100%)"}].map(k=>e.jsx("button",{onClick:b=>{b.stopPropagation(),h(k.value)},className:`px-3 py-1.5 text-sm rounded-lg transition-colors ${t===k.value?"bg-blue-600 text-white":"bg-white text-slate-700 hover:bg-slate-100 border border-slate-200"}`,children:k.label},k.value))})]})]}),e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto pb-2",children:g.map(k=>{const b=k.icon,f=o===k.id;return e.jsxs("button",{onClick:()=>d(k.id),className:`flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-all whitespace-nowrap ${f?"bg-blue-100 text-blue-700 shadow-sm":"text-slate-600 hover:bg-slate-100"}`,children:[e.jsx(b,{size:18}),e.jsx("span",{children:k.label})]},k.id)})})]}),e.jsxs("div",{className:"mt-6",children:[o==="dashboard"&&e.jsx(js,{}),o==="heatmap"&&e.jsx(fs,{resourceLoads:n,buckets:s}),o==="gantt"&&e.jsx(ss,{projects:m,resources:j}),o==="conflicts"&&e.jsx(Ns,{}),o==="costs"&&e.jsx(as,{}),o==="skills"&&e.jsx(ws,{}),o==="decision"&&e.jsx(ls,{}),o==="prediction"&&e.jsx(hs,{projects:m,resourcePool:j}),o==="efficiency"&&e.jsx(Ms,{})]}),(r||c)&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>{u(!1)}}),e.jsx(Cs,{isOpen:x,onClose:()=>i(!1)})]})};export{Gs as default};
