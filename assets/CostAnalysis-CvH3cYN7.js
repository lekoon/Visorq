import{u as Y,a as _,r as b,p as B,j as t,T as N,G as H}from"./index-WvHo_kXV.js";import{D as C}from"./dollar-sign-CUpX4q43.js";import{A as J}from"./activity-DIiQUslX.js";import{R as w,T as $,L as I,B as Q,C as M}from"./generateCategoricalChart-7WjfhzzQ.js";import{L as V,a as D}from"./LineChart-wJk4DMAN.js";import{C as P,X as A,Y as O}from"./YAxis-Bjld2WV-.js";import{B as Z}from"./BarChart-DHifeU4c.js";import{P as q,a as tt}from"./PieChart-B5tJ2Iwl.js";import{L as et}from"./lightbulb-_5jKYvZ_.js";import{T as st}from"./trending-down-BKxwTGSa.js";import{s as T,a as ot,e as at}from"./startOfMonth-Bpv36zMA.js";import{f as rt}from"./format--C-ir6Ff.js";const lt=(c,i)=>{if(!i.costPerUnit&&!i.hourlyRate)return 0;let n=0;const{count:l,duration:a,unit:s}=c;if(i.hourlyRate){let o=0;switch(s){case"day":o=a*8;break;case"month":o=a*160;break;case"year":o=a*1920;break}n=l*o*i.hourlyRate}else if(i.costPerUnit){let o=a;s==="day"&&(o=a/30),s==="year"&&(o=a*12),n=l*o*i.costPerUnit}return n},it=(c,i)=>{const n=(c.resourceRequirements||[]).map(a=>{const s=i.find(d=>d.id===a.resourceId);if(!s)return{resourceId:a.resourceId,resourceName:"Unknown Resource",quantity:a.count,duration:a.duration,unit:a.unit,unitCost:0,totalCost:0};const o=lt(a,s),r=s.costPerUnit||s.hourlyRate||0;return{resourceId:s.id,resourceName:s.name,quantity:a.count,duration:a.duration,unit:a.unit,unitCost:r,totalCost:o}}),l=n.reduce((a,s)=>a+s.totalCost,0);return{projectId:c.id,projectName:c.name,totalCost:l,resourceCosts:n}},S=(c,i)=>{const n=c.map(o=>it(o,i)),l=n.reduce((o,r)=>o+r.totalCost,0),a=new Map;n.forEach(o=>{o.resourceCosts.forEach(r=>{const d=a.get(r.resourceId)||{resourceName:r.resourceName,totalAllocated:0,totalCost:0,projects:[]};a.set(r.resourceId,{resourceName:r.resourceName,totalAllocated:d.totalAllocated+r.quantity,totalCost:d.totalCost+r.totalCost,projects:[...d.projects,{projectId:o.projectId,projectName:o.projectName,cost:r.totalCost}]})})});const s=Array.from(a.entries()).map(([o,r])=>({resourceId:o,...r}));return{totalCost:l,projectCosts:n,resourceUtilizationCost:s}},nt=(c,i,n)=>{const l=S(c,i),a=l.totalCost,s=n||c.reduce((x,e)=>x+(e.budget||0),0),o=s-a,r=s>0?a/s*100:0;let d="on-track";r>100?d="over":r<70&&(d="under");const u=c.map(x=>{const e=l.projectCosts.find(p=>p.projectId===x.id),m=(e==null?void 0:e.totalCost)||0,g=x.budget||0;return g>0&&m>g?{projectId:x.id,projectName:x.name,budget:g,actualCost:m,variance:m-g}:null}).filter(Boolean),h=[];d==="over"?h.push(`Portfolio is ${(r-100).toFixed(1)}% over budget. Consider reducing scope or reallocating resources.`):d==="under"&&h.push(`Only ${r.toFixed(1)}% of budget utilized. Consider taking on additional projects.`),u.length>0&&h.push(`${u.length} project(s) are over budget. Review resource allocation for: ${u.map(x=>x.projectName).join(", ")}`);const j=l.resourceUtilizationCost.sort((x,e)=>e.totalCost-x.totalCost)[0];return j&&h.push(`Highest cost resource: ${j.resourceName} ($${j.totalCost.toLocaleString()}). Monitor utilization closely.`),{totalBudget:s,totalCost:a,remaining:o,utilizationRate:r,status:d,projectsOverBudget:u,recommendations:h}},ct=(c,i)=>{const n=[],l=S(c,i),a=l.resourceUtilizationCost.filter(o=>o.totalCost>l.totalCost*.3).sort((o,r)=>r.totalCost-o.totalCost);a.length>0&&n.push(`${a[0].resourceName} accounts for ${(a[0].totalCost/l.totalCost*100).toFixed(1)}% of total cost. Consider optimizing allocation.`);const s=c.map(o=>{var d;const r=((d=l.projectCosts.find(u=>u.projectId===o.id))==null?void 0:d.totalCost)||0;return{...o,cost:r,efficiency:(o.score||0)/(r||1)}}).filter(o=>o.cost>0).sort((o,r)=>o.efficiency-r.efficiency).slice(0,3);return s.length>0&&s[0].efficiency<.01&&n.push(`Project "${s[0].name}" has low ROI (score ${(s[0].score||0).toFixed(1)} vs cost $${s[0].cost.toLocaleString()}). Review justification.`),n},vt=({totalBudget:c})=>{const{projects:i,resourcePool:n}=Y(),{t:l}=_(),a=b.useMemo(()=>S(i,n),[i,n]),s=b.useMemo(()=>nt(i,n,c),[i,n,c]),o=b.useMemo(()=>ct(i,n),[i,n]),r=a.projectCosts.sort((e,m)=>m.totalCost-e.totalCost).slice(0,10).map(e=>({name:e.projectName.length>15?e.projectName.substring(0,15)+"...":e.projectName,cost:parseFloat(e.totalCost.toFixed(0))})),d=a.resourceUtilizationCost.sort((e,m)=>m.totalCost-e.totalCost).map(e=>({name:e.resourceName,value:parseFloat(e.totalCost.toFixed(0))})),u=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d"],h=b.useMemo(()=>{const m=T(new Date),g=[];let p=0,z=0;for(let v=0;v<12;v++){const y=ot(m,v),U=T(y),E=at(y),K=rt(y,"MMM");let k=0;i.forEach(f=>{var F;if(!f.startDate||!f.endDate)return;const R=B(f.startDate),L=B(f.endDate);if(R<=E&&L>=U){const G=Math.max(1,(L.getTime()-R.getTime())/2592e6),W=((F=a.projectCosts.find(X=>X.projectId===f.id))==null?void 0:F.totalCost)||0;k+=W/G}}),p+=k,z+=s.totalBudget/12,g.push({name:K,actual:Math.round(p),budget:Math.round(z)})}return g},[i,a,s.totalBudget]),j=e=>{switch(e){case"under":return"from-blue-500 to-cyan-500";case"on-track":return"from-green-500 to-emerald-500";case"over":return"from-red-500 to-orange-500";default:return"from-slate-500 to-gray-500"}},x=e=>{switch(e){case"under":return t.jsx(st,{className:"text-blue-600",size:28});case"on-track":return t.jsx(C,{className:"text-green-600",size:28});case"over":return t.jsx(N,{className:"text-red-600",size:28});default:return t.jsx(C,{className:"text-slate-600",size:28})}};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:t.jsx(C,{className:"text-blue-600",size:24})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-slate-500 font-medium",children:l("cost.totalBudget")}),t.jsxs("h3",{className:"text-2xl font-bold text-slate-900",children:["$",s.totalBudget.toLocaleString()]})]})]})}),t.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-3 bg-purple-100 rounded-xl",children:t.jsx(N,{className:"text-purple-600",size:24})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-slate-500 font-medium",children:l("cost.totalCost")}),t.jsxs("h3",{className:"text-2xl font-bold text-slate-900",children:["$",s.totalCost.toLocaleString()]})]})]})}),t.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-3 bg-green-100 rounded-xl",children:t.jsx(C,{className:"text-green-600",size:24})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-slate-500 font-medium",children:l("cost.remaining")}),t.jsxs("h3",{className:"text-2xl font-bold text-slate-900",children:["$",s.remaining.toLocaleString()]})]})]})}),t.jsx("div",{className:`bg-gradient-to-br ${j(s.status)} p-6 rounded-2xl shadow-lg`,children:t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-3 bg-white/20 rounded-xl",children:x(s.status)}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-white/90 font-medium",children:l("cost.utilization")}),t.jsxs("h3",{className:"text-2xl font-bold text-white",children:[s.utilizationRate.toFixed(1),"%"]})]})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"ç´¯è®¡æˆæœ¬é¢„æµ‹ (S-Curve)"}),t.jsx(J,{className:"text-slate-400",size:20})]}),t.jsx("div",{className:"h-80",children:t.jsx(w,{width:"100%",height:"100%",children:t.jsxs(V,{data:h,children:[t.jsx(P,{strokeDasharray:"3 3",stroke:"#f1f5f9"}),t.jsx(A,{dataKey:"name",tick:{fill:"#64748b"}}),t.jsx(O,{tick:{fill:"#64748b"},tickFormatter:e=>`$${e/1e3}k`}),t.jsx($,{formatter:e=>`$${e.toLocaleString()}`,contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),t.jsx(I,{}),t.jsx(D,{type:"monotone",dataKey:"budget",name:"é¢„ç®—åŸºçº¿",stroke:"#94a3b8",strokeDasharray:"5 5",strokeWidth:2,dot:!1}),t.jsx(D,{type:"monotone",dataKey:"actual",name:"é¢„æµ‹æˆæœ¬",stroke:"#3b82f6",strokeWidth:3,dot:{r:4},activeDot:{r:6}})]})})})]}),t.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-bold text-slate-900",children:l("cost.topProjectCosts")}),t.jsx(N,{className:"text-slate-400",size:20})]}),t.jsx("div",{className:"h-80",children:t.jsx(w,{width:"100%",height:"100%",children:t.jsxs(Z,{data:r,layout:"vertical",children:[t.jsx(P,{strokeDasharray:"3 3",stroke:"#f1f5f9",horizontal:!1}),t.jsx(A,{type:"number",tick:{fill:"#64748b"},tickFormatter:e=>`$${e/1e3}k`}),t.jsx(O,{dataKey:"name",type:"category",tick:{fill:"#64748b",fontSize:12},width:100}),t.jsx($,{formatter:e=>`$${e.toLocaleString()}`,contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),t.jsx(Q,{dataKey:"cost",radius:[0,4,4,0],children:r.map((e,m)=>t.jsx(M,{fill:m<3?"#3b82f6":"#94a3b8"},`cell-${m}`))})]})})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 lg:col-span-1",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"èµ„æºæˆæœ¬åˆ†å¸ƒ"}),t.jsx(H,{className:"text-slate-400",size:20})]}),t.jsx("div",{className:"h-64",children:t.jsx(w,{width:"100%",height:"100%",children:t.jsxs(q,{children:[t.jsx(tt,{data:d,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:d.map((e,m)=>t.jsx(M,{fill:u[m%u.length]},`cell-${m}`))}),t.jsx($,{formatter:e=>`$${e.toLocaleString()}`,contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}}),t.jsx(I,{layout:"horizontal",verticalAlign:"bottom",align:"center"})]})})})]}),t.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[s.projectsOverBudget.length>0&&t.jsxs("div",{className:"bg-red-50 p-6 rounded-2xl border-2 border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(N,{className:"text-red-600",size:24}),t.jsx("h3",{className:"text-lg font-bold text-red-900",children:l("cost.overBudgetProjects")})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.projectsOverBudget.map(e=>t.jsx("div",{className:"bg-white p-4 rounded-xl border border-red-300 shadow-sm",children:t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-bold text-slate-900",children:e.projectName}),t.jsxs("div",{className:"text-sm text-slate-600 mt-1",children:[t.jsxs("div",{children:[l("cost.budget"),": ",t.jsxs("span",{className:"font-medium",children:["$",e.budget.toLocaleString()]})]}),t.jsxs("div",{children:[l("cost.actual"),": ",t.jsxs("span",{className:"font-medium",children:["$",e.actualCost.toLocaleString()]})]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"text-lg font-bold text-red-600",children:["+$",e.variance.toLocaleString()]}),t.jsxs("div",{className:"px-2 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-full inline-block mt-1",children:[(e.variance/e.budget*100).toFixed(1),"% ",l("cost.over")]})]})]})},e.projectId))})]}),t.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(et,{className:"text-yellow-500",size:24}),t.jsx("h3",{className:"text-lg font-bold text-slate-900",children:l("cost.recommendations")})]}),t.jsxs("div",{className:"space-y-3",children:[[...s.recommendations,...o].slice(0,5).map((e,m)=>t.jsxs("div",{className:"flex gap-3 p-4 bg-blue-50 rounded-xl border border-blue-200",children:[t.jsx("div",{className:"text-xl",children:"ðŸ’¡"}),t.jsx("p",{className:"text-sm text-slate-700 flex-1 font-medium",children:e})]},m)),s.recommendations.length===0&&o.length===0&&t.jsx("p",{className:"text-slate-500 text-center py-4",children:l("cost.noRecommendations")})]})]})]})]})]})};export{vt as C};
