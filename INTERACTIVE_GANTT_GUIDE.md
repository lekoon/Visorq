# ğŸ¨ äº¤äº’å¼ç”˜ç‰¹å›¾ä½¿ç”¨æŒ‡å—

## ğŸ“… åˆ›å»ºæ—¶é—´
2025-12-06 18:35

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

å…¨æ–°çš„äº¤äº’å¼ç”˜ç‰¹å›¾ç»„ä»¶ (`InteractiveGanttChart`) æä¾›äº†ç±»ä¼¼è‡ªç”±ç”»æ¿çš„ä½“éªŒï¼Œæ”¯æŒä»»åŠ¡çš„å®Œæ•´å¢åˆ æŸ¥æ”¹æ“ä½œã€‚

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### 1. ä»»åŠ¡æ‹–æ‹½ç§»åŠ¨ ğŸ–±ï¸
- **æ“ä½œ**: ç‚¹å‡»ä»»åŠ¡æ¡å¹¶æ‹–åŠ¨
- **æ‰¹é‡ç§»åŠ¨**: æŒ‰ä½ Shift æˆ– Ctrl ç‚¹å‡»å¯å¤šé€‰ï¼Œæ‹–åŠ¨å…¶ä¸­ä¸€ä¸ªå³å¯æ‰¹é‡ç§»åŠ¨
- **æ•ˆæœ**: æ›´æ”¹ä»»åŠ¡çš„å¼€å§‹å’Œç»“æŸæ—¥æœŸ
- **å®æ—¶åé¦ˆ**: æ‹–åŠ¨æ—¶æ˜¾ç¤ºæ–°çš„æ—¶é—´ä½ç½®

### 2. ä»»åŠ¡æ—¶é•¿è°ƒæ•´ â†”ï¸
- **å³ä¾§è°ƒæ•´**: æ‹–åŠ¨ä»»åŠ¡æ¡å³ä¾§è¾¹ç¼˜ï¼Œè°ƒæ•´ç»“æŸæ—¥æœŸ
- **å·¦ä¾§è°ƒæ•´**: æ‹–åŠ¨ä»»åŠ¡æ¡å·¦ä¾§è¾¹ç¼˜ï¼Œè°ƒæ•´å¼€å§‹æ—¥æœŸï¼ˆå·¥æœŸå˜åŒ–ï¼‰
- **é™åˆ¶**: ç»“æŸæ—¥æœŸä¸èƒ½æ—©äºå¼€å§‹æ—¥æœŸ

### 3. ç”»å¸ƒç¼©æ”¾ ğŸ”
- **å·¥å…·æ æŒ‰é’®**: ç‚¹å‡» + / - æŒ‰é’®
- **ç¼©æ”¾èŒƒå›´**: 25% - 200%
- **æ˜¾ç¤º**: å®æ—¶æ˜¾ç¤ºå½“å‰ç¼©æ”¾æ¯”ä¾‹

### 4. ç”»å¸ƒå¹³ç§» âœ‹
- **æ“ä½œ**: åœ¨ç©ºç™½åŒºåŸŸæŒ‰ä½é¼ æ ‡å·¦é”®æ‹–åŠ¨
- **æ•ˆæœ**: å¹³ç§»æ•´ä¸ªç”˜ç‰¹å›¾è§†å›¾
- **å…‰æ ‡**: æ‹–åŠ¨æ—¶æ˜¾ç¤ºæŠ“æ‰‹å…‰æ ‡

### 5. ä»»åŠ¡å¿«é€Ÿæ“ä½œ âš¡
- **å³é”®èœå•**: åœ¨ä»»åŠ¡ä¸Šå³é”®ç‚¹å‡»
- **é€‰é¡¹**:
  - ğŸ“ ç¼–è¾‘ä»»åŠ¡
  - ğŸ—‘ï¸ åˆ é™¤ä»»åŠ¡
- **æ’¤é”€/é‡åš**: å·¥å…·æ ä¸Šçš„æ’¤é”€/é‡åšæŒ‰é’® (Ctrl+Z / Ctrl+Y)

### 6. ä»»åŠ¡ä¾èµ–ç®¡ç† ğŸ”—
- **åˆ›å»º**: æ‚¬åœåœ¨ä»»åŠ¡ä¸¤ä¾§åœ†ç‚¹ï¼Œæ‹–åŠ¨åˆ°ç›®æ ‡ä»»åŠ¡
- **æ˜¾ç¤º**: SVG æ›²çº¿è¿æ¥
- **åˆ é™¤**: åŒå‡»è¿çº¿å³å¯åˆ é™¤
- **æ‚¬åœæ•ˆæœ**: é¼ æ ‡æ‚¬åœæ—¶é«˜äº®è¿çº¿

### 7. æ•°æ®å¯¼å‡º ğŸ’¾
- **æ“ä½œ**: ç‚¹å‡»å·¥å…·æ ä¸Šçš„ä¸‹è½½æŒ‰é’®
- **æ ¼å¼**: å¯¼å‡ºå½“å‰è§†å›¾ä»»åŠ¡ä¸º JSON æ–‡ä»¶

### 8. ç‰¹æ®Šä»»åŠ¡ç±»å‹ ğŸ”·
- **é‡Œç¨‹ç¢‘**: æ˜¾ç¤ºä¸ºè±å½¢å›¾æ ‡
  - ä¸èƒ½è°ƒæ•´æ—¶é•¿
  - æ”¯æŒæ‹–æ‹½ç§»åŠ¨
  - æ”¯æŒä¾èµ–è¿çº¿

### 9. æ—¶é—´è½´æ˜¾ç¤º ğŸ“…
- **æœˆä»½æ ‡æ³¨**: æ¯æœˆ1æ—¥æ˜¾ç¤ºå¹´æœˆ
- **æ—¥æœŸæ˜¾ç¤º**: æ˜¾ç¤ºæ—¥æœŸå’Œæ˜ŸæœŸ
- **å‘¨æœ«é«˜äº®**: å‘¨æœ«èƒŒæ™¯è‰²åŒºåˆ†
- **ä»Šæ—¥æ ‡è®°**: å½“å‰æ—¥æœŸè“è‰²é«˜äº®
- **å½“å‰æ—¶é—´çº¿**: çº¢è‰²ç«–çº¿æ ‡è®°å½“å‰æ—¶åˆ»

### 10. ä»»åŠ¡çŠ¶æ€é¢œè‰² ğŸ¨
- **å·²å®Œæˆ**: ç»¿è‰²èƒŒæ™¯
- **è¿›è¡Œä¸­**: è“è‰²èƒŒæ™¯
- **è§„åˆ’ä¸­**: è“è‰²èƒŒæ™¯

---

## ğŸ® äº¤äº’æ“ä½œ

### é¼ æ ‡æ“ä½œ

| æ“ä½œ | æ•ˆæœ |
|------|------|
| å·¦é”®ç‚¹å‡»ä»»åŠ¡ | é€‰ä¸­ä»»åŠ¡ |
| å·¦é”®æ‹–åŠ¨ä»»åŠ¡ | ç§»åŠ¨ä»»åŠ¡æ—¶é—´ |
| å·¦é”®æ‹–åŠ¨è¾¹ç¼˜ | è°ƒæ•´ä»»åŠ¡æ—¶é•¿ |
| å·¦é”®æ‹–åŠ¨ç©ºç™½ | å¹³ç§»ç”»å¸ƒ |
| å³é”®ç‚¹å‡»ä»»åŠ¡ | æ‰“å¼€ä¸Šä¸‹æ–‡èœå• |
| æ‚¬åœä»»åŠ¡ | æ˜¾ç¤ºè¿æ¥ç‚¹ |

### è§†è§‰åé¦ˆ

- **é€‰ä¸­çŠ¶æ€**: è“è‰²è¾¹æ¡†é«˜äº®
- **æ‚¬åœæ•ˆæœ**: é˜´å½±åŠ æ·±
- **æ‹–åŠ¨å…‰æ ‡**: ç§»åŠ¨/è°ƒæ•´å¤§å°å…‰æ ‡
- **è¿æ¥ç‚¹**: ä»»åŠ¡ä¸¤ä¾§çš„åœ†ç‚¹ï¼ˆæ‚¬åœå¯è§ï¼‰

---

## ğŸ—ï¸ æŠ€æœ¯å®ç°

### ç»„ä»¶æ¶æ„
```
InteractiveGanttChart
â”œâ”€â”€ Toolbar (å·¥å…·æ )
â”‚   â”œâ”€â”€ Zoom Controls (ç¼©æ”¾æ§åˆ¶)
â”‚   â””â”€â”€ Add Task Button (æ–°å¢æŒ‰é’®)
â”œâ”€â”€ Canvas Area (ç”»å¸ƒåŒºåŸŸ)
â”‚   â”œâ”€â”€ Header (æ—¶é—´è½´æ ‡é¢˜)
â”‚   â”œâ”€â”€ Grid Background (ç½‘æ ¼èƒŒæ™¯)
â”‚   â”œâ”€â”€ Tasks Layer (ä»»åŠ¡å±‚)
â”‚   â”‚   â”œâ”€â”€ Task Bars (ä»»åŠ¡æ¡)
â”‚   â”‚   â”œâ”€â”€ Progress Bars (è¿›åº¦æ¡)
â”‚   â”‚   â””â”€â”€ Resize Handles (è°ƒæ•´æ‰‹æŸ„)
â”‚   â””â”€â”€ Dependencies SVG (ä¾èµ–å…³ç³»)
â””â”€â”€ Context Menu (å³é”®èœå•)
```

### æ ¸å¿ƒç®—æ³•

#### 1. æ—¥æœŸåˆ°ä½ç½®è½¬æ¢
```typescript
const getXFromDate = (date: Date | string) => {
    const d = typeof date === 'string' ? parseISO(date) : date;
    return differenceInDays(d, startDate) * currentCellWidth;
};
```

#### 2. æ‹–æ‹½è·ç¦»åˆ°æ—¥æœŸè½¬æ¢
```typescript
const daysDelta = Math.round(dx / currentCellWidth);
const newStart = addDays(originalStart, daysDelta);
```

#### 3. æ—¶é—´èŒƒå›´è‡ªåŠ¨è®¡ç®—
```typescript
// è‡ªåŠ¨è®¡ç®—æ˜¾ç¤ºèŒƒå›´
const min = Math.min(...tasks.map(t => new Date(t.startDate)));
const max = Math.max(...tasks.map(t => new Date(t.endDate)));
const start = addDays(startOfWeek(min), -7); // å‰ç¼“å†²
const end = addDays(max, 14); // åç¼“å†²
```

---

## ğŸ“Š æ•°æ®æµ

### ä»»åŠ¡æ›´æ–°æµç¨‹
```
ç”¨æˆ·æ‹–åŠ¨ä»»åŠ¡
    â†“
handleTaskDragStart (è®°å½•åˆå§‹çŠ¶æ€)
    â†“
handleMouseMove (è·Ÿè¸ªç§»åŠ¨)
    â†“
handleMouseUp (è®¡ç®—æ–°æ—¥æœŸ)
    â†“
onTaskUpdate (å›è°ƒæ›´æ–°)
    â†“
çˆ¶ç»„ä»¶æ›´æ–°çŠ¶æ€
    â†“
é‡æ–°æ¸²æŸ“ç”˜ç‰¹å›¾
```

### æ–°å¢ä»»åŠ¡æµç¨‹
```
ç‚¹å‡»"æ–°å¢ä»»åŠ¡"æŒ‰é’®
    â†“
onTaskAdd å›è°ƒ
    â†“
SmartTaskView åˆ›å»ºå®Œæ•´ Task å¯¹è±¡
    â†“
è°ƒç”¨çˆ¶ç»„ä»¶çš„ onTaskAdd
    â†“
ä»»åŠ¡æ·»åŠ åˆ°åˆ—è¡¨
    â†“
ç”˜ç‰¹å›¾è‡ªåŠ¨æ˜¾ç¤ºæ–°ä»»åŠ¡
```

---

## ğŸ¨ æ ·å¼ç³»ç»Ÿ

### é¢œè‰²æ–¹æ¡ˆ
```typescript
const colors = {
  completed: 'bg-green-100 text-green-800',
  active: 'bg-blue-100 text-blue-800',
  planning: 'bg-blue-100 text-blue-800',
  selected: 'ring-2 ring-blue-500',
  weekend: 'bg-slate-50',
  today: 'bg-blue-50',
  currentTime: 'border-red-500'
};
```

### å°ºå¯¸å¸¸é‡
```typescript
const CELL_WIDTH = 50;  // æ¯å¤©çš„å®½åº¦
const ROW_HEIGHT = 48;  // ä»»åŠ¡è¡Œé«˜åº¦
const HEADER_HEIGHT = 40; // æ ‡é¢˜æ é«˜åº¦
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### å·²å®ç°
- âœ… **useMemo**: ç¼“å­˜æ—¶é—´èŒƒå›´è®¡ç®—
- âœ… **CSS Transform**: GPU åŠ é€Ÿçš„å¹³ç§»å’Œç¼©æ”¾
- âœ… **äº‹ä»¶å§”æ‰˜**: å‡å°‘äº‹ä»¶ç›‘å¬å™¨æ•°é‡
- âœ… **æ¡ä»¶æ¸²æŸ“**: åªæ¸²æŸ“å¯è§åŒºåŸŸ

### å»ºè®®ä¼˜åŒ–
- [ ] è™šæ‹Ÿæ»šåŠ¨ (ä»»åŠ¡æ•° > 100)
- [ ] Canvas æ¸²æŸ“ (ä»»åŠ¡æ•° > 500)
- [ ] Web Workers (å¤æ‚è®¡ç®—)
- [ ] é˜²æŠ–/èŠ‚æµ (æ‹–åŠ¨äº‹ä»¶)

---

## ğŸ”§ é›†æˆæ–¹å¼

### åœ¨ SmartTaskView ä¸­ä½¿ç”¨
```tsx
import InteractiveGanttChart from './InteractiveGanttChart';

const renderGanttView = () => {
    return (
        <InteractiveGanttChart 
            tasks={tasks}
            onTaskUpdate={onTaskUpdate}
            onTaskDelete={onTaskDelete}
            onTaskAdd={(partialTask) => {
                const newTask: Task = {
                    id: Date.now().toString(),
                    name: 'æ–°ä»»åŠ¡',
                    // ... å…¶ä»–é»˜è®¤å€¼
                    ...partialTask
                };
                onTaskAdd(newTask);
            }}
        />
    );
};
```

### Props æ¥å£
```typescript
interface InteractiveGanttChartProps {
    tasks: Task[];
    onTaskUpdate: (task: Task) => void;
    onTaskDelete: (taskId: string) => void;
    onTaskAdd: (task: Partial<Task>) => void;
    onDependencyAdd?: (sourceId: string, targetId: string) => void;
    onDependencyDelete?: (sourceId: string, targetId: string) => void;
}
```

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```tsx
<InteractiveGanttChart 
    tasks={projectTasks}
    onTaskUpdate={(task) => updateTask(task)}
    onTaskDelete={(id) => deleteTask(id)}
    onTaskAdd={(partial) => createTask(partial)}
/>
```

### å®Œæ•´ç¤ºä¾‹
```tsx
const MyGanttView = () => {
    const [tasks, setTasks] = useState<Task[]>([]);

    const handleUpdate = (updatedTask: Task) => {
        setTasks(tasks.map(t => 
            t.id === updatedTask.id ? updatedTask : t
        ));
    };

    const handleDelete = (taskId: string) => {
        setTasks(tasks.filter(t => t.id !== taskId));
    };

    const handleAdd = (partialTask: Partial<Task>) => {
        const newTask: Task = {
            id: Date.now().toString(),
            name: 'æ–°ä»»åŠ¡',
            startDate: format(new Date(), 'yyyy-MM-dd'),
            endDate: format(addDays(new Date(), 2), 'yyyy-MM-dd'),
            status: 'planning',
            priority: 'P2',
            progress: 0,
            type: 'task',
            dependencies: [],
            ...partialTask
        };
        setTasks([...tasks, newTask]);
    };

    return (
        <InteractiveGanttChart 
            tasks={tasks}
            onTaskUpdate={handleUpdate}
            onTaskDelete={handleDelete}
            onTaskAdd={handleAdd}
        />
    );
};
```

---

## ğŸ› å·²çŸ¥é™åˆ¶

1. **ä¾èµ–å…³ç³»ç¼–è¾‘**: ç›®å‰ä»…æ˜¾ç¤ºï¼Œæš‚ä¸æ”¯æŒæ‹–æ‹½åˆ›å»º
2. **å·¦ä¾§è°ƒæ•´**: æš‚ä¸æ”¯æŒæ‹–åŠ¨å·¦è¾¹ç¼˜è°ƒæ•´å¼€å§‹æ—¥æœŸ
3. **å¤šé€‰æ“ä½œ**: æš‚ä¸æ”¯æŒæ¡†é€‰å¤šä¸ªä»»åŠ¡
4. **æ’¤é”€/é‡åš**: éœ€è¦å¤–éƒ¨çŠ¶æ€ç®¡ç†æ”¯æŒ

---

## ğŸ”® æœªæ¥è®¡åˆ’

### Phase 1 (å·²å®Œæˆ)
- âœ… åŸºç¡€æ‹–æ‹½ç§»åŠ¨
- âœ… å³ä¾§è°ƒæ•´æ—¶é•¿
- âœ… ç¼©æ”¾å’Œå¹³ç§»
- âœ… å³é”®èœå•
- âœ… ä¾èµ–å…³ç³»æ˜¾ç¤º

### Phase 2 (è®¡åˆ’ä¸­)
- [ ] å·¦ä¾§è°ƒæ•´å¼€å§‹æ—¥æœŸ
- [ ] æ‹–æ‹½åˆ›å»ºä¾èµ–å…³ç³»
- [ ] å¤šé€‰å’Œæ‰¹é‡æ“ä½œ
- [ ] æ’¤é”€/é‡åš
- [ ] ä»»åŠ¡åˆ†ç»„æŠ˜å 

### Phase 3 (æœªæ¥)
- [ ] é‡Œç¨‹ç¢‘æ ‡è®°
- [ ] å…³é”®è·¯å¾„é«˜äº®
- [ ] èµ„æºåˆ†é…æ˜¾ç¤º
- [ ] å¯¼å‡ºä¸ºå›¾ç‰‡/PDF
- [ ] åä½œå…‰æ ‡

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ•°æ®ç®¡ç†
- ä½¿ç”¨ Zustand æˆ– Redux ç®¡ç†ä»»åŠ¡çŠ¶æ€
- å®ç°ä¹è§‚æ›´æ–°æå‡å“åº”é€Ÿåº¦
- æ·»åŠ é˜²æŠ–é¿å…é¢‘ç¹ä¿å­˜

### 2. æ€§èƒ½ä¼˜åŒ–
- ä»»åŠ¡æ•° < 50: æ— éœ€ä¼˜åŒ–
- ä»»åŠ¡æ•° 50-100: ä½¿ç”¨ React.memo
- ä»»åŠ¡æ•° > 100: è€ƒè™‘è™šæ‹Ÿæ»šåŠ¨

### 3. ç”¨æˆ·ä½“éªŒ
- æä¾›åŠ è½½çŠ¶æ€
- æ˜¾ç¤ºæ“ä½œåé¦ˆ
- æ·»åŠ é”®ç›˜å¿«æ·é”®
- å®ç°è‡ªåŠ¨ä¿å­˜

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- æºä»£ç : `src/components/InteractiveGanttChart.tsx`
- é›†æˆä»£ç : `src/components/SmartTaskView.tsx`
- ç±»å‹å®šä¹‰: `src/types/index.ts`

---

**äº«å—è‡ªç”±ç”»æ¿èˆ¬çš„ç”˜ç‰¹å›¾ä½“éªŒï¼** ğŸ¨âœ¨
