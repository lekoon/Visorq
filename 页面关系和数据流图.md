# Visorq 页面关系和数据流图

## 📊 页面架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                         Visorq PMO 系统                          │
└─────────────────────────────────────────────────────────────────┘
                                 │
                    ┌────────────┼────────────┐
                    │            │            │
            ┌───────▼──────┐ ┌──▼──────┐ ┌──▼──────────┐
            │  核心业务    │ │  分析    │ │  系统管理   │
            │  (7个页面)   │ │  (6个)   │ │  (4个)      │
            └──────────────┘ └─────────┘ └─────────────┘
```

## 🔗 核心业务页面数据流

### 1. 项目管理流程

```
┌──────────────┐
│  Dashboard   │  总览仪表盘
│  (首页)      │  - 显示所有项目统计
└──────┬───────┘  - KPI指标
       │          - 项目健康度
       │
       ├─────────────────────────────────────┐
       │                                     │
       ▼                                     ▼
┌──────────────┐                      ┌──────────────┐
│  Projects    │                      │  Templates   │
│  项目列表    │◄─────────────────────│  模板管理    │
└──────┬───────┘  一键创建项目         └──────────────┘
       │
       │ 点击项目卡片
       │
       ▼
┌──────────────────────┐
│ ProjectDetailEnhanced│  项目详情页
│  项目详情增强版      │  - 基本信息
└──────┬───────────────┘  - 甘特图
       │                  - 资源分配
       │                  - 成本分析
       │
       ├──────────────┬──────────────┬──────────────┐
       │              │              │              │
       ▼              ▼              ▼              ▼
┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐
│  Risk    │  │ Resource │  │  Cost    │  │ Gantt    │
│  风险    │  │ 资源     │  │  成本    │  │ 甘特图   │
│  管理    │  │ 分配     │  │  分析    │  │ 视图     │
└──────────┘  └──────────┘  └──────────┘  └──────────┘
```

### 2. 资源管理流程

```
┌──────────────────────┐
│ UnifiedResourcesPage │  统一资源页面
│  资源管理中心        │  - 资源池管理
└──────┬───────────────┘  - 时间线视图
       │                  - 热力图
       │                  - 容量规划
       │
       ├──────────────┬──────────────┬──────────────┐
       │              │              │              │
       ▼              ▼              ▼              ▼
┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐
│ Resource │  │ Capacity │  │ Conflict │  │ Skill    │
│ Detail   │  │ Planning │  │ Detection│  │ Matching │
│ 资源详情 │  │ 容量规划 │  │ 冲突检测 │  │ 技能匹配 │
└──────────┘  └──────────┘  └──────────┘  └──────────┘
       │
       │ 点击项目进度卡片
       │
       ▼
┌──────────────────────┐
│ ProjectDetailEnhanced│  返回项目详情
└──────────────────────┘
```

### 3. 风险管理流程

```
┌──────────────────────┐
│ ProjectDetailEnhanced│  项目详情
└──────┬───────────────┘
       │
       │ 点击"风险管理"
       │
       ▼
┌──────────────────────┐
│  RiskManagement      │  风险管理页面
│  风险管理            │  - 风险矩阵
└──────┬───────────────┘  - 风险列表
       │                  - AI建议
       │                  - 缓解措施
       │
       ├──────────────┬──────────────┬──────────────┐
       │              │              │              │
       ▼              ▼              ▼              ▼
┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐
│  Risk    │  │  Risk    │  │  Risk    │  │  Cross   │
│  Matrix  │  │  Trend   │  │  Heatmap │  │  Project │
│  矩阵    │  │  趋势    │  │  热力图  │  │  分析    │
└──────────┘  └──────────┘  └──────────┘  └──────────┘
```

## 📈 分析决策页面流程

```
┌──────────────┐
│  Dashboard   │  总览仪表盘
└──────┬───────┘
       │
       │ 点击"详细分析"
       │
       ├──────────────┬──────────────┬──────────────┐
       │              │              │              │
       ▼              ▼              ▼              ▼
┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐
│Portfolio │  │   EVM    │  │Dependency│  │   AI     │
│组合分析  │  │挣值分析  │  │依赖分析  │  │决策支持  │
└──────────┘  └──────────┘  └──────────┘  └──────────┘
       │              │              │              │
       │              │              │              │
       └──────────────┴──────────────┴──────────────┘
                              │
                              ▼
                      ┌──────────────┐
                      │   Advanced   │
                      │   Reports    │
                      │  高级报表    │
                      └──────────────┘
```

## 🔄 数据联动关系

### 项目 ↔ 资源

```
Projects ──────────────► UnifiedResourcesPage
  │                           │
  │ 项目ID                    │ 项目筛选
  │                           │
  ▼                           ▼
ProjectDetailEnhanced ◄─── 点击项目卡片
  │
  │ 查看资源分配
  │
  ▼
UnifiedResourcesPage (带项目筛选)
```

### 项目 ↔ 风险

```
ProjectDetailEnhanced ──────► RiskManagement
  │                               │
  │ 项目ID                        │ 风险数据
  │                               │
  └───────────────────────────────┘
         双向数据同步
```

### 项目 ↔ 成本

```
ProjectDetailEnhanced ──────► Cost Analysis
  │                               │
  │ 项目ID                        │ 成本数据
  │                               │
  └───────────────────────────────┘
         实时成本追踪
```

## 📦 数据传递方式

### 1. URL 参数传递 (推荐用于ID)

```tsx
// 跳转
navigate(`/projects/${projectId}`)
navigate(`/projects/${projectId}/risks`)

// 接收
const { projectId } = useParams<{ projectId: string }>();
```

### 2. Query 参数传递 (推荐用于筛选条件)

```tsx
// 跳转
navigate(`/resources?project=${projectId}`)
navigate(`/resources?department=${dept}&skill=${skill}`)

// 接收
const searchParams = new URLSearchParams(location.search);
const projectId = searchParams.get('project');
const department = searchParams.get('department');
```

### 3. 状态管理传递 (推荐用于全局数据)

```tsx
// 使用 Zustand Store
const { projects, updateProject, resourcePool } = useStore();

// 更新项目
updateProject(projectId, { risks: updatedRisks });

// 获取项目
const project = projects.find(p => p.id === projectId);
```

## 🎯 页面跳转规则

### 核心跳转路径

```
1. 项目列表 → 项目详情
   /projects → /projects/:projectId

2. 项目详情 → 风险管理
   /projects/:projectId → /projects/:projectId/risks

3. 项目列表 → 资源页面 (带筛选)
   /projects → /resources?project=:projectId

4. 资源页面 → 项目详情
   /resources → /projects/:projectId

5. 仪表盘 → 分析页面
   /dashboard → /portfolio
   /dashboard → /evm
   /dashboard → /dependencies

6. 项目列表 → 模板管理
   /projects → /projects/templates

7. 任意页面 → 用户工作台
   * → /workbench
```

## 🔍 页面状态同步

### 实时同步的数据

```
┌──────────────┐
│  Zustand     │  全局状态管理
│  Store       │
└──────┬───────┘
       │
       ├─────► projects[]      项目列表
       ├─────► resourcePool[]  资源池
       ├─────► user            当前用户
       ├─────► templates[]     项目模板
       └─────► notifications[] 通知列表
```

### 页面间共享数据

```
Dashboard ◄──────────┐
    │                │
    ▼                │
Projects ◄───────────┤  共享 projects[]
    │                │
    ▼                │
ProjectDetail ◄──────┘

UnifiedResources ◄───┐
    │                │  共享 resourcePool[]
    ▼                │
ResourceDetail ◄─────┘
```

## 📋 页面优先级和依赖关系

### 高优先级页面 (核心功能)

```
1. Dashboard          (依赖: projects, resourcePool)
2. Projects           (依赖: projects, templates)
3. ProjectDetail      (依赖: projects, resourcePool, risks)
4. UnifiedResources   (依赖: resourcePool, projects)
5. RiskManagement     (依赖: projects, risks)
```

### 中优先级页面 (分析功能)

```
6. PortfolioDashboard (依赖: projects)
7. EVMAnalysis        (依赖: projects, costs)
8. AIDecisionDashboard(依赖: projects, resourcePool)
9. AdvancedReports    (依赖: projects, resourcePool, risks)
```

### 低优先级页面 (辅助功能)

```
10. TemplateManager   (依赖: templates)
11. BatchImport       (依赖: projects)
12. UserWorkbench     (依赖: user, projects)
13. Settings          (依赖: user)
```

## 🚀 性能优化建议

### 懒加载页面

```tsx
// App.tsx 中已实现
const Dashboard = lazy(() => import('./pages/Dashboard'));
const Projects = lazy(() => import('./pages/Projects'));
const ProjectDetailEnhanced = lazy(() => import('./pages/ProjectDetailEnhanced'));
```

### 数据缓存策略

```tsx
// 使用 useMemo 缓存计算结果
const topProjects = useMemo(() => {
  return [...projects]
    .sort((a, b) => (b.score || 0) - (a.score || 0))
    .slice(0, 5);
}, [projects]);

// 使用 useCallback 缓存函数
const handleProjectClick = useCallback((projectId: string) => {
  navigate(`/projects/${projectId}`);
}, [navigate]);
```

---

**版本**: 1.0  
**创建时间**: 2025-12-13  
**最后更新**: 2025-12-13  
**负责人**: Antigravity Team
